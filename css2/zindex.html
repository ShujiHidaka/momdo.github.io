<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN">
<html lang="ja">

<HEAD>
<TITLE>Elaborate description of Stacking Contexts</TITLE>
<link rel="stylesheet" href="http://www.w3.org/StyleSheets/TR/W3C-ED.css" type="text/css">
<link rel="stylesheet" href="style/default.css" type="text/css">
<link rel="prev" href="sample.html">
<link rel="next" href="propidx.html">
<link rel="contents" href="cover.html#minitoc">
<link rel="CSS-properties" href="propidx.html" title="properties">
<link rel="index" href="indexlist.html" title="index">
<link rel="first" href="cover.html">

</HEAD>
<BODY>
<div class="navbar">
<p><a href="sample.html">前章</a> &nbsp; <a href="propidx.html">次章</a> &nbsp; <a href="cover.html#minitoc">目次</a> &nbsp; <a href="propidx.html">プロパティー</a> &nbsp; <a href="indexlist.html">索引</a> &nbsp;
</div>
<hr class="navbar">

<H1><a name="q0">付録 E. スタックコンテキストの詳説</a></H1>
<div class="subtoc">
<p><strong>目次</strong>
  <ul class="toc">
    <li class="tocline2"><a href="zindex.html#stacking-defs" class="tocxref">E.1 定義</a>
    </li><li class="tocline2"><a href="zindex.html#painting-order" class="tocxref">E.2 描画順序</a>
    </li><li class="tocline2"><a href="zindex.html#stacking-notes" class="tocxref">E.3 ノート</a>
  </li></ul>
</div>


<p>この章では、仕様の残りにおける説明よりも詳細にCSS&nbsp;2.2描画順序を定義する。</p>

<h2>E.1 <a name="stacking-defs">定義</a></h2>

<dl>

<dt>ツリー順</dt>

<dd>周りのボックスを移動するプロパティーを考慮した後、双方向のコンテンツのに対する論理的な（視覚でない）順序で、レンダリング<em>ツリー</em>の先行順に深さ探索すること。</dd>

<dt>要素</dt>

<dd>この説明において"要素"は、実際の要素、疑似要素、および匿名ボックスを指す。疑似要素および匿名ボックスは、適切な場所で子孫として扱われる。たとえば、外側のリストマーカーはラインボックスに隣接する':before'ボックスの前に来るが、これは、ボックスコンテンツの前に来る、など。</dd>

</dl>

<h2>E.2 <a name="painting-order">描画順序</a></h2>

    <p>スタックの最下部はユーザーから最も遠いが、スタックの最上位はユーザーに最も近い：

<pre>
	     |	   |	     |	  |
	     |		|    |	  |	⇦ ☻
	     |		|	  |	ユーザー
z-index:  canvas  -1	0    1	  2
</pre>

    <p>スタックコンテキストの背景と最も負の位置のスタックコンテキストは、スタックの下部にあり、一方最も正の位置のスタックコンテキストはスタックの最上位にある。

    <p>別の内側に含まれる場合はキャンバスは透明であり、そうでない場合はユーザーエージェント定義の色が与えられる。範囲内で無限大であり、かつルート要素を含む。初めに、ビューポートは、キャンバスの原点で左上隅で固定される。

    <p>スタックコンテキスト（ <a href="visuren.html#propdef-z-index" class="noxref"><span
    class="propinst-z-index">'z-index'</span></a>プロパティーを参照）を生成する要素の子孫の塗装順序は次のとおり：

    <ol class=stack>
      <li>
	<p>要素がルート要素である場合：
	<ol>
	  <li>全キャンバス上の要素の背景色。

	  </li><li>ルート要素に塗装された場合、全キャンバスの上に、使用される原点に固定される要素の背景画像。
	</li></ol>

      </li><li>
	<p>要素が、ブロック、リスト項目、または他のブロックと等価である場合：
	<ol>
	  <li>ルート要素である場合を除き、要素の背景色。

	  </li><li>ルート要素である場合を除き、要素の背景画像。

	  </li><li>要素のボーダー。
	</li></ol>

	<p>そうでなければ、要素がブロックレベルのテーブルである場合：
	<ol>
	  <li>ルート要素である場合を除き、テーブルの背景（色、次に画像）。
	  </li><li>列グループの背景（色、次に画像）。
	  </li><li>列の背景（色、次に画像）。
	  </li><li>行グループの背景（色、次に画像）。
	  </li><li>行の背景（色、次に画像）。
	  </li><li>セルの背景（色、次に画像）。
	  </li><li>すべてのテーブルのボーダー（分離ボーダーによるツリー順で）。
	</li></ol>

      </li><li>
	<p>z-index順（最も負のものが最初）でz-index（0を除く）とともに配置される子孫によって形成されるスタックコンテキスト、次にツリー順。

      </li><li>
	<p>要素が、ブロック、リスト項目、または他のブロックと等価である場合、ツリーの順でほとんどすべてのフロー内、非配置、ブロックレベルの子孫：
	<ol>
	  <li>要素の背景色。
	  </li><li>要素の背景画像。
	  </li><li>要素のボーダー。
	</li></ol>

	<p>そうでなければ、要素がテーブルである：
	<ol>
	  <li>テーブルの背景（色、次に画像）。
	  </li><li>列グループの背景（色、次に画像）。
	  </li><li>列の背景（色、次に画像）。
	  </li><li>行グループの背景（色、次に画像）。
	  </li><li>行の背景（色、次に画像）。
	  </li><li>セルの背景（色、次に画像）。
	  </li><li>すべてのテーブルのボーダー（分離ボーダーによるツリー順で）。
	</li></ol>

      </li><li>
	<p>ツリー順で、すべての非配置浮動子孫。これらのいずれかそれぞれについて、あたかも新しいスタックコンテキストを作成したかのように要素を扱うが、任意の配置される子孫および実際に新しいスタックコンテキストを作成する子孫は、新しいスタックコンテキストではなく、親スタックコンテキストの一部と見なされるべきである。

      </li><li>
	<p>要素がスタックコンテキストを生成するインライン要素である場合：
	<ol>
	  <li>
	    <p>要素であるそれぞれの行ボックスの場合：
	    <ol>
	      <li>その行ボックスにおける要素のボックスに対して<a href="#each-box">7.2.1</a>にジャンプする（ツリー順に）。
	    </li></ol>
	</li></ol>

      </li><li>
	<p>そうでなければ、最初に要素に対して、次にすべてのフロー、非配置、ブロックレベルの子孫のツリー順に：
	<ol>
	  <li>
	    <p>要素がブロックレベル置換要素の場合、分割不能な置換コンテンツ。

	  </li><li>
	    <p>そうでなければ、その要素の各行ボックスに対して：
	    <ol>
	      <li id=each-box>
		<p>その行ボックスで、ツリー順でその要素の子である各行ボックスに対して：
		<ol>
		  <li>
		    <p>要素の背景色。
		  </li><li>
		    <p>要素の背景画像。
		  </li><li>
		    <p>要素のボーダー。
		  </li><li>
		    <p>インライン要素に対して：
		    <ol>
		      <li>
			<p>すべての要素のフロー内、非配置、この行のボックスにあるインラインレベルの子、この行のボックス上にある要素内のテキストのすべての実行、ツリーの順序で：
			<ol>
			  <li>
			    <p>これがテキストの続きである場合：
			    <ol>
			      <li>下線を適用する要素のツリー順で、要素のテキストに影響を与える下線（もしあれば、最も深い要素の下線が最上位で描かれ、かつ、もしあれば、ルート要素の下線が上記の手順でなく、一番下で描画されるような）。

			      </li><li>上線を適用する要素のツリー順で、要素のテキストに影響を与える上線（もしあれば、最も深い要素の上線が最上位で描かれ、かつ、もしあれば、ルート要素の上線が一番下で描画されるような）。

			      </li><li>テキスト。

			      </li><li>中央線を適用する要素のツリー順で、要素のテキストに影響を与える中央線（もしあれば、最も深い要素の中央線が最上位とルート要素の中央線を描かれているような、もしあれば、一番下の描画されるような）。
			    </li></ol>

			  </li><li>
			    <p>そうでなければ、その要素に対して<a
			    href="#each-box">7.2.1</a>にジャンプする。
			</li></ol>
		    </li></ol>

		    <p>インラインブロックおよびインラインテーブル要素に対して：
		    <ol>
		      <li>これらのいずれかそれぞれについて、あたかも新しいスタックコンテキストを作成したかのように要素を扱うが、任意の配置される子孫および実際に新しいスタックコンテキストを作成する子孫は、新しいスタックコンテキストではなく、親スタックコンテキストの一部と見なされるべきである。
		    </li></ol>

		    <p>インラインレベル置換要素に対して：
		    <ol>
		      <li>分割不能な、置換コンテンツ。
		    </li></ol>
		</li></ol>

		<p class=note>ボックスの一部は、行分割またはUnicode双方向アルゴリズムによって生成されていてもよい。

	      </li><li>
		<p>必要に応じて、要素のアウトライン（<a
		href="#outlines">下記10</a>を参照）。
	    </li></ol>

	  </li><li>
	    <p>必要に応じて、要素がブロックレベルであれば、要素のアウトライン（<a href="#outlines">下記10</a>を参照）。
	</li></ol>

      </li><li>
	<p>ツリー順で、'z-index: auto'または 'z-index: 0'をもつすべての配置子孫。'z-index: auto'をもつ子孫に対して、あたかも新しいスタックコンテキストを作成したかのように要素を扱うが、任意の配置される子孫および実際に新しいスタックコンテキストを作成する子孫は、新しいスタックコンテキストではなく、親スタックコンテキストの一部と考慮されるべきである。'z-index: 0'をもつこれらに対して、分割不能な生成スタックコンテキストを扱う。

      </li><li>
	<p>z-index順（最小が最初）で1以上のz-indexをもつ配置される子孫によって形成されるスタックコンテキスト。

      </li><li id=outlines>
	<p>最後に、上記の手順でアウトラインを描画しない実装は、この段階でこのスタックコンテキストからアウトラインを描画しなければならない。（上記の手順でなく、この手順でアウトラインの描画を推奨する。）
    </li></ol>

    <h2>E.3 <a name="stacking-notes">ノート</a></h2>

    <p>ルート要素の背景は、全体のキャンバスの上に一度だけ描かれる。

    <p>双方向のインラインの背景はツリー順で描かれる一方、視覚的な順序で配置される。インライン背景の配置はCSS&nbsp;2.2で指定されないので、これら2つの要件の正確な結果は、ユーザーエージェント定義である。CSS3は、詳細にこれを定義するかもしれない。

<hr class="navbar">

<div class="navbar">
<p><a href="sample.html">前章</a> &nbsp; <a href="propidx.html">次章</a> &nbsp; <a href="cover.html#minitoc">目次</a> &nbsp; <a href="propidx.html">プロパティー</a> &nbsp; <a href="indexlist.html">索引</a> &nbsp;
</div>
</BODY>
</HTML>
