<!DOCTYPE html><html class=split lang=ja><meta charset=utf-8><meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name=viewport><title>HTML Standard 日本語訳</title><meta content=#3c790a name=theme-color>
<script defer="" src=https://resources.whatwg.org/dfn.js></script>
<script data-file-issue-url=https://github.com/momdo/momdo.github.io/issues/new defer="" src=https://resources.whatwg.org/file-issue.js></script>
<script>
   function F( /* varargs... */) {
     var fragment = document.createDocumentFragment();
     for (var index = 0; index < arguments.length; index += 1) {
       if (arguments[index] instanceof Array) {
         fragment.appendChild(F.apply(this, arguments[index]));
       } else if (typeof arguments[index] == 'string') {
         fragment.appendChild(document.createTextNode(arguments[index]));
       } else {
         fragment.appendChild(arguments[index]);
       }
     }
     return fragment;
   }
   function E(name, /* optional */ attributes /*, varargs... */) {
     var element = document.createElement(name);
     var index = 1;
     if ((arguments.length > 1) && (typeof attributes != 'string') &&
         (!(attributes instanceof Node)) && (!(attributes instanceof Array))) {
       for (var attName in attributes) {
         if (typeof attributes[attName] == 'boolean') {
           if (attributes[attName])
             element.setAttribute(attName, '');
         } else if (typeof attributes[attName] == 'function') {
           element[attName] = attributes[attName];
         } else {
           element.setAttribute(attName, attributes[attName]);
         }
       }
       index = 2;
     }
     for (; index < arguments.length; index += 1) {
       if (arguments[index] instanceof Array) {
         element.appendChild(F.apply(this, arguments[index]));
       } else if (typeof arguments[index] == 'string') {
         element.appendChild(document.createTextNode(arguments[index]));
       } else {
         element.appendChild(arguments[index]);
       }
     }
     return element;
   }
   var currentAlert;
   var currentAlertTimeout;
   function showAlert(s, href) {
     if (!currentAlert) {
       currentAlert = document.createElement('div');
       currentAlert.id = 'alert';
       var x = document.createElement('button');
       x.textContent = '\u2573';
       x.onclick = closeAlert2;
       currentAlert.appendChild(x);
       currentAlert.appendChild(document.createElement('span'));
       currentAlert.onmousemove = function () {
         clearTimeout(currentAlertTimeout);
         currentAlert.className = '';
         currentAlertTimeout = setTimeout(closeAlert, 10000);
       }
       document.body.appendChild(currentAlert);
     } else {
       clearTimeout(currentAlertTimeout);
       currentAlert.className = '';
     }
     currentAlert.lastChild.textContent = '';
     currentAlert.lastChild.appendChild(F(s));
     if (href) {
       var link = document.createElement('a');
       link.href = href;
       link.textContent = href;
       currentAlert.lastChild.appendChild(F(' ', link));
     }
     currentAlertTimeout = setTimeout(closeAlert, 10000);
   }
   function closeAlert() {
     clearTimeout(currentAlertTimeout);
     if (currentAlert) {
       currentAlert.className = 'closed';
       currentAlertTimeout = setTimeout(closeAlert2, 3000);
     }
   }
   function closeAlert2() {
     clearTimeout(currentAlertTimeout);
     if (currentAlert) {
       currentAlert.parentNode.removeChild(currentAlert);
       currentAlert = null;
     }
   }
   window.addEventListener('keydown', function (event) {
     if (event.keyCode == 27) {
       if (currentAlert)
         closeAlert2();
     } else {
       closeAlert();
     }
   }, false);
   window.addEventListener('scroll', function (event) {
     closeAlert();
   }, false);

   var startedInit = 0;
   function init() {
     startedInit = 1;
   }
   if (document.documentElement.className == "")
     setTimeout(function () {
       if (!startedInit)
         showAlert("Too slow? Try reading the multipage copy of the spec instead:", "https://whatwg.org/html");
     }, 6000);

   window.addEventListener('keypress', function (event) {
     if ((event.which == 114) && (event.metaKey)) {
       if (!confirm('Are you sure you want to reload this page?'))
         event.preventDefault();
     }
   }, false);
  </script>
<script>
   function toggleStatus(div) {
     div.parentNode.classList.toggle('wrapped');
   }
  </script><link rel=stylesheet href=https://resources.whatwg.org/standard.css><link rel=icon href=https://resources.whatwg.org/logo.svg>
<style>
   [hidden] { display: none; }

   .proposal { border: blue solid; padding: 1em; }
   .bad, .bad *:not(.X\58X) { color: gray; border-color: gray; background: transparent; }
   #updatesStatus { display: none; z-index: 10; }
   #updatesStatus.relevant { display: block; position: fixed; right: 1em; top: 1em; padding: 0.5em; font: bold small sans-serif; min-width: 25em; width: 30%; max-width: 40em; height: auto; border: ridge 4px gray; background: #EEEEEE; color: black; }
   div.head .logo { width: 11em; margin-bottom: 20em; }

   #configUI { position: absolute; z-index: 20; top: auto; right: 0; width: 11em; padding: 0 0.5em 0 0.5em; font-size: small; background: gray; background: rgba(32,32,32,0.9); color: white; border-radius: 0.5em 0 0 0.5em; }
   #configUI p { margin: 0.75em 0; padding: 0.3em; }
   #configUI p label { display: block; }
   #configUI #updateUI, #configUI .loginUI { text-align: center; }
   #configUI input[type=button] { display: block; margin: auto; }
   #configUI :link, #configUI :visited { color: white; }
   #configUI :link:hover, #configUI :visited:hover { background: transparent; }

   #alert { position: fixed; top: 20%; left: 20%; right: 20%; font-size: 2em; padding: 0.5em; z-index: 40; background: gray; background: rgba(32,32,32,0.9); color: white; border-radius: 0.5em; transition: opacity 1s linear; }
   #alert.closed { opacity: 0; }
   #alert button { position: absolute; top: -1em; right: 2em; border-radius: 0.5em 0.5em 0 0; border: none; line-height: 0.9; color: white; background: rgb(64,64,64); font-size: 0.6em; font-weight: 900; cursor: pointer; padding: 0.25em; }
   #alert :link, #alert :visited { color: white; text-decoration: underline; }
   #alert :link:hover, #alert :visited:hover { background: transparent; }

   @media print { #configUI, #alert { display: none; } }

   .fingerprint { position: absolute; right: 0; z-index: 5; }
   @media (max-width: 767px) {
     .fingerprint { max-width: 35px; }
   }

   .status { font: 1em sans-serif; width: 9em; padding: 0.3em; position: absolute; z-index: 8; top: auto; right: 0.3em; background: #EEE; color: black; box-shadow: 0 0 3px #999; overflow: hidden; margin: -2em 0 0 0; border-collapse: initial; border-spacing: initial; }
   .status.wrapped { width: 1em; height: 1em; }
   .status.wrapped > :not(input) { display: none; }
   .status > input { position: absolute; right: 0; top: 0; width: 1em; height: 1em; border: none; background: transparent; padding: 0; margin: 0; }
   .status > p { font-size: 0.6em; margin: 0; padding: 0; }
   .status > p + p { padding-top: 0.5em; }
   .status > .support { display: block; }
   .status > .support > span { padding: 0.2em 0; display: block; display: table; }
   .status > .support > span.partial { color: #666666; filter: grayscale(50%); }
   .status > .support > span.no { color: #CCCCCC; filter: grayscale(100%); }
   .status > .support > span:first-of-type { padding-top: 0.5em; }
   .status > .support > span > span { padding: 0 0.5em; display: table-cell; vertical-align: top; }
   .status > .support > span > span:first-child { width: 100%; }
   .status > .support > span > span:last-child { width: 100%; white-space: pre; padding: 0; }
   .status > .support > span::before { content: ' '; display: table-cell; min-width: 1.5em; height: 1.5em; background: no-repeat center center; background-size: contain; text-align: right; font-size: 0.75em; font-weight: bold; }
   .status > .support > .and_chr::before { background-image: url(https://resources.whatwg.org/browser-logos/chrome-android.png); }
   .status > .support > .and_ff::before { background-image: url(https://resources.whatwg.org/browser-logos/firefox.png); }
   .status > .support > .and_uc::before { background-image: url(https://resources.whatwg.org/browser-logos/uc.png); } /* UC Browser for Android */
   .status > .support > .android::before { background-image: url(https://resources.whatwg.org/browser-logos/android.svg); }
   .status > .support > .bb::before { background-image: url(https://resources.whatwg.org/browser-logos/bb.jpg); } /* Blackberry Browser */
   .status > .support > .chrome::before { background-image: url(https://resources.whatwg.org/browser-logos/chrome.png); }
   .status > .support > .firefox::before { background-image: url(https://resources.whatwg.org/browser-logos/firefox.png); }
   .status > .support > .ie::before { background-image: url(https://resources.whatwg.org/browser-logos/ie.png); }
   .status > .support > .ie_mob::before { background-image: url(https://resources.whatwg.org/browser-logos/ie-mobile.svg); }
   .status > .support > .ios_saf::before { background-image: url(https://resources.whatwg.org/browser-logos/safari-ios.svg); }
   .status > .support > .op_mini::before { background-image: url(https://resources.whatwg.org/browser-logos/opera-mobile.png); }
   .status > .support > .op_mob::before { background-image: url(https://resources.whatwg.org/browser-logos/opera-mobile.png); }
   .status > .support > .opera::before { background-image: url(https://resources.whatwg.org/browser-logos/opera.png); }
   .status > .support > .safari::before { background-image: url(https://resources.whatwg.org/browser-logos/safari.png); }
   .status > .caniuse { text-align: right; font-style: italic; }

   @media (max-width: 767px) {
     .status.wrapped { width: 9em; height: auto; }
     .status:not(.wrapped) { width: 1em; height: 1em; }
     .status.wrapped > :not(input) { display: block; }
     .status:not(.wrapped) > :not(input) { display: none; }
   }

   .panel { position: fixed; z-index: 30; top: 10%; left: 0; margin: auto; right: 0; width: 35em; border: double thick; background: #EEEEEE; color: black; padding: 1em; font: 1em sans-serif; max-height: 70%; overflow: auto; }
   .panel h2 { margin: 0; text-align: center; }
   .panel ul { min-height: 6em; }
   .panel p { text-align: right; margin: 0; }
   .panel form { background: transparent; color: black; margin: 0.5em -0.5em 1em; padding: 0.5em; }
   .panel form.changed { background: yellow; color: black; }
   .panel form p { text-align: left; margin: 1em 0 0; }
   .panel form p:first-child { margin-top: 0; }
   .panel form p:last-child { margin-bottom: 0; }
   .panel form p textarea { width: 100% /* TODO: need the keyword that makes it fit to the parent here */; min-height: 4em; display: block; }
   .panel form dl { line-height: 1.5em; }
   .panel form dt { display: inline-block; width: 20em; white-space: nowrap; text-align: right; font-weight: normal; margin: 0; padding: 0; }
   .panel form dd { display: inline; margin: 0 0 0 1em; padding: 0; }
   .panel form dd:after { display: block; }
   ul.checkboxes { list-style-type: none; }
   .progress { text-decoration: blink; }

   .applies .yes, .yesno .yes { background: yellow; }
   .yesno .yes, .yesno .no { text-align: center; }
  </style>
<style>
   .applies thead th > * { display: block; }
   .applies thead code { display: block; }
   .applies td { text-align: center; }

   .matrix, .matrix td { border: hidden; text-align: right; }
   .matrix { margin-left: 2em; }

   .vertical-summary-table tr > th[rowspan="2"]:first-child + th,
   .vertical-summary-table tr > td[rowspan="2"]:first-child + td { border-bottom: hidden; }

   .dice-example { border-collapse: collapse; border-style: hidden solid solid hidden; border-width: thin; margin-left: 3em; }
   .dice-example caption { width: 30em; font-size: smaller; font-style: italic; padding: 0.75em 0; text-align: left; }
   .dice-example td, .dice-example th { border: solid thin; width: 1.35em; height: 1.05em; text-align: center; padding: 0; }

   td.eg { border-width: thin; text-align: center; }

   #table-example-1 { border: solid thin; border-collapse: collapse; margin-left: 3em; }
   #table-example-1 caption { padding-bottom: 0.5em; }
   #table-example-1 thead, #table-example-1 tbody { border: none; }
   #table-example-1 th, #table-example-1 td { border: solid thin; }
   #table-example-1 th { font-weight: normal; }
   #table-example-1 td { border-style: none solid; vertical-align: top; }
   #table-example-1 th { padding: 0.5em; vertical-align: middle; text-align: center; }
   #table-example-1 tbody tr:first-child td { padding-top: 0.5em; }
   #table-example-1 tbody tr:last-child td { padding-bottom: 1.5em; }
   #table-example-1 tbody td:first-child { padding-left: 2.5em; padding-right: 0; width: 9em; }
   #table-example-1 tbody td:first-child::after { content: leader(". "); }
   #table-example-1 tbody td { padding-left: 2em; padding-right: 2em; }
   #table-example-1 tbody td:first-child + td { width: 10em; }
   #table-example-1 tbody td:first-child + td ~ td { width: 2.5em; }
   #table-example-1 tbody td:first-child + td + td + td ~ td { width: 1.25em; }

   .apple-table-examples { border: none; border-collapse: separate; border-spacing: 1.5em 0em; width: 40em; margin-left: 3em; }
   .apple-table-examples * { font-family: "Times", serif; }
   .apple-table-examples td, .apple-table-examples th { border: none; white-space: nowrap; padding-top: 0; padding-bottom: 0; }
   .apple-table-examples tbody th:first-child { border-left: none; width: 100%; }
   .apple-table-examples thead th:first-child ~ th { font-size: smaller; font-weight: bolder; border-bottom: solid 2px; text-align: center; }
   .apple-table-examples tbody th::after, .apple-table-examples tfoot th::after { content: leader(". ") }
   .apple-table-examples tbody th, .apple-table-examples tfoot th { font: inherit; text-align: left; }
   .apple-table-examples td { text-align: right; vertical-align: top; }
   .apple-table-examples.e1 tbody tr:last-child td { border-bottom: solid 1px; }
   .apple-table-examples.e1 tbody + tbody tr:last-child td { border-bottom: double 3px; }
   .apple-table-examples.e2 th[scope=row] { padding-left: 1em; }
   .apple-table-examples sup { line-height: 0; }

   .three-column-nowrap tr > td:first-child,
   .three-column-nowrap tr > td:first-child + td,
   .three-column-nowrap tr > td:first-child + td + td { white-space: nowrap; }

   .details-example img { vertical-align: top; }

   #base64-table {
     white-space: nowrap;
     font-size: 0.6em;
     column-width: 6em;
     column-count: 5;
     column-gap: 1em;
     -moz-column-width: 6em;
     -moz-column-count: 5;
     -moz-column-gap: 1em;
     -webkit-column-width: 6em;
     -webkit-column-count: 5;
     -webkit-column-gap: 1em;
   }
   #base64-table thead { display: none; }
   #base64-table * { border: none; }
   #base64-table tbody td:first-child:after { content: ':'; }
   #base64-table tbody td:last-child { text-align: right; }

   #named-character-references-table {
     white-space: nowrap;
     font-size: 0.6em;
     column-width: 30em;
     column-gap: 1em;
     -moz-column-width: 30em;
     -moz-column-gap: 1em;
     -webkit-column-width: 30em;
     -webkit-column-gap: 1em;
   }
   #named-character-references-table > table > tbody > tr > td:first-child + td,
   #named-character-references-table > table > tbody > tr > td:last-child { text-align: center; }
   #named-character-references-table > table > tbody > tr > td:last-child:hover > span { position: absolute; top: auto; left: auto; margin-left: 0.5em; line-height: 1.2; font-size: 5em; border: outset; padding: 0.25em 0.5em; background: white; width: 1.25em; height: auto; text-align: center; }
   #named-character-references-table > table > tbody > tr#entity-CounterClockwiseContourIntegral > td:first-child { font-size: 0.5em; }

   .glyph.control { color: red; }
  </style>
<style>
   #table-example-1 * { font-family: "Essays1743", serif; line-height: 1.01em; }
   @font-face {
     font-family: 'Essays1743';
     src: url('/fonts/Essays1743.ttf');
   }
   @font-face {
     font-family: 'Essays1743';
     font-weight: bold;
     src: url('/fonts/Essays1743-Bold.ttf');
   }
   @font-face {
     font-family: 'Essays1743';
     font-style: italic;
     src: url('/fonts/Essays1743-Italic.ttf');
   }
   @font-face {
     font-family: 'Essays1743';
     font-style: italic;
     font-weight: bold;
     src: url('/fonts/Essays1743-BoldItalic.ttf');
   }
  </style>
<script src=link-fixup.js></script>
<body onload=init()>
  <header id=head class="head with-buttons">
   <p><a href=https://whatwg.org/ class=logo><img alt=WHATWG src=https://resources.whatwg.org/logo.svg width=100 height=100></a></p>
   <hgroup><h1 class=allcaps>HTML</h1><h2 id=living-standard class="no-num no-toc">Living Standard — Last Updated <span class=pubdate>16 May 2016</span></h2></hgroup>
   
   
  </header>

  

  

  
  

  
  

  

  <nav><a href=interaction.html>← 6 ユーザーとの対話処理</a> — <a href=index.html>目次</a> — <a href=webappapis.html>8 ウェブアプリケーションAPI →</a></nav><ol class=toc><li id=toc-browsers><a href=browsers.html#browsers>7 ウェブページの読み込み</a><ol><li><a href=browsers.html#windows>7.1 ブラウジングコンテキスト</a><ol><li><a href=browsers.html#nested-browsing-contexts>7.1.1 ネストされたブラウジングコンテキスト</a><ol><li><a href=browsers.html#navigating-nested-browsing-contexts-in-the-dom>7.1.1.1 DOM内でネストされたブラウジングコンテキストを操作する</a></li></ol></li><li><a href=browsers.html#auxiliary-browsing-contexts>7.1.2 補助ブラウジングコンテキスト</a><ol><li><a href=browsers.html#navigating-auxiliary-browsing-contexts-in-the-dom>7.1.2.1 DOM内の補助ブラウジングコンテキストを操作する</a></li></ol></li><li><a href=browsers.html#security-nav>7.1.3 セキュリティー</a></li><li><a href=browsers.html#groupings-of-browsing-contexts>7.1.4 Groupings of browsing contexts</a></li><li><a href=browsers.html#browsing-context-names>7.1.5 ブラウジングコンテキスト名</a></li><li><a href=browsers.html#script-settings-for-browsing-contexts>7.1.6 Script settings for browsing contexts</a></li></ol></li><li><a href=browsers.html#cross-origin-objects>7.2 Security infrastructure for <code>Window</code>,
  <code>WindowProxy</code>, and <code>Location</code> objects</a><ol><li><a href=browsers.html#integration-with-idl>7.2.1 Integration with IDL</a></li><li><a href=browsers.html#shared-internal-slot:-[[crossoriginpropertydescriptormap]]>7.2.2 Shared internal slot: [[CrossOriginPropertyDescriptorMap]]</a></li><li><a href=browsers.html#shared-abstract-operations>7.2.3 Shared abstract operations</a><ol><li><a href=browsers.html#crossoriginproperties-(-o-)>7.2.3.1 CrossOriginProperties ( <var>O</var> )</a></li><li><a href=browsers.html#isplatformobjectsameorigin-(-o-)>7.2.3.2 IsPlatformObjectSameOrigin ( <var>O</var> )</a></li><li><a href=browsers.html#crossorigingetownpropertyhelper-(-o,-p-)>7.2.3.3 CrossOriginGetOwnPropertyHelper ( <var>O</var>, <var>P</var> )</a><ol><li><a href=browsers.html#crossoriginpropertydescriptor-(-crossoriginproperty,-originaldesc-)>7.2.3.3.1 CrossOriginPropertyDescriptor ( <var>crossOriginProperty</var>,
  <var>originalDesc</var> )</a></li><li><a href=browsers.html#crossoriginfunctionwrapper-(-needswrapping,-functiontowrap-)>7.2.3.3.2 CrossOriginFunctionWrapper ( <var>needsWrapping</var>, <var>functionToWrap</var>
  )</a></li></ol></li><li><a href=browsers.html#crossoriginget-(-o,-p,-receiver-)>7.2.3.4 CrossOriginGet ( <var>O</var>, <var>P</var>, <var>Receiver</var> )</a></li><li><a href=browsers.html#crossoriginset-(-o,-p,-v,-receiver-)>7.2.3.5 CrossOriginSet ( <var>O</var>, <var>P</var>, <var>V</var>,
  <var>Receiver</var> )</a></li><li><a href=browsers.html#crossoriginownpropertykeys-(-o-)>7.2.3.6 CrossOriginOwnPropertyKeys ( <var>O</var> )</a></li></ol></li></ol></li><li><a href=browsers.html#the-window-object>7.3 <code>Window</code>オブジェクト</a><ol><li><a href=browsers.html#apis-for-creating-and-navigating-browsing-contexts-by-name>7.3.1 名前でブラウジングコンテキストを作成および操作するためのAPI</a></li><li><a href=browsers.html#accessing-other-browsing-contexts>7.3.2 他のブラウジングコンテキストへのアクセス</a></li><li><a href=browsers.html#named-access-on-the-window-object>7.3.3 <code>Window</code>オブジェクトの名前付きアクセス</a></li><li><a href=browsers.html#garbage-collection-and-browsing-contexts>7.3.4 Garbage collection and browsing contexts</a></li><li><a href=browsers.html#closing-browsing-contexts>7.3.5 ブラウジングコンテキストを閉じる</a></li><li><a href=browsers.html#browser-interface-elements>7.3.6 ブラウザーインターフェイス要素</a></li></ol></li><li><a href=browsers.html#the-windowproxy-exotic-object>7.4 The <code>WindowProxy</code> exotic object</a><ol><li><a href=browsers.html#windowproxy-getprototypeof>7.4.1 [[GetPrototypeOf]] ( )</a></li><li><a href=browsers.html#windowproxy-setprototypeof>7.4.2 [[SetPrototypeOf]] ( <var>V</var> )</a></li><li><a href=browsers.html#windowproxy-isextensible>7.4.3 [[IsExtensible]] ( )</a></li><li><a href=browsers.html#windowproxy-preventextensions>7.4.4 [[PreventExtensions]] ( )</a></li><li><a href=browsers.html#windowproxy-getownproperty>7.4.5 [[GetOwnProperty]] ( <var>P</var> )</a></li><li><a href=browsers.html#windowproxy-defineownproperty>7.4.6 [[DefineOwnProperty]] ( <var>P</var>, <var>Desc</var>
  )</a></li><li><a href=browsers.html#windowproxy-get>7.4.7 [[Get]] ( <var>P</var>, <var>Receiver</var> )</a></li><li><a href=browsers.html#windowproxy-set>7.4.8 [[Set]] ( <var>P</var>, <var>V</var>, <var>Receiver</var> )</a></li><li><a href=browsers.html#windowproxy-delete>7.4.9 [[Delete]] ( <var>P</var> )</a></li><li><a href=browsers.html#windowproxy-ownpropertykeys>7.4.10 [[OwnPropertyKeys]] ( )</a></li></ol></li><li><a href=browsers.html#origin>7.5 生成元</a><ol><li><a href=browsers.html#relaxing-the-same-origin-restriction>7.5.1 同一生成元制限を緩和する</a></li></ol></li><li><a href=browsers.html#sandboxing>7.6 サンドボックス</a></li><li><a href=browsers.html#history>7.7 セッション履歴およびナビゲーション</a><ol><li><a href=browsers.html#the-session-history-of-browsing-contexts>7.7.1 ブラウジングコンテキストのセッション履歴</a></li><li><a href=browsers.html#the-history-interface>7.7.2 <code>History</code>インターフェイス</a></li><li><a href=browsers.html#history-notes>7.7.3 Implementation notes for session history</a></li><li><a href=browsers.html#the-location-interface>7.7.4 <code>Location</code>インターフェイス</a><ol><li><a href=browsers.html#location-getprototypeof>7.7.4.1 [[GetPrototypeOf]] ( )</a></li><li><a href=browsers.html#location-setprototypeof>7.7.4.2 [[SetPrototypeOf]] ( <var>V</var> )</a></li><li><a href=browsers.html#location-isextensible>7.7.4.3 [[IsExtensible]] ( )</a></li><li><a href=browsers.html#location-preventextensions>7.7.4.4 [[PreventExtensions]] ( )</a></li><li><a href=browsers.html#location-getownproperty>7.7.4.5 [[GetOwnProperty]] ( <var>P</var> )</a></li><li><a href=browsers.html#location-defineownproperty>7.7.4.6 [[DefineOwnProperty]] ( <var>P</var>, <var>Desc</var> )</a></li><li><a href=browsers.html#location-get>7.7.4.7 [[Get]] ( <var>P</var>, <var>Receiver</var> )</a></li><li><a href=browsers.html#location-set>7.7.4.8 [[Set]] ( <var>P</var>, <var>V</var>, <var>Receiver</var> )</a></li><li><a href=browsers.html#location-delete>7.7.4.9 [[Delete]] ( <var>P</var> )</a></li><li><a href=browsers.html#location-ownpropertykeys>7.7.4.10 [[OwnPropertyKeys]] ( )</a></li></ol></li></ol></li><li><a href=browsers.html#browsing-the-web>7.8 ウェブを閲覧する</a><ol><li><a href=browsers.html#navigating-across-documents>7.8.1 Navigating across documents</a></li><li><a href=browsers.html#read-html>7.8.2 Page load processing model for HTML files</a></li><li><a href=browsers.html#read-xml>7.8.3 Page load processing model for XML files</a></li><li><a href=browsers.html#read-text>7.8.4 Page load processing model for text files</a></li><li><a href=browsers.html#read-multipart-x-mixed-replace>7.8.5 Page load processing model for <code>multipart/x-mixed-replace</code> resources</a></li><li><a href=browsers.html#read-media>7.8.6 Page load processing model for media</a></li><li><a href=browsers.html#read-plugin>7.8.7 Page load processing model for content that uses plugins</a></li><li><a href=browsers.html#read-ua-inline>7.8.8 Page load processing model for inline
  content that doesn't have a DOM</a></li><li><a href=browsers.html#scroll-to-fragid>7.8.9 Navigating to a fragment</a></li><li><a href=browsers.html#history-traversal>7.8.10 履歴走査</a><ol><li><a href=browsers.html#persisted-user-state-restoration>7.8.10.1 Persisted user state restoration</a></li><li><a href=browsers.html#the-popstateevent-interface>7.8.10.2 <code>PopStateEvent</code>インターフェイス</a></li><li><a href=browsers.html#the-hashchangeevent-interface>7.8.10.3 <code>HashChangeEvent</code>インターフェイス</a></li><li><a href=browsers.html#the-pagetransitionevent-interface>7.8.10.4 <code>PageTransitionEvent</code>インターフェイス</a></li></ol></li><li><a href=browsers.html#unloading-documents>7.8.11 文書の解放</a><ol><li><a href=browsers.html#the-beforeunloadevent-interface>7.8.11.1 <code>BeforeUnloadEvent</code>インターフェイス</a></li></ol></li><li><a href=browsers.html#aborting-a-document-load>7.8.12 Aborting a document load</a></li></ol></li><li><a href=browsers.html#offline>7.9 オフラインウェブアプリケーション</a><ol><li><a href=browsers.html#introduction-9>7.9.1 導入</a><ol><li><a href=browsers.html#supporting-offline-caching-for-legacy-applications>7.9.1.1 レガシーアプリケーションへのオフラインキャッシュのサポート</a></li><li><a href=browsers.html#appcacheevents>7.9.1.2 イベントの概要</a></li></ol></li><li><a href=browsers.html#appcache>7.9.2 Application caches</a></li><li><a href=browsers.html#manifests>7.9.3 キャッシュマニフェスト構文</a><ol><li><a href=browsers.html#some-sample-manifests>7.9.3.1 サンプルマニフェスト</a></li><li><a href=browsers.html#writing-cache-manifests>7.9.3.2 キャッシュマニフェストの記述</a></li><li><a href=browsers.html#parsing-cache-manifests>7.9.3.3 Parsing cache manifests</a></li></ol></li><li><a href=browsers.html#downloading-or-updating-an-application-cache>7.9.4 Downloading or updating an application cache</a></li><li><a href=browsers.html#the-application-cache-selection-algorithm>7.9.5 The application cache selection algorithm</a></li><li><a href=browsers.html#changesToNetworkingModel>7.9.6 Changes to the networking model</a></li><li><a href=browsers.html#expiring-application-caches>7.9.7 Expiring application caches</a></li><li><a href=browsers.html#disk-space>7.9.8 Disk space</a></li><li><a href=browsers.html#security-concerns-with-offline-applications-caches>7.9.9 Security concerns with offline applications caches</a></li><li><a href=browsers.html#application-cache-api>7.9.10 アプリケーションキャッシュAPI</a></li><li><a href=browsers.html#navigator.online>7.9.11 ブラウザーの状態</a></li></ol></li></ol></li></ol><h2 id=browsers>7 ウェブページの読み込み</h2>

  

  <p>This section describes features that apply most directly to Web browsers. Having said that,
  except where specified otherwise, the requirements defined in this section <em>do</em> apply to
  all user agents, whether they are Web browsers or not.</p>

  



  <h3 id=windows>7.1 ブラウジングコンテキスト</h3>

  <p><dfn id=browsing-context>ブラウジングコンテキスト</dfn>は<code id=windows:document><a href=dom.html#document>Document</a></code>オブジェクトがユーザーに提示される環境である。</p>

  <p class=note>A tab or window in a Web browser typically contains a <a href=#browsing-context id=windows:browsing-context>browsing
  context</a>, as does an <code id=windows:the-iframe-element><a href=embedded-content.html#the-iframe-element>iframe</a></code> or <code id=windows:frame><a href=obsolete.html#frame>frame</a></code>s in a
  <code id=windows:frameset><a href=obsolete.html#frameset>frameset</a></code>.</p>

  <p><a href=#browsing-context id=windows:browsing-context-2>ブラウジングコンテキスト</a>は、対応する<code id=windows:windowproxy><a href=#windowproxy>WindowProxy</a></code>オブジェクトを持つ。</p>

  <p><a href=#browsing-context id=windows:browsing-context-3>ブラウジングコンテキスト</a>は、<a href=#browsing-context id=windows:browsing-context-4>ブラウジングコンテキスト</a>が提示されていた、している、またはするだろう<code id=windows:document-2><a href=dom.html#document>Document</a></code>オブジェクトを一覧表示する<a href=#session-history id=windows:session-history>セッション履歴</a>を持つ。任意の時点で、それぞれの<a href=#browsing-context id=windows:browsing-context-5>ブラウジングコンテキスト</a>で1つの<code id=windows:document-3><a href=dom.html#document>Document</a></code>が<dfn id=active-document>アクティブドキュメント</dfn>を指定される。<dfn id=concept-document-bc><code>Document</code>のブラウジングコンテキスト</dfn>は、もしあれば、<a href=#session-history id=windows:session-history-2>セッション履歴</a>が<code id=windows:document-4><a href=dom.html#document>Document</a></code>を含む<a href=#browsing-context id=windows:browsing-context-6>ブラウジングコンテキスト</a>である。(A <code id=windows:document-5><a href=dom.html#document>Document</a></code> created using an API such as <code id=windows:dom-domimplementation-createdocument><a data-x-internal=dom-domimplementation-createdocument href=https://triple-underscore.github.io/DOM4-ja.htmlcreatedocument>createDocument()</a></code> has no <a href=#concept-document-bc id=windows:concept-document-bc>browsing context</a>.) Each <code id=windows:document-6><a href=dom.html#document>Document</a></code> in a <a href=#browsing-context id=windows:browsing-context-7>browsing context</a> is <dfn id=concept-document-window>associated</dfn> with a <code id=windows:window><a href=#window>Window</a></code> object.</p>

  <p class=note>一般に、<code id=windows:window-2><a href=#window>Window</a></code>オブジェクトから<code id=windows:document-7><a href=dom.html#document>Document</a></code>オブジェクトへ1対1の対応が存在する。2つの例外が存在する。まず、<code id=windows:window-3><a href=#window>Window</a></code>は、マッピングが1対2になるような、同じ<a href=#browsing-context id=windows:browsing-context-8>ブラウジングコンテキスト</a>における2番目の<code id=windows:document-8><a href=dom.html#document>Document</a></code>のプレゼンテーションに対して再利用できる。<a href=#replacement-enabled id=windows:replacement-enabled>交換が有効になっている</a>、<a href=#browsing-context id=windows:browsing-context-9>ブラウジングコンテキスト</a>は初期<code id=windows:about:blank><a href=infrastructure.html#about:blank>about:blank</a></code> <code id=windows:document-9><a href=dom.html#document>Document</a></code>から別のものに<a href=#navigate id=windows:navigate>ナビゲート</a>したとき、これは起こる。次に、<code id=windows:document-10><a href=dom.html#document>Document</a></code>は、マッピングが多対1であるような、<code id=windows:dom-document-open><a href=webappapis.html#dom-document-open>document.open()</a></code>メソッドが使用される場合、複数の<code id=windows:window-4><a href=#window>Window</a></code>オブジェクトを再利用されて終わることができる。</p>

  <p class=note><code id=windows:document-11><a href=dom.html#document>Document</a></code>は、関連付けられた<a href=#browsing-context id=windows:browsing-context-10>ブラウジングコンテキスト</a>を必ずしも持たない。具体的には、データマイニングツールはブラウジングコンテキストをインスタンス化できないだろう。</p>

  <hr>

  <p><a href=#browsing-context id=windows:browsing-context-11>ブラウジングコンテキスト</a>は、その作成に関与する<a href=#browsing-context id=windows:browsing-context-12>ブラウジングコンテキスト</a>、<dfn id=creator-browsing-context>クリエイターブラウジングコンテキスト</dfn>を持つことができる。<a href=#browsing-context id=windows:browsing-context-13>ブラウジングコンテキスト</a>が<a href=#parent-browsing-context id=windows:parent-browsing-context>親ブラウジングコンテキスト</a>を持つ場合、それは、その<a href=#creator-browsing-context id=windows:creator-browsing-context>クリエイターブラウジングコンテキスト</a>である。そうでなければ、<a href=#browsing-context id=windows:browsing-context-14>ブラウジングコンテキスト</a>が<a href=#opener-browsing-context id=windows:opener-browsing-context>オープナーブラウジングコンテキスト</a>を持つ場合、<em>それ</em>がその<a href=#creator-browsing-context id=windows:creator-browsing-context-2>クリエイターブラウジングコンテキスト</a>である。そうでなければ、<a href=#browsing-context id=windows:browsing-context-15>ブラウジングコンテキスト</a>は<a href=#creator-browsing-context id=windows:creator-browsing-context-3>作成者ブラウジングコンテキスト</a>を持たない。</p>

  <p>If a <a href=#browsing-context id=windows:browsing-context-16>browsing context</a> <var>A</var> has a <a href=#creator-browsing-context id=windows:creator-browsing-context-4>creator browsing
  context</a>, then the <dfn id=creator-origin>creator origin</dfn>, <dfn id=creator-url>creator URL</dfn>, and <dfn id=creator-base-url>creator base
  URL</dfn> are the <a href=#concept-origin id=windows:concept-origin>origin</a>, <a href=https://triple-underscore.github.io/DOM4-ja.html#concept-document-url id="windows:the-document's-address" data-x-internal="the-document's-address">URL</a>, and <a href=infrastructure.html#document-base-url id=windows:document-base-url>base URL</a>, respectively, of the <code id=windows:document-12><a href=dom.html#document>Document</a></code> that was
  the <a href=#active-document id=windows:active-document>active document</a> of that <a href=#creator-browsing-context id=windows:creator-browsing-context-5>creator browsing context</a> at the time
  <var>A</var> was created.</p>

  

  <p>To <dfn id=creating-a-new-browsing-context>create a new browsing context</dfn>:</p>

  <ol><li>
    <p>Call the JavaScript <a href=https://tc39.github.io/ecma262/#sec-initializehostdefinedrealm id=windows:js-initializehostdefinedrealm data-x-internal=js-initializehostdefinedrealm>InitializeHostDefinedRealm()</a> abstract operation
    with the following customizations:</p>

    <ul><li><p>For the global object, create a new <code id=windows:window-5><a href=#window>Window</a></code> object
     <var>window</var>.</li><li>
      <p>For the global <b>this</b> value, create a new <code id=windows:windowproxy-2><a href=#windowproxy>WindowProxy</a></code> object
      <var>windowProxy</var>, whose [[<a href=#concept-windowproxy-window id=windows:concept-windowproxy-window>Window</a>]]
      internal slot value is <var>window</var>.</p>

      <p class=note>The internal slot value is updated when navigations occur.</p>
     </li><li><p>Let <var>realm execution context</var> be the created <a id=windows:javascript-execution-context href=https://tc39.github.io/ecma262/#sec-execution-contexts data-x-internal=javascript-execution-context>JavaScript execution
     context</a>.</li></ul>
   </li><li><p>Set the new <a href=#browsing-context id=windows:browsing-context-17>browsing context</a>'s associated <code id=windows:windowproxy-3><a href=#windowproxy>WindowProxy</a></code> to
   <var>windowProxy</var>.</li><li><p>Let <var>document</var> be a new <code id=windows:document-13><a href=dom.html#document>Document</a></code>, whose <a href=https://triple-underscore.github.io/DOM4-ja.html#concept-document-url id="windows:the-document's-address-2" data-x-internal="the-document's-address">URL</a> is <code id=windows:about:blank-2><a href=infrastructure.html#about:blank>about:blank</a></code>, which is marked as being an
   <a href=https://triple-underscore.github.io/DOM4-ja.html#html-document id=windows:html-documents data-x-internal=html-documents>HTML document</a>, whose <a href=https://triple-underscore.github.io/DOM4-ja.html#concept-document-encoding id="windows:document's-character-encoding" data-x-internal="document's-character-encoding">character encoding</a> is UTF-8, and which is both <a id=windows:ready-for-post-load-tasks href=syntax.html#ready-for-post-load-tasks>ready for post-load
   tasks</a> and <a id=windows:completely-loaded href=syntax.html#completely-loaded>completely loaded</a> immediately.</li><li>
    <p id=about-blank-origin>Set the <a href=#concept-origin id=windows:concept-origin-2>origin</a> of <var>document</var>:</p>

    <ul><li><p>If the new <a href=#browsing-context id=windows:browsing-context-18>browsing context</a> has a <a href=#creator-browsing-context id=windows:creator-browsing-context-6>creator browsing context</a>,
     then the <a href=#concept-origin id=windows:concept-origin-3>origin</a> of <var>document</var> is the <a href=#creator-origin id=windows:creator-origin>creator
     origin</a>.</li><li><p>Otherwise, the <a href=#concept-origin id=windows:concept-origin-4>origin</a> of <var>document</var> is a unique <a href=#concept-origin-opaque id=windows:concept-origin-opaque>opaque origin</a> assigned when the new <a href=#browsing-context id=windows:browsing-context-19>browsing
     context</a> is created.</li></ul>
   </li><li><p>If the new <a href=#browsing-context id=windows:browsing-context-20>browsing context</a> has a <a href=#creator-browsing-context id=windows:creator-browsing-context-7>creator browsing context</a>, then
   set <var>document</var>'s <a href="dom.html#the-document's-referrer" id="windows:the-document's-referrer">referrer</a> to the
   <a href=#creator-url id=windows:creator-url>creator URL</a>.</li><li><p>Ensure that <var>document</var> has a single child <code id=windows:the-html-element><a href=semantics.html#the-html-element>html</a></code> node, which itself
   has two empty child nodes: a <code id=windows:the-head-element><a href=semantics.html#the-head-element>head</a></code> element, and a <code id=windows:the-body-element><a href=semantics.html#the-body-element>body</a></code>
   element.</li><li><p><a href=#implement-the-sandboxing id=windows:implement-the-sandboxing>Implement the sandboxing</a> for <var>document</var>.</li><li><p>Add <var>document</var> to the new <a href=#browsing-context id=windows:browsing-context-21>browsing context</a>'s <a href=#session-history id=windows:session-history-3>session
   history</a>.</li><li><p>Set <var>window</var>'s <a href=#concept-document-window id=windows:concept-document-window>associated
   <code>Document</code></a> to <var>document</var>.</li><li><p><a href=#set-up-a-browsing-context-environment-settings-object id=windows:set-up-a-browsing-context-environment-settings-object>Set up a browsing context environment settings object</a> with
   <var>realm execution context</var>.</li></ol>

  


  <h4 id=nested-browsing-contexts>7.1.1 ネストされたブラウジングコンテキスト</h4>

  <p>特定の要素（たとえば、<code id=nested-browsing-contexts:the-iframe-element><a href=embedded-content.html#the-iframe-element>iframe</a></code>要素）は、<a href=#browsing-context id=nested-browsing-contexts:browsing-context>ブラウジングコンテキスト</a>をさらにインスタンス化できる。これらは、<dfn id=nested-browsing-context>ネストされたブラウジングコンテキスト</dfn>と呼ばれる。ブラウジングコンテキスト<var>P</var>が、その中に別のブラウジングコンテキスト<var>C</var>をネストする要素<var>E</var>とともに<code id=nested-browsing-contexts:document><a href=dom.html#document>Document</a></code> <var>D</var>を持つ場合、<var>C</var>は<var>D</var>を<dfn id=browsing-context-nested-through>介してネストされる</dfn>と言い、<var>E</var>は<var>C</var>の<dfn id=browsing-context-container>ブラウジングコンテキストコンテナ</dfn>であると言われる。<a href=#browsing-context-container id=nested-browsing-contexts:browsing-context-container>ブラウジングコンテキストコンテナ</a>要素<var>E</var>が<code id=nested-browsing-contexts:document-2><a href=dom.html#document>Document</a></code> <var>D</var>の<a href=https://triple-underscore.github.io/DOM4-ja.html#in-a-document id=nested-browsing-contexts:in-a-document data-x-internal=in-a-document>中に</a>ある場合、<var>P</var>は<var>C</var>の<dfn id=parent-browsing-context>親ブラウジングコンテキスト</dfn>であると言われ、<var>C</var>は<var>P</var>の<dfn id=child-browsing-context>子ブラウジングコンテキスト</dfn>であると言われる。そうでなければ、<a href=#nested-browsing-context id=nested-browsing-contexts:nested-browsing-context>ネストされたブラウジングコンテキスト</a><var>C</var>は<a href=#parent-browsing-context id=nested-browsing-contexts:parent-browsing-context>親ブラウジングコンテキスト</a>を持たない。</p>

  <p><var>A</var>の<a href=#child-browsing-context id=nested-browsing-contexts:child-browsing-context>子ブラウジングコンテキスト</a>であるブラウジングコンテキスト<var>A'</var>が存在し、それが<var>B</var>の<a href=#ancestor-browsing-context id=nested-browsing-contexts:ancestor-browsing-context>祖先</a>自身である場合、または、ブラウジングコンテキスト<var>A</var>が<var>B</var>の<a href=#parent-browsing-context id=nested-browsing-contexts:parent-browsing-context-2>親ブラウジングコンテキスト</a>である場合、ブラウジングコンテキスト<var>A</var>はブラウジングコンテキスト<var>B</var>の<dfn id=ancestor-browsing-context>祖先</dfn>であると言われる。</p>

  <p>ブラウジングコンテキストは<a href=#nested-browsing-context id=nested-browsing-contexts:nested-browsing-context-2>ネストされたブラウジングコンテキスト</a>が<a href=#parent-browsing-context id=nested-browsing-contexts:parent-browsing-context-3>親ブラウジングコンテキスト</a>を持たないものでなく、<a href=#ancestor-browsing-context id=nested-browsing-contexts:ancestor-browsing-context-2>祖先のブラウジングコンテキスト</a>であるすべてのブラウジングコンテキストの<dfn id=top-level-browsing-context>レベルレベルブラウジングコンテキスト</dfn>である。</p>

  <p><a href=#nested-browsing-context id=nested-browsing-contexts:nested-browsing-context-3>ネストされたブラウジングコンテキスト</a>への<a href=#parent-browsing-context id=nested-browsing-contexts:parent-browsing-context-4>親ブラウジングコンテキスト</a>の推移クロージャは、<a href=#ancestor-browsing-context id=nested-browsing-contexts:ancestor-browsing-context-3>先祖ブラウジングコンテキスト</a>のリストを提供する。</p>

  <p><code id=nested-browsing-contexts:document-3><a href=dom.html#document>Document</a></code> <var>d</var>の<dfn id=list-of-the-descendant-browsing-contexts>子孫ブラウジングコンテキストのリスト</dfn>は、以下のアルゴリズムによって返される（順序の）リストである：</p>

  <ol><li><p><var>list</var>を空にする。</li><li>

    <p><var>d</var>の各<a href=#child-browsing-context id=nested-browsing-contexts:child-browsing-context-2>子ブラウジングコンテキスト</a>は<var>d</var> <a href=https://triple-underscore.github.io/DOM4-ja.html#in-a-document id=nested-browsing-contexts:in-a-document-2 data-x-internal=in-a-document><code>Document</code>で</a>存在する要素を<a href=#browsing-context-nested-through id=nested-browsing-contexts:browsing-context-nested-through>介してネストされる</a>ので、要素のこれら<a href=#browsing-context id=nested-browsing-contexts:browsing-context-2>ブラウジングコンテキスト</a>をネストする<a id=nested-browsing-contexts:tree-order href=https://triple-underscore.github.io/DOM4-ja.html#concept-tree-order data-x-internal=tree-order>ツリー順</a>に、次のサブステップを実行する：</p>

    <ol><li><p>リスト<var>list</var>にその<a href=#child-browsing-context id=nested-browsing-contexts:child-browsing-context-3>子ブラウジングコンテキスト</a>を追加する。</p>

     </li><li><p>リスト<var>list</var>にその<a href=#child-browsing-context id=nested-browsing-contexts:child-browsing-context-4>子ブラウジングコンテキスト</a>の<a href=#active-document id=nested-browsing-contexts:active-document>アクティブドキュメント</a>に属する<a href=#list-of-the-descendant-browsing-contexts id=nested-browsing-contexts:list-of-the-descendant-browsing-contexts>子孫ブラウジングコンテキストのリスト</a>を追加する。</li></ol>

   </li><li><p>構築された<var>list</var>を返す。</li></ol>

  <p>A <code id=nested-browsing-contexts:document-4><a href=dom.html#document>Document</a></code> is said to be <dfn id=fully-active>fully active</dfn> when it has a <a href=#concept-document-bc id=nested-browsing-contexts:concept-document-bc>browsing context</a> and it is the <a href=#active-document id=nested-browsing-contexts:active-document-2>active document</a> of
  that <a href=#browsing-context id=nested-browsing-contexts:browsing-context-3>browsing context</a>, and either its browsing context is a <a href=#top-level-browsing-context id=nested-browsing-contexts:top-level-browsing-context>top-level browsing
  context</a>, or it has a <a href=#parent-browsing-context id=nested-browsing-contexts:parent-browsing-context-5>parent browsing context</a> and the <code id=nested-browsing-contexts:document-5><a href=dom.html#document>Document</a></code>
  <a href=#browsing-context-nested-through id=nested-browsing-contexts:browsing-context-nested-through-2>through which</a> it is <a href=#nested-browsing-context id=nested-browsing-contexts:nested-browsing-context-4>nested</a> is itself <a href=#fully-active id=nested-browsing-contexts:fully-active>fully active</a>.</p>

  <p>それらは要素を介してネストされるため、<a href=#child-browsing-context id=nested-browsing-contexts:child-browsing-context-5>子ブラウジングコンテキスト</a>は常に、<a href=#parent-browsing-context id=nested-browsing-contexts:parent-browsing-context-6>親ブラウジングコンテキスト</a>内の特定の<code id=nested-browsing-contexts:document-6><a href=dom.html#document>Document</a></code>に関連付けられる。ユーザーエージェントは、ユーザーにがいない自身が<a href=#fully-active id=nested-browsing-contexts:fully-active-2>完全にアクティブ</a>でない<code id=nested-browsing-contexts:document-7><a href=dom.html#document>Document</a></code>にある要素の<a href=#child-browsing-context id=nested-browsing-contexts:child-browsing-context-6>子ブラウジングコンテキスト</a>と対話することを許可してはならない。</p>

  <p><a href=#nested-browsing-context id=nested-browsing-contexts:nested-browsing-context-5>ネストされたブラウジングコンテキスト</a>は、<dfn id=delaying-load-events-mode>遅延<code>load</code>イベントモード</dfn>にすることができる。これは、新しい<code id=nested-browsing-contexts:document-8><a href=dom.html#document>Document</a></code>が作成される前に<a href=#browsing-context-container id=nested-browsing-contexts:browsing-context-container-2>ブラウジングコンテキストコンテナ</a>の<a id=nested-browsing-contexts:delay-the-load-event href=syntax.html#delay-the-load-event>loadイベントを遅らせる</a>ために、<a href=#navigate id=nested-browsing-contexts:navigate>移動された</a>際に使用される。</p>



  <p><a href=#browsing-context id=nested-browsing-contexts:browsing-context-4>ブラウジングコンテキスト</a>の<dfn id=document-family>ドキュメントファミリー</dfn>は、その<a href=#browsing-context id=nested-browsing-contexts:browsing-context-5>ブラウジングコンテキスト</a>の<a href=#session-history id=nested-browsing-contexts:session-history>セッション履歴</a>ですべての<code id=nested-browsing-contexts:document-9><a href=dom.html#document>Document</a></code>オブジェクト　およびすべてのそれら<code id=nested-browsing-contexts:document-10><a href=dom.html#document>Document</a></code>オブジェクトの<a href=#document-family id=nested-browsing-contexts:document-family>ドキュメントファミリー</a>の結合で構成される。<code id=nested-browsing-contexts:document-11><a href=dom.html#document>Document</a></code>オブジェクトの<a href=#document-family id=nested-browsing-contexts:document-family-2>ドキュメントファミリー</a>は、<code id=nested-browsing-contexts:document-12><a href=dom.html#document>Document</a></code>オブジェクトを<a href=#browsing-context-nested-through id=nested-browsing-contexts:browsing-context-nested-through-3>介してネストされる</a><a href=#browsing-context id=nested-browsing-contexts:browsing-context-6>ブラウジングコンテキスト</a>の所有するすべての<a href=#document-family id=nested-browsing-contexts:document-family-3>ドキュメントファミリー</a>の結合で構成される。</p>


  <h5 id=navigating-nested-browsing-contexts-in-the-dom>7.1.1.1 DOM内でネストされたブラウジングコンテキストを操作する</h5>

  <dl class=domintro><dt><var>window</var> . <code id=navigating-nested-browsing-contexts-in-the-dom:dom-top><a href=#dom-top>top</a></code><dd>

    <p><a href=#top-level-browsing-context id=navigating-nested-browsing-contexts-in-the-dom:top-level-browsing-context>トップレベルブラウジングコンテキスト</a>の<code id=navigating-nested-browsing-contexts-in-the-dom:windowproxy><a href=#windowproxy>WindowProxy</a></code>を返す。</p>

   <dt><var>window</var> . <code id=navigating-nested-browsing-contexts-in-the-dom:dom-parent><a href=#dom-parent>parent</a></code><dd>

    <p><a href=#parent-browsing-context id=navigating-nested-browsing-contexts-in-the-dom:parent-browsing-context>親ブラウジングコンテキスト</a>に対する<code id=navigating-nested-browsing-contexts-in-the-dom:windowproxy-2><a href=#windowproxy>WindowProxy</a></code>を返す。</p>

   <dt><var>window</var> . <code id=navigating-nested-browsing-contexts-in-the-dom:dom-frameelement><a href=#dom-frameelement>frameElement</a></code><dd>

    <p><a href=#browsing-context-container id=navigating-nested-browsing-contexts-in-the-dom:browsing-context-container>ブラウジングコンテキストコンテナ</a>の<code id=navigating-nested-browsing-contexts-in-the-dom:element><a data-x-internal=element href=https://triple-underscore.github.io/DOM4-ja.html#interface-element>Element</a></code>を返す。</p>

    <p>Returns null if there isn't one, and in cross-origin situations.</p>

   </dl>

  

  <p>The <dfn id=dom-top><code>top</code></dfn> IDL attribute on the <code id=navigating-nested-browsing-contexts-in-the-dom:window><a href=#window>Window</a></code> object
  of a <code id=navigating-nested-browsing-contexts-in-the-dom:document><a href=dom.html#document>Document</a></code> that has a <a href=#concept-document-bc id=navigating-nested-browsing-contexts-in-the-dom:concept-document-bc>browsing context</a>
  <var>b</var> must return the <code id=navigating-nested-browsing-contexts-in-the-dom:windowproxy-3><a href=#windowproxy>WindowProxy</a></code> object of its <a href=#top-level-browsing-context id=navigating-nested-browsing-contexts-in-the-dom:top-level-browsing-context-2>top-level browsing
  context</a> (which would be its own <code id=navigating-nested-browsing-contexts-in-the-dom:windowproxy-4><a href=#windowproxy>WindowProxy</a></code> object if it was a <a href=#top-level-browsing-context id=navigating-nested-browsing-contexts-in-the-dom:top-level-browsing-context-3>top-level
  browsing context</a> itself), if it has one, or its own <code id=navigating-nested-browsing-contexts-in-the-dom:windowproxy-5><a href=#windowproxy>WindowProxy</a></code> object
  otherwise (e.g. if it was a detached <a href=#nested-browsing-context id=navigating-nested-browsing-contexts-in-the-dom:nested-browsing-context>nested browsing context</a>).</p>

  <p>The <dfn id=dom-parent><code>parent</code></dfn> IDL attribute on the <code id=navigating-nested-browsing-contexts-in-the-dom:window-2><a href=#window>Window</a></code>
  object of a <code id=navigating-nested-browsing-contexts-in-the-dom:document-2><a href=dom.html#document>Document</a></code> that has a <a href=#concept-document-bc id=navigating-nested-browsing-contexts-in-the-dom:concept-document-bc-2>browsing
  context</a> <var>b</var> must return the <code id=navigating-nested-browsing-contexts-in-the-dom:windowproxy-6><a href=#windowproxy>WindowProxy</a></code> object of the <a href=#parent-browsing-context id=navigating-nested-browsing-contexts-in-the-dom:parent-browsing-context-2>parent
  browsing context</a>, if there is one (i.e. if <var>b</var> is a <a href=#child-browsing-context id=navigating-nested-browsing-contexts-in-the-dom:child-browsing-context>child browsing
  context</a>), or the <code id=navigating-nested-browsing-contexts-in-the-dom:windowproxy-7><a href=#windowproxy>WindowProxy</a></code> object of the <a href=#browsing-context id=navigating-nested-browsing-contexts-in-the-dom:browsing-context>browsing context</a>
  <var>b</var> itself, otherwise (i.e. if it is a <a href=#top-level-browsing-context id=navigating-nested-browsing-contexts-in-the-dom:top-level-browsing-context-4>top-level browsing context</a> or a
  detached <a href=#nested-browsing-context id=navigating-nested-browsing-contexts-in-the-dom:nested-browsing-context-2>nested browsing context</a>).</p>

  <p>The <dfn id=dom-frameelement><code>frameElement</code></dfn> IDL attribute, on getting,
  must run the following algorithm:</p>

  <ol><li><p>Let <var>d</var> be the <code id=navigating-nested-browsing-contexts-in-the-dom:window-3><a href=#window>Window</a></code> object's
   <a href=#concept-document-window id=navigating-nested-browsing-contexts-in-the-dom:concept-document-window>associated <code>Document</code></a>.</li><li><p>Let <var>context</var> be <var>d</var>'s <a href=#concept-document-bc id=navigating-nested-browsing-contexts-in-the-dom:concept-document-bc-3>browsing context</a>.</li><li><p>If <var>context</var> is not a <a href=#nested-browsing-context id=navigating-nested-browsing-contexts-in-the-dom:nested-browsing-context-3>nested browsing context</a>, return null and abort
   these steps.</li><li><p>Let <var>container</var> be <var>context</var>'s <a href=#browsing-context-container id=navigating-nested-browsing-contexts-in-the-dom:browsing-context-container-2>browsing context
   container</a>.</li><li><p>If <var>container</var>'s <a id=navigating-nested-browsing-contexts-in-the-dom:node-document href=https://triple-underscore.github.io/DOM4-ja.html#concept-node-document data-x-internal=node-document>node document</a>'s <a href=#concept-origin id=navigating-nested-browsing-contexts-in-the-dom:concept-origin>origin</a> is not
   <a href=#same-origin-domain id=navigating-nested-browsing-contexts-in-the-dom:same-origin-domain>same origin-domain</a> with the <a id=navigating-nested-browsing-contexts-in-the-dom:entry-settings-object href=webappapis.html#entry-settings-object>entry settings object</a>'s
   <a href=#concept-origin id=navigating-nested-browsing-contexts-in-the-dom:concept-origin-2>origin</a>, then return null and abort these steps.</li><li><p>Return <var>container</var>.</li></ol>

  



  <h4 id=auxiliary-browsing-contexts>7.1.2 補助ブラウジングコンテキスト</h4>

  <p>要素を通じてネストせずに<a href=#top-level-browsing-context id=auxiliary-browsing-contexts:top-level-browsing-context>トップレベルブラウジングコンテキスト</a>に関連する新しいブラウジングコンテキストを作成することが可能である。このようなブラウジングコンテキストは、<dfn id=auxiliary-browsing-context>補助ブラウジングコンテキスト</dfn>と呼ばれる。補助ブラウジングコンテキストは常に<a href=#top-level-browsing-context id=auxiliary-browsing-contexts:top-level-browsing-context-2>トップレベルブラウジングコンテキスト</a>である。</p>

  <p><a href=#auxiliary-browsing-context id=auxiliary-browsing-contexts:auxiliary-browsing-context>補助ブラウジングコンテキスト</a>は、<a href=#auxiliary-browsing-context id=auxiliary-browsing-contexts:auxiliary-browsing-context-2>補助ブラウジングコンテキスト</a>から作成された<a href=#browsing-context id=auxiliary-browsing-contexts:browsing-context>ブラウジングコンテキスト</a>である、<dfn id=opener-browsing-context>オープナーブラウジングコンテキスト</dfn>を持つ。</p>


  <h5 id=navigating-auxiliary-browsing-contexts-in-the-dom>7.1.2.1 DOM内の補助ブラウジングコンテキストを操作する</h5>

  <p>存在し、利用可能であり、かつ現在の<a href=#browsing-context id=navigating-auxiliary-browsing-contexts-in-the-dom:browsing-context-3>ブラウジングコンテキスト</a>が、<i id=navigating-auxiliary-browsing-contexts-in-the-dom:disowned-its-opener><a href=#disowned-its-opener>そのオープナーを解消する</a></i>のでない場合、取得時に、<code id=navigating-auxiliary-browsing-contexts-in-the-dom:window><a href=#window>Window</a></code>オブジェクトの<dfn id=dom-opener><code>opener</code></dfn>IDL属性は、現在の<a href=#browsing-context id=navigating-auxiliary-browsing-contexts-in-the-dom:browsing-context-2>ブラウジングコンテキスト</a>が（その<a href=#opener-browsing-context id=navigating-auxiliary-browsing-contexts-in-the-dom:opener-browsing-context>オープナーブラウジングコンテキスト</a>）を作成された<a href=#browsing-context id=navigating-auxiliary-browsing-contexts-in-the-dom:browsing-context>ブラウジングコンテキスト</a>の<code id=navigating-auxiliary-browsing-contexts-in-the-dom:windowproxy><a href=#windowproxy>WindowProxy</a></code>オブジェクトを返さなければならない。そうでなければ、nullを返さなければならない。設定時に、新しい値がnullの場合、現在の<a href=#browsing-context id=navigating-auxiliary-browsing-contexts-in-the-dom:browsing-context-4>ブラウジングコンテキスト</a>は<dfn id=disowned-its-opener>オープナーを解消し</dfn>なければならない。新しい値が何か他のものである場合、ユーザーエージェントは<code id=navigating-auxiliary-browsing-contexts-in-the-dom:window-2><a href=#window>Window</a></code>オブジェクトの[[DefineOwnProperty]]初期メソッドを呼ばなければならず、 プロパティキーとしてプロパティ名"<code>opener</code>"を通過し、かつプロパティ記述子としてプロパティ記述子 { [[Value]]: <var>value</var>, [[Writable]]: true, [[Enumerable]]: true, [[Configurable]]: true }とする。ここで<var>value</var>は新しい値である。</p>




  

  <h4 id=security-nav>7.1.3 セキュリティー</h4>

  <p id=security-1>A <a href=#browsing-context id=security-nav:browsing-context>browsing context</a> <var>A</var> is <dfn id=familiar-with>familiar
  with</dfn> a second <a href=#browsing-context id=security-nav:browsing-context-2>browsing context</a> <var>B</var> if one of the following
  conditions is true:</p>

  <ul><li>Either the <a href=#concept-origin id=security-nav:concept-origin>origin</a> of the <a href=#active-document id=security-nav:active-document>active document</a> of <var>A</var>
   is the <a href=#same-origin id=security-nav:same-origin>same</a> as the <a href=#concept-origin id=security-nav:concept-origin-2>origin</a> of the <a href=#active-document id=security-nav:active-document-2>active
   document</a> of <var>B</var>, or</li><li>The browsing context <var>A</var> is a <a href=#nested-browsing-context id=security-nav:nested-browsing-context>nested browsing context</a> with a
   <a href=#top-level-browsing-context id=security-nav:top-level-browsing-context>top-level browsing context</a>, and its <a href=#top-level-browsing-context id=security-nav:top-level-browsing-context-2>top-level browsing context</a> is <var>B</var>, or</li><li>The browsing context <var>B</var> is an <a href=#auxiliary-browsing-context id=security-nav:auxiliary-browsing-context>auxiliary browsing context</a> and
   <var>A</var> is <a href=#familiar-with id=security-nav:familiar-with>familiar with</a> <var>B</var>'s <a href=#opener-browsing-context id=security-nav:opener-browsing-context>opener
   browsing context</a>, or</li><li>The browsing context <var>B</var> is not a <a href=#top-level-browsing-context id=security-nav:top-level-browsing-context-3>top-level browsing context</a>,
   but there exists an <a href=#ancestor-browsing-context id=security-nav:ancestor-browsing-context>ancestor browsing context</a> of <var>B</var> whose
   <a href=#active-document id=security-nav:active-document-3>active document</a> has the <a href=#same-origin id=security-nav:same-origin-2>same</a> <a href=#concept-origin id=security-nav:concept-origin-3>origin</a> as
   the <a href=#active-document id=security-nav:active-document-4>active document</a> of <var>A</var> (possibly in fact being <var>A</var> itself).</li></ul>

  <hr>

  <p>A <a href=#browsing-context id=security-nav:browsing-context-3>browsing context</a> <var>A</var> is <dfn id=allowed-to-navigate>allowed to navigate</dfn> a
  second <a href=#browsing-context id=security-nav:browsing-context-4>browsing context</a> <var>B</var> if the following algorithm terminates
  positively:</p>

  <ol><li><p>If <var>A</var> is not the same <a href=#browsing-context id=security-nav:browsing-context-5>browsing context</a> as <var>B</var>, and <var>A</var> is not one of the <a href=#ancestor-browsing-context id=security-nav:ancestor-browsing-context-2>ancestor browsing contexts</a> of <var>B</var>, and <var>B</var>
   is not a <a href=#top-level-browsing-context id=security-nav:top-level-browsing-context-4>top-level browsing context</a>, and <var>A</var>'s <a href=#active-document id=security-nav:active-document-5>active
   document</a>'s <a href=#active-sandboxing-flag-set id=security-nav:active-sandboxing-flag-set>active sandboxing flag set</a> has its <a href=#sandboxed-navigation-browsing-context-flag id=security-nav:sandboxed-navigation-browsing-context-flag>sandboxed navigation
   browsing context flag</a> set, then abort these steps negatively.</li><li><p>Otherwise, if <var>B</var> is a <a href=#top-level-browsing-context id=security-nav:top-level-browsing-context-5>top-level browsing context</a>, and is one of the
   <a href=#ancestor-browsing-context id=security-nav:ancestor-browsing-context-3>ancestor browsing contexts</a> of <var>A</var>, and
   <var>A</var>'s <a href=#active-document id=security-nav:active-document-6>active document</a>'s <a href=#active-sandboxing-flag-set id=security-nav:active-sandboxing-flag-set-2>active sandboxing flag set</a> has its
   <a href=#sandboxed-top-level-navigation-browsing-context-flag id=security-nav:sandboxed-top-level-navigation-browsing-context-flag>sandboxed top-level navigation browsing context flag</a> set, then abort these steps
   negatively.</li><li><p>Otherwise, if <var>B</var> is a <a href=#top-level-browsing-context id=security-nav:top-level-browsing-context-6>top-level browsing context</a>, and is
   neither <var>A</var> nor one of the <a href=#ancestor-browsing-context id=security-nav:ancestor-browsing-context-4>ancestor
   browsing contexts</a> of <var>A</var>, and <var>A</var>'s
   <code id=security-nav:document><a href=dom.html#document>Document</a></code>'s <a href=#active-sandboxing-flag-set id=security-nav:active-sandboxing-flag-set-3>active sandboxing flag set</a> has its <a href=#sandboxed-navigation-browsing-context-flag id=security-nav:sandboxed-navigation-browsing-context-flag-2>sandboxed
   navigation browsing context flag</a> set, and <var>A</var> is not the <a href=#one-permitted-sandboxed-navigator id=security-nav:one-permitted-sandboxed-navigator>one
   permitted sandboxed navigator</a> of <var>B</var>, then abort these steps
   negatively.</li><li><p>Otherwise, terminate positively!</li></ol>

  <hr>

  <p>An element has a <dfn id=browsing-context-scope-origin>browsing context scope origin</dfn> if its <code id=security-nav:document-2><a href=dom.html#document>Document</a></code>'s
  <a href=#concept-document-bc id=security-nav:concept-document-bc>browsing context</a> is a <a href=#top-level-browsing-context id=security-nav:top-level-browsing-context-7>top-level browsing
  context</a> or if all of its <code id=security-nav:document-3><a href=dom.html#document>Document</a></code>'s <a href=#ancestor-browsing-context id=security-nav:ancestor-browsing-context-5>ancestor browsing contexts</a> all have <a href=#active-document id=security-nav:active-document-7>active
  documents</a> whose <a href=#concept-origin id=security-nav:concept-origin-4>origin</a> are the <a href=#same-origin id=security-nav:same-origin-3>same origin</a> as the element's
  <a id=security-nav:node-document href=https://triple-underscore.github.io/DOM4-ja.html#concept-node-document data-x-internal=node-document>node document</a>'s <a href=#concept-origin id=security-nav:concept-origin-5>origin</a>. If an element has a <a href=#browsing-context-scope-origin id=security-nav:browsing-context-scope-origin>browsing context scope
  origin</a>, then its value is the <a href=#concept-origin id=security-nav:concept-origin-6>origin</a> of the element's <a id=security-nav:node-document-2 href=https://triple-underscore.github.io/DOM4-ja.html#concept-node-document data-x-internal=node-document>node
  document</a>.</p>

  



  

  <h4 id=groupings-of-browsing-contexts>7.1.4 Groupings of browsing contexts</h4>

  <p>Each <a href=#browsing-context id=groupings-of-browsing-contexts:browsing-context>browsing context</a> is defined as having a list of one or more <dfn id=directly-reachable-browsing-contexts>directly
  reachable browsing contexts</dfn>. These are:</p>

  <ul><li>The <a href=#browsing-context id=groupings-of-browsing-contexts:browsing-context-2>browsing context</a> itself.</li><li>All the <a href=#browsing-context id=groupings-of-browsing-contexts:browsing-context-3>browsing context</a>'s <a href=#child-browsing-context id=groupings-of-browsing-contexts:child-browsing-context>child browsing
   contexts</a>.</li><li>The <a href=#browsing-context id=groupings-of-browsing-contexts:browsing-context-4>browsing context</a>'s <a href=#parent-browsing-context id=groupings-of-browsing-contexts:parent-browsing-context>parent browsing context</a>.</li><li>All the <a href=#browsing-context id=groupings-of-browsing-contexts:browsing-context-5>browsing contexts</a> that have the <a href=#browsing-context id=groupings-of-browsing-contexts:browsing-context-6>browsing
   context</a> as their <a href=#opener-browsing-context id=groupings-of-browsing-contexts:opener-browsing-context>opener browsing context</a>.</li><li>The <a href=#browsing-context id=groupings-of-browsing-contexts:browsing-context-7>browsing context</a>'s <a href=#opener-browsing-context id=groupings-of-browsing-contexts:opener-browsing-context-2>opener browsing context</a>.</li></ul>

  <p>The transitive closure of all the <a href=#browsing-context id=groupings-of-browsing-contexts:browsing-context-8>browsing contexts</a> that
  are <a href=#directly-reachable-browsing-contexts id=groupings-of-browsing-contexts:directly-reachable-browsing-contexts>directly reachable browsing contexts</a> forms a <dfn id=unit-of-related-browsing-contexts>unit of related browsing
  contexts</dfn>.</p>

  <p>Each <a href=#unit-of-related-browsing-contexts id=groupings-of-browsing-contexts:unit-of-related-browsing-contexts>unit of related browsing contexts</a> is then further divided into the smallest
  number of groups such that every member of each group has an <a href=#active-document id=groupings-of-browsing-contexts:active-document>active document</a> with an
  <a href=#concept-origin id=groupings-of-browsing-contexts:concept-origin>origin</a> that, through appropriate manipulation of the <code id=groupings-of-browsing-contexts:dom-document-domain><a href=#dom-document-domain>document.domain</a></code> attribute, could be made to be <a href=#same-origin-domain id=groupings-of-browsing-contexts:same-origin-domain>same
  origin-domain</a> with other members of the group, but could not be made the same as members of
  any other group. Each such group is a <dfn id=unit-of-related-similar-origin-browsing-contexts data-export="">unit of related similar-origin browsing
  contexts</dfn>.</p>

  <p class=note>There is also at most one <a id=groupings-of-browsing-contexts:event-loop href=webappapis.html#event-loop>event loop</a> per <a href=#unit-of-related-similar-origin-browsing-contexts id=groupings-of-browsing-contexts:unit-of-related-similar-origin-browsing-contexts>unit of related
  similar-origin browsing contexts</a> (though several <a href=#unit-of-related-similar-origin-browsing-contexts id=groupings-of-browsing-contexts:unit-of-related-similar-origin-browsing-contexts-2>units of related similar-origin browsing contexts</a> can
  have a shared <a id=groupings-of-browsing-contexts:event-loop-2 href=webappapis.html#event-loop>event loop</a>).</p>

  



  <h4 id=browsing-context-names>7.1.5 ブラウジングコンテキスト名</h4>

  <p>ブラウジングコンテキストは、<dfn id=browsing-context-name>ブラウジングコンテキスト名</dfn>を持つことができる。デフォルトでは、ブラウジングコンテキストは名前を持たない（名前が設定されない）。</p>

  <p><dfn id=valid-browsing-context-name>妥当なブラウジングコンテキスト名</dfn>は、U+005F LOW LINE文字で始まらない少なくとも1文字をもつ任意の文字列である。（アンダースコアで始まる名前は、特別なキーワードのために予約されている。）</p>

  <p><dfn id=valid-browsing-context-name-or-keyword>妥当なブラウジングコンテキスト名またはキーワード</dfn>は、<a href=#valid-browsing-context-name id=browsing-context-names:valid-browsing-context-name>妥当なブラウジングコンテキスト名</a>または<a id=browsing-context-names:ascii-case-insensitive href=infrastructure.html#ascii-case-insensitive>ASCII大文字・小文字不区別</a>で<code>_blank</code>、<code>_self</code>、<code>_parent</code>、または<code>_top</code>の1つにマッチするいずれかとなる任意の文字列である。</p>

  <p>これらの値は、以下の（非規範的な）テーブルで要約されるように、ページがサンドボックス化されるかどうかに基づいて異なる意味を持つ。In this table, "current" means the <a href=#browsing-context id=browsing-context-names:browsing-context>browsing context</a> that the link or script is in, "parent" means the <a href=#parent-browsing-context id=browsing-context-names:parent-browsing-context>parent browsing context</a> of the one the link or script is in, "top" means the <a href=#top-level-browsing-context id=browsing-context-names:top-level-browsing-context>top-level browsing context</a> of the one the link or script is in, "new" means a new <a href=#top-level-browsing-context id=browsing-context-names:top-level-browsing-context-2>top-level browsing context</a> or <a href=#auxiliary-browsing-context id=browsing-context-names:auxiliary-browsing-context>auxiliary browsing context</a> is to be created, subject to various user preferences and user agent policies, "none" means that nothing will happen, and "maybe new" means the same as "new" if the "<code id=browsing-context-names:attr-iframe-sandbox-allow-popups><a href=#attr-iframe-sandbox-allow-popups>allow-popups</a></code>" keyword is also specified on the <code id=browsing-context-names:attr-iframe-sandbox><a href=embedded-content.html#attr-iframe-sandbox>sandbox</a></code> attribute (or if the user overrode the sandboxing), and the same as "none" otherwise.</p>

  <table><thead><tr><th rowspan=2>キーワード
     </th><th rowspan=2>普通の効果
     </th><th colspan=2><code id=browsing-context-names:the-iframe-element><a href=embedded-content.html#the-iframe-element>iframe</a></code>での効果
    </th></tr><tr><th><code>sandbox=""</code>
     </th><th><code>sandbox="allow-top-navigation"</code>

   <tbody></th></tr><tr><td>リンクおよびフォーム送信に対して、何も指定しない 
     </td><td>current
     
     </td><td>current
     
     </td><td>current

    

    </td></tr><tr><td>空文字列
     </td><td>current
     
     </td><td>current
     
     </td><td>current

    

    </td></tr><tr><td><code>_blank</code>
     </td><td>new
     
     </td><td>maybe new
     
     </td><td>maybe new

    

    </td></tr><tr><td><code>_self</code>
     </td><td>current
     
     </td><td>current
     
     </td><td>current

    

    </td></tr><tr><td>親が存在しない場合の<code>_parent</code>
     </td><td>current
     
     </td><td>current
     
     </td><td>current

    

    </td></tr><tr><td>親がまたトップである場合の<code>_parent</code>
     </td><td>parent/top
     
     </td><td>なし
     </td><td>parent/top

    

    </td></tr><tr><td>存在するがトップでない場合の<code>_parent</code>
     </td><td>parent
     
     </td><td>なし
     </td><td>なし

    </td></tr><tr><td>トップが現在である場合の<code>_top</code>
     </td><td>current
     
     </td><td>current
     
     </td><td>current

    

    </td></tr><tr><td>トップが現在でない場合の<code>_top</code>
     </td><td>top
     
     </td><td>なし
     </td><td>top

    

    </td></tr><tr><td>名前が存在しない
     </td><td>new
     
     </td><td>maybe new
     
     </td><td>maybe new

    

    </td></tr><tr><td>名前が存在しかつ子孫である
     </td><td>specified descendant
     
     </td><td>specified descendant
     
     </td><td>specified descendant

    

    </td></tr><tr><td>名前が存在し現在である
     </td><td>current
     
     </td><td>current
     
     </td><td>current

    

    </td></tr><tr><td>名前が存在しかつトップとなる祖先である
     </td><td>specified ancestor
     
     </td><td>なし
     </td><td>specified ancestor/top

    

    </td></tr><tr><td>名前が存在しかつトップでない祖先である
     </td><td>specified ancestor
     
     </td><td>なし
     </td><td>なし

    </td></tr><tr><td>他の名前が共通のトップとともに存在する
     </td><td>specified
     
     </td><td>なし
     </td><td>なし

    </td></tr><tr><td><a href=#familiar-with id=browsing-context-names:familiar-with>familiar</a>かつ<a href=#one-permitted-sandboxed-navigator id=browsing-context-names:one-permitted-sandboxed-navigator>ある許可されたサンドボックス化されたナビゲーター</a>である場合、異なるトップをもつ名前が存在する
     </td><td>specified
     
     </td><td>specified
     
     </td><td>specified

    

    </td></tr><tr><td><a href=#familiar-with id=browsing-context-names:familiar-with-2>familiar</a>だが<a href=#one-permitted-sandboxed-navigator id=browsing-context-names:one-permitted-sandboxed-navigator-2>ある許可されたサンドボックス化されたナビゲーター</a>でない場合、異なるトップをもつ名前が存在する
     </td><td>specified
     
     </td><td>なし
     </td><td>なし

    </td></tr><tr><td><a href=#familiar-with id=browsing-context-names:familiar-with-3>familiar</a>でない、異なるトップをもつ名前が存在する
     </td><td>new
     
     </td><td>maybe new
     
     </td><td>maybe new

  

  </td></tr></table>

  <p class=tablenote><small>サンドボックス化されたブラウジングコンテキストの制限のほとんどは、他のアルゴリズムにより適用される。たとえば、下記で与えられる<a href=#the-rules-for-choosing-a-browsing-context-given-a-browsing-context-name id=browsing-context-names:the-rules-for-choosing-a-browsing-context-given-a-browsing-context-name>ブラウジングコンテキスト名で与えられたをブラウジングコンテキストを選択するための規則</a>でなく、<a href=#navigate id=browsing-context-names:navigate>ナビゲーション</a>アルゴリズムとして。</small></p>

  

  <hr>

  <p>An algorithm is <dfn id=allowed-to-show-a-popup>allowed to show a popup</dfn> if any of the following conditions is
  true:</p>

  <ul><li><p>The <a href=webappapis.html#concept-task id=browsing-context-names:concept-task>task</a> in which the algorithm is running is currently
   processing an <a id=browsing-context-names:activation-behaviour href=interaction.html#activation-behaviour>activation behaviour</a> whose <code id=browsing-context-names:event-click><a data-x-internal=event-click href=https://w3c.github.io/uievents/#event-type-click>click</a></code> event
   was <a href=infrastructure.html#concept-events-trusted id=browsing-context-names:concept-events-trusted>trusted</a>.</li><li>

    <p>The <a href=webappapis.html#concept-task id=browsing-context-names:concept-task-2>task</a> in which the algorithm is running is currently
    running the event listener for a <a href=infrastructure.html#concept-events-trusted id=browsing-context-names:concept-events-trusted-2>trusted</a> event whose
    type is in the following list:</p>

    <ul class=brief><li><code id=browsing-context-names:event-change><a href=indices.html#event-change>change</a></code></li><li><code id=browsing-context-names:event-click-2><a data-x-internal=event-click href=https://w3c.github.io/uievents/#event-type-click>click</a></code></li><li><code id=browsing-context-names:event-dblclick><a data-x-internal=event-dblclick href=https://w3c.github.io/uievents/#event-type-dblclick>dblclick</a></code></li><li><code id=browsing-context-names:event-mouseup><a data-x-internal=event-mouseup href=https://w3c.github.io/uievents/#event-type-mouseup>mouseup</a></code></li><li><code id=browsing-context-names:event-reset><a href=indices.html#event-reset>reset</a></code></li><li><code id=browsing-context-names:event-submit><a href=indices.html#event-submit>submit</a></code></li></ul>

   </li><li>

    <p>The <a href=webappapis.html#concept-task id=browsing-context-names:concept-task-3>task</a> in which the algorithm is running was <a href=webappapis.html#queue-a-task id=browsing-context-names:queue-a-task>queued</a> by an algorithm that was <a href=#allowed-to-show-a-popup id=browsing-context-names:allowed-to-show-a-popup>allowed to show a popup</a>,
    and the chain of such algorithms started within a user-agent defined timeframe.</p>

    <p class=example>For example, if a user clicked a button, it might be acceptable for a popup
    to result from that after 4 seconds, but it would likely not be acceptable for a popup to result
    from that after 4 hours.</p>

   </li></ul>

  <hr>

  <p><dfn id=the-rules-for-choosing-a-browsing-context-given-a-browsing-context-name>The rules for choosing a browsing context given a browsing context name</dfn> are as
  follows. The rules assume that they are being applied in the context of a <a href=#browsing-context id=browsing-context-names:browsing-context-2>browsing
  context</a>, as part of the execution of a <a href=webappapis.html#concept-task id=browsing-context-names:concept-task-4>task</a>.</p>

  <ol><li>

    <p>If the given browsing context name is the empty string or <code>_self</code>, then
    the chosen browsing context must be the current one.</p>

   </li><li><p>If the given browsing context name is <code>_parent</code>, then the chosen
   browsing context must be the <a href=#parent-browsing-context id=browsing-context-names:parent-browsing-context-2><em>parent</em> browsing context</a> of the current one,
   unless there isn't one, in which case the chosen browsing context must be the current browsing
   context.</li><li><p>If the given browsing context name is <code>_top</code>, then the chosen browsing
   context must be the <a href=#top-level-browsing-context id=browsing-context-names:top-level-browsing-context-3>top-level browsing context</a> of the current one, if there is one,
   or else the current browsing context.</li><li>

    <p>If the given browsing context name is not <code>_blank</code> and there exists a
    browsing context whose <a href=#browsing-context-name id=browsing-context-names:browsing-context-name>name</a> is the same as the given
    browsing context name, and the current browsing context is <a href=#familiar-with id=browsing-context-names:familiar-with-4>familiar with</a> that
    browsing context, and the user agent determines that the two browsing contexts are related
    enough that it is ok if they reach each other, then that browsing context must be the chosen
    one. If there are multiple matching browsing contexts, the user agent should select one in some
    arbitrary consistent manner, such as the most recently opened, most recently focused, or more
    closely related.</p>

   </li><li>

    <p>Otherwise, a new browsing context is being requested, and what happens depends on the user
    agent's configuration and abilities — it is determined by the rules given for the first
    applicable option from the following list:</p>

    <dl class=switch><dt id=popup-blocker>If the algorithm is not <a href=#allowed-to-show-a-popup id=browsing-context-names:allowed-to-show-a-popup-2>allowed to show a popup</a> and the
     user agent has been configured to not show popups (i.e. the user agent has a "popup blocker"
     enabled)<dd>

      <p>There is no chosen browsing context. The user agent may inform the user that a popup has
      been blocked.</p>

     <dt id=sandboxWindowOpen>If the current browsing context's <a href=#active-document id=browsing-context-names:active-document>active document</a>'s
     <a href=#active-sandboxing-flag-set id=browsing-context-names:active-sandboxing-flag-set>active sandboxing flag set</a> has the <a href=#sandboxed-auxiliary-navigation-browsing-context-flag id=browsing-context-names:sandboxed-auxiliary-navigation-browsing-context-flag>sandboxed auxiliary navigation browsing
     context flag</a> set.<dd>

      <p>Typically, there is no chosen browsing context.</p>

      <p>The user agent may offer to <a href=#creating-a-new-browsing-context id=browsing-context-names:creating-a-new-browsing-context>create</a> a new <a href=#top-level-browsing-context id=browsing-context-names:top-level-browsing-context-4>top-level browsing context</a> or reuse
      an existing <a href=#top-level-browsing-context id=browsing-context-names:top-level-browsing-context-5>top-level browsing context</a>. If the user picks one of those options,
      then the designated browsing context must be the chosen one (the browsing context's name isn't
      set to the given browsing context name). The default behaviour (if the user agent doesn't
      offer the option to the user, or if the user declines to allow a browsing context to be used)
      must be that there must not be a chosen browsing context.</p>

      <p class=warning>If this case occurs, it means that an author has explicitly sandboxed the
      document that is trying to open a link.</p>

     <dt id=noopener>If the user agent has been configured such that in this instance it will
     create a new browsing context:<dd>
      <p>A new <a href=#auxiliary-browsing-context id=browsing-context-names:auxiliary-browsing-context-2>auxiliary browsing context</a> must be created, with the <a href=#opener-browsing-context id=browsing-context-names:opener-browsing-context>opener
      browsing context</a> being the current one. If the given browsing context name is not
      <code>_blank</code>, then the new auxiliary browsing context's name must be the
      given browsing context name (otherwise, it has no name). The chosen browsing context must be
      this new browsing context.</p>

      <p class=note>If the newly created <a href=#browsing-context id=browsing-context-names:browsing-context-3>browsing context</a> is immediately <a href=#navigate id=browsing-context-names:navigate-2>navigated</a>, then the navigation will be done with <a href=#replacement-enabled id=browsing-context-names:replacement-enabled>replacement
      enabled</a>.</p>
     <dt>If the user agent has been configured such that in this instance it will reuse the current
     browsing context<dd><p>The chosen browsing context is the current browsing context.<dt>If the user agent has been configured such that in this instance it will not find a
     browsing context<dd><p>There must not be a chosen browsing context.</dl>

    <p>User agent implementors are encouraged to provide a way for users to configure the user agent
    to always reuse the current browsing context.</p>

    <p>If the current browsing context's <a href=#active-document id=browsing-context-names:active-document-2>active document</a>'s <a href=#active-sandboxing-flag-set id=browsing-context-names:active-sandboxing-flag-set-2>active sandboxing flag
    set</a> has both the <a href=#sandboxed-navigation-browsing-context-flag id=browsing-context-names:sandboxed-navigation-browsing-context-flag>sandboxed navigation browsing context flag</a> and
    <a href=#sandbox-propagates-to-auxiliary-browsing-contexts-flag id=browsing-context-names:sandbox-propagates-to-auxiliary-browsing-contexts-flag>sandbox propagates to auxiliary browsing contexts flag</a> set, and the chosen browsing
    context picked above, if any, is a new browsing context, then all the flags that are set in the
    current browsing context's <a href=#active-document id=browsing-context-names:active-document-3>active document</a>'s <a href=#active-sandboxing-flag-set id=browsing-context-names:active-sandboxing-flag-set-3>active sandboxing flag
    set</a> when the new browsing context is created must be set in the new browsing context's
    <a href=#popup-sandboxing-flag-set id=browsing-context-names:popup-sandboxing-flag-set>popup sandboxing flag set</a>, and the current browsing context must be set as the new
    browsing context's <a href=#one-permitted-sandboxed-navigator id=browsing-context-names:one-permitted-sandboxed-navigator-3>one permitted sandboxed navigator</a>.</p>

   </li></ol>

  


  

  <h4 id=script-settings-for-browsing-contexts>7.1.6 Script settings for browsing contexts</h4>

  <p>When the user agent is required to <dfn id=set-up-a-browsing-context-environment-settings-object>set up a browsing context environment settings
  object</dfn>, given a <a id=script-settings-for-browsing-contexts:javascript-execution-context href=https://tc39.github.io/ecma262/#sec-execution-contexts data-x-internal=javascript-execution-context>JavaScript execution context</a> <var>execution context</var>, it
  must run the following steps:</p>

  <ol><li><p>Let <var>realm</var> be the value of <var>execution context</var>'s Realm
   component.</li><li><p>Let <var>window</var> be <var>realm</var>'s <a href=webappapis.html#concept-realm-global id=script-settings-for-browsing-contexts:concept-realm-global>global
   object</a>.</li><li><p>Let <var>url</var> be a copy of the <a href=https://triple-underscore.github.io/DOM4-ja.html#concept-document-url id="script-settings-for-browsing-contexts:the-document's-address" data-x-internal="the-document's-address">URL</a> of the
   <code id=script-settings-for-browsing-contexts:document><a href=dom.html#document>Document</a></code> with which <var>window</var> associated.</li><li>
    <p>Let <var>settings object</var> be a new <a id=script-settings-for-browsing-contexts:environment-settings-object href=webappapis.html#environment-settings-object>environment settings object</a> whose
    algorithms are defined as follows:</p>

    <dl><dt>The <a id=script-settings-for-browsing-contexts:realm-execution-context href=webappapis.html#realm-execution-context>realm execution context</a><dd>

      <p>Return <var>execution context</var>.</p>

     <dt>The <a id=script-settings-for-browsing-contexts:module-map href=webappapis.html#module-map>module map</a><dd>

      <p>Return the <a href=dom.html#concept-document-module-map id=script-settings-for-browsing-contexts:concept-document-module-map>module map</a> of the
      <code id=script-settings-for-browsing-contexts:document-2><a href=dom.html#document>Document</a></code> with which <var>window</var> is currently associated.</p>

     <dt>The <a id=script-settings-for-browsing-contexts:responsible-browsing-context href=webappapis.html#responsible-browsing-context>responsible browsing context</a><dd>

      <p>Return the <a href=#browsing-context id=script-settings-for-browsing-contexts:browsing-context>browsing context</a> with which <var>window</var> is associated.</p>

     <dt>The <a id=script-settings-for-browsing-contexts:responsible-event-loop href=webappapis.html#responsible-event-loop>responsible event loop</a><dd>

      <p>Return the <a id=script-settings-for-browsing-contexts:event-loop href=webappapis.html#event-loop>event loop</a> that is associated with the <a href=#unit-of-related-similar-origin-browsing-contexts id=script-settings-for-browsing-contexts:unit-of-related-similar-origin-browsing-contexts>unit of related
      similar-origin browsing contexts</a> to which <var>window</var>'s <a href=#browsing-context id=script-settings-for-browsing-contexts:browsing-context-2>browsing
      context</a> belongs.</p>

     <dt>The <a id=script-settings-for-browsing-contexts:responsible-document href=webappapis.html#responsible-document>responsible document</a><dd>

      <p>Return the <code id=script-settings-for-browsing-contexts:document-3><a href=dom.html#document>Document</a></code> with which <var>window</var> is currently associated.</p>

     <dt>The <a id=script-settings-for-browsing-contexts:api-url-character-encoding href=webappapis.html#api-url-character-encoding>API URL character encoding</a><dd>

      <p>Return the current <a href=https://triple-underscore.github.io/DOM4-ja.html#concept-document-encoding id="script-settings-for-browsing-contexts:document's-character-encoding" data-x-internal="document's-character-encoding">character encoding</a> of
      the <code id=script-settings-for-browsing-contexts:document-4><a href=dom.html#document>Document</a></code> with which <var>window</var> is currently associated.</p>

     <dt>The <a id=script-settings-for-browsing-contexts:api-base-url href=webappapis.html#api-base-url>API base URL</a><dd>

      <p>Return the current <a href=infrastructure.html#document-base-url id=script-settings-for-browsing-contexts:document-base-url>base URL</a> of the
      <code id=script-settings-for-browsing-contexts:document-5><a href=dom.html#document>Document</a></code> with which <var>window</var> is currently associated.</p>

     <dt>The <a href=#concept-origin id=script-settings-for-browsing-contexts:concept-origin>origin</a><dd>

      <p>Return the <a href=#concept-origin id=script-settings-for-browsing-contexts:concept-origin-2>origin</a> of the <code id=script-settings-for-browsing-contexts:document-6><a href=dom.html#document>Document</a></code> with which <var>window</var>
      is currently associated.</p>

     <dt>The <a id=script-settings-for-browsing-contexts:creation-url href=webappapis.html#creation-url>creation URL</a><dd>

      <p>Return <var>url</var>.</p>

     <dt>The <a id=script-settings-for-browsing-contexts:https-state href=webappapis.html#https-state>HTTPS state</a><dd>

      <p>Return the <a href=dom.html#concept-document-https-state id=script-settings-for-browsing-contexts:concept-document-https-state>HTTPS state</a> of the
      <code id=script-settings-for-browsing-contexts:document-7><a href=dom.html#document>Document</a></code> with which <var>window</var> is currently associated.</p>

     </dl>
   </li><li><p>Set <var>realm</var>'s [[HostDefined]] field to <var>settings object</var>.</li><li><p>Return <var>settings object</var>.</li></ol>

  



  <h3 id=cross-origin-objects>7.2 Security infrastructure for <code id=cross-origin-objects:window><a href=#window>Window</a></code>,
  <code id=cross-origin-objects:windowproxy><a href=#windowproxy>WindowProxy</a></code>, and <code id=cross-origin-objects:location><a href=#location>Location</a></code> objects</h3>

  <p>Although typically objects cannot be accessed across <a href=#concept-origin id=cross-origin-objects:concept-origin>origins</a>, the
  web platform would not be true to itself if it did not have some legacy exceptions to that rule
  that the web depends upon.


  


  <h4 id=integration-with-idl>7.2.1 Integration with IDL</h4>

  <p>When <a id=integration-with-idl:perform-a-security-check href=https://triple-underscore.github.io/WebIDL-ja.html#dfn-perform-a-security-check data-x-internal=perform-a-security-check>perform a security check</a> is invoked, with a <var>platformObject</var>,
  <var>realm</var>, <var>identifier</var>, and <var>type</var>, run these steps:</p>

  <ol><li>
    <p>If <var>platformObject</var> is a <code id=integration-with-idl:window><a href=#window>Window</a></code> or <code id=integration-with-idl:location><a href=#location>Location</a></code> object,
    then:</p>

    <ol><li>
      <p>Repeat for each <var>e</var> that is an element of
      <a href=#crossoriginproperties-(-o-) id=integration-with-idl:crossoriginproperties-(-o-)>CrossOriginProperties</a>(<var>platformObject</var>):</p>

      <ol><li>
        <p>If <a id=integration-with-idl:samevalue href=https://tc39.github.io/ecma262/#sec-samevalue data-x-internal=samevalue>SameValue</a>(<var>e</var>.[[Property]], <var>identifier</var>) is true,
        then:</p>

        <ol><li><p>If <var>type</var> is "<code>method</code>" and <var>e</var> has neither
         [[NeedsGet]] nor [[NeedsGet]], then return.</li><li><p>Otherwise, if <var>type</var> is "<code>getter</code>" and
         <var>e</var>.[[NeedsGet]] is true, then return.</li><li><p>Otherwise, if <var>type</var> is "<code>setter</code>" and
         <var>e</var>.[[NeedsSet]] is true, then return.</li></ol>
       </li></ol>
     </li></ol>
   </li><li><p>If <a href=#isplatformobjectsameorigin-(-o-) id=integration-with-idl:isplatformobjectsameorigin-(-o-)>IsPlatformObjectSameOrigin</a>(<var>platformObject</var>) is false, then throw
   a <a id=integration-with-idl:securityerror href=https://triple-underscore.github.io/WebIDL-ja.html#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a> <code id=integration-with-idl:domexception><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.</li></ol>


  <h4 id=shared-internal-slot:-[[crossoriginpropertydescriptormap]]>7.2.2 Shared internal slot: [[CrossOriginPropertyDescriptorMap]]</h4>

  <p><code id=shared-internal-slot:-[[crossoriginpropertydescriptormap]]:window><a href=#window>Window</a></code> and <code id=shared-internal-slot:-[[crossoriginpropertydescriptormap]]:location><a href=#location>Location</a></code> objects both have a
  [[<dfn id=crossoriginpropertydescriptormap>CrossOriginPropertyDescriptorMap</dfn>]] internal slot, whose value is initially an empty
  map.

  

  <p class=note>The [[<a href=#crossoriginpropertydescriptormap id=shared-internal-slot:-[[crossoriginpropertydescriptormap]]:crossoriginpropertydescriptormap>CrossOriginPropertyDescriptorMap</a>]] internal slot contains a map
  with entries whose keys are (<var>currentOrigin</var>, <var>objectOrigin</var>,
  <var>propertyKey</var>)-tuples and values are property descriptors, as a memoization of what is
  visible to scripts when <var>currentOrigin</var> inspects a <code id=shared-internal-slot:-[[crossoriginpropertydescriptormap]]:window-2><a href=#window>Window</a></code> or
  <code id=shared-internal-slot:-[[crossoriginpropertydescriptormap]]:location-2><a href=#location>Location</a></code> object from <var>objectOrigin</var>. It is filled lazily by
  <a href=#crossorigingetownpropertyhelper-(-o,-p-) id=shared-internal-slot:-[[crossoriginpropertydescriptormap]]:crossorigingetownpropertyhelper-(-o,-p-)>CrossOriginGetOwnPropertyHelper</a>, which consults it on future lookups.</p>

  <p>User agents should allow a value held in the map to be garbage collected along with its
  corresponding key when nothing holds a reference to any part of the value. That is, as long as
  garbage collection is not observable.</p>

  <p class=example>For example, with <code>const href =
  Object.getOwnPropertyDescriptor(crossOriginLocation, "href").set</code> the value and its
  corresponding key in the map cannot be garbage collected as that would be observable.</p>

  <p>User agents may have an optimization whereby they remove key-value pairs from the map when
  <code id=shared-internal-slot:-[[crossoriginpropertydescriptormap]]:dom-document-domain><a href=#dom-document-domain>document.domain</a></code> is set. This is not observable as <code id=shared-internal-slot:-[[crossoriginpropertydescriptormap]]:dom-document-domain-2><a href=#dom-document-domain>document.domain</a></code> cannot revisit an earlier value.</p>

  <p class=example>For example, setting <code id=shared-internal-slot:-[[crossoriginpropertydescriptormap]]:dom-document-domain-3><a href=#dom-document-domain>document.domain</a></code>
  to "<code>example.com</code>" on www.example.com means user agents can remove all
  key-value pairs from the map where part of the key is www.example.com, as that can never be part
  of the <a href=#concept-origin id=shared-internal-slot:-[[crossoriginpropertydescriptormap]]:concept-origin>origin</a> again and therefore the corresponding value could never be retrieved
  from the map.</p>


  <h4 id=shared-abstract-operations>7.2.3 Shared abstract operations</h4>

  <h5 id=crossoriginproperties-(-o-)>7.2.3.1 <dfn>CrossOriginProperties</dfn> ( <var>O</var> )</h5>

  <ol><li><p>Assert: <var>O</var> is a <code id=crossoriginproperties-(-o-):location><a href=#location>Location</a></code> or <code id=crossoriginproperties-(-o-):window><a href=#window>Window</a></code> object.</li><li><p>If <var>O</var> is a <code id=crossoriginproperties-(-o-):location-2><a href=#location>Location</a></code> object, then return «
   { [[Property]]: "<code>href</code>", [[NeedsGet]]: false, [[NeedsSet]]: true },
   { [[Property]]: "<code>replace</code>" } ».</li><li><p>Let <var>crossOriginWindowProperties</var> be «
   { [[Property]]: "<code>window</code>", [[NeedsGet]]: true, [[NeedsSet]]: false },
   { [[Property]]: "<code>self</code>", [[NeedsGet]]: true, [[NeedsSet]]: false },
   { [[Property]]: "<code>location</code>", [[NeedsGet]]: true, [[NeedsSet]]: true },
   { [[Property]]: "<code>close</code>" },
   { [[Property]]: "<code>closed</code>", [[NeedsGet]]: true, [[NeedsSet]]: false },
   { [[Property]]: "<code>focus</code>" },
   { [[Property]]: "<code>blur</code>" },
   { [[Property]]: "<code>frames</code>", [[NeedsGet]]: true, [[NeedsSet]]: false },
   { [[Property]]: "<code>length</code>", [[NeedsGet]]: true, [[NeedsSet]]: false },
   { [[Property]]: "<code>top</code>", [[NeedsGet]]: true, [[NeedsSet]]: false },
   { [[Property]]: "<code>opener</code>", [[NeedsGet]]: true, [[NeedsSet]]: false },
   { [[Property]]: "<code>parent</code>", [[NeedsGet]]: true, [[NeedsSet]]: false },
   { [[Property]]: "<code>postMessage</code>" } ».</li><li>
    <p>Repeat for each <var>e</var> that is an element of the <a href=#child-browsing-context-name-property-set id=crossoriginproperties-(-o-):child-browsing-context-name-property-set>child browsing context name
    property set</a>:</p>

    <ol><li><p>Add { [[Property]]: <var>e</var> } as the last element of
     <var>crossOriginWindowProperties</var>.</li></ol>
   </li><li><p>Return <var>crossOriginWindowProperties</var>.</li></ol>

  <p class=note>Indexed properties do not need to be safelisted as they are handled directly by
  the <code id=crossoriginproperties-(-o-):windowproxy><a href=#windowproxy>WindowProxy</a></code> object.</p>

  <h5 id=isplatformobjectsameorigin-(-o-)>7.2.3.2 <dfn>IsPlatformObjectSameOrigin</dfn> ( <var>O</var> )</h5>

  <ol><li><p>Return true if the <a id=isplatformobjectsameorigin-(-o-):current-settings-object href=webappapis.html#current-settings-object>current settings object</a>'s <a href=#concept-origin id=isplatformobjectsameorigin-(-o-):concept-origin>origin</a> is
   <a href=#same-origin-domain id=isplatformobjectsameorigin-(-o-):same-origin-domain>same origin-domain</a> with <var>O</var>'s <a id=isplatformobjectsameorigin-(-o-):relevant-settings-object href=webappapis.html#relevant-settings-object>relevant settings object</a>'s
   <a href=#concept-origin id=isplatformobjectsameorigin-(-o-):concept-origin-2>origin</a>, and false otherwise.</li></ol>

  <h5 id=crossorigingetownpropertyhelper-(-o,-p-)>7.2.3.3 <dfn>CrossOriginGetOwnPropertyHelper</dfn> ( <var>O</var>, <var>P</var> )</h5>

  <p class=note>If this abstract operation returns undefined and there is no custom behaviour, the
  caller needs to throw a <a id=crossorigingetownpropertyhelper-(-o,-p-):securityerror href=https://triple-underscore.github.io/WebIDL-ja.html#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a> <code id=crossorigingetownpropertyhelper-(-o,-p-):domexception><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.</p>

  <ol><li><p>If <var>P</var> is <a id=crossorigingetownpropertyhelper-(-o,-p-):@@tostringtag href=infrastructure.html#@@tostringtag>@@toStringTag</a>, <a id=crossorigingetownpropertyhelper-(-o,-p-):@@hasinstance href=infrastructure.html#@@hasinstance>@@hasInstance</a>, or
   <a id=crossorigingetownpropertyhelper-(-o,-p-):@@isconcatspreadable href=infrastructure.html#@@isconcatspreadable>@@isConcatSpreadable</a>, then return <a id=crossorigingetownpropertyhelper-(-o,-p-):propertydescriptor href=https://tc39.github.io/ecma262/#sec-property-descriptor-specification-type data-x-internal=propertydescriptor>PropertyDescriptor</a>{
   [[Value]]: undefined,
   [[Writable]]: false,
   [[Enumerable]]: false,
   [[Configurable]]: true }.</li><li><p>Let <var>crossOriginKey</var> be a tuple consisting of the <a id=crossorigingetownpropertyhelper-(-o,-p-):current-settings-object href=webappapis.html#current-settings-object>current settings
   object</a>'s <a href=#concept-origin id=crossorigingetownpropertyhelper-(-o,-p-):concept-origin>origin</a>'s <a href=#concept-origin-effective-domain id=crossorigingetownpropertyhelper-(-o,-p-):concept-origin-effective-domain>effective
   domain</a>, <var>O</var>'s <a id=crossorigingetownpropertyhelper-(-o,-p-):relevant-settings-object href=webappapis.html#relevant-settings-object>relevant settings object</a>'s <a href=#concept-origin id=crossorigingetownpropertyhelper-(-o,-p-):concept-origin-2>origin</a>'s <a href=#concept-origin-effective-domain id=crossorigingetownpropertyhelper-(-o,-p-):concept-origin-effective-domain-2>effective domain</a>, and <var>P</var>.</li><li>
    <p>Repeat for each <var>e</var> that is an element of
    <a href=#crossoriginproperties-(-o-) id=crossorigingetownpropertyhelper-(-o,-p-):crossoriginproperties-(-o-)>CrossOriginProperties</a>(<var>O</var>):</p>

    <ol><li>
      <p>If <a id=crossorigingetownpropertyhelper-(-o,-p-):samevalue href=https://tc39.github.io/ecma262/#sec-samevalue data-x-internal=samevalue>SameValue</a>(<var>e</var>.[[Property]], <var>P</var>) is true, then:</p>

      <ol><li><p>If the value of the [[<a href=#crossoriginpropertydescriptormap id=crossorigingetownpropertyhelper-(-o,-p-):crossoriginpropertydescriptormap>CrossOriginPropertyDescriptorMap</a>]] internal slot of
       <var>O</var> contains an entry whose key is <var>crossOriginKey</var>, then return that
       entry's value.</li><li><p>Let <var>originalDesc</var> be <a id=crossorigingetownpropertyhelper-(-o,-p-):ordinarygetownproperty href=https://tc39.github.io/ecma262/#sec-ordinarygetownproperty data-x-internal=ordinarygetownproperty>OrdinaryGetOwnProperty</a>(<var>O</var>,
       <var>P</var>).</li><li><p>Let <var>crossOriginDesc</var> be
       <a href=#crossoriginpropertydescriptor-(-crossoriginproperty,-originaldesc-) id=crossorigingetownpropertyhelper-(-o,-p-):crossoriginpropertydescriptor-(-crossoriginproperty,-originaldesc-)>CrossOriginPropertyDescriptor</a>(<var>e</var>, <var>originalDesc</var>).</li><li><p>Create an entry in the value of the [[<a href=#crossoriginpropertydescriptormap id=crossorigingetownpropertyhelper-(-o,-p-):crossoriginpropertydescriptormap-2>CrossOriginPropertyDescriptorMap</a>]]
       internal slot of <var>O</var> with key <var>crossOriginKey</var> and value
       <var>crossOriginDesc</var>.</li><li><p>Return <var>crossOriginDesc</var>.</li></ol>
     </li></ol>
   </li><li><p>Return undefined.</li></ol>

  <h6 id=crossoriginpropertydescriptor-(-crossoriginproperty,-originaldesc-)>7.2.3.3.1 <dfn>CrossOriginPropertyDescriptor</dfn> ( <var>crossOriginProperty</var>,
  <var>originalDesc</var> )</h6>

  <ol><li>
    <p>If <var>crossOriginProperty</var>.[[NeedsGet]] and
    <var>crossOriginProperty</var>.[[NeedsSet]] are absent, then:</p>

    <ol><li><p>Let <var>value</var> be <var>originalDesc</var>.[[Value]].</li><li><p>If <a id=crossoriginpropertydescriptor-(-crossoriginproperty,-originaldesc-):iscallable href=https://tc39.github.io/ecma262/#sec-iscallable data-x-internal=iscallable>IsCallable</a>(<var>value</var>) is true, set <var>value</var> to
     <a href=#crossoriginfunctionwrapper-(-needswrapping,-functiontowrap-) id=crossoriginpropertydescriptor-(-crossoriginproperty,-originaldesc-):crossoriginfunctionwrapper-(-needswrapping,-functiontowrap-)>CrossOriginFunctionWrapper</a>(true, <var>value</var>).</li><li><p>Return <a id=crossoriginpropertydescriptor-(-crossoriginproperty,-originaldesc-):propertydescriptor href=https://tc39.github.io/ecma262/#sec-property-descriptor-specification-type data-x-internal=propertydescriptor>PropertyDescriptor</a>{
     [[Value]]: <var>value</var>,
     [[Enumerable]]: false,
     [[Writable]]: false,
     [[Configurable]]: true }.</li></ol>
   </li><li>
    <p>そうでなければ：</p>

    <ol><li><p>Let <var>crossOriginGet</var> be
     <a href=#crossoriginfunctionwrapper-(-needswrapping,-functiontowrap-) id=crossoriginpropertydescriptor-(-crossoriginproperty,-originaldesc-):crossoriginfunctionwrapper-(-needswrapping,-functiontowrap-)-2>CrossOriginFunctionWrapper</a>(<var>crossOriginProperty</var>.[[NeedsGet]],
     <var>originalDesc</var>.[[Get]]).</li><li><p>Let <var>crossOriginSet</var> be
     <a href=#crossoriginfunctionwrapper-(-needswrapping,-functiontowrap-) id=crossoriginpropertydescriptor-(-crossoriginproperty,-originaldesc-):crossoriginfunctionwrapper-(-needswrapping,-functiontowrap-)-3>CrossOriginFunctionWrapper</a>(<var>crossOriginProperty</var>.[[NeedsSet]],
     <var>originalDesc</var>.[[Set]]).</li><li><p>Return <a id=crossoriginpropertydescriptor-(-crossoriginproperty,-originaldesc-):propertydescriptor-2 href=https://tc39.github.io/ecma262/#sec-property-descriptor-specification-type data-x-internal=propertydescriptor>PropertyDescriptor</a>{
     [[Get]]: <var>crossOriginGet</var>,
     [[Set]]: <var>crossOriginSet</var>,
     [[Enumerable]]: false,
     [[Configurable]]: true }.</li></ol>
   </li></ol>

  <h6 id=crossoriginfunctionwrapper-(-needswrapping,-functiontowrap-)>7.2.3.3.2 <dfn>CrossOriginFunctionWrapper</dfn> ( <var>needsWrapping</var>, <var>functionToWrap</var>
  )</h6>

  <ol><li><p>If <var>needsWrapping</var> is false, then return undefined.</li><li><p>Return a new <a href=#cross-origin-wrapper-function id=crossoriginfunctionwrapper-(-needswrapping,-functiontowrap-):cross-origin-wrapper-function>cross-origin wrapper function</a> whose [[Wrapped]] internal slot is
   <var>functionToWrap</var>.</li></ol>

  <hr>

  <p>A <dfn id=cross-origin-wrapper-function>cross-origin wrapper function</dfn> is an anonymous built-in function that has a
  [[Wrapped]] internal slot.</p>

  <p>When a <a href=#cross-origin-wrapper-function id=crossoriginfunctionwrapper-(-needswrapping,-functiontowrap-):cross-origin-wrapper-function-2>cross-origin wrapper function</a> <var>F</var> is called with a list of
  arguments <var>argumentsList</var>, the following steps are taken:</p>

  <ol><li><p>Assert: <var>F</var> has a [[Wrapped]] internal slot that is a function.</li><li><p>Let <var>wrappedFunction</var> be the [[Wrapped]] internal slot of <var>F</var>.</li><li><p>Return ? <a id=crossoriginfunctionwrapper-(-needswrapping,-functiontowrap-):call href=https://tc39.github.io/ecma262/#sec-call data-x-internal=call>Call</a>(<var>wrappedFunction</var>, <b>this</b>,
   <var>argumentsList</var>).</li></ol>

  <p class=note>Due to this being invoked from a different <a href=#concept-origin id=crossoriginfunctionwrapper-(-needswrapping,-functiontowrap-):concept-origin>origin</a>, a
  <a href=#cross-origin-wrapper-function id=crossoriginfunctionwrapper-(-needswrapping,-functiontowrap-):cross-origin-wrapper-function-3>cross-origin wrapper function</a> will have a different value for
  <code>Function.prototype</code> from the function being wrapped. This follows from how
  JavaScript creates anonymous built-in functions.</p>

  <h5 id=crossoriginget-(-o,-p,-receiver-)>7.2.3.4 <dfn>CrossOriginGet</dfn> ( <var>O</var>, <var>P</var>, <var>Receiver</var> )</h5>

  <ol><li><p>Let <var>desc</var> be ? <var>O</var>.[[GetOwnProperty]](<var>P</var>).</li><li><p>Assert: <var>desc</var> is not undefined.</li><li><p>If <a id=crossoriginget-(-o,-p,-receiver-):isdatadescriptor href=https://tc39.github.io/ecma262/#sec-isdatadescriptor data-x-internal=isdatadescriptor>IsDataDescriptor</a>(<var>desc</var>) is true, then return
   <var>desc</var>.[[Value]].</li><li><p>Assert: <a id=crossoriginget-(-o,-p,-receiver-):isaccessordescriptor href=https://tc39.github.io/ecma262/#sec-isaccessordescriptor data-x-internal=isaccessordescriptor>IsAccessorDescriptor</a>(<var>desc</var>) is true.</li><li><p>Let <var>getter</var> be <var>desc</var>.[[Get]].</li><li><p>If <var>getter</var> is undefined, throw a <a id=crossoriginget-(-o,-p,-receiver-):securityerror href=https://triple-underscore.github.io/WebIDL-ja.html#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a>
   <code id=crossoriginget-(-o,-p,-receiver-):domexception><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.</li><li><p>Return ? <a id=crossoriginget-(-o,-p,-receiver-):call href=https://tc39.github.io/ecma262/#sec-call data-x-internal=call>Call</a>(<var>getter</var>, <var>Receiver</var>).</li></ol>

  <h5 id=crossoriginset-(-o,-p,-v,-receiver-)>7.2.3.5 <dfn>CrossOriginSet</dfn> ( <var>O</var>, <var>P</var>, <var>V</var>,
  <var>Receiver</var> )</h5>

  <ol><li><p>Let <var>desc</var> be ? <var>O</var>.[[GetOwnProperty]](<var>P</var>).</li><li><p>Assert: <var>desc</var> is not undefined.</li><li>
    <p>If <a id=crossoriginset-(-o,-p,-v,-receiver-):isaccessordescriptor href=https://tc39.github.io/ecma262/#sec-isaccessordescriptor data-x-internal=isaccessordescriptor>IsAccessorDescriptor</a>(<var>desc</var>) is true, then:</p>

    <ol><li><p>Let <var>setter</var> be <var>desc</var>.[[Set]].</li><li><p>If <var>setter</var> is undefined, return false.</li><li><p>Perform ? <a id=crossoriginset-(-o,-p,-v,-receiver-):call href=https://tc39.github.io/ecma262/#sec-call data-x-internal=call>Call</a>(<var>setter</var>, <var>Receiver</var>,
     «<var>V</var>»).</li><li><p>Return true.</li></ol>
   </li><li><p>Return false.</li></ol>

  <h5 id=crossoriginownpropertykeys-(-o-)>7.2.3.6 <dfn>CrossOriginOwnPropertyKeys</dfn> ( <var>O</var> )</h5>

  <ol><li><p>Let <var>keys</var> be a new empty <a id=crossoriginownpropertykeys-(-o-):list href=https://tc39.github.io/ecma262/#sec-list-and-record-specification-type data-x-internal=list>List</a>.</li><li>
    <p>Repeat for each <var>e</var> that is an element of
    <a href=#crossoriginproperties-(-o-) id=crossoriginownpropertykeys-(-o-):crossoriginproperties-(-o-)>CrossOriginProperties</a>(<var>O</var>):</p>

    <ol><li><p>Add <var>e</var>.[[Property]] as the last element of <var>keys</var>.</li></ol>
   </li><li><p>Return <var>keys</var>.</li></ol>



  <h3 id=the-window-object>7.3 The <code id=the-window-object:window><a href=#window>Window</a></code> object</h3>

  <pre class=idl>[PrimaryGlobal, LegacyUnenumerableNamedProperties] 
/*sealed*/ interface <dfn id=window>Window</dfn> : <a id=the-window-object:eventtarget href=https://triple-underscore.github.io/DOM4-ja.html#interface-eventtarget data-x-internal=eventtarget>EventTarget</a> {
  // the current browsing context
  [Unforgeable] readonly attribute <a href=#windowproxy id=the-window-object:windowproxy>WindowProxy</a> <a href=#dom-window id=the-window-object:dom-window>window</a>;
  [Replaceable] readonly attribute <a href=#windowproxy id=the-window-object:windowproxy-2>WindowProxy</a> <a href=#dom-self id=the-window-object:dom-self>self</a>;
  [Unforgeable] readonly attribute <a id=the-window-object:document href=dom.html#document>Document</a> <a href=#dom-document-2 id=the-window-object:dom-document-2>document</a>;
  attribute DOMString <a href=#dom-name id=the-window-object:dom-name>name</a>;
  [PutForwards=<a href=#dom-location-href id=the-window-object:dom-location-href>href</a>, Unforgeable] readonly attribute <a href=#location id=the-window-object:location>Location</a> <a href=#dom-location id=the-window-object:dom-location>location</a>;
  readonly attribute <a href=#history-3 id=the-window-object:history-3>History</a> <a href=#dom-history id=the-window-object:dom-history>history</a>;
  readonly attribute <a id=the-window-object:customelementsregistry href=scripting.html#customelementsregistry>CustomElementsRegistry</a> <a href=scripting.html#dom-window-customelements id=the-window-object:dom-window-customelements>customElements</a>;
  [Replaceable] readonly attribute <a href=#barprop id=the-window-object:barprop>BarProp</a> <a href=#dom-window-locationbar id=the-window-object:dom-window-locationbar>locationbar</a>;
  [Replaceable] readonly attribute <a href=#barprop id=the-window-object:barprop-2>BarProp</a> <a href=#dom-window-menubar id=the-window-object:dom-window-menubar>menubar</a>;
  [Replaceable] readonly attribute <a href=#barprop id=the-window-object:barprop-3>BarProp</a> <a href=#dom-window-personalbar id=the-window-object:dom-window-personalbar>personalbar</a>;
  [Replaceable] readonly attribute <a href=#barprop id=the-window-object:barprop-4>BarProp</a> <a href=#dom-window-scrollbars id=the-window-object:dom-window-scrollbars>scrollbars</a>;
  [Replaceable] readonly attribute <a href=#barprop id=the-window-object:barprop-5>BarProp</a> <a href=#dom-window-statusbar id=the-window-object:dom-window-statusbar>statusbar</a>;
  [Replaceable] readonly attribute <a href=#barprop id=the-window-object:barprop-6>BarProp</a> <a href=#dom-window-toolbar id=the-window-object:dom-window-toolbar>toolbar</a>;
  attribute DOMString <a href=#dom-window-status id=the-window-object:dom-window-status>status</a>;
  void <a href=#dom-window-close id=the-window-object:dom-window-close>close</a>();
  readonly attribute boolean <a href=#dom-window-closed id=the-window-object:dom-window-closed>closed</a>;
  void <a href=#dom-window-stop id=the-window-object:dom-window-stop>stop</a>();
  void <a href=interaction.html#dom-window-focus id=the-window-object:dom-window-focus>focus</a>();
  void <a href=interaction.html#dom-window-blur id=the-window-object:dom-window-blur>blur</a>();

  // other browsing contexts
  [Replaceable] readonly attribute <a href=#windowproxy id=the-window-object:windowproxy-3>WindowProxy</a> <a href=#dom-frames id=the-window-object:dom-frames>frames</a>;
  [Replaceable] readonly attribute unsigned long <a href=#dom-length id=the-window-object:dom-length>length</a>;
  [Unforgeable] readonly attribute <a href=#windowproxy id=the-window-object:windowproxy-4>WindowProxy</a> <a href=#dom-top id=the-window-object:dom-top>top</a>;
  attribute any <a href=#dom-opener id=the-window-object:dom-opener>opener</a>;
  [Replaceable] readonly attribute <a href=#windowproxy id=the-window-object:windowproxy-5>WindowProxy</a> <a href=#dom-parent id=the-window-object:dom-parent>parent</a>;
  readonly attribute <a id=the-window-object:element href=https://triple-underscore.github.io/DOM4-ja.html#interface-element data-x-internal=element>Element</a>?<a href=#dom-frameelement id=the-window-object:dom-frameelement>frameElement</a>;
  <a href=#windowproxy id=the-window-object:windowproxy-6>WindowProxy</a>?<a href=#dom-open id=the-window-object:dom-open>open</a>(optional DOMString url = "about:blank", optional DOMString target = "_blank", [TreatNullAs=EmptyString] optional DOMString features = "", optional boolean replace = false);
  <a href=#dom-window-nameditem id=the-window-object:dom-window-nameditem>getter</a> <a href=https://triple-underscore.github.io/WebIDL-ja.html#idl-object id=the-window-object:idl-object data-x-internal=idl-object>object</a> (DOMString name);
  // Since this is the global object, the IDL named getter adds a NamedPropertiesObject exotic
  // object on the prototype chain. Indeed, this does not make the global object an exotic object.
  // Indexed access is taken care of by the <a href=#windowproxy id=the-window-object:windowproxy-7>WindowProxy</a> exotic object.

  // the user agent
  readonly attribute <a id=the-window-object:navigator href=webappapis.html#navigator>Navigator</a> <a href=webappapis.html#dom-navigator id=the-window-object:dom-navigator>navigator</a>;
  readonly attribute <a href=#applicationcache id=the-window-object:applicationcache>ApplicationCache</a> <a href=#dom-applicationcache id=the-window-object:dom-applicationcache>applicationCache</a>;

  // user prompts
  void <a href=webappapis.html#dom-alert id=the-window-object:dom-alert>alert</a>();
  void <a href=webappapis.html#dom-alert id=the-window-object:dom-alert-2>alert</a>(DOMString message);
  boolean <a href=webappapis.html#dom-confirm id=the-window-object:dom-confirm>confirm</a>(optional DOMString message = "");
  DOMString?<a href=webappapis.html#dom-prompt id=the-window-object:dom-prompt>prompt</a>(optional DOMString message = "", optional DOMString default = "");
  void <a href=webappapis.html#dom-print id=the-window-object:dom-print>print</a>();

  unsigned long <a href=webappapis.html#dom-window-requestanimationframe id=the-window-object:dom-window-requestanimationframe>requestAnimationFrame</a>(<a href=#framerequestcallback id=the-window-object:framerequestcallback>FrameRequestCallback</a> callback);
  void <a href=webappapis.html#dom-window-cancelanimationframe id=the-window-object:dom-window-cancelanimationframe>cancelAnimationFrame</a>(unsigned long handle);

  void <a href=comms.html#dom-window-postmessage id=the-window-object:dom-window-postmessage>postMessage</a>(any message, DOMString targetOrigin, optional sequence&lt;<a href=https://triple-underscore.github.io/WebIDL-ja.html#idl-object id=the-window-object:idl-object-2 data-x-internal=idl-object>object</a>&gt; transfer = []);
};
<a href=#window id=the-window-object:window-2>Window</a> implements <a id=the-window-object:globaleventhandlers href=webappapis.html#globaleventhandlers>GlobalEventHandlers</a>;
<a href=#window id=the-window-object:window-3>Window</a> implements <a id=the-window-object:windoweventhandlers href=webappapis.html#windoweventhandlers>WindowEventHandlers</a>;

callback <dfn id=framerequestcallback>FrameRequestCallback</dfn> = void (<a id=the-window-object:domhighrestimestamp href=https://w3c.github.io/hr-time/#dom-domhighrestimestamp data-x-internal=domhighrestimestamp>DOMHighResTimeStamp</a> time);</pre>



  <dl class=domintro><dt><var>window</var> . <code id=the-window-object:dom-window-2><a href=#dom-window>window</a></code><dt><var>window</var> . <code id=the-window-object:dom-frames-2><a href=#dom-frames>frames</a></code><dt><var>window</var> . <code id=the-window-object:dom-self-2><a href=#dom-self>self</a></code><dd>

    <p>これらの属性すべては<var>window</var>を返す。</p>

   <dt><var>window</var> . <code id=the-window-object:dom-document-2-2><a href=#dom-document-2>document</a></code><dd>

    <p><var>window</var>と関連する<code id=the-window-object:document-2><a href=dom.html#document>Document</a></code>を返す。</p>

   <dt><var>document</var> . <code id=the-window-object:dom-document-defaultview><a href=#dom-document-defaultview>defaultView</a></code><dd>

    <p><a href=#active-document id=the-window-object:active-document>アクティブドキュメント</a>の<code id=the-window-object:window-4><a href=#window>Window</a></code>オブジェクトを返す。</p>

   </dl>

  

  <p>The <dfn id=dom-window><code>window</code></dfn>, <dfn id=dom-frames><code>frames</code></dfn>, and <dfn id=dom-self><code>self</code></dfn>
  IDL attributes must all return the <code id=the-window-object:window-5><a href=#window>Window</a></code> object's <a href=#browsing-context id=the-window-object:browsing-context>browsing context</a>'s
  <code id=the-window-object:windowproxy-8><a href=#windowproxy>WindowProxy</a></code> object.</p>

  <p>The <dfn id=dom-document-2><code>document</code></dfn> IDL attribute must return
  <a href=#concept-document-window id=the-window-object:concept-document-window>the <code>Window</code> object's newest <code>Document</code> object</a>.</p>

  <p class=note>The <code id=the-window-object:document-3><a href=dom.html#document>Document</a></code> object associated with a <code id=the-window-object:window-6><a href=#window>Window</a></code> object can
  change in exactly one case: when the <a href=#navigate id=the-window-object:navigate>navigate</a> algorithm <a href=#initialise-the-document-object id=the-window-object:initialise-the-document-object>initialises a new <code>Document</code> object</a> for the first page loaded
  in a <a href=#browsing-context id=the-window-object:browsing-context-2>browsing context</a>. In that specific case, the <code id=the-window-object:window-7><a href=#window>Window</a></code> object of the
  original <code id=the-window-object:about:blank><a href=infrastructure.html#about:blank>about:blank</a></code> page is reused and gets a new <code id=the-window-object:document-4><a href=dom.html#document>Document</a></code> object.</p>

  <p>The <dfn id=dom-document-defaultview><code>defaultView</code></dfn> IDL attribute of the
  <code id=the-window-object:document-5><a href=dom.html#document>Document</a></code> interface must return the <code id=the-window-object:document-6><a href=dom.html#document>Document</a></code>'s <a href=#concept-document-bc id=the-window-object:concept-document-bc>browsing context</a>'s <code id=the-window-object:windowproxy-9><a href=#windowproxy>WindowProxy</a></code> object, if there
  is one, or null otherwise.</p>

  <hr>

  <p>For historical reasons, <code id=the-window-object:window-8><a href=#window>Window</a></code> objects must also have a writable, configurable,
  non-enumerable property named <dfn id=htmldocument><code>HTMLDocument</code></dfn> whose value is the
  <code id=the-window-object:document-7><a href=dom.html#document>Document</a></code> interface object.</p>

  


  <h4 id=apis-for-creating-and-navigating-browsing-contexts-by-name>7.3.1 名前でブラウジングコンテキストを作成および操作するためのAPI</h4>

  <dl class=domintro><dt><var>window</var> = <var>window</var> . <code id=apis-for-creating-and-navigating-browsing-contexts-by-name:dom-open><a href=#dom-open>open</a></code>( [ <var>url</var> [, <var>target</var> [, <var>features</var> [, <var>replace</var> ] ] ] ] )<dd>

    <p><var>url</var>（デフォルトで<code id=apis-for-creating-and-navigating-browsing-contexts-by-name:about:blank><a href=infrastructure.html#about:blank>about:blank</a></code>）を表示するためのウィンドウを開き、それを返す。<var>target</var>引数は、新しいウィンドウの名前を与える。すでにその名前をもつウィンドウが存在する場合、それが再利用される。<var>replace</var>属性がtrueの場合、どのページでも、ウィンドウがウィンドウのセッション履歴から削除される現在開いていることを意味する。The <var id=apis-for-creating-and-navigating-browsing-contexts-by-name:dom-open-features><a data-x-internal=dom-open-features href=https://triple-underscore.github.io/cssom-view-ja.html#the-features-argument-to-the-open()-method>features</a></var> argument can be used to influence the rendering of the new window.</p>

   <dt><var>window</var> . <code id=apis-for-creating-and-navigating-browsing-contexts-by-name:dom-name><a href=#dom-name>name</a></code> [ = <var>value</var> ]<dd>

    <p>ウィンドウの名前を返す。</p>

    <p>名前を変更する設定が可能である。</p>

   <dt><var>window</var> . <code id=apis-for-creating-and-navigating-browsing-contexts-by-name:dom-window-close><a href=#dom-window-close>close</a></code>()<dd>

    <p>ウィンドウを閉じる。</p>

   <dt><var>window</var> . <code id=apis-for-creating-and-navigating-browsing-contexts-by-name:dom-window-closed><a href=#dom-window-closed>closed</a></code><dd>

    <p>ウィンドウが閉じられている場合はtrueを返し、そうでなければfalseを返す。</p>

   <dt><var>window</var> . <code id=apis-for-creating-and-navigating-browsing-contexts-by-name:dom-window-stop><a href=#dom-window-stop>stop</a></code>()<dd>

    <p>ドキュメントの読み込みを中止する。</p>

   </dl>

  

  <p>The <dfn id=dom-open><code>open()</code></dfn> method on <code id=apis-for-creating-and-navigating-browsing-contexts-by-name:window><a href=#window>Window</a></code> objects
  provides a mechanism for <a href=#navigate id=apis-for-creating-and-navigating-browsing-contexts-by-name:navigate>navigating</a> an existing <a href=#browsing-context id=apis-for-creating-and-navigating-browsing-contexts-by-name:browsing-context>browsing
  context</a> or opening and navigating an <a href=#auxiliary-browsing-context id=apis-for-creating-and-navigating-browsing-contexts-by-name:auxiliary-browsing-context>auxiliary browsing context</a>.</p>

  <p>When the method is invoked, the user agent must run the following steps:</p>

  <ol><li><p>Let <var>entry settings</var> be the <a id=apis-for-creating-and-navigating-browsing-contexts-by-name:entry-settings-object href=webappapis.html#entry-settings-object>entry settings object</a> when the method
   was invoked.</li><li><p>Let <var>url</var> be the first argument.</li><li><p>Let <var>target</var> be the second argument.</li><li><p>Let <var id=apis-for-creating-and-navigating-browsing-contexts-by-name:dom-open-features-2><a data-x-internal=dom-open-features href=https://triple-underscore.github.io/cssom-view-ja.html#the-features-argument-to-the-open()-method>features</a></var> be the third argument.</li><li><p>Let <var>replace</var> be the fourth argument.</li><li><p>Let <var>source browsing context</var> be the <a id=apis-for-creating-and-navigating-browsing-contexts-by-name:responsible-browsing-context href=webappapis.html#responsible-browsing-context>responsible browsing context</a>
   specified by <var>entry settings</var>.</li><li><p>If <var>target</var> is the empty string, let it be the string "<code>_blank</code>" instead.</li><li>

    <p>If the user has indicated a preference for which <a href=#browsing-context id=apis-for-creating-and-navigating-browsing-contexts-by-name:browsing-context-2>browsing context</a> to navigate,
    follow these substeps:</p>

    <ol><li><p>Let <var>target browsing context</var> be the <a href=#browsing-context id=apis-for-creating-and-navigating-browsing-contexts-by-name:browsing-context-3>browsing context</a> indicated by
     the user.</li><li><p>If <var>target browsing context</var> is a new <a href=#top-level-browsing-context id=apis-for-creating-and-navigating-browsing-contexts-by-name:top-level-browsing-context>top-level browsing context</a>,
     let the <var>source browsing context</var> be set as <var>target browsing context</var>'s
     <a href=#one-permitted-sandboxed-navigator id=apis-for-creating-and-navigating-browsing-contexts-by-name:one-permitted-sandboxed-navigator>one permitted sandboxed navigator</a>.</li></ol>

    <p class=example>For example, suppose there is a user agent that supports control-clicking a
    link to open it in a new tab. If a user clicks in that user agent on an element whose <code id=apis-for-creating-and-navigating-browsing-contexts-by-name:handler-onclick><a href=webappapis.html#handler-onclick>onclick</a></code> handler uses the <code id=apis-for-creating-and-navigating-browsing-contexts-by-name:dom-open-2><a href=#dom-open>window.open()</a></code> API to open a page in an iframe, but, while doing so,
    holds the control key down, the user agent could override the selection of the target browsing
    context to instead target a new tab.</p>

    <p>Otherwise, apply <a href=#the-rules-for-choosing-a-browsing-context-given-a-browsing-context-name id=apis-for-creating-and-navigating-browsing-contexts-by-name:the-rules-for-choosing-a-browsing-context-given-a-browsing-context-name>the rules for choosing a browsing context given a browsing context
    name</a> using <var>target</var> as the name and <var>source browsing context</var> as the
    context in which the algorithm is executed. If this results in there not being a chosen browsing
    context, then throw an <a id=apis-for-creating-and-navigating-browsing-contexts-by-name:invalidaccesserror href=https://triple-underscore.github.io/WebIDL-ja.html#invalidaccesserror data-x-internal=invalidaccesserror>"<code>InvalidAccessError</code>"</a> <code id=apis-for-creating-and-navigating-browsing-contexts-by-name:domexception><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>
    and abort these steps. Otherwise, let <var>target browsing context</var> be the <a href=#browsing-context id=apis-for-creating-and-navigating-browsing-contexts-by-name:browsing-context-4>browsing
    context</a> so obtained.</p>

   </li><li><p>If <var>target browsing context</var> was just created, either as part of <a href=#the-rules-for-choosing-a-browsing-context-given-a-browsing-context-name id=apis-for-creating-and-navigating-browsing-contexts-by-name:the-rules-for-choosing-a-browsing-context-given-a-browsing-context-name-2>the rules
   for choosing a browsing context given a browsing context name</a> or due to the user
   indicating a preference for navigating a new <a href=#top-level-browsing-context id=apis-for-creating-and-navigating-browsing-contexts-by-name:top-level-browsing-context-2>top-level browsing context</a>, then let
   <var>new</var> be true. Otherwise, let it be false.</li><li><p>Interpret <var>features</var> as defined in the CSSOM View specification. <a href=references.html#refsCSSOMVIEW>[CSSOMVIEW]</a></li><li>

    <p>If <var>url</var> is the empty string, run the appropriate steps from the following list:</p>

    <dl><dt>If <var>new</var> is false<dd><p>Jump to the step labeled <i>end</i>.<dt>If <var>new</var> is true<dd><p>Let <var>resource</var> be the <a id=apis-for-creating-and-navigating-browsing-contexts-by-name:url href=https://triple-underscore.github.io/URL-ja.html#concept-url data-x-internal=url>URL</a> "<code id=apis-for-creating-and-navigating-browsing-contexts-by-name:about:blank-2><a href=infrastructure.html#about:blank>about:blank</a></code>".</dl>

    <p>Otherwise, <a href=infrastructure.html#parse-a-url id=apis-for-creating-and-navigating-browsing-contexts-by-name:parse-a-url>parse</a> <var>url</var> relative to <var>entry
    settings</var>, and let <var>resource</var> be the <a id=apis-for-creating-and-navigating-browsing-contexts-by-name:resulting-url-record href=infrastructure.html#resulting-url-record>resulting URL record</a>, if any. If
    the <a id=apis-for-creating-and-navigating-browsing-contexts-by-name:parse-a-url-2 href=infrastructure.html#parse-a-url>parse a URL</a> algorithm failed, then run one of the following two steps
    instead:</p>

    <ul><li><p>Let <var>resource</var> be a resource representing an inline error page.</li><li><p>If <var>new</var> is false, jump to the step labeled <i>end</i>, otherwise, let
     <var>resource</var> be the <a id=apis-for-creating-and-navigating-browsing-contexts-by-name:url-2 href=https://triple-underscore.github.io/URL-ja.html#concept-url data-x-internal=url>URL</a> "<code id=apis-for-creating-and-navigating-browsing-contexts-by-name:about:blank-3><a href=infrastructure.html#about:blank>about:blank</a></code>".</li></ul>

   </li><li>

    <p>If <var>resource</var> is "<code id=apis-for-creating-and-navigating-browsing-contexts-by-name:about:blank-4><a href=infrastructure.html#about:blank>about:blank</a></code>" and <var>new</var> is true, <a id=apis-for-creating-and-navigating-browsing-contexts-by-name:queue-a-task href=webappapis.html#queue-a-task>queue
    a task</a> to <a id=apis-for-creating-and-navigating-browsing-contexts-by-name:fire-a-simple-event href=webappapis.html#fire-a-simple-event>fire a simple event</a> named <code id=apis-for-creating-and-navigating-browsing-contexts-by-name:event-load><a href=indices.html#event-load>load</a></code> at
    <var>target browsing context</var>'s <code id=apis-for-creating-and-navigating-browsing-contexts-by-name:window-2><a href=#window>Window</a></code> object, with <i id=apis-for-creating-and-navigating-browsing-contexts-by-name:concept-event-target-override><a href=infrastructure.html#concept-event-target-override>target override</a></i> set to <var>target browsing
    context</var>'s <a href=#concept-document-window id=apis-for-creating-and-navigating-browsing-contexts-by-name:concept-document-window><code>Window</code> object's
    <code>Document</code></a> object.</p>

    <p>Otherwise, <a href=#navigate id=apis-for-creating-and-navigating-browsing-contexts-by-name:navigate-2>navigate</a> <var>target browsing context</var>
    to <var>resource</var>, with the <var><a href=#exceptions-enabled id=apis-for-creating-and-navigating-browsing-contexts-by-name:exceptions-enabled>exceptions enabled flag</a></var> set. If
    <var>new</var> is true, then <a href=#replacement-enabled id=apis-for-creating-and-navigating-browsing-contexts-by-name:replacement-enabled>replacement must be
    enabled</a>. The <a href=#source-browsing-context id=apis-for-creating-and-navigating-browsing-contexts-by-name:source-browsing-context>source browsing context</a> is <var>source browsing context</var>.
    Rethrow any exceptions.</p>

   </li><li>
    <p><i>End</i>:</p>

    <ol><li><p>If the result of <a href=infrastructure.html#split-a-string-on-commas id=apis-for-creating-and-navigating-browsing-contexts-by-name:split-a-string-on-commas>splitting <var>features</var>
     on commas</a> contains the token "<code>noopener</code>", <a href=#disowned-its-opener id=apis-for-creating-and-navigating-browsing-contexts-by-name:disowned-its-opener>disown <var>target browsing context</var>'s opener</a>, and return <code>null</code>.</li><li><p>Otherwise, return the <code id=apis-for-creating-and-navigating-browsing-contexts-by-name:windowproxy><a href=#windowproxy>WindowProxy</a></code> object of <var>target browsing
     context</var>.</li></ol>

   </li></ol>

  <hr>

  <p>The <dfn id=dom-name><code>name</code></dfn> attribute of the <code id=apis-for-creating-and-navigating-browsing-contexts-by-name:window-3><a href=#window>Window</a></code> object
  must, on getting, return the current <a href=#browsing-context-name id=apis-for-creating-and-navigating-browsing-contexts-by-name:browsing-context-name>name</a> of the
  <a href=#browsing-context id=apis-for-creating-and-navigating-browsing-contexts-by-name:browsing-context-5>browsing context</a>, if one is set, or the empty string otherwise; and, on setting, set
  the <a href=#browsing-context-name id=apis-for-creating-and-navigating-browsing-contexts-by-name:browsing-context-name-2>name</a> of the <a href=#browsing-context id=apis-for-creating-and-navigating-browsing-contexts-by-name:browsing-context-6>browsing context</a> to the
  new value.</p>

  <p class=note>The name <a href=#resetBCName>gets reset</a> when the browsing context is
  navigated to another domain.</p>

  <hr>

  <p>The <dfn id=dom-window-close><code>close()</code></dfn> method on <code id=apis-for-creating-and-navigating-browsing-contexts-by-name:window-4><a href=#window>Window</a></code>
  objects should, if all the following conditions are met, <a href=#close-a-browsing-context id=apis-for-creating-and-navigating-browsing-contexts-by-name:close-a-browsing-context>close</a> the <a href=#browsing-context id=apis-for-creating-and-navigating-browsing-contexts-by-name:browsing-context-7>browsing context</a> <var>A</var>:

  

  <ul class=brief><li>The corresponding <a href=#browsing-context id=apis-for-creating-and-navigating-browsing-contexts-by-name:browsing-context-8>browsing context</a> <var>A</var> is
   <a href=#script-closable id=apis-for-creating-and-navigating-browsing-contexts-by-name:script-closable>script-closable</a>.</li><li>The <a id=apis-for-creating-and-navigating-browsing-contexts-by-name:responsible-browsing-context-2 href=webappapis.html#responsible-browsing-context>responsible browsing context</a> specified by the <a id=apis-for-creating-and-navigating-browsing-contexts-by-name:incumbent-settings-object href=webappapis.html#incumbent-settings-object>incumbent settings
   object</a> is <a href=#familiar-with id=apis-for-creating-and-navigating-browsing-contexts-by-name:familiar-with>familiar with</a> the <a href=#browsing-context id=apis-for-creating-and-navigating-browsing-contexts-by-name:browsing-context-9>browsing context</a> <var>A</var>.</li><li id=sandboxClose>The <a id=apis-for-creating-and-navigating-browsing-contexts-by-name:responsible-browsing-context-3 href=webappapis.html#responsible-browsing-context>responsible browsing context</a> specified by the
   <a id=apis-for-creating-and-navigating-browsing-contexts-by-name:incumbent-settings-object-2 href=webappapis.html#incumbent-settings-object>incumbent settings object</a> is <a href=#allowed-to-navigate id=apis-for-creating-and-navigating-browsing-contexts-by-name:allowed-to-navigate>allowed to navigate</a> the <a href=#browsing-context id=apis-for-creating-and-navigating-browsing-contexts-by-name:browsing-context-10>browsing
   context</a> <var>A</var>.</li></ul>

  <p>A <a href=#browsing-context id=apis-for-creating-and-navigating-browsing-contexts-by-name:browsing-context-11>browsing context</a> is <dfn id=script-closable>script-closable</dfn> if it is an <a href=#auxiliary-browsing-context id=apis-for-creating-and-navigating-browsing-contexts-by-name:auxiliary-browsing-context-2>auxiliary
  browsing context</a> that was created by a script (as opposed to by an action of the user), or
  if it is a <a href=#top-level-browsing-context id=apis-for-creating-and-navigating-browsing-contexts-by-name:top-level-browsing-context-3>top-level browsing context</a> whose <a href=#session-history id=apis-for-creating-and-navigating-browsing-contexts-by-name:session-history>session history</a> contains
  only one <code id=apis-for-creating-and-navigating-browsing-contexts-by-name:document><a href=dom.html#document>Document</a></code>.</p>

  <p>The <dfn id=dom-window-closed><code>closed</code></dfn> attribute on <code id=apis-for-creating-and-navigating-browsing-contexts-by-name:window-5><a href=#window>Window</a></code>
  objects must return true if the <code id=apis-for-creating-and-navigating-browsing-contexts-by-name:window-6><a href=#window>Window</a></code> object's <a href=#browsing-context id=apis-for-creating-and-navigating-browsing-contexts-by-name:browsing-context-12>browsing context</a> has
  been <a href=#a-browsing-context-is-discarded id=apis-for-creating-and-navigating-browsing-contexts-by-name:a-browsing-context-is-discarded>discarded</a>, and false otherwise.</p>

  <p>The <dfn id=dom-window-stop><code>stop()</code></dfn> method on <code id=apis-for-creating-and-navigating-browsing-contexts-by-name:window-7><a href=#window>Window</a></code>
  objects should, if there is an existing attempt to <a href=#navigate id=apis-for-creating-and-navigating-browsing-contexts-by-name:navigate-3>navigate</a> the <a href=#browsing-context id=apis-for-creating-and-navigating-browsing-contexts-by-name:browsing-context-13>browsing
  context</a> and that attempt is not currently running the <a href=#unload-a-document id=apis-for-creating-and-navigating-browsing-contexts-by-name:unload-a-document>unload a document</a>
  algorithm, cancel that <a href=#navigate id=apis-for-creating-and-navigating-browsing-contexts-by-name:navigate-4>navigation</a>; then, it must <a href=#abort-a-document id=apis-for-creating-and-navigating-browsing-contexts-by-name:abort-a-document>abort</a> the <a href=#active-document id=apis-for-creating-and-navigating-browsing-contexts-by-name:active-document>active document</a> of the <a href=#browsing-context id=apis-for-creating-and-navigating-browsing-contexts-by-name:browsing-context-14>browsing
  context</a> of the <code id=apis-for-creating-and-navigating-browsing-contexts-by-name:window-8><a href=#window>Window</a></code> object on which it was invoked.</p>

  


  <h4 id=accessing-other-browsing-contexts>7.3.2 他のブラウジングコンテキストへのアクセス</h4>

  <dl class=domintro><dt><var>window</var> . <code id=accessing-other-browsing-contexts:dom-length><a href=#dom-length>length</a></code><dd>

    <p><a href=#child-browsing-context id=accessing-other-browsing-contexts:child-browsing-context>子ブラウジングコンテキスト</a>の数を返す。</p>

   <dt><var>window</var>[<var>index</var>]<dd>

    <p>指示された<a href=#child-browsing-context id=accessing-other-browsing-contexts:child-browsing-context-2>子ブラウジングコンテキスト</a>を返す。</p>

   </dl>

  

  <p>The <dfn id=number-of-child-browsing-contexts>number of child browsing contexts</dfn> of a <code id=accessing-other-browsing-contexts:window><a href=#window>Window</a></code> object <var>W</var>
  is the number of <a href=#child-browsing-context id=accessing-other-browsing-contexts:child-browsing-context-3>child browsing contexts</a> that are
  <a href=#browsing-context-nested-through id=accessing-other-browsing-contexts:browsing-context-nested-through>nested through</a> elements that are <a id=accessing-other-browsing-contexts:in-a-document href=https://triple-underscore.github.io/DOM4-ja.html#in-a-document data-x-internal=in-a-document>in a
  <code>Document</code></a> that is the <a href=#active-document id=accessing-other-browsing-contexts:active-document>active document</a> of the <code id=accessing-other-browsing-contexts:window-2><a href=#window>Window</a></code>
  object's <a href=#concept-document-window id=accessing-other-browsing-contexts:concept-document-window>associated</a> <code id=accessing-other-browsing-contexts:document><a href=dom.html#document>Document</a></code> object's
  <a href=#concept-document-bc id=accessing-other-browsing-contexts:concept-document-bc>browsing context</a>.</p>

  <p>The <dfn id=dom-length><code>length</code></dfn> IDL attribute's getter must return the
  <a href=#number-of-child-browsing-contexts id=accessing-other-browsing-contexts:number-of-child-browsing-contexts>number of child browsing contexts</a> of this <code id=accessing-other-browsing-contexts:window-3><a href=#window>Window</a></code> object.</p>

  <p class=note>Indexed access to <a href=#child-browsing-context id=accessing-other-browsing-contexts:child-browsing-context-4>child browsing
  contexts</a> is defined through the <a href=#windowproxy-getownproperty>[[GetOwnProperty]]</a> internal method of the
  <code id=accessing-other-browsing-contexts:windowproxy><a href=#windowproxy>WindowProxy</a></code> object.</p>

  



  <h4 id=named-access-on-the-window-object>7.3.3 <code id=named-access-on-the-window-object:window><a href=#window>Window</a></code>オブジェクトの名前付きアクセス</h4>

  <dl class=domintro><dt><var>window</var>[<var>name</var>]<dd>

    <p>指示された要素または要素のコレクションを返す。</p>

    <p>一般的な規則として、これに依存することはもろいコードを導く。たとえば、新しい機能がウェブプラットフォームに加えられるように、いずれかのIDがこのAPIのマッピングで終わることは時間をかけて変化できる。この代わりに、<code>document.getElementById()</code>または<code>document.querySelector()</code>を使用する。</p>

   </dl>

  

  <p>The <dfn id=child-browsing-context-name-property-set>child browsing context name property set</dfn> consists of the <a href=#browsing-context-name id=named-access-on-the-window-object:browsing-context-name>browsing context names</a> of any <a href=#child-browsing-context id=named-access-on-the-window-object:child-browsing-context>child browsing context</a> of the
  <a href=#active-document id=named-access-on-the-window-object:active-document>active document</a> whose name is not the empty string, with duplicates omitted.</p>

  <p>The <code id=named-access-on-the-window-object:window-2><a href=#window>Window</a></code> interface <a href=https://triple-underscore.github.io/WebIDL-ja.html#dfn-support-named-properties id=named-access-on-the-window-object:support-named-properties data-x-internal=support-named-properties>supports named
  properties</a>. The <a id=named-access-on-the-window-object:supported-property-names href=https://triple-underscore.github.io/WebIDL-ja.html#dfn-supported-property-names data-x-internal=supported-property-names>supported property names</a> at any moment consist of the
  following, in <a id=named-access-on-the-window-object:tree-order href=https://triple-underscore.github.io/DOM4-ja.html#concept-tree-order data-x-internal=tree-order>tree order</a>, ignoring later duplicates:</p>

  <ul><li>the <a href=#child-browsing-context-name-property-set id=named-access-on-the-window-object:child-browsing-context-name-property-set>child browsing context name property set</a>,</li><li>the value of the <code>name</code> content attribute for all <code id=named-access-on-the-window-object:the-a-element><a href=semantics.html#the-a-element>a</a></code>,
   <code id=named-access-on-the-window-object:the-applet-element><a href=obsolete.html#the-applet-element>applet</a></code>, <code id=named-access-on-the-window-object:the-area-element><a href=embedded-content.html#the-area-element>area</a></code>, <code id=named-access-on-the-window-object:the-embed-element><a href=embedded-content.html#the-embed-element>embed</a></code>, <code id=named-access-on-the-window-object:the-form-element><a href=forms.html#the-form-element>form</a></code>,
   <code id=named-access-on-the-window-object:frameset><a href=obsolete.html#frameset>frameset</a></code>, <code id=named-access-on-the-window-object:the-img-element><a href=embedded-content.html#the-img-element>img</a></code>, and <code id=named-access-on-the-window-object:the-object-element><a href=embedded-content.html#the-object-element>object</a></code> elements in the <a href=#active-document id=named-access-on-the-window-object:active-document-2>active
   document</a> that have a non-empty <code>name</code> content attribute, and</li><li>the value of the <code id=named-access-on-the-window-object:the-id-attribute><a href=dom.html#the-id-attribute>id</a></code> content attribute of any <a href=infrastructure.html#html-elements id=named-access-on-the-window-object:html-elements>HTML element</a> in the <a href=#active-document id=named-access-on-the-window-object:active-document-3>active document</a> with a non-empty <code id=named-access-on-the-window-object:the-id-attribute-2><a href=dom.html#the-id-attribute>id</a></code> content attribute.</li></ul>

  <p>To <a id=named-access-on-the-window-object:determine-the-value-of-a-named-property href=https://triple-underscore.github.io/WebIDL-ja.html#dfn-determine-the-value-of-a-named-property data-x-internal=determine-the-value-of-a-named-property>determine the value of a named property</a> <var>name</var> when <dfn id=dom-window-nameditem>the <code>Window</code> object is indexed for property
  retrieval</dfn>, the user agent must return the value obtained using the following steps:</p>

  <ol><li>

    <p>Let <var>objects</var> be the list of <a href=#dom-window-nameditem-filter id=named-access-on-the-window-object:dom-window-nameditem-filter>named objects</a> with the name <var>name</var>
    in the <a href=#active-document id=named-access-on-the-window-object:active-document-4>active document</a>.

    

    <p class=note>There will be at least one such object, by definition.</p>

   </li><li>

    <p>If <var>objects</var> contains a <a href=#nested-browsing-context id=named-access-on-the-window-object:nested-browsing-context>nested browsing context</a>, then return
    the <code id=named-access-on-the-window-object:windowproxy><a href=#windowproxy>WindowProxy</a></code> object of the <a href=#nested-browsing-context id=named-access-on-the-window-object:nested-browsing-context-2>nested browsing context</a> corresponding to
    the first <a href=#browsing-context-container id=named-access-on-the-window-object:browsing-context-container>browsing context container</a> in <a id=named-access-on-the-window-object:tree-order-2 href=https://triple-underscore.github.io/DOM4-ja.html#concept-tree-order data-x-internal=tree-order>tree order</a> whose
    <a href=#browsing-context id=named-access-on-the-window-object:browsing-context>browsing context</a> is in <var>objects</var>, and abort these steps.</p>

   </li><li>

    <p>Otherwise, if <var>objects</var> has only one element, return that element and
    abort these steps.</p>

   </li><li>

    <p>Otherwise return an <code id=named-access-on-the-window-object:htmlcollection><a data-x-internal=htmlcollection href=https://triple-underscore.github.io/DOM4-ja.html#interface-htmlcollection>HTMLCollection</a></code> rooted at the <code id=named-access-on-the-window-object:document><a href=dom.html#document>Document</a></code> node,
    whose filter matches only <a href=#dom-window-nameditem-filter id=named-access-on-the-window-object:dom-window-nameditem-filter-2>named objects</a> with
    the name <var>name</var>. (By definition, these will all be elements.)</p> 

   </li></ol>

  <p><dfn id=dom-window-nameditem-filter>Named objects</dfn> with the name <var>name</var>, for the purposes of the above algorithm, are those that are either:</p>

  <ul><li><a href=#child-browsing-context id=named-access-on-the-window-object:child-browsing-context-2>child browsing contexts</a> of the <a href=#active-document id=named-access-on-the-window-object:active-document-5>active
   document</a> whose name is <var>name</var>,</li><li><code id=named-access-on-the-window-object:the-a-element-2><a href=semantics.html#the-a-element>a</a></code>, <code id=named-access-on-the-window-object:the-applet-element-2><a href=obsolete.html#the-applet-element>applet</a></code>, <code id=named-access-on-the-window-object:the-area-element-2><a href=embedded-content.html#the-area-element>area</a></code>, <code id=named-access-on-the-window-object:the-embed-element-2><a href=embedded-content.html#the-embed-element>embed</a></code>,
   <code id=named-access-on-the-window-object:the-form-element-2><a href=forms.html#the-form-element>form</a></code>, <code id=named-access-on-the-window-object:frameset-2><a href=obsolete.html#frameset>frameset</a></code>, <code id=named-access-on-the-window-object:the-img-element-2><a href=embedded-content.html#the-img-element>img</a></code>, or <code id=named-access-on-the-window-object:the-object-element-2><a href=embedded-content.html#the-object-element>object</a></code> elements that
   have a <code>name</code> content attribute whose value is <var>name</var>, or</li><li><a id=named-access-on-the-window-object:html-elements-2 href=infrastructure.html#html-elements>HTML elements</a> that have an <code id=named-access-on-the-window-object:the-id-attribute-3><a href=dom.html#the-id-attribute>id</a></code> content attribute
   whose value is <var>name</var>.</li></ul>

  


  

  <h4 id=garbage-collection-and-browsing-contexts>7.3.4 Garbage collection and browsing contexts</h4>

  <p>A <a href=#browsing-context id=garbage-collection-and-browsing-contexts:browsing-context>browsing context</a> has a strong reference to each of its <code id=garbage-collection-and-browsing-contexts:document><a href=dom.html#document>Document</a></code>s
  and its <code id=garbage-collection-and-browsing-contexts:windowproxy><a href=#windowproxy>WindowProxy</a></code> object, and the user agent itself has a strong reference to its
  <a href=#top-level-browsing-context id=garbage-collection-and-browsing-contexts:top-level-browsing-context>top-level browsing contexts</a>.</p>

  <p>A <code id=garbage-collection-and-browsing-contexts:document-2><a href=dom.html#document>Document</a></code> has a strong reference to its <code id=garbage-collection-and-browsing-contexts:window><a href=#window>Window</a></code> object.</p>

  <p class=note>A <code id=garbage-collection-and-browsing-contexts:window-2><a href=#window>Window</a></code> object <a href=infrastructure.html#implied-strong-reference id=garbage-collection-and-browsing-contexts:implied-strong-reference>has a strong
  reference</a> to its <code id=garbage-collection-and-browsing-contexts:document-3><a href=dom.html#document>Document</a></code> object through its <code id=garbage-collection-and-browsing-contexts:dom-document-2><a href=#dom-document-2>document</a></code> attribute. Thus, references from other scripts to either of
  those objects will keep both alive. Similarly, both <code id=garbage-collection-and-browsing-contexts:document-4><a href=dom.html#document>Document</a></code> and <code id=garbage-collection-and-browsing-contexts:window-3><a href=#window>Window</a></code>
  objects have <a href=infrastructure.html#implied-strong-reference id=garbage-collection-and-browsing-contexts:implied-strong-reference-2>implied strong references</a> to the
  <code id=garbage-collection-and-browsing-contexts:windowproxy-2><a href=#windowproxy>WindowProxy</a></code> object.</p>

  <p>Each <a href=webappapis.html#concept-script id=garbage-collection-and-browsing-contexts:concept-script>script</a> has a strong reference to its <a id=garbage-collection-and-browsing-contexts:settings-object href=webappapis.html#settings-object>settings
  object</a>, and each <a id=garbage-collection-and-browsing-contexts:environment-settings-object href=webappapis.html#environment-settings-object>environment settings object</a> has strong references to its
  <a href=webappapis.html#concept-settings-object-global id=garbage-collection-and-browsing-contexts:concept-settings-object-global>global object</a>, <a id=garbage-collection-and-browsing-contexts:responsible-browsing-context href=webappapis.html#responsible-browsing-context>responsible browsing
  context</a>, and <a id=garbage-collection-and-browsing-contexts:responsible-document href=webappapis.html#responsible-document>responsible document</a> (if any).</p>

  
  <p>When a <a href=#browsing-context id=garbage-collection-and-browsing-contexts:browsing-context-2>browsing context</a> is to <dfn id=discard-a-document>discard a <code>Document</code></dfn>, the user
  agent must run the following steps:</p>

  <ol><li><p>Set the <code id=garbage-collection-and-browsing-contexts:document-5><a href=dom.html#document>Document</a></code>'s <i id=garbage-collection-and-browsing-contexts:concept-document-salvageable><a href=#concept-document-salvageable>salvageable</a></i> state to false.</li><li><p>Run any <a href=#unloading-document-cleanup-steps id=garbage-collection-and-browsing-contexts:unloading-document-cleanup-steps>unloading document cleanup steps</a> for the <code id=garbage-collection-and-browsing-contexts:document-6><a href=dom.html#document>Document</a></code> that
   are defined by this specification and <a id=garbage-collection-and-browsing-contexts:other-applicable-specifications href=infrastructure.html#other-applicable-specifications>other applicable specifications</a>.</li><li><p><a href=#abort-a-document id=garbage-collection-and-browsing-contexts:abort-a-document>Abort the <code>Document</code></a>.</li><li><p>Remove any <a href=webappapis.html#concept-task id=garbage-collection-and-browsing-contexts:concept-task>tasks</a> associated with the
   <code id=garbage-collection-and-browsing-contexts:document-7><a href=dom.html#document>Document</a></code> in any <a id=garbage-collection-and-browsing-contexts:task-source href=webappapis.html#task-source>task source</a>, without running those tasks.</li><li><p><a href=#a-browsing-context-is-discarded id=garbage-collection-and-browsing-contexts:a-browsing-context-is-discarded>Discard</a> all the <a href=#child-browsing-context id=garbage-collection-and-browsing-contexts:child-browsing-context>child browsing contexts</a> of the <code id=garbage-collection-and-browsing-contexts:document-8><a href=dom.html#document>Document</a></code>.</li><li><p>Lose the strong reference from the <code id=garbage-collection-and-browsing-contexts:document-9><a href=dom.html#document>Document</a></code>'s <a href=#concept-document-bc id=garbage-collection-and-browsing-contexts:concept-document-bc>browsing context</a> to the <code id=garbage-collection-and-browsing-contexts:document-10><a href=dom.html#document>Document</a></code>.</li></ol>

  <p class=note>Whenever a <code id=garbage-collection-and-browsing-contexts:document-11><a href=dom.html#document>Document</a></code> object is <a href=#discard-a-document id=garbage-collection-and-browsing-contexts:discard-a-document>discarded</a>, it is also removed from the list of <a id="garbage-collection-and-browsing-contexts:the-worker's-documents" href="workers.html#the-worker's-documents">the worker's
  <code>Document</code>s</a> of each worker whose list contains that <code id=garbage-collection-and-browsing-contexts:document-12><a href=dom.html#document>Document</a></code>.</p>

  <p>When <dfn id=a-browsing-context-is-discarded>a <em>browsing context</em> is discarded</dfn>, the strong reference from the user
  agent itself to the <a href=#browsing-context id=garbage-collection-and-browsing-contexts:browsing-context-3>browsing context</a> must be severed, and all the
  <code id=garbage-collection-and-browsing-contexts:document-13><a href=dom.html#document>Document</a></code> objects for all the entries in the <a href=#browsing-context id=garbage-collection-and-browsing-contexts:browsing-context-4>browsing context</a>'s session
  history must be <a href=#discard-a-document id=garbage-collection-and-browsing-contexts:discard-a-document-2>discarded</a> as well.</p>

  <p>User agents may <a href=#a-browsing-context-is-discarded id=garbage-collection-and-browsing-contexts:a-browsing-context-is-discarded-2>discard</a> <a href=#top-level-browsing-context id=garbage-collection-and-browsing-contexts:top-level-browsing-context-2>top-level browsing contexts</a> at any time (typically, in
  response to user requests, e.g. when a user force-closes a window containing one or more <a href=#top-level-browsing-context id=garbage-collection-and-browsing-contexts:top-level-browsing-context-3>top-level browsing contexts</a>). Other <a href=#browsing-context id=garbage-collection-and-browsing-contexts:browsing-context-5>browsing contexts</a> must be discarded once their
  <code id=garbage-collection-and-browsing-contexts:windowproxy-3><a href=#windowproxy>WindowProxy</a></code> object is eligible for garbage collection.</p>

  


  <h4 id=closing-browsing-contexts>7.3.5 ブラウジングコンテキストを閉じる</h4>

  <p>ユーザーエージェントは、<dfn id=close-a-browsing-context>ブラウジングコンテキストを閉じる</dfn>ことを供給される場合、以下のステップを実行しなければならない：</p>

  <ol><li><p><var>specified browsing context</var>を閉じられている<a href=#browsing-context id=closing-browsing-contexts:browsing-context>ブラウジングコンテキスト</a>とする。</li><li><p><var>specified browsing context</var>の<a href=#active-document id=closing-browsing-contexts:active-document>アクティブなドキュメント</a>を<a href=#prompt-to-unload-a-document id=closing-browsing-contexts:prompt-to-unload-a-document>アンロードするように要求する</a>。ユーザーが<a href=#refused-to-allow-the-document-to-be-unloaded id=closing-browsing-contexts:refused-to-allow-the-document-to-be-unloaded>文書をアンロードできるようにすることを拒否した</a>場合、これらの手順を中止する。</li><li><p>falseに設定する<var>recycle</var>パラメーターをもつ<var>specified browsing context</var>の<a href=#active-document id=closing-browsing-contexts:active-document-2>アクティブなドキュメント</a>を<a href=#unload-a-document id=closing-browsing-contexts:unload-a-document>アンロードする</a>。</li><li><p>ユーザーインターフェイス（たとえばタブブラウザーでタブを閉じる、または非表示にする）から、<var>specified browsing context</var>を削除する。</li><li><p><var>specified browsing context</var>を<a href=#a-browsing-context-is-discarded id=closing-browsing-contexts:a-browsing-context-is-discarded>破棄する</a>。</li></ol>

  <p>ユーザーエージェントは、ユーザーが任意に任意の<a href=#top-level-browsing-context id=closing-browsing-contexts:top-level-browsing-context>トップレベルブラウジングコンテキスト</a>を<a href=#close-a-browsing-context id=closing-browsing-contexts:close-a-browsing-context>閉じる</a>機能を提供すべきである。</p>



  <h4 id=browser-interface-elements>7.3.6 ブラウザーインターフェイス要素</h4>

  <p>ウェブページがウェブブラウザーと統合できるようにするために、特定のウェブブラウザーインターフェイス要素はウェブページ内のスクリプトに限られた方法で公開される。</p>

  <p>各インターフェイス要素は<code id=browser-interface-elements:barprop><a href=#barprop>BarProp</a></code>オブジェクトによって表される：</p>

  <pre class=idl>interface <dfn id=barprop>BarProp</dfn> {
  readonly attribute boolean <a href=#dom-barprop-visible id=browser-interface-elements:dom-barprop-visible>visible</a>;
};</pre>

  <dl class=domintro><dt><var>window</var> . <code id=browser-interface-elements:dom-window-locationbar><a href=#dom-window-locationbar>locationbar</a></code> . <code id=browser-interface-elements:dom-barprop-visible-2><a href=#dom-barprop-visible>visible</a></code><dd>
    <p>ロケーションバーが表示される場合はtrueを返し、そうでなければfalseを返す。</p>
   <dt><var>window</var> . <code id=browser-interface-elements:dom-window-menubar><a href=#dom-window-menubar>menubar</a></code> . <code id=browser-interface-elements:dom-barprop-visible-3><a href=#dom-barprop-visible>visible</a></code><dd>
    <p>メニューバーが表示される場合はtrueを返し、そうでなければfalseを返す。</p>
   <dt><var>window</var> . <code id=browser-interface-elements:dom-window-personalbar><a href=#dom-window-personalbar>personalbar</a></code> . <code id=browser-interface-elements:dom-barprop-visible-4><a href=#dom-barprop-visible>visible</a></code><dd>
    <p>パーソナルバーが表示される場合はtrueを返し、そうでなければfalseを返す。</p>
   <dt><var>window</var> . <code id=browser-interface-elements:dom-window-scrollbars><a href=#dom-window-scrollbars>scrollbars</a></code> . <code id=browser-interface-elements:dom-barprop-visible-5><a href=#dom-barprop-visible>visible</a></code><dd>
    <p>スクロールバーが表示される場合はtrueを返し、そうでなければfalseを返す。</p>
   <dt><var>window</var> . <code id=browser-interface-elements:dom-window-statusbar><a href=#dom-window-statusbar>statusbar</a></code> . <code id=browser-interface-elements:dom-barprop-visible-6><a href=#dom-barprop-visible>visible</a></code><dd>
    <p>ステータスバーが表示される場合はtrueを返し、そうでなければfalseを返す。</p>
   <dt><var>window</var> . <code id=browser-interface-elements:dom-window-toolbar><a href=#dom-window-toolbar>toolbar</a></code> . <code id=browser-interface-elements:dom-barprop-visible-7><a href=#dom-barprop-visible>visible</a></code><dd>
    <p>ツールバーが表示される場合はtrueを返し、そうでなければfalseを返す。</p>
   </dl>

  

  <p>The <dfn id=dom-barprop-visible>visible</dfn> attribute, on getting, must return either
  true or a value determined by the user agent to most accurately represent the visibility state of
  the user interface element that the object represents, as described below.</p>

  <p>The following <code id=browser-interface-elements:barprop-2><a href=#barprop>BarProp</a></code> objects exist for each <code id=browser-interface-elements:document><a href=dom.html#document>Document</a></code> object in a
  <a href=#browsing-context id=browser-interface-elements:browsing-context>browsing context</a>. Some of the user interface elements represented by these objects
  might have no equivalent in some user agents; for those user agents, except when otherwise
  specified, the object must act as if it was present and visible (i.e. its <code id=browser-interface-elements:dom-barprop-visible-8><a href=#dom-barprop-visible>visible</a></code> attribute must return true).</p>

  <dl><dt><dfn id=the-location-bar-barprop-object>The location bar <code>BarProp</code> object</dfn><dd>Represents the user interface element that contains a control that displays the
   <a id=browser-interface-elements:url href=https://triple-underscore.github.io/URL-ja.html#concept-url data-x-internal=url>URL</a> of the <a href=#active-document id=browser-interface-elements:active-document>active document</a>, or some similar interface concept.<dt><dfn id=the-menu-bar-barprop-object>The menu bar <code>BarProp</code> object</dfn><dd>Represents the user interface element that contains a list of commands in menu form, or some
   similar interface concept.<dt><dfn id=the-personal-bar-barprop-object>The personal bar <code>BarProp</code> object</dfn><dd>Represents the user interface element that contains links to the user's favorite pages, or
   some similar interface concept.<dt><dfn id=the-scrollbar-barprop-object>The scrollbar <code>BarProp</code> object</dfn><dd>Represents the user interface element that contains a scrolling mechanism, or some similar
   interface concept.<dt><dfn id=the-status-bar-barprop-object>The status bar <code>BarProp</code> object</dfn><dd>Represents a user interface element found immediately below or after the document, as
   appropriate for the user's media, which typically provides information about ongoing network
   activity or information about elements that the user's pointing device is current indicating. If
   the user agent has no such user interface element, then the object may act as if the
   corresponding user interface element was absent (i.e. its <code id=browser-interface-elements:dom-barprop-visible-9><a href=#dom-barprop-visible>visible</a></code> attribute may return false).<dt><dfn id=the-toolbar-barprop-object>The toolbar <code>BarProp</code> object</dfn><dd>Represents the user interface element found immediately above or before the document, as
   appropriate for the user's media, which typically provides <a href=#session-history id=browser-interface-elements:session-history>session history</a> traversal
   controls (back and forward buttons, reload buttons, etc). If the user agent has no such user
   interface element, then the object may act as if the corresponding user interface element was
   absent (i.e. its <code id=browser-interface-elements:dom-barprop-visible-10><a href=#dom-barprop-visible>visible</a></code> attribute may return
   false).</dl>

  <p>The <dfn id=dom-window-locationbar><code>locationbar</code></dfn> attribute must return
  <a href=#the-location-bar-barprop-object id=browser-interface-elements:the-location-bar-barprop-object>the location bar <code>BarProp</code> object</a>.</p>

  <p>The <dfn id=dom-window-menubar><code>menubar</code></dfn> attribute must return <a href=#the-menu-bar-barprop-object id=browser-interface-elements:the-menu-bar-barprop-object>the
  menu bar <code>BarProp</code> object</a>.</p>

  <p>The <dfn id=dom-window-personalbar><code>personalbar</code></dfn> attribute must return
  <a href=#the-personal-bar-barprop-object id=browser-interface-elements:the-personal-bar-barprop-object>the personal bar <code>BarProp</code> object</a>.</p>

  <p>The <dfn id=dom-window-scrollbars><code>scrollbars</code></dfn> attribute must return
  <a href=#the-scrollbar-barprop-object id=browser-interface-elements:the-scrollbar-barprop-object>the scrollbar <code>BarProp</code> object</a>.</p>

  <p>The <dfn id=dom-window-statusbar><code>statusbar</code></dfn> attribute must return
  <a href=#the-status-bar-barprop-object id=browser-interface-elements:the-status-bar-barprop-object>the status bar <code>BarProp</code> object</a>.</p>

  <p>The <dfn id=dom-window-toolbar><code>toolbar</code></dfn> attribute must return <a href=#the-toolbar-barprop-object id=browser-interface-elements:the-toolbar-barprop-object>the
  toolbar <code>BarProp</code> object</a>.</p>



  <hr>

  <p>For historical reasons, the <dfn id=dom-window-status><code>status</code></dfn> attribute
  on the <code id=browser-interface-elements:window><a href=#window>Window</a></code> object must, on getting, return the last string it was set to, and on
  setting, must set itself to the new value. When the <code id=browser-interface-elements:window-2><a href=#window>Window</a></code> object is created, the
  attribute must be set to the empty string. It does not do anything else.</p>

  


  

  <h3 id=the-windowproxy-exotic-object>7.4 The <code id=the-windowproxy-exotic-object:windowproxy><a href=#windowproxy>WindowProxy</a></code> exotic object</h3>

  <p>A <dfn id=windowproxy><code>WindowProxy</code></dfn> is an exotic object that wraps a <code id=the-windowproxy-exotic-object:window><a href=#window>Window</a></code>
  ordinary object, indirecting most operations through to the wrapped object. Each
  <a href=#browsing-context id=the-windowproxy-exotic-object:browsing-context>browsing context</a> has an associated <code id=the-windowproxy-exotic-object:windowproxy-2><a href=#windowproxy>WindowProxy</a></code> object. When the
  <a href=#browsing-context id=the-windowproxy-exotic-object:browsing-context-2>browsing context</a> is <a href=#navigate id=the-windowproxy-exotic-object:navigate>navigated</a>, the <code id=the-windowproxy-exotic-object:window-2><a href=#window>Window</a></code>
  object wrapped by the <a href=#browsing-context id=the-windowproxy-exotic-object:browsing-context-3>browsing context</a>'s associated <code id=the-windowproxy-exotic-object:windowproxy-3><a href=#windowproxy>WindowProxy</a></code> object
  is changed.</p>

  <p>There is no <code id=the-windowproxy-exotic-object:windowproxy-4><a href=#windowproxy>WindowProxy</a></code> interface object.</p>

  <p>Every <code id=the-windowproxy-exotic-object:windowproxy-5><a href=#windowproxy>WindowProxy</a></code> object has a
  [[<dfn id=concept-windowproxy-window>Window</dfn>]] internal slot representing the wrapped
  <code id=the-windowproxy-exotic-object:window-3><a href=#window>Window</a></code> object.</p>

  <p>The <code id=the-windowproxy-exotic-object:windowproxy-6><a href=#windowproxy>WindowProxy</a></code> object internal methods are described in the subsections
  below.</p>

  <p class=note>Although <code id=the-windowproxy-exotic-object:windowproxy-7><a href=#windowproxy>WindowProxy</a></code> is named as a "proxy", it does not do
  polymorphic dispatch on its target's internal methods as a real proxy would, due to a desire to
  reuse machinery between <code id=the-windowproxy-exotic-object:windowproxy-8><a href=#windowproxy>WindowProxy</a></code> and <code id=the-windowproxy-exotic-object:location><a href=#location>Location</a></code> objects. As long as the
  <code id=the-windowproxy-exotic-object:window-4><a href=#window>Window</a></code> object remains an ordinary object this is unobservable and can be implemented
  either way.</p>

  <h4 id=windowproxy-getprototypeof>7.4.1 [[GetPrototypeOf]] ( )</h4>

  <ol><li><p>Let <var>W</var> be the value of the
   [[<a href=#concept-windowproxy-window id=windowproxy-getprototypeof:concept-windowproxy-window>Window</a>]] internal slot of
   <b>this</b>.</li><li><p>If <a href=#isplatformobjectsameorigin-(-o-) id=windowproxy-getprototypeof:isplatformobjectsameorigin-(-o-)>IsPlatformObjectSameOrigin</a>(<var>W</var>) is true, then return !
   <a id=windowproxy-getprototypeof:ordinarygetprototypeof href=https://tc39.github.io/ecma262/#sec-ordinarygetprototypeof data-x-internal=ordinarygetprototypeof>OrdinaryGetPrototypeOf</a>(<var>W</var>).</li><li><p>Return null.</li></ol>

  <h4 id=windowproxy-setprototypeof>7.4.2 [[SetPrototypeOf]] ( <var>V</var> )</h4>

  <ol><li><p>Return false.</li></ol>

  <h4 id=windowproxy-isextensible>7.4.3 [[IsExtensible]] ( )</h4>

  <ol><li><p>Return true.</li></ol>

  <h4 id=windowproxy-preventextensions>7.4.4 [[PreventExtensions]] ( )</h4>

  <ol><li><p>Return false.</li></ol>

  <h4 id=windowproxy-getownproperty>7.4.5 [[GetOwnProperty]] ( <var>P</var> )</h4>

  <ol><li><p>Let <var>W</var> be the value of the
   [[<a href=#concept-windowproxy-window id=windowproxy-getownproperty:concept-windowproxy-window>Window</a>]] internal slot of
   <b>this</b>.</li><li>
    <p>If <var>P</var> is an <a id=windowproxy-getownproperty:array-index-property-name href=https://triple-underscore.github.io/WebIDL-ja.html#dfn-array-index-property-name data-x-internal=array-index-property-name>array index property name</a>, then:</p>

    <ol><li><p>Let <var>index</var> be <a id=windowproxy-getownproperty:touint32 href=https://tc39.github.io/ecma262/#sec-touint32 data-x-internal=touint32>ToUint32</a>(<var>P</var>).</li><li><p>Let <var>maxProperties</var> be the <a href=#number-of-child-browsing-contexts id=windowproxy-getownproperty:number-of-child-browsing-contexts>number of child browsing contexts</a> of
     <var>W</var>.

     

     </li><li><p>Let <var>value</var> be undefined.

     

     </li><li>
      <p>If <var>maxProperties</var> is greater than 0 and <var>index</var> is less than
      <var>maxProperties</var>, then:

      

      <ol><li><p>Set <var>value</var> to the <code id=windowproxy-getownproperty:windowproxy><a href=#windowproxy>WindowProxy</a></code> object of the <var>index</var>th
       <a href=#child-browsing-context id=windowproxy-getownproperty:child-browsing-context>child browsing context</a> of the <code id=windowproxy-getownproperty:document><a href=dom.html#document>Document</a></code> that is <a href=#browsing-context-nested-through id=windowproxy-getownproperty:browsing-context-nested-through>nested through</a> an element that is <a href=https://triple-underscore.github.io/DOM4-ja.html#in-a-document id=windowproxy-getownproperty:in-a-document data-x-internal=in-a-document>in <var>W</var>'s <code>Document</code></a>, sorted in the order
       that the elements nesting those <a href=#browsing-context id=windowproxy-getownproperty:browsing-context>browsing contexts</a> were
       most recently inserted into the <code id=windowproxy-getownproperty:document-2><a href=dom.html#document>Document</a></code>, the <code id=windowproxy-getownproperty:windowproxy-2><a href=#windowproxy>WindowProxy</a></code> object of
       the most recently inserted <a href=#browsing-context-container id=windowproxy-getownproperty:browsing-context-container>browsing context container</a>'s <a href=#nested-browsing-context id=windowproxy-getownproperty:nested-browsing-context>nested browsing
       context</a> being last.</li></ol>

     </li><li><p>Return <a id=windowproxy-getownproperty:propertydescriptor href=https://tc39.github.io/ecma262/#sec-property-descriptor-specification-type data-x-internal=propertydescriptor>PropertyDescriptor</a>{
     [[Value]]: <var>value</var>,
     [[Writable]]: false,
     [[Enumerable]]: false,
     [[Configurable]]: true }.</li></ol>
   </li><li>
    <p>If <a href=#isplatformobjectsameorigin-(-o-) id=windowproxy-getownproperty:isplatformobjectsameorigin-(-o-)>IsPlatformObjectSameOrigin</a>(<var>W</var>) is true, then return
    <a id=windowproxy-getownproperty:ordinarygetownproperty href=https://tc39.github.io/ecma262/#sec-ordinarygetownproperty data-x-internal=ordinarygetownproperty>OrdinaryGetOwnProperty</a>(<var>W</var>, <var>P</var>).</p>

    <p class=note>This violates JavaScript's internal method invariants. <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1197958#c4">Gecko bug 1197958 comment 4</a>
    has further discussion on the manner.</li><li><p>Let <var>property</var> be <a href=#crossorigingetownpropertyhelper-(-o,-p-) id=windowproxy-getownproperty:crossorigingetownpropertyhelper-(-o,-p-)>CrossOriginGetOwnPropertyHelper</a>(<var>W</var>,
   <var>P</var>).</li><li><p>If <var>property</var> is not undefined, return <var>property</var>.</li><li>
    <p>If <var>property</var> is undefined and <var>P</var> is in the <a href=#child-browsing-context-name-property-set id=windowproxy-getownproperty:child-browsing-context-name-property-set>child browsing
    context name property set</a>, then:</p>

    <ol><li><p>Let <var>value</var> be the <code id=windowproxy-getownproperty:windowproxy-3><a href=#windowproxy>WindowProxy</a></code> object of the
     <a href=#dom-window-nameditem-filter id=windowproxy-getownproperty:dom-window-nameditem-filter>named object</a> with the name <var>P</var>.

     

     </li><li><p>Return <a id=windowproxy-getownproperty:propertydescriptor-2 href=https://tc39.github.io/ecma262/#sec-property-descriptor-specification-type data-x-internal=propertydescriptor>PropertyDescriptor</a>{
     [[Value]]: <var>value</var>,
     [[Enumerable]]: false,
     [[Writable]]: false,
     [[Configurable]]: true }.</li></ol>

   </li><li><p>Throw a <a id=windowproxy-getownproperty:securityerror href=https://triple-underscore.github.io/WebIDL-ja.html#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a> <code id=windowproxy-getownproperty:domexception><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.</li></ol>

  <h4 id=windowproxy-defineownproperty>7.4.6 [[DefineOwnProperty]] ( <var>P</var>, <var>Desc</var>
  )</h4>

  <ol><li><p>If <var>P</var> is an <a id=windowproxy-defineownproperty:array-index-property-name href=https://triple-underscore.github.io/WebIDL-ja.html#dfn-array-index-property-name data-x-internal=array-index-property-name>array index property name</a>, return false.</li><li><p>Let <var>W</var> be the value of the
   [[<a href=#concept-windowproxy-window id=windowproxy-defineownproperty:concept-windowproxy-window>Window</a>]] internal slot of
   <b>this</b>.</li><li>
    <p>If <a href=#isplatformobjectsameorigin-(-o-) id=windowproxy-defineownproperty:isplatformobjectsameorigin-(-o-)>IsPlatformObjectSameOrigin</a>(<var>W</var>) is true, then return ?
    <a id=windowproxy-defineownproperty:ordinarydefineownproperty href=https://tc39.github.io/ecma262/#sec-ordinarydefineownproperty data-x-internal=ordinarydefineownproperty>OrdinaryDefineOwnProperty</a>(<var>W</var>, <var>P</var>, <var>Desc</var>).</p>

    <p class=note>See above about how this violates JavaScript's internal method
    invariants.</li><li><p>Return false.</li></ol>

  <h4 id=windowproxy-get>7.4.7 [[Get]] ( <var>P</var>, <var>Receiver</var> )</h4>

  <ol><li><p>Let <var>W</var> be the value of the
   [[<a href=#concept-windowproxy-window id=windowproxy-get:concept-windowproxy-window>Window</a>]] internal slot of
   <b>this</b>.</li><li><p>If <a href=#isplatformobjectsameorigin-(-o-) id=windowproxy-get:isplatformobjectsameorigin-(-o-)>IsPlatformObjectSameOrigin</a>(<var>W</var>) is true, then return ?
   <a id=windowproxy-get:ordinaryget href=https://tc39.github.io/ecma262/#sec-ordinaryget data-x-internal=ordinaryget>OrdinaryGet</a>(<b>this</b>, <var>P</var>, <var>Receiver</var>).</li><li><p>Return ? <a href=#crossoriginget-(-o,-p,-receiver-) id=windowproxy-get:crossoriginget-(-o,-p,-receiver-)>CrossOriginGet</a>(<b>this</b>, <var>P</var>,
   <var>Receiver</var>).</li></ol>

  <h4 id=windowproxy-set>7.4.8 [[Set]] ( <var>P</var>, <var>V</var>, <var>Receiver</var> )</h4>

  <ol><li><p>Let <var>W</var> be the value of the
   [[<a href=#concept-windowproxy-window id=windowproxy-set:concept-windowproxy-window>Window</a>]] internal slot of
   <b>this</b>.</li><li><p>If <a href=#isplatformobjectsameorigin-(-o-) id=windowproxy-set:isplatformobjectsameorigin-(-o-)>IsPlatformObjectSameOrigin</a>(<var>W</var>) is true, then return ?
   <a id=windowproxy-set:ordinaryset href=https://tc39.github.io/ecma262/#sec-ordinaryset data-x-internal=ordinaryset>OrdinarySet</a>(<var>W</var>, <b>this</b>, <var>Receiver</var>).</li><li><p>Return ? <a href=#crossoriginset-(-o,-p,-v,-receiver-) id=windowproxy-set:crossoriginset-(-o,-p,-v,-receiver-)>CrossOriginSet</a>(<b>this</b>, <var>P</var>, <var>V</var>,
   <var>Receiver</var>).</li></ol>

  <h4 id=windowproxy-delete>7.4.9 [[Delete]] ( <var>P</var> )</h4>

  <ol><li><p>If <var>P</var> is an <a id=windowproxy-delete:array-index-property-name href=https://triple-underscore.github.io/WebIDL-ja.html#dfn-array-index-property-name data-x-internal=array-index-property-name>array index property name</a>, return false.</li><li><p>Let <var>W</var> be the value of the
   [[<a href=#concept-windowproxy-window id=windowproxy-delete:concept-windowproxy-window>Window</a>]] internal slot of
   <b>this</b>.</li><li><p>If <a href=#isplatformobjectsameorigin-(-o-) id=windowproxy-delete:isplatformobjectsameorigin-(-o-)>IsPlatformObjectSameOrigin</a>(<var>W</var>) is true, then return ?
   <a id=windowproxy-delete:ordinarydelete href=https://tc39.github.io/ecma262/#sec-ordinarydelete data-x-internal=ordinarydelete>OrdinaryDelete</a>(<var>W</var>, <var>P</var>).</li><li><p>Return false.</li></ol>

  <h4 id=windowproxy-ownpropertykeys>7.4.10 [[OwnPropertyKeys]] ( )</h4>

  <ol><li><p>Let <var>W</var> be the value of the
   [[<a href=#concept-windowproxy-window id=windowproxy-ownpropertykeys:concept-windowproxy-window>Window</a>]] internal slot of
   <b>this</b>.</li><li><p>Let <var>keys</var> be a new empty <a id=windowproxy-ownpropertykeys:list href=https://tc39.github.io/ecma262/#sec-list-and-record-specification-type data-x-internal=list>List</a>.</li><li><p>Let <var>maxProperties</var> be the <a href=#number-of-child-browsing-contexts id=windowproxy-ownpropertykeys:number-of-child-browsing-contexts>number of child browsing contexts</a> of
   <var>W</var>.</li><li><p><var>index</var>を0にする。</li><li>
    <p>Repeat while <var>index</var> &lt; <var>maxProperties</var>,

    

    <ol><li><p>Add ! <a id=windowproxy-ownpropertykeys:tostring href=https://tc39.github.io/ecma262/#sec-tostring data-x-internal=tostring>ToString</a>(<var>index</var>) as the last element of
     <var>keys</var>.</li><li><p>Increment <var>index</var> by 1.</li></ol>
   </li><li><p>If <a href=#isplatformobjectsameorigin-(-o-) id=windowproxy-ownpropertykeys:isplatformobjectsameorigin-(-o-)>IsPlatformObjectSameOrigin</a>(<var>W</var>) is true, then return the
   concatenation of <var>keys</var> and !
   <a id=windowproxy-ownpropertykeys:ordinaryownpropertykeys href=https://tc39.github.io/ecma262/#sec-ordinaryownpropertykeys data-x-internal=ordinaryownpropertykeys>OrdinaryOwnPropertyKeys</a>(<var>W</var>).</li><li><p>Return the concatenation of <var>keys</var> and !
   <a href=#crossoriginownpropertykeys-(-o-) id=windowproxy-ownpropertykeys:crossoriginownpropertykeys-(-o-)>CrossOriginOwnPropertyKeys</a>(<var>W</var>).</li></ol>

  





  <h3 id=origin>7.5 生成元</h3><div class=status><input onclick=toggleStatus(this) value=⋰ type=button><p class=bugs><strong>Spec bugs:</strong> <a href="https://www.w3.org/Bugs/Public/show_bug.cgi?id=28374" title="Should canvas really get tainted by a cross-origin (via document.domain) drawImage call?">28374</a></div>
  

  <p>生成元は、ウェブのセキュリティーモデルの基本的な通貨である。生成元を共有するウェブプラットフォーム内の2つの当事者が互いに信頼し、同一の権限を有すると仮定される。異なる生成元をもつ当事者は、互いに潜在的に悪意があると見なされ、互いから程度を変化させるよう隔離される。</p>

  <p class=example>For example, if Example Bank's Web site, hosted at <code>bank.example.com</code>, tries to examine the DOM of Example Charity's Web site, hosted
  at <code>charity.example.org</code>, a <a id=origin:securityerror href=https://triple-underscore.github.io/WebIDL-ja.html#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a>
  <code id=origin:domexception><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code> will be raised.</p>

  <hr>

  <p id=origin-2>An <dfn data-dfn-for=origin id=concept-origin data-export="">origin</dfn> is
  one of the following:</p>

  <dl><dt>An <dfn id=concept-origin-opaque data-export="">opaque origin</dfn><dd><p>An internal value, with no serialisation it can be recreated from (it is serialised as
   "<code>null</code>" per <a href=#ascii-serialisation-of-an-origin id=origin:ascii-serialisation-of-an-origin>ASCII serialisation of an origin</a>), for which the
   only meaningful operation is testing for equality.<dt>A <dfn id=concept-origin-tuple data-export="">tuple origin</dfn><dd>
    <p>A <a href=#concept-origin-tuple id=origin:concept-origin-tuple>tuple</a> consists of:

    

    <ul class=brief><li>A <dfn id=concept-origin-scheme data-export="">scheme</dfn> (a <a href=https://triple-underscore.github.io/URL-ja.html#concept-url-scheme id=origin:concept-url-scheme data-x-internal=concept-url-scheme>scheme</a>).</li><li>A <dfn id=concept-origin-host data-export="">host</dfn> (a <a href=https://triple-underscore.github.io/URL-ja.html#concept-host id=origin:concept-host data-x-internal=concept-host>host</a>).</li><li>A <dfn id=concept-origin-port data-export="">port</dfn> (a <a href=https://triple-underscore.github.io/URL-ja.html#concept-url-port id=origin:concept-url-port data-x-internal=concept-url-port>port</a>).</li><li>A <dfn id=concept-origin-domain data-export="">domain</dfn> (null or a <a href=https://triple-underscore.github.io/URL-ja.html#concept-domain id=origin:concept-domain data-x-internal=concept-domain>domain</a>). Null unless stated otherwise.</li></ul>
   </dl>

  <p class=note><a href=#concept-origin id=origin:concept-origin>Origins</a> can be shared, e.g., among multiple
  <code id=origin:document><a href=dom.html#document>Document</a></code> objects. Furthermore, <a href=#concept-origin id=origin:concept-origin-2>origins</a> are generally
  immutable. Only the <a href=#concept-origin-domain id=origin:concept-origin-domain>domain</a> of a <a href=#concept-origin-tuple id=origin:concept-origin-tuple-2>tuple origin</a> can be changed, and only through the <code id=origin:dom-document-domain><a href=#dom-document-domain>document.domain</a></code> API.</p>

  <p>The <dfn id=concept-origin-effective-domain data-export="">effective domain</dfn> of an
  <a href=#concept-origin id=origin:concept-origin-3>origin</a> <var>origin</var> is computed as follows:</p>

  <ol><li><p>If <var>origin</var> is an <a href=#concept-origin-opaque id=origin:concept-origin-opaque>opaque origin</a>, then
   return <var>origin</var>.</li><li><p>If <var>origin</var>'s <a href=#concept-origin-domain id=origin:concept-origin-domain-2>domain</a> is non-null,
   then return <var>origin</var>'s <a href=#concept-origin-domain id=origin:concept-origin-domain-3>domain</a>.</li><li><p>Return <var>origin</var>'s <a href=#concept-origin-host id=origin:concept-origin-host>host</a>.</li></ol>

  

  <p>Various specification objects are defined to have an <a href=#concept-origin id=origin:concept-origin-4>origin</a>. These <a href=#concept-origin id=origin:concept-origin-5>origins</a> are determined as follows:</p>

  <dl><dt>For <code id=origin:document-2><a href=dom.html#document>Document</a></code> objects<dd>

    <dl class=switch><dt id=sandboxOrigin>If the <code id=origin:document-3><a href=dom.html#document>Document</a></code>'s <a href=#active-sandboxing-flag-set id=origin:active-sandboxing-flag-set>active sandboxing flag set</a>
     has its <a href=#sandboxed-origin-browsing-context-flag id=origin:sandboxed-origin-browsing-context-flag>sandboxed origin browsing context flag</a> set<dd><p>A unique <a href=#concept-origin-opaque id=origin:concept-origin-opaque-2>opaque origin</a> assigned when the
     <code id=origin:document-4><a href=dom.html#document>Document</a></code> is created.<dt>If the <code id=origin:document-5><a href=dom.html#document>Document</a></code>'s <a href=https://triple-underscore.github.io/DOM4-ja.html#concept-document-url id="origin:the-document's-address" data-x-internal="the-document's-address">URL</a>'s <a href=https://triple-underscore.github.io/URL-ja.html#concept-url-scheme id=origin:concept-url-scheme-2 data-x-internal=concept-url-scheme>scheme</a> is a <a id=origin:network-scheme href=https://triple-underscore.github.io/URL-ja.html#network-scheme data-x-internal=network-scheme>network scheme</a><dd>
      <p>A copy of the <code id=origin:document-6><a href=dom.html#document>Document</a></code>'s <a href=https://triple-underscore.github.io/DOM4-ja.html#concept-document-url id="origin:the-document's-address-2" data-x-internal="the-document's-address">URL</a>'s
      <a href=https://triple-underscore.github.io/URL-ja.html#concept-url-origin id=origin:concept-url-origin data-x-internal=concept-url-origin>origin</a> assigned when the <code id=origin:document-7><a href=dom.html#document>Document</a></code> is
      created.</p>

      <p class=note>The <code id=origin:dom-document-open><a href=webappapis.html#dom-document-open>document.open()</a></code> method can change
      the <code id=origin:document-8><a href=dom.html#document>Document</a></code>'s <a href=https://triple-underscore.github.io/DOM4-ja.html#concept-document-url id="origin:the-document's-address-3" data-x-internal="the-document's-address">URL</a> to
      "<code id=origin:about:blank><a href=infrastructure.html#about:blank>about:blank</a></code>". Therefore the <a href=#concept-origin id=origin:concept-origin-6>origin</a> is assigned when the
      <code id=origin:document-9><a href=dom.html#document>Document</a></code> is created.</p>
     <dt>If the <code id=origin:document-10><a href=dom.html#document>Document</a></code> is the initial "<code id=origin:about:blank-2><a href=infrastructure.html#about:blank>about:blank</a></code>" document<dd><p><a href=#about-blank-origin>The one it was assigned when its browsing context was
     created</a>.<dt>If the <code id=origin:document-11><a href=dom.html#document>Document</a></code> is a non-initial "<code id=origin:about:blank-3><a href=infrastructure.html#about:blank>about:blank</a></code>" document<dt>If the <code id=origin:document-12><a href=dom.html#document>Document</a></code> was generated from a <a href=http://www.akanko.net/marimo/data/rfc/rfc2397-jp.txt#section-2 id=origin:data-protocol data-x-internal=data-protocol><code>data:</code> URL</a> found in another <code id=origin:document-13><a href=dom.html#document>Document</a></code> or in a
     script<dd><p>The <a href=#concept-origin id=origin:concept-origin-7>origin</a> of the <a id=origin:incumbent-settings-object href=webappapis.html#incumbent-settings-object>incumbent settings object</a> when the
     <a href=#navigate id=origin:navigate>navigate</a> algorithm was invoked, or, if no <a href=webappapis.html#concept-script id=origin:concept-script>script</a> was involved, the <a href=#concept-origin id=origin:concept-origin-8>origin</a> of the <a id=origin:node-document href=https://triple-underscore.github.io/DOM4-ja.html#concept-node-document data-x-internal=node-document>node
     document</a> of the element that initiated the <a href=#navigate id=origin:navigate-2>navigation</a> to
     that <a id=origin:url href=https://triple-underscore.github.io/URL-ja.html#concept-url data-x-internal=url>URL</a>.<dt>If the <code id=origin:document-14><a href=dom.html#document>Document</a></code> was created as part of the processing for <a href=#javascript-protocol id=origin:javascript-protocol><code>javascript:</code> URLs</a><dd><p>The <a href=#concept-origin id=origin:concept-origin-9>origin</a> of the <a href=#active-document id=origin:active-document>active document</a> of the <a href=#browsing-context id=origin:browsing-context>browsing
     context</a> being navigated when the <a href=#navigate id=origin:navigate-3>navigate</a> algorithm was invoked.<dt>If the <code id=origin:document-15><a href=dom.html#document>Document</a></code> is <a id=origin:an-iframe-srcdoc-document href=embedded-content.html#an-iframe-srcdoc-document>an <code>iframe</code> <code>srcdoc</code> document</a><dd><p>The <a href=#concept-origin id=origin:concept-origin-10>origin</a> of the <code id=origin:document-16><a href=dom.html#document>Document</a></code>'s <a href=#concept-document-bc id=origin:concept-document-bc>browsing context</a>'s <a href=#browsing-context-container id=origin:browsing-context-container>browsing context
     container</a>'s <a id=origin:node-document-2 href=https://triple-underscore.github.io/DOM4-ja.html#concept-node-document data-x-internal=node-document>node document</a>.<dt>If the <code id=origin:document-17><a href=dom.html#document>Document</a></code> was obtained in some other manner (e.g. a <a href=http://www.akanko.net/marimo/data/rfc/rfc2397-jp.txt#section-2 id=origin:data-protocol-2 data-x-internal=data-protocol><code>data:</code> URL</a> typed in by the user or that was returned as the
     location of a redirect, a <code id=origin:document-18><a href=dom.html#document>Document</a></code> created using the <code id=origin:dom-domimplementation-createdocument><a data-x-internal=dom-domimplementation-createdocument href=https://triple-underscore.github.io/DOM4-ja.htmlcreatedocument>createDocument()</a></code> API, etc)<dd>
      <p>The default behaviour as defined in the WHATWG DOM standard applies. <a href=references.html#refsDOM>[DOM]</a>.</p>

      <p class=note>The <a href=#concept-origin id=origin:concept-origin-11>origin</a> is a unique <a href=#concept-origin-opaque id=origin:concept-origin-opaque-3>opaque origin</a> assigned when the <code id=origin:document-19><a href=dom.html#document>Document</a></code> is
      created.</p>
     </dl>

   <dt>For images of <code id=origin:the-img-element><a href=embedded-content.html#the-img-element>img</a></code> elements<dd>

    <dl class=switch><dt>If the image data is <a id=origin:cors-cross-origin href=infrastructure.html#cors-cross-origin>CORS-cross-origin</a><dd><p>A unique <a href=#concept-origin-opaque id=origin:concept-origin-opaque-4>opaque origin</a> assigned when the
     image is created.<dt>If the image data is <a id=origin:cors-same-origin href=infrastructure.html#cors-same-origin>CORS-same-origin</a><dd><p>The <code id=origin:the-img-element-2><a href=embedded-content.html#the-img-element>img</a></code> element's <a id=origin:node-document-3 href=https://triple-underscore.github.io/DOM4-ja.html#concept-node-document data-x-internal=node-document>node document</a>'s
     <a href=#concept-origin id=origin:concept-origin-12>origin</a>.</dl>

   <dt>For <code id=origin:the-audio-element><a href=embedded-content.html#the-audio-element>audio</a></code> and <code id=origin:the-video-element><a href=embedded-content.html#the-video-element>video</a></code> elements<dd>

    <dl class=switch><dt>If the <a id=origin:media-data href=embedded-content.html#media-data>media data</a> is <a id=origin:cors-cross-origin-2 href=infrastructure.html#cors-cross-origin>CORS-cross-origin</a><dd><p>A unique <a href=#concept-origin-opaque id=origin:concept-origin-opaque-5>opaque origin</a> assigned when the
     <a id=origin:media-data-2 href=embedded-content.html#media-data>media data</a> is fetched.<dt>If the <a id=origin:media-data-3 href=embedded-content.html#media-data>media data</a> is <a id=origin:cors-same-origin-2 href=infrastructure.html#cors-same-origin>CORS-same-origin</a><dd><p>The <a id=origin:media-element href=embedded-content.html#media-element>media element</a>'s <a id=origin:node-document-4 href=https://triple-underscore.github.io/DOM4-ja.html#concept-node-document data-x-internal=node-document>node document</a>'s
     <a href=#concept-origin id=origin:concept-origin-13>origin</a>.</dl>

   <dt>For fonts<dd>

    <p>For a downloadable Web font it is a copy of the <a href=https://triple-underscore.github.io/URL-ja.html#concept-url-origin id=origin:concept-url-origin-2 data-x-internal=concept-url-origin>origin</a> of the <a id=origin:url-record href=https://triple-underscore.github.io/URL-ja.html#concept-url data-x-internal=url-record>URL record</a> used to obtain the font
    (after any redirects). <a href=references.html#refsCSSFONTS>[CSSFONTS]</a> <a href=references.html#refsCSSFONTLOAD>[CSSFONTLOAD]</a></p> 

    <p>For a locally installed system font is the <a href=#concept-origin id=origin:concept-origin-14>origin</a> of the <code id=origin:document-20><a href=dom.html#document>Document</a></code>
    in which that font is being used.</p>

   </dl>

  <p>Other specifications can override the above definitions by themselves specifying the origin of
  a particular <code id=origin:document-21><a href=dom.html#document>Document</a></code> object, image, <a id=origin:media-element-2 href=embedded-content.html#media-element>media element</a>, or font.</p>

  <hr>

  <p>The <dfn id=unicode-serialisation-of-an-origin data-export="">Unicode serialisation of an origin</dfn> is the string obtained by
  applying the following algorithm to the given <a href=#concept-origin id=origin:concept-origin-15>origin</a> <var>origin</var>:</p>

  <ol><li><p>If <var>origin</var> is an <a href=#concept-origin-opaque id=origin:concept-origin-opaque-6>opaque origin</a>, then
   return "<code>null</code>".</li><li><p>Let <var>host</var> be <var>origin</var>'s <a href=#concept-origin-host id=origin:concept-origin-host-2>host</a>.</li><li><p>Let <var>unicodeHost</var> be <var>host</var> if <var>host</var> is not a <a href=https://triple-underscore.github.io/URL-ja.html#concept-domain id=origin:concept-domain-2 data-x-internal=concept-domain>domain</a>, and the result of applying <a id=origin:domain-to-unicode href=https://triple-underscore.github.io/URL-ja.html#concept-domain-to-unicode data-x-internal=domain-to-unicode>domain to Unicode</a>
   to <var>host</var> otherwise.</li><li><p>Let <var>unicodeOrigin</var> be a new <a href=#concept-origin-tuple id=origin:concept-origin-tuple-3>tuple
   origin</a> consisting <var>origin</var>'s <a href=#concept-origin-scheme id=origin:concept-origin-scheme>scheme</a>,
   <var>unicodeHost</var>, and <var>origin</var>'s <a href=#concept-origin-port id=origin:concept-origin-port>port</a>.</li><li>
    <p>Return the <a href=#ascii-serialisation-of-an-origin id=origin:ascii-serialisation-of-an-origin-2>ASCII serialisation of an origin</a>, given <var>unicodeOrigin</var>.</p>

    <p class=note>The name <a href=#ascii-serialisation-of-an-origin id=origin:ascii-serialisation-of-an-origin-3>ASCII serialisation of an origin</a> is misleading, as it
    merely serialises an origin, which are all ASCII by default due to the <a id=origin:url-parser href=https://triple-underscore.github.io/URL-ja.html#concept-url-parser data-x-internal=url-parser>URL
    parser</a>.</p>
   </li></ol>

  <p class=example>The <a href=#unicode-serialisation-of-an-origin id=origin:unicode-serialisation-of-an-origin>Unicode
  serialisation</a> of ("<code>https</code>", "<code>xn--maraa-rta.example</code>", null, null) is "<code>https://maraña.example</code>".</p>

  <p>The <dfn id=ascii-serialisation-of-an-origin data-export="">ASCII serialisation of an origin</dfn> is the string obtained by
  applying the following algorithm to the given <a href=#concept-origin id=origin:concept-origin-16>origin</a> <var>origin</var>:</p>

  <ol><li><p>If <var>origin</var> is an <a href=#concept-origin-opaque id=origin:concept-origin-opaque-7>opaque origin</a>, then
   return "<code>null</code>".</li><li><p>Otherwise, let <var>result</var> be <var>origin</var>'s <a href=#concept-origin-scheme id=origin:concept-origin-scheme-2>scheme</a>.</li><li><p>Append "<code>://</code>" to <var>result</var>.</li><li><p>Append <var>origin</var>'s <a href=#concept-origin-host id=origin:concept-origin-host-3>host</a>, <a href=https://triple-underscore.github.io/URL-ja.html#concept-host-serializer id=origin:host-serialiser data-x-internal=host-serialiser>serialised</a>, to <var>result</var>.</li><li><p>If <var>origin</var>'s <a href=#concept-origin-port id=origin:concept-origin-port-2>port</a> is non-null, append
   a U+003A COLON character (:), and <var>origin</var>'s <a href=#concept-origin-port id=origin:concept-origin-port-3>port</a>, <a href=https://triple-underscore.github.io/URL-ja.html#serialize-an-integer id=origin:serialise-an-integer data-x-internal=serialise-an-integer>serialised</a>,
   to <var>result</var>.</li><li><p>Return <var>result</var>.</li></ol>

  <hr>

  <p>Two <a href=#concept-origin id=origin:concept-origin-17>origins</a>, <var>A</var> and <var>B</var>, are said to be
  <dfn id=same-origin data-export="">same origin</dfn> if the following algorithm returns true:</p>

  <ol><li><p>If <var>A</var> and <var>B</var> are the same <a href=#concept-origin-opaque id=origin:concept-origin-opaque-8>opaque
   origin</a>, then return true.</li><li><p>If <var>A</var> and <var>B</var> are both <a href=#concept-origin-tuple id=origin:concept-origin-tuple-4>tuple
   origins</a> and their <a href=#concept-origin-scheme id=origin:concept-origin-scheme-3>schemes</a>, <a href=#concept-origin-host id=origin:concept-origin-host-4>hosts</a>, and <a href=#concept-origin-port id=origin:concept-origin-port-4>port</a> are
   identical, then return true.</li><li><p>Return false.</li></ol>

  <p>Two <a href=#concept-origin id=origin:concept-origin-18>origins</a>, <var>A</var> and <var>B</var>, are said to be
  <dfn id=same-origin-domain data-export="">same origin-domain</dfn> if the following algorithm returns true:</p>

  <ol><li><p>If <var>A</var> and <var>B</var> are the same <a href=#concept-origin-opaque id=origin:concept-origin-opaque-9>opaque
   origin</a>, then return true.</li><li>
    <p>If <var>A</var> and <var>B</var> are both <a href=#concept-origin-tuple id=origin:concept-origin-tuple-5>tuple
    origins</a>, run these substeps:</p>

    <ol><li><p>If <var>A</var> and <var>B</var>'s <a href=#concept-origin-scheme id=origin:concept-origin-scheme-4>schemes</a>
     are identical, and their <a href=#concept-origin-domain id=origin:concept-origin-domain-4>domains</a> are identical and
     non-null, then return true.</li><li><p>Otherwise, if <var>A</var> and <var>B</var> are <a href=#same-origin id=origin:same-origin>same origin</a> and their <a href=#concept-origin-domain id=origin:concept-origin-domain-5>domains</a> are identical and null, then return
     true.</li></ol>

   </li><li><p>Return false.</li></ol>

  <div class=example>
   <table><tr><th><var>A</var>
     </th><th><var>B</var>
     </th><th><a href=#same-origin id=origin:same-origin-2>same origin</a>
     </th><th><a href=#same-origin-domain id=origin:same-origin-domain>same origin-domain</a>
    </th></tr><tr><td>("<code>https</code>", "<code>example.org</code>", null, null)
     
     </td><td>("<code>https</code>", "<code>example.org</code>", null, null)
     
     </td><td>✅
     
     </td><td>✅
    
    </td></tr><tr><td>("<code>https</code>", "<code>example.org</code>", 314, "<code>example.org</code>")
     
     </td><td>("<code>https</code>", "<code>example.org</code>", 420, "<code>example.org</code>")
     
     </td><td>❌
     
     </td><td>✅
    
    </td></tr><tr><td>("<code>https</code>", "<code>example.org</code>", null, null)
     
     </td><td>("<code>https</code>", "<code>example.org</code>", null, "<code>example.org</code>")
     
     </td><td>✅
     
     </td><td>❌
    
    </td></tr><tr><td>("<code>https</code>", "<code>example.org</code>", null, "<code>example.org</code>")
     
     </td><td>("<code>http</code>", "<code>example.org</code>", null, "<code>example.org</code>")
     
     </td><td>❌
     
     </td><td>❌
   
   </td></tr></table>
  </div>

  


  <h4 id=relaxing-the-same-origin-restriction>7.5.1 同一生成元制限を緩和する</h4>

  <dl class=domintro><dt><var>document</var> . <code id=relaxing-the-same-origin-restriction:dom-document-domain><a href=#dom-document-domain>domain</a></code> [ = <var>domain</var> ]<dd>

    <p>セキュリティーチェックのために使用される現在のドメインを返す。</p>

    <p>Can be set to a value that removes subdomains, to change the <a href=#concept-origin id=relaxing-the-same-origin-restriction:concept-origin>origin</a>'s <a href=#concept-origin-domain id=relaxing-the-same-origin-restriction:concept-origin-domain>domain</a> to allow pages on other subdomains of the same
    domain (if they do the same thing) to access each other. (Can't be set in sandboxed
    <code id=relaxing-the-same-origin-restriction:the-iframe-element><a href=embedded-content.html#the-iframe-element>iframe</a></code>s.)</p>

   </dl>

  

  <p>The <dfn id=dom-document-domain><code>domain</code></dfn> attribute's getter must run
  these steps:</p>

  <ol><li><p>If this <code id=relaxing-the-same-origin-restriction:document><a href=dom.html#document>Document</a></code> object does not have a <a href=#concept-document-bc id=relaxing-the-same-origin-restriction:concept-document-bc>browsing context</a>, then return the empty string.

   

   </li><li><p>Let <var>effectiveDomain</var> be this <code id=relaxing-the-same-origin-restriction:document-2><a href=dom.html#document>Document</a></code>'s <a href=#concept-origin id=relaxing-the-same-origin-restriction:concept-origin-2>origin</a>'s <a href=#concept-origin-effective-domain id=relaxing-the-same-origin-restriction:concept-origin-effective-domain>effective domain</a>.

   

   </li><li><p>If <var>effectiveDomain</var> is an <a href=#concept-origin-opaque id=relaxing-the-same-origin-restriction:concept-origin-opaque>opaque
   origin</a>, then return the empty string.</li><li><p>Return <var>effectiveDomain</var>, <a href=https://triple-underscore.github.io/URL-ja.html#concept-host-serializer id=relaxing-the-same-origin-restriction:host-serialiser data-x-internal=host-serialiser>serialised</a>.</li></ol>

  <p>The <code id=relaxing-the-same-origin-restriction:dom-document-domain-2><a href=#dom-document-domain>domain</a></code> attribute's setter must run these
  steps:</p>

  <ol><li><p>If this <code id=relaxing-the-same-origin-restriction:document-3><a href=dom.html#document>Document</a></code> object has no <a href=#concept-document-bc id=relaxing-the-same-origin-restriction:concept-document-bc-2>browsing
   context</a>, then throw a <a id=relaxing-the-same-origin-restriction:securityerror href=https://triple-underscore.github.io/WebIDL-ja.html#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a>
   <code id=relaxing-the-same-origin-restriction:domexception><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.</li><li><p>If this <code id=relaxing-the-same-origin-restriction:document-4><a href=dom.html#document>Document</a></code> object's <a href=#active-sandboxing-flag-set id=relaxing-the-same-origin-restriction:active-sandboxing-flag-set>active sandboxing flag set</a> has its
   <a href=#sandboxed-document.domain-browsing-context-flag id=relaxing-the-same-origin-restriction:sandboxed-document.domain-browsing-context-flag>sandboxed <code>document.domain</code> browsing context
   flag</a> set, then throw a <a id=relaxing-the-same-origin-restriction:securityerror-2 href=https://triple-underscore.github.io/WebIDL-ja.html#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a>
   <code id=relaxing-the-same-origin-restriction:domexception-2><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.</li><li><p>If the given value is the empty string, then throw a
   <a id=relaxing-the-same-origin-restriction:securityerror-3 href=https://triple-underscore.github.io/WebIDL-ja.html#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a> <code id=relaxing-the-same-origin-restriction:domexception-3><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.</li><li><p>Let <var>host</var> be the result of <a href=https://triple-underscore.github.io/URL-ja.html#concept-host-parser id=relaxing-the-same-origin-restriction:host-parser data-x-internal=host-parser>parsing</a> the given
   value.</li><li><p>If <var>host</var> is failure, then throw a <a id=relaxing-the-same-origin-restriction:securityerror-4 href=https://triple-underscore.github.io/WebIDL-ja.html#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a>
   <code id=relaxing-the-same-origin-restriction:domexception-4><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.</li><li><p>Let <var>effectiveDomain</var> be this <code id=relaxing-the-same-origin-restriction:document-5><a href=dom.html#document>Document</a></code> object's
   <a href=#concept-origin id=relaxing-the-same-origin-restriction:concept-origin-3>origin</a>'s <a href=#concept-origin-effective-domain id=relaxing-the-same-origin-restriction:concept-origin-effective-domain-2>effective
   domain</a>.</li><li>
    <p>If <var>host</var> is <em>not</em> <a href=https://triple-underscore.github.io/URL-ja.html#concept-host-equals id=relaxing-the-same-origin-restriction:host-equals data-x-internal=host-equals>equal</a> to
    <var>effectiveDomain</var>, then run these substeps:</p>

    <ol><li>
      <p>If <var>host</var> or <var>effectiveDomain</var> is not a <a href=https://triple-underscore.github.io/URL-ja.html#concept-domain id=relaxing-the-same-origin-restriction:concept-domain data-x-internal=concept-domain>domain</a>, then throw a <a id=relaxing-the-same-origin-restriction:securityerror-5 href=https://triple-underscore.github.io/WebIDL-ja.html#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a>
      <code id=relaxing-the-same-origin-restriction:domexception-5><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.</p>

      <p class=note>This is meant to exclude <a href=https://triple-underscore.github.io/URL-ja.html#concept-host id=relaxing-the-same-origin-restriction:concept-host data-x-internal=concept-host>hosts</a> that are an
      <a id=relaxing-the-same-origin-restriction:ipv4-address href=https://triple-underscore.github.io/URL-ja.html#concept-ipv4 data-x-internal=ipv4-address>IPv4 address</a> or an <a id=relaxing-the-same-origin-restriction:ipv6-address href=https://triple-underscore.github.io/URL-ja.html#concept-ipv6 data-x-internal=ipv6-address>IPv6 address</a>.</p>
     </li><li><p>If <var>host</var>, prefixed by a U+002E FULL STOP (.), does not exactly match the end
     of <var>effectiveDomain</var>, then throw a <a id=relaxing-the-same-origin-restriction:securityerror-6 href=https://triple-underscore.github.io/WebIDL-ja.html#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a>
     <code id=relaxing-the-same-origin-restriction:domexception-6><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.</li><li>
      <p>If <var>host</var> matches a suffix in the Public Suffix List, or, if <var>host</var>,
      prefixed by a U+002E FULL STOP (.), matches the end of a suffix in the Public Suffix List,
      then throw a <a id=relaxing-the-same-origin-restriction:securityerror-7 href=https://triple-underscore.github.io/WebIDL-ja.html#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a> <code id=relaxing-the-same-origin-restriction:domexception-7><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>. <a href=references.html#refsPSL>[PSL]</a></p>

      <p>Suffixes must be compared after applying the <a id=relaxing-the-same-origin-restriction:host-parser-2 href=https://triple-underscore.github.io/URL-ja.html#concept-host-parser data-x-internal=host-parser>host parser</a> algorithm.</p>
     </li></ol>
   </li><li><p>Set <var>origin</var>'s <a href=#concept-origin-domain id=relaxing-the-same-origin-restriction:concept-origin-domain-2>domain</a> to
   <var>host</var>.</li></ol>

  

  <p class=note>The <code id=relaxing-the-same-origin-restriction:dom-document-domain-3><a href=#dom-document-domain>document.domain</a></code> attribute is used to
  enable pages on different hosts of a domain to access each others' DOMs.</p>

  <p class=warning>共有ホスティングを使用する際<code id=relaxing-the-same-origin-restriction:dom-document-domain-4><a href=#dom-document-domain>document.domain</a></code>の属性を使用しない。信頼できない第三者が同じIPアドレスだが別のポート上でHTTPサーバーをホストできる場合、<code id=relaxing-the-same-origin-restriction:dom-document-domain-5><a href=#dom-document-domain>document.domain</a></code>属性が使用された後に生成元を比較する際にポートは無視されるように、通常同じホスト上の2つの異なるサイトを保護する同一生成元の保護は失敗するだろう。</p>





  <h3 id=sandboxing>7.6 サンドボックス</h3>

  <p><dfn id=sandboxing-flag-set>サンドボックスフラグ設定</dfn>は、潜在的に信頼されないリソースが持つ能力を制限するために使用される、以下のフラグに属するゼロ個以上のセットである：</p>

  <dl><dt><dfn id=sandboxed-navigation-browsing-context-flag>サンドボックス化されたナビゲーションブラウジングコンテキストフラグ</dfn><dd>

    <p>このフラグは、<a href=#sandboxLinks>サンドボックス化されたブラウジングコンテキスト自身以外のコンテンツのナビゲーションブラウジングコンテキスト</a>（またはその中にさらにネストされたブラウジングコンテキスト）、（次の定義された<a href=#sandboxed-auxiliary-navigation-browsing-context-flag id=sandboxing:sandboxed-auxiliary-navigation-browsing-context-flag>サンドボックス化された補助ナビゲーションブラウジングコンテキストフラグ</a>により保護される）<a href=#auxiliary-browsing-context id=sandboxing:auxiliary-browsing-context>補助ブラウジングコンテキスト</a>、および（以下に定義する<a href=#sandboxed-top-level-navigation-browsing-context-flag id=sandboxing:sandboxed-top-level-navigation-browsing-context-flag>サンドボックス化されたトップレベルナビゲーションブラウジングコンテキストフラグ</a>によって保護される）<a href=#top-level-browsing-context id=sandboxing:top-level-browsing-context>トップレベルブラウジングコンテキスト</a>を阻止する。</p>

    <p><a href=#sandboxed-auxiliary-navigation-browsing-context-flag id=sandboxing:sandboxed-auxiliary-navigation-browsing-context-flag-2>サンドボックス化された補助ナビゲーションブラウジングコンテキストフラグ</a>が設定されない場合、それにもかかわらず一定の場合における制限はポップアップ（新しい<a href=#top-level-browsing-context id=sandboxing:top-level-browsing-context-2>トップレベルブラウジングコンテキスト</a>）を開くことができる。これらの<a href=#browsing-context id=sandboxing:browsing-context>ブラウジングコンテキスト</a>は常に、<dfn id=one-permitted-sandboxed-navigator>1つの許可されたサンドボックス化されたナビゲーター</dfn>を持ち、実際に移動するために作成した<a href=#browsing-context id=sandboxing:browsing-context-2>ブラウジングコンテキスト</a>を許可する、ブラウジングコンテキストが作成される際に設定を持つ。（そうでなければ、<a href=#sandboxed-navigation-browsing-context-flag id=sandboxing:sandboxed-navigation-browsing-context-flag>サンドボックス化されたナビゲーションブラウジングコンテキストフラグ</a>は、それらが開かれた場合であってもナビゲートされていくのを防ぐだろう。）</p>

   <dt><dfn id=sandboxed-auxiliary-navigation-browsing-context-flag>サンドボックス化された補助ナビゲーションブラウジングコンテキストフラグ</dfn><dd>

    <p>This flag <a href=#sandboxWindowOpen>prevents content from creating new auxiliary browsing
    contexts</a>, e.g. using the <code id=sandboxing:attr-hyperlink-target><a href=semantics.html#attr-hyperlink-target>target</a></code> attribute or
    the <code id=sandboxing:dom-open><a href=#dom-open>window.open()</a></code> method.</p>

   <dt><dfn id=sandboxed-top-level-navigation-browsing-context-flag>サンドボックス化されたトップレベルナビゲーションブラウジングコンテキストフラグ</dfn><dd>

    <p>このフラグは、<a href=#sandboxLinks>それらの<span>トップレベルブラウジングコンテキスト</span>のナビゲートからコンテンツを防ぎ</a>、かつ<a href=#sandboxClose>それらの<span>トップレベルブラウジングコンテキスト</span>の遮断からコンテンツを防ぐ</a>。</p>

    <p><a href=#sandboxed-top-level-navigation-browsing-context-flag id=sandboxing:sandboxed-top-level-navigation-browsing-context-flag-2>サンドボックス化されたトップレベルナビゲーションブラウジングコンテキストフラグ</a>が設定され<em>ない</em>場合、コンテンツはその<a href=#top-level-browsing-context id=sandboxing:top-level-browsing-context-3>トップレベルブラウジングコンテキスト</a>をナビゲートできるが、他の<a href=#browsing-context id=sandboxing:browsing-context-3>ブラウジングコンテキスト</a>は依然として<a href=#sandboxed-navigation-browsing-context-flag id=sandboxing:sandboxed-navigation-browsing-context-flag-2>サンドボックス化されたナビゲーションブラウジングコンテキストフラグ</a>およびおそらく<a href=#sandboxed-auxiliary-navigation-browsing-context-flag id=sandboxing:sandboxed-auxiliary-navigation-browsing-context-flag-3>サンドボックス化された補助ナビゲーションブラウジングコンテキストフラグ</a>によって保護される。</p>

   <dt><dfn id=sandboxed-plugins-browsing-context-flag>サンドボックス化されたプラグインブラウジングコンテキストフラグ</dfn><dd>

    <p>これらの<a href=infrastructure.html#plugin id=sandboxing:plugin-2>プラグイン</a>が<a href=infrastructure.html#concept-plugin-secure id=sandboxing:concept-plugin-secure>安全</a>でない限り、<a href=embedded-content.html#sandboxPluginEmbed><code>embed</code>要素</a>、<a href=embedded-content.html#sandboxPluginObject><code>object</code>要素</a>、<a href=obsolete.html#sandboxPluginApplet><code>applet</code>要素</a>を使用しているかどうか、または<a href=#nested-browsing-context id=sandboxing:nested-browsing-context>ネストされたブラウジングコンテキスト</a>の<a href=#sandboxPluginNavigate>ナビゲーション</a>を介して、このフラグは、<a href=infrastructure.html#plugin id=sandboxing:plugin>プラグイン</a>をインスタンス化するコンテンツを防ぐ。</p>

   <dt><dfn id=sandboxed-origin-browsing-context-flag>サンドボックス化された生成元ブラウジングコンテキストフラグ</dfn><dd>

    <p>このフラグは、<a href=#sandboxOrigin>一意な生成元にコンテンツを強制する</a>。したがって、同一<a href=#concept-origin id=sandboxing:concept-origin>生成元</a>から他のコンテンツにアクセスすることを防止する。</p>

    <p>このフラグはまた、<a href=dom.html#sandboxCookies><code>document.cookie</code> IDL属性からの読み取りまたは書き込みをするスクリプトを防止し</a>、<code id=sandboxing:dom-localstorage><a href=webstorage.html#dom-localstorage>localStorage</a></code>へのアクセスをブロックする。</p>

   <dt><dfn id=sandboxed-forms-browsing-context-flag>サンドボックス化されたフォームブラウジングコンテキストフラグ</dfn><dd>

    <p>このフラグは<a href=forms.html#sandboxSubmitBlocked>フォーム送信をブロックする</a>。</p>

   <dt><dfn id=sandboxed-pointer-lock-browsing-context-flag>サンドボックス化されたポインターロックブラウジングコンテキストフラグ</dfn><dd>

    <p>このフラグはPointer Lock APIを無効にする。<a href=references.html#refsPOINTERLOCK>[POINTERLOCK]</a></p>

   <dt><dfn id=sandboxed-scripts-browsing-context-flag>サンドボックス化されたスクリプトブラウジングコンテキストフラグ</dfn><dd>

    <p>このフラグは、<a href=webappapis.html#sandboxScriptBlocked>スクリプトの実行をブロックする</a>。</p>

   <dt><dfn id=sandboxed-automatic-features-browsing-context-flag>サンドボックス化された自動機能ブラウジングコンテキストフラグ</dfn><dd>

    <p>このフラグは、<a href=embedded-content.html#attr-media-autoplay id=sandboxing:attr-media-autoplay>自動ビデオ再生</a>や<a href=forms.html#attr-fe-autofocus id=sandboxing:attr-fe-autofocus>自動フォームコントロールフォーカス</a>などの、自動的に切り替える機能をブロックする。</p>

   <dt>The <dfn id=sandboxed-storage-area-urls-flag>sandboxed storage area URLs flag</dfn><dd>

    <p>This flag prevents URL schemes that use storage areas from being able to access the origin's
    data.</p>

   <dt><dfn id=sandboxed-fullscreen-browsing-context-flag>サンドボックス化されたフルスクリーンブラウジングコンテキストフラグ</dfn><dd>

    <p>このフラグは、<code id=sandboxing:dom-element-requestfullscreen><a data-x-internal=dom-element-requestfullscreen href=https://fullscreen.spec.whatwg.org/#dom-element-requestfullscreen>requestFullscreen()</a></code>メソッドの使用からコンテンツを保護する。</p>

   <dt><dfn id=sandboxed-document.domain-browsing-context-flag>サンドボックス化された<code>document.domain</code>ブラウジングコンテキストフラグ</dfn>。<dd>

    <p>This flag prevents content from using the
    <code id=sandboxing:dom-document-domain><a href=#dom-document-domain>document.domain</a></code> setter.</p>

   <dt>The <dfn id=sandbox-propagates-to-auxiliary-browsing-contexts-flag>sandbox propagates to auxiliary browsing contexts flag</dfn><dd>

    <p>This flag prevents content from escaping the sandbox by ensuring that any
    <a href=#auxiliary-browsing-context id=sandboxing:auxiliary-browsing-context-2>auxiliary browsing context</a> it creates inherits the content's
    <a href=#active-sandboxing-flag-set id=sandboxing:active-sandboxing-flag-set>active sandboxing flag set</a>.</p>

   <dt>The <dfn id=sandboxed-modals-flag>sandboxed modals flag</dfn><dd>

    <p>This flag prevents content from using any of the following features to produce modal
    dialogs:</p>

    <ul><li><code id=sandboxing:dom-alert><a href=webappapis.html#dom-alert>window.alert()</a></code></li><li><code id=sandboxing:dom-confirm><a href=webappapis.html#dom-confirm>window.confirm()</a></code></li><li><code id=sandboxing:dom-print><a href=webappapis.html#dom-print>window.print()</a></code></li><li><code id=sandboxing:dom-prompt><a href=webappapis.html#dom-prompt>window.prompt()</a></code></li><li>the <code id=sandboxing:event-beforeunload><a href=indices.html#event-beforeunload>beforeunload</a></code> event</li></ul>

   </dl>

  <p>ユーザーエージェントが<dfn id=parse-a-sandboxing-directive>サンドボックスディレクティブを解析する</dfn>場合、文字列<var>input</var>、<a href=#sandboxing-flag-set id=sandboxing:sandboxing-flag-set>サンドボックスフラグ設定</a><var>output</var>、および任意で<var>allow fullscreen flag</var>を与え、次の手順を実行しなければならない：</p>

  <ol><li><p><var>tokens</var>を取得するために、<a href=infrastructure.html#split-a-string-on-spaces id=sandboxing:split-a-string-on-spaces>スペースでの<var>input</var>を分割する</a>。</li><li><p><var>output</var>を空にする。</li><li>

    <p><var>output</var>に次のフラグを追加する：</p>

    <ul><li><p><a href=#sandboxed-navigation-browsing-context-flag id=sandboxing:sandboxed-navigation-browsing-context-flag-3>サンドボックス化されたナビゲーションブラウジングコンテキストフラグ</a></li><li><p><var>tokens</var>が<dfn id=attr-iframe-sandbox-allow-popups><code>allow-popups</code></dfn>キーワードを含む場合を除いて、<a href=#sandboxed-auxiliary-navigation-browsing-context-flag id=sandboxing:sandboxed-auxiliary-navigation-browsing-context-flag-4>サンドボックス化された補助ナビゲーションブラウジングコンテキストフラグ</a></li><li><p><var>tokens</var>が<dfn id=attr-iframe-sandbox-allow-top-navigation><code>allow-top-navigation</code></dfn>キーワードを含む場合を除いて、<a href=#sandboxed-top-level-navigation-browsing-context-flag id=sandboxing:sandboxed-top-level-navigation-browsing-context-flag-3>サンドボックス化されたトップレベルブラウジングコンテキストフラグ</a></li><li><p><a href=#sandboxed-plugins-browsing-context-flag id=sandboxing:sandboxed-plugins-browsing-context-flag>サンドボックス化されたプラグインブラウジングコンテキストフラグ</a></li><li>

      <p><var>tokens</var>が<dfn id=attr-iframe-sandbox-allow-same-origin><code>allow-same-origin</code></dfn>キーワードを含む場合を除いて、<a href=#sandboxed-origin-browsing-context-flag id=sandboxing:sandboxed-origin-browsing-context-flag>サンドボックス化された生成元ブラウジングコンテキストフラグ</a></p>

      <div class=note>

       <p><code id=sandboxing:attr-iframe-sandbox-allow-same-origin><a href=#attr-iframe-sandbox-allow-same-origin>allow-same-origin</a></code>キーワードは2つの例を対象とする。</p>

       <p>1つ目は、依然としてサンドボックス化されたコンテンツのDOMへのアクセスを可能する一方で、スクリプトを無効にするためにサンドボックス化されるべき同じサイトからコンテンツを許可するために使用できる。</p>

       <p>2つ目は、サードパーティサイトからコンテンツを埋め込むために使用でき、データなどを格納するためにデータベースAPIを使用して、その元のサイトに戻る通信から埋め込まれたページを妨げることなく、ポップアップウィンドウなどを開いてから、そのサイトを防ぐためにサンドボックス化する。</p>

      </div>

     </li><li><p><var>tokens</var>が<dfn id=attr-iframe-sandbox-allow-forms><code>allow-forms</code></dfn>キーワードを含む場合を除いて、<a href=#sandboxed-forms-browsing-context-flag id=sandboxing:sandboxed-forms-browsing-context-flag>サンドボックス化されたフォームブラウジングコンテキストフラグ</a></li><li><p><var>tokens</var>が<dfn id=attr-iframe-sandbox-allow-pointer-lock><code>allow-pointer-lock</code></dfn>キーワードを含む場合を除いて、<a href=#sandboxed-pointer-lock-browsing-context-flag id=sandboxing:sandboxed-pointer-lock-browsing-context-flag>サンドボックス化されたポインターロックブラウジングコンテキストフラグ</a></li><li><p><var>tokens</var>が<dfn id=attr-iframe-sandbox-allow-scripts><code>allow-scripts</code></dfn>キーワードを含む場合を除いて、<a href=#sandboxed-scripts-browsing-context-flag id=sandboxing:sandboxed-scripts-browsing-context-flag>サンドボックス化されたスクリプトブラウジングコンテキストフラグ</a></li><li>

      <p><var>tokens</var>が（上記で定義された）<code id=sandboxing:attr-iframe-sandbox-allow-scripts><a href=#attr-iframe-sandbox-allow-scripts>allow-scripts</a></code>キーワードを含む場合を除いて、<a href=#sandboxed-automatic-features-browsing-context-flag id=sandboxing:sandboxed-automatic-features-browsing-context-flag>サンドボックス化された自動機能ブラウジングコンテキストフラグ</a></p>

      <p class=note>このフラグは、サンドボックスの自動機能　これらの機能がとにかく些細なことも可能であるスクリプトが有効である場合、およびそれらが宣言機能を使用できるようにするよりむしろサンドボックス化された場合、著者がそれらを行うためのスクリプトを使用するよう強制することが不幸であるので、スクリプトと同じキーワードで緩和される。</p>

     </li><li><p>The <a href=#sandboxed-storage-area-urls-flag id=sandboxing:sandboxed-storage-area-urls-flag>sandboxed storage area URLs flag</a>.</li><li><p><var>allow fullscreen flag</var>が<a href=#parse-a-sandboxing-directive id=sandboxing:parse-a-sandboxing-directive>サンドボックスディレクティブを解析する</a>フラグを通過される場合を除いて、<a href=#sandboxed-fullscreen-browsing-context-flag id=sandboxing:sandboxed-fullscreen-browsing-context-flag>サンドボックス化されたフルスクリーンブラウジングコンテキストフラグ</a></li><li><p><a href=#sandboxed-document.domain-browsing-context-flag id=sandboxing:sandboxed-document.domain-browsing-context-flag>サンドボックス化された<code>document.domain</code>ブラウジングコンテキストフラグ</a>。</li><li><p>The <a href=#sandbox-propagates-to-auxiliary-browsing-contexts-flag id=sandboxing:sandbox-propagates-to-auxiliary-browsing-contexts-flag>sandbox propagates to auxiliary browsing contexts flag</a>, unless
     <var>tokens</var> contains the <dfn id=attr-iframe-sandbox-allow-popups-to-escape-sandbox><code>allow-popups-to-escape-sandbox</code></dfn>
     keyword.</li><li><p>The <a href=#sandboxed-modals-flag id=sandboxing:sandboxed-modals-flag>sandboxed modals flag</a>, unless <var>tokens</var> contains the <dfn id=attr-iframe-sandbox-allow-modals><code>allow-modals</code></dfn> keyword.</li></ul>

   </li></ol>

  <hr>

  <p>すべての<a href=#top-level-browsing-context id=sandboxing:top-level-browsing-context-4>トップレベルブラウジングコンテキスト</a>は、<a href=#sandboxing-flag-set id=sandboxing:sandboxing-flag-set-2>サンドボックスフラグが設定</a>される、<dfn id=popup-sandboxing-flag-set>ポップアップサンドボックスフラグ設定</dfn>を持つ。<a href=#browsing-context id=sandboxing:browsing-context-4>ブラウジングコンテキスト</a>が作成される場合、その<a href=#popup-sandboxing-flag-set id=sandboxing:popup-sandboxing-flag-set>ポップアップサンドフラグ設定</a>は空でなければならない。これは、<a href=#the-rules-for-choosing-a-browsing-context-given-a-browsing-context-name id=sandboxing:the-rules-for-choosing-a-browsing-context-given-a-browsing-context-name>ブラウジングコンテキスト名を指定されるブラウジングコンテキストを選択するための規則</a>によって移入される。</p>

  <p>すべての<a href=#nested-browsing-context id=sandboxing:nested-browsing-context-2>ネストされたブラウジングコンテキスト</a>は、<a href=#sandboxing-flag-set id=sandboxing:sandboxing-flag-set-3>サンドボックスフラグが設定</a>される、<dfn id=iframe-sandboxing-flag-set><code>iframe</code>サンドボックスフラグ設定</dfn>を持つ。<a href=#nested-browsing-context id=sandboxing:nested-browsing-context-3>ネストされたブラウジングコンテキスト</a>の<a href=#iframe-sandboxing-flag-set id=sandboxing:iframe-sandboxing-flag-set><code>iframe</code>サンドボックスフラグ設定</a>で任意の特定の時間に設定されるそれぞれのフラグは、<code id=sandboxing:the-iframe-element><a href=embedded-content.html#the-iframe-element>iframe</a></code>要素の<code id=sandboxing:attr-iframe-sandbox><a href=embedded-content.html#attr-iframe-sandbox>sandbox</a></code>属性によって決定される。</p>

  <p>すべての<code id=sandboxing:document><a href=dom.html#document>Document</a></code>は、<a href=#sandboxing-flag-set id=sandboxing:sandboxing-flag-set-4>サンドボックスフラグ設定</a>である、<dfn id=active-sandboxing-flag-set>アクティブサンドボックスフラグ設定</dfn>を持つ。<code id=sandboxing:document-2><a href=dom.html#document>Document</a></code>が作成される場合、その<a href=#active-sandboxing-flag-set id=sandboxing:active-sandboxing-flag-set-2>アクティブサンドボックスフラグ設定</a>が空でなければならない。それは、<a href=#navigate id=sandboxing:navigate>ナビゲーションアルゴリズム</a>によって追加される。</p>

  <p><a href=#navigate id=sandboxing:navigate-2>ナビゲーションアルゴリズム</a>によって得られるすべてのリソースは、<a href=#sandboxing-flag-set id=sandboxing:sandboxing-flag-set-5>サンドボックスフラグが設定</a>される、<dfn id=forced-sandboxing-flag-set>強制サンドボックスフラグ設定</dfn>を持つ。デフォルトでリソースは、その<a href=#forced-sandboxing-flag-set id=sandboxing:forced-sandboxing-flag-set>強制サンドボックスフラグセット</a>で設定されるフラグを持たないが、他の仕様は、特定のフラグが設定されていることを定義できる。</p>

  <p class=note>具体的には、<a href=#forced-sandboxing-flag-set id=sandboxing:forced-sandboxing-flag-set-2>強制サンドボックスフラグセット</a>が<cite>Content Security Policy</cite>によって使用される。<a href=references.html#refsCSP>[CSP]</a></p>

  <hr>

  <p>ユーザーエージェントが<code id=sandboxing:document-3><a href=dom.html#document>Document</a></code>の<dfn id=implement-the-sandboxing>サンドボックスを実装する</dfn>際に、<code id=sandboxing:document-5><a href=dom.html#document>Document</a></code>オブジェクトが作成された時点で、次の<a href=#sandboxing-flag-set id=sandboxing:sandboxing-flag-set-6>サンドボックスフラグセット</a>に存在するフラグの組合とともに<code id=sandboxing:document-4><a href=dom.html#document>Document</a></code>の<a href=#active-sandboxing-flag-set id=sandboxing:active-sandboxing-flag-set-3>アクティブなサンドボックスフラグセット</a>を追加しなければならない：</p>

  <ul><li><p><code id=sandboxing:document-6><a href=dom.html#document>Document</a></code>の<a href=#concept-document-bc id=sandboxing:concept-document-bc>ブラウジングコンテキスト</a>が<a href=#top-level-browsing-context id=sandboxing:top-level-browsing-context-5>トップレベルブラウジングコンテキスト</a>である場合：<a href=#browsing-context id=sandboxing:browsing-context-5>ブラウジングコンテキスト</a>の<a href=#popup-sandboxing-flag-set id=sandboxing:popup-sandboxing-flag-set-2>ポップアップサンドフラグセット</a>に設定されたフラグ。</li><li><p><code id=sandboxing:document-7><a href=dom.html#document>Document</a></code>の<a href=#concept-document-bc id=sandboxing:concept-document-bc-2>ブラウジングコンテキスト</a>が<a href=#nested-browsing-context id=sandboxing:nested-browsing-context-4>ネストされたブラウジングコンテキスト</a>である場合：<a href=#browsing-context id=sandboxing:browsing-context-6>ブラウジングコンテキスト</a>の<a href=#iframe-sandboxing-flag-set id=sandboxing:iframe-sandboxing-flag-set-2><code>iframe</code>サンドフラグセット</a>に設定されたフラグ。</li><li><p><code id=sandboxing:document-8><a href=dom.html#document>Document</a></code>の<a href=#concept-document-bc id=sandboxing:concept-document-bc-3>ブラウジングコンテキスト</a>が<a href=#nested-browsing-context id=sandboxing:nested-browsing-context-5>ネストされたブラウジングコンテキスト</a>である場合：<a href=#browsing-context id=sandboxing:browsing-context-7>ブラウジングコンテキスト</a>の<a href=#parent-browsing-context id=sandboxing:parent-browsing-context>親ブラウジングコンテキスト</a>に属する<a href=#active-document id=sandboxing:active-document>アクティブ文書</a>の<a href=#active-sandboxing-flag-set id=sandboxing:active-sandboxing-flag-set-4>アクティブサンドボックスフラグセット</a>。</li><li><p>存在する場合、<code id=sandboxing:document-9><a href=dom.html#document>Document</a></code>のリソースの<a href=#forced-sandboxing-flag-set id=sandboxing:forced-sandboxing-flag-set-3>強制サンドボックスフラグセット</a>に設定されたフラグをフラグは設定する。</li></ul>



  <h3 id=history>7.7 セッション履歴およびナビゲーション</h3>

  <h4 id=the-session-history-of-browsing-contexts>7.7.1 ブラウジングコンテキストのセッション履歴</h4>

  <p><a href=#browsing-context id=the-session-history-of-browsing-contexts:browsing-context>ブラウジングコンテキスト</a>内の<code id=the-session-history-of-browsing-contexts:document><a href=dom.html#document>Document</a></code>の配列は、その<dfn id=session-history>セッション履歴</dfn>である。<a href=#nested-browsing-context id=the-session-history-of-browsing-contexts:nested-browsing-context>ネストされたブラウジングコンテキスト</a>を含む各<a href=#browsing-context id=the-session-history-of-browsing-contexts:browsing-context-2>ブラウジングコンテキスト</a>は、個別のセッション履歴を持つ。<a href=#browsing-context id=the-session-history-of-browsing-contexts:browsing-context-3>ブラウジングコンテキスト</a>のセッション履歴は、<a href=#session-history-entry id=the-session-history-of-browsing-contexts:session-history-entry>セッション履歴のエントリ</a>のフラットなリストから成る。Each <dfn id=session-history-entry>session history entry</dfn> consists, at a minimum, of a <a id=the-session-history-of-browsing-contexts:url href=https://triple-underscore.github.io/URL-ja.html#concept-url data-x-internal=url>URL</a>, and each entry may in addition have a <a href=#state-object id=the-session-history-of-browsing-contexts:state-object>state object</a>, a title, a <code id=the-session-history-of-browsing-contexts:document-2><a href=dom.html#document>Document</a></code> object, form data, a <a href=#scroll-restoration-mode id=the-session-history-of-browsing-contexts:scroll-restoration-mode>scroll restoration mode</a>, a scroll position, and other information associated with it.</p>

  <p class=note>最初に作成される際、各エントリは<code id=the-session-history-of-browsing-contexts:document-3><a href=dom.html#document>Document</a></code>を持つ。しかし、<code id=the-session-history-of-browsing-contexts:document-4><a href=dom.html#document>Document</a></code>が<a href=#fully-active id=the-session-history-of-browsing-contexts:fully-active>活性化</a>でない場合、リソースを解放するために<a href=#discard-a-document id=the-session-history-of-browsing-contexts:discard-a-document>廃棄する</a>ことができる。<a href=#session-history-entry id=the-session-history-of-browsing-contexts:session-history-entry-2>セッション履歴のエントリ</a>において<a id=the-session-history-of-browsing-contexts:url-2 href=https://triple-underscore.github.io/URL-ja.html#concept-url data-x-internal=url>URL</a>などのデータは、新しい<code id=the-session-history-of-browsing-contexts:document-5><a href=dom.html#document>Document</a></code>に元の場所を取るものをもたらすために使用され、ユーザーエージェントは自身にその<code id=the-session-history-of-browsing-contexts:document-6><a href=dom.html#document>Document</a></code>を再活性化する必要を見つけるべきである。</p>

  <p class=note><a href=#session-history-entry id=the-session-history-of-browsing-contexts:session-history-entry-3>セッション履歴エントリ</a>に関連付けられたタイトルは、<code id=the-session-history-of-browsing-contexts:document-7><a href=dom.html#document>Document</a></code>の現在の<code id=the-session-history-of-browsing-contexts:the-title-element><a href=semantics.html#the-title-element>title</a></code>と関係をもつ必要はない。<a href=#session-history-entry id=the-session-history-of-browsing-contexts:session-history-entry-4>セッション履歴エントリ</a>のタイトルは、ユーザーが文書の履歴をナビゲートできるように、その時点で文書の状態を説明しようとするものである。</p>

  <p><a href=#state-object id=the-session-history-of-browsing-contexts:state-object-2>セッション履歴</a>関連付けられるURLが、ユーザー（またはスクリプト）がページからページへ移動するように状態に追加される。</p>

  <hr>

  <p><a href=#browsing-context id=the-session-history-of-browsing-contexts:browsing-context-4>ブラウジングコンテキスト</a>の<a href=#session-history id=the-session-history-of-browsing-contexts:session-history>セッション履歴</a>における各<code id=the-session-history-of-browsing-contexts:document-8><a href=dom.html#document>Document</a></code>オブジェクトは、同じ基礎となる<a href=#session-history id=the-session-history-of-browsing-contexts:session-history-2>セッション履歴</a>をすべてモデル化しなければならない、一意な<code id=the-session-history-of-browsing-contexts:history-3><a href=#history-3>History</a></code>オブジェクトに関連付けられる。</p>

  

  <p>The <dfn id=dom-history><code>history</code></dfn> attribute of the <code id=the-session-history-of-browsing-contexts:window><a href=#window>Window</a></code>
  interface must return the object implementing the <code id=the-session-history-of-browsing-contexts:history-3-2><a href=#history-3>History</a></code> interface for that <a href=#concept-document-window id=the-session-history-of-browsing-contexts:concept-document-window><code>Window</code> object's newest
  <code>Document</code></a>.</p>

  

  <hr>

  <p><dfn id=state-object>状態オブジェクト</dfn>は、ユーザーインターフェイスの状態を表すオブジェクトである。</p>

  <p>ページは、セッション履歴に<a href=#state-object id=the-session-history-of-browsing-contexts:state-object-3>状態オブジェクト</a>を<a href=#dom-history-pushstate id=the-session-history-of-browsing-contexts:dom-history-pushstate>追加</a>できる。このように著者に一つでもページのアプリケーションでは"ナビゲーション"メタファーを使用できるように、これらは、ユーザー（またはスクリプト）が履歴に戻る際にその後<a href=indices.html#event-popstate id=the-session-history-of-browsing-contexts:event-popstate>スクリプトに返される</a>。</p>

  <div class=note>

   <p><a href=#state-object id=the-session-history-of-browsing-contexts:state-object-4>状態オブジェクト</a>は、2つの主な目的に使用されることを意図される：1つ目は、（それがユーザーによって扱う<a href=https://triple-underscore.github.io/URL-ja.html#concept-url id=the-session-history-of-browsing-contexts:url-4 data-x-internal=url>URL</a>を渡されるものに対して解析する必要が依然としてあるので、マイナー最適化のみであるが）単純なケース場合において、著者が解析を行う必要がないように、<a id=the-session-history-of-browsing-contexts:url-3 href=https://triple-underscore.github.io/URL-ja.html#concept-url data-x-internal=url>URL</a>内の状態の事前解析された説明を格納し、2つ目は、新しい<code id=the-session-history-of-browsing-contexts:document-10><a href=dom.html#document>Document</a></code>が開かれた場合、現在の<code id=the-session-history-of-browsing-contexts:document-9><a href=dom.html#document>Document</a></code>インスタンスのみに適用され、再構築しなければならないため、著者はそれがURLに格納しない状態を保存できるようにする。</p>

   <p>後者の例は、ユーザーが戻った場合同じ場所にアニメーションさせることができるように、ポップアップ<code id=the-session-history-of-browsing-contexts:the-div-element><a href=semantics.html#the-div-element>div</a></code>がアニメーション化するために作られた正確な座標を追跡するようなものになるだろう。またその代わりに、前後に行く際に、情報が再度フェッチする必要がないよう、<a id=the-session-history-of-browsing-contexts:url-5 href=https://triple-underscore.github.io/URL-ja.html#concept-url data-x-internal=url>URL</a>内の情報に基づいてサーバーからフェッチされるデータのキャッシュにポインターを保持するために使用できる。</p>

  </div>

  <hr>

  <p>任意の時点で、セッション履歴のエントリの一つは、<dfn id=current-entry>現在のエントリ</dfn>である。これは、<a href=#browsing-context id=the-session-history-of-browsing-contexts:browsing-context-5>ブラウジングコンテキスト</a>の<a href=#active-document id=the-session-history-of-browsing-contexts:active-document>アクティブドキュメント</a>を表すエントリである。<a href=#current-entry id=the-session-history-of-browsing-contexts:current-entry>現在のエントリ</a>であるそれぞれのエントリは、この仕様で定義されるアルゴリズムによって変更される。たとえば<a href=#traverse-the-history id=the-session-history-of-browsing-contexts:traverse-the-history>セッション履歴走査</a>中など。</p>

  <p class=note>The <a href=#current-entry id=the-session-history-of-browsing-contexts:current-entry-2>current entry</a> is usually an entry for the <a href=https://triple-underscore.github.io/DOM4-ja.html#concept-document-url id="the-session-history-of-browsing-contexts:the-document's-address" data-x-internal="the-document's-address">URL</a> of the <code id=the-session-history-of-browsing-contexts:document-11><a href=dom.html#document>Document</a></code>. しかし、それはまた、その文書によって履歴に追加された<a href=#state-object id=the-session-history-of-browsing-contexts:state-object-5>状態オブジェクト</a>のエントリのいずれかを指定できる。</p>

  <p><dfn id=an-entry-with-persisted-user-state>永続ユーザー状態を持つエントリ</dfn>はまた、ユーザーエージェント定義の状態を持つ。この仕様は、何が状態の種類を格納できるのかを指定しない。</p>

  <p class=example>たとえば、一部のユーザーエージェントは、スクロール位置またはフォームコントロールの値を永続化したいかもしれない。</p>

  <p class=note>フォームコントロールの値を永続化するユーザーエージェントはまた、それらの方向（要素の<code id=the-session-history-of-browsing-contexts:the-dir-attribute><a href=dom.html#the-dir-attribute>dir</a></code>属性の値）を保持することが推奨される。これは、ユーザーが最初明示的にデフォルト以外の方向をもつ値を入力した場合、履歴走査の後に誤って値を表示することを防ぐ。</p>

  <p>An entry's <dfn id=scroll-restoration-mode>scroll restoration mode</dfn> indicates whether the user agent should
  restore the persisted scroll position (if any) when traversing to it. The scroll restoration
  mode may be one of the following:</p>

  <dl><dt>"<dfn id=dom-scrollrestoration-auto><code>auto</code></dfn>"<dd>The user agent is responsible for restoring the scroll position upon navigation.<dt>"<dfn id=dom-scrollrestoration-manual><code>manual</code></dfn>"<dd>The page is responsible for restoring the scroll position and the user agent does not
   attempt to do so automatically</dl>

  <p>If unspecified, the <a href=#scroll-restoration-mode id=the-session-history-of-browsing-contexts:scroll-restoration-mode-2>scroll restoration mode</a> of a new entry must be set to
  "<code id=the-session-history-of-browsing-contexts:dom-scrollrestoration-auto><a href=#dom-scrollrestoration-auto>auto</a></code>".</p>

  <p><a href=#state-object id=the-session-history-of-browsing-contexts:state-object-6>状態オブジェクト</a>から成るエントリは、追加された際にアクティブであったページのエントリと同じ<code id=the-session-history-of-browsing-contexts:document-12><a href=dom.html#document>Document</a></code>を共有する。</p>

  <p>Contiguous entries that differ just by their <a href=https://triple-underscore.github.io/URL-ja.html#concept-url id=the-session-history-of-browsing-contexts:url-6 data-x-internal=url>URLs</a>' <a href=https://triple-underscore.github.io/URL-ja.html#concept-url-fragment id=the-session-history-of-browsing-contexts:concept-url-fragment data-x-internal=concept-url-fragment>fragments</a> also share the same <code id=the-session-history-of-browsing-contexts:document-13><a href=dom.html#document>Document</a></code>.</p>

  <p class=note>（単にある特定の文書の異なる状態である）同じ<code id=the-session-history-of-browsing-contexts:document-14><a href=dom.html#document>Document</a></code>を共有するすべてのエントリは、定義により連続する。</p>

  <p><a href=#browsing-context id=the-session-history-of-browsing-contexts:browsing-context-6>ブラウジングコンテキスト</a>内の各<code id=the-session-history-of-browsing-contexts:document-15><a href=dom.html#document>Document</a></code>はまた、<dfn id=latest-entry>最新のエントリ</dfn>を持つことができる。This is the entry for that <code id=the-session-history-of-browsing-contexts:document-16><a href=dom.html#document>Document</a></code> to which the <a href=#browsing-context id=the-session-history-of-browsing-contexts:browsing-context-7>browsing context</a>'s <a href=#session-history id=the-session-history-of-browsing-contexts:session-history-3>session history</a> was most recently traversed. When a <code id=the-session-history-of-browsing-contexts:document-17><a href=dom.html#document>Document</a></code> is created, it initially has no <a href=#latest-entry id=the-session-history-of-browsing-contexts:latest-entry>latest entry</a>.</p>

  

  <p>User agents may <a href=#discard-a-document id=the-session-history-of-browsing-contexts:discard-a-document-2>discard</a> the <code id=the-session-history-of-browsing-contexts:document-18><a href=dom.html#document>Document</a></code>
  objects of entries other than the <a href=#current-entry id=the-session-history-of-browsing-contexts:current-entry-3>current entry</a> that are not referenced from any
  script, reloading the pages afresh when the user or script navigates back to such pages. This
  specification does not specify when user agents should discard <code id=the-session-history-of-browsing-contexts:document-19><a href=dom.html#document>Document</a></code> objects and
  when they should cache them.</p>

  <p>Entries that have had their <code id=the-session-history-of-browsing-contexts:document-20><a href=dom.html#document>Document</a></code> objects discarded must, for the purposes of
  the algorithms given below, act as if they had not. When the user or script navigates back or
  forwards to a page which has no in-memory DOM objects, any other entries that shared the same
  <code id=the-session-history-of-browsing-contexts:document-21><a href=dom.html#document>Document</a></code> object with it must share the new object as well.</p>

  




  <h4 id=the-history-interface>7.7.2 <code id=the-history-interface:history-3><a href=#history-3>History</a></code>インターフェイス</h4>

  <pre class=idl>enum <dfn id=scrollrestoration>ScrollRestoration</dfn> { "<a href=#dom-scrollrestoration-auto id=the-history-interface:dom-scrollrestoration-auto>auto</a>", "<a href=#dom-scrollrestoration-manual id=the-history-interface:dom-scrollrestoration-manual>manual</a>" };

interface <dfn id=history-3>History</dfn> {
  readonly attribute unsigned long <a href=#dom-history-length id=the-history-interface:dom-history-length>length</a>;
  attribute <a href=#scrollrestoration id=the-history-interface:scrollrestoration>ScrollRestoration</a> <a href=#dom-history-scroll-restoration id=the-history-interface:dom-history-scroll-restoration>scrollRestoration</a>;
  readonly attribute any <a href=#dom-history-state id=the-history-interface:dom-history-state>state</a>;
  void <a href=#dom-history-go id=the-history-interface:dom-history-go>go</a>(optional long delta = 0);
  void <a href=#dom-history-back id=the-history-interface:dom-history-back>back</a>();
  void <a href=#dom-history-forward id=the-history-interface:dom-history-forward>forward</a>();
  void <a href=#dom-history-pushstate id=the-history-interface:dom-history-pushstate>pushState</a>(any data, DOMString title, optional DOMString? url = null);
  void <a href=#dom-history-replacestate id=the-history-interface:dom-history-replacestate>replaceState</a>(any data, DOMString title, optional DOMString? url = null);
};</pre>

  <dl class=domintro><dt><var>window</var> . <code id=the-history-interface:dom-history><a href=#dom-history>history</a></code> . <code id=the-history-interface:dom-history-length-2><a href=#dom-history-length>length</a></code><dd>

    <p><a href=#joint-session-history id=the-history-interface:joint-session-history>ジョイントセッション履歴</a>内のエントリの数を返す。</p>

   <dt><var>window</var> . <code id=the-history-interface:dom-history-2><a href=#dom-history>history</a></code> . <code id=the-history-interface:dom-history-scroll-restoration-2><a href=#dom-history-scroll-restoration>scrollRestoration</a></code> [ = <var>value</var> ]<dd>

    <p>Returns the <a href=#scroll-restoration-mode id=the-history-interface:scroll-restoration-mode>scroll restoration mode</a> of the current entry in the <a href=#session-history id=the-history-interface:session-history>session
    history</a>.</p>

    <p>Can be set, to change the <a href=#scroll-restoration-mode id=the-history-interface:scroll-restoration-mode-2>scroll restoration mode</a> of the current entry in the <a href=#session-history id=the-history-interface:session-history-2>session history</a>.</p>

   <dt><var>window</var> . <code id=the-history-interface:dom-history-3><a href=#dom-history>history</a></code> . <code id=the-history-interface:dom-history-state-2><a href=#dom-history-state>state</a></code><dd>

    <p>現在の<a href=#state-object id=the-history-interface:state-object>状態オブジェクト</a>を返す。</p>

   <dt><var>window</var> . <code id=the-history-interface:dom-history-4><a href=#dom-history>history</a></code> . <code id=the-history-interface:dom-history-go-2><a href=#dom-history-go>go</a></code>( [ <var>delta</var> ] )<dd>

    <p><a href=#joint-session-history id=the-history-interface:joint-session-history-2>ジョイントセッション履歴</a>内のステップの指定した数の前後に進む。</p>

    <p>ゼロ差分は、現在のページをリロードする。</p>

    <p>差分が範囲外の場合、何もしない。</p>

   <dt><var>window</var> . <code id=the-history-interface:dom-history-5><a href=#dom-history>history</a></code> . <code id=the-history-interface:dom-history-back-2><a href=#dom-history-back>back</a></code>()<dd>

    <p><a href=#joint-session-history id=the-history-interface:joint-session-history-3>ジョイントセッション履歴</a>内の1つのステップに戻る。</p>

    <p>前のページが存在しない場合、何もしない。</p>

   <dt><var>window</var> . <code id=the-history-interface:dom-history-6><a href=#dom-history>history</a></code> . <code id=the-history-interface:dom-history-forward-2><a href=#dom-history-forward>forward</a></code>()<dd>

    <p><a href=#joint-session-history id=the-history-interface:joint-session-history-4>ジョイントセッション履歴</a>内の1つのステップに進む。</p>

    <p>次のページが存在しない場合、何もしない。</p>

   <dt><var>window</var> . <code id=the-history-interface:dom-history-7><a href=#dom-history>history</a></code> . <code id=the-history-interface:dom-history-pushstate-2><a href=#dom-history-pushstate>pushState</a></code>(<var>data</var>, <var>title</var> [, <var>url</var> ] )<dd>

    <p>指定されたURLが供給される場合、指定されたタイトルとともに、セッション履歴上に与えられたデータをプッシュする。</p>

   <dt><var>window</var> . <code id=the-history-interface:dom-history-8><a href=#dom-history>history</a></code> . <code id=the-history-interface:dom-history-replacestate-2><a href=#dom-history-replacestate>replaceState</a></code>(<var>data</var>, <var>title</var> [, <var>url</var> ] )<dd>

    <p>指定されたデータ、タイトルおよび、提供される場合にURLを持つ、セッション履歴の現在のエントリを更新する。</p>

   </dl>



  <p><a href=#top-level-browsing-context id=the-history-interface:top-level-browsing-context>トップレベルブラウジングコンテキスト</a>の<dfn id=joint-session-history>ジョイントセッション履歴</dfn>は、<a href=#current-entry-of-the-joint-session-history id=the-history-interface:current-entry-of-the-joint-session-history>ジョイントセッション履歴の現在のエントリ</a>を除いて削除されたそれぞれの<a href=#session-history id=the-history-interface:session-history-4>セッション履歴</a>において<a href=#current-entry id=the-history-interface:current-entry>現在のエントリ</a>であるすべてのエントリとともに、<a href=#top-level-browsing-context id=the-history-interface:top-level-browsing-context-2>トップレベルブラウジングコンテキスト</a>を共有するすべての<a href=#fully-active id=the-history-interface:fully-active>完全にアクティブな</a><code id=the-history-interface:document><a href=dom.html#document>Document</a></code>オブジェクトのすべての<a href=#concept-document-bc id=the-history-interface:concept-document-bc>ブラウジングコンテキスト</a>に属するすべての<a href=#session-history id=the-history-interface:session-history-3>セッション履歴</a>の結合である。</p>

  <p><dfn id=current-entry-of-the-joint-session-history>ジョイントセッション履歴の現在のエントリ</dfn>は、最近その<a href=#session-history id=the-history-interface:session-history-5>セッション履歴</a>内の<a href=#current-entry id=the-history-interface:current-entry-2>現在のエントリ</a>になったエントリである。</p>

  <p><a href=#joint-session-history id=the-history-interface:joint-session-history-5>ジョイントセッション履歴</a>内のエントリは、それぞれの<a href=#session-history id=the-history-interface:session-history-6>セッション履歴</a>に追加された時点で時系列に並べられる。各エントリはインデックスを持つ。最古のエントリのインデックスは0を持ち、後続のエントリは連続して増加する整数（1、2、3など）を番号付けされる。</p>

  <p class=note><a href=#browsing-context id=the-history-interface:browsing-context>ブラウジングコンテキスト</a>内の各<code id=the-history-interface:document-2><a href=dom.html#document>Document</a></code>は、異なる<a id=the-history-interface:event-loop href=webappapis.html#event-loop>イベントループ</a>があるかもしれないので、<a href=#joint-session-history id=the-history-interface:joint-session-history-6>ジョイントセッション履歴</a>の実際の状態は、不明瞭にできる。たとえば、2つの兄弟<code id=the-history-interface:the-iframe-element><a href=embedded-content.html#the-iframe-element>iframe</a></code>要素は、同時に1つのユニークな原点から別のものに互いに<a href=#traverse-the-history id=the-history-interface:traverse-the-history>横断</a>でき、それらの正確な順序は明確に定義されないかもしれない。それらは後にお互いを知るかもしれないので、同様に、それらは<a href=#joint-session-history id=the-history-interface:joint-session-history-7>ジョイントセッション履歴</a>の長さについて同意しないかもしれない。</p>



  

  <p>The <dfn id=dom-history-length><code>length</code></dfn> attribute of the
  <code id=the-history-interface:history-3-2><a href=#history-3>History</a></code> interface, on getting, must return the number of entries in the
  <a href=#top-level-browsing-context id=the-history-interface:top-level-browsing-context-3>top-level browsing context</a>'s <a href=#joint-session-history id=the-history-interface:joint-session-history-8>joint session history</a>. If this
  <code id=the-history-interface:history-3-3><a href=#history-3>History</a></code> object is associated with a <code id=the-history-interface:document-3><a href=dom.html#document>Document</a></code> that is not
  <a href=#fully-active id=the-history-interface:fully-active-2>fully active</a>, getting must instead throw a <a id=the-history-interface:securityerror href=https://triple-underscore.github.io/WebIDL-ja.html#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a>
  <code id=the-history-interface:domexception><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.</p>

  <p>The actual entries are not accessible from script.</p>

  <p>The <dfn id=dom-history-scroll-restoration><code>scrollRestoration</code></dfn> attribute
  of the History interface, on getting, must return the <a href=#scroll-restoration-mode id=the-history-interface:scroll-restoration-mode-3>scroll restoration mode</a> of the
  current entry in the <a href=#session-history id=the-history-interface:session-history-7>session history</a>. On setting, the <a href=#scroll-restoration-mode id=the-history-interface:scroll-restoration-mode-4>scroll restoration mode
  </a> of the current entry in the <a href=#session-history id=the-history-interface:session-history-8>session history</a> must be set to the new
  value.  If this <code id=the-history-interface:history-3-4><a href=#history-3>History</a></code> object is associated with a <code id=the-history-interface:document-4><a href=dom.html#document>Document</a></code> that is
  not <a href=#fully-active id=the-history-interface:fully-active-3>fully active</a>, both getting and setting must instead throw a
  <a id=the-history-interface:securityerror-2 href=https://triple-underscore.github.io/WebIDL-ja.html#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a> <code id=the-history-interface:domexception-2><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.</p>

  <p>The <dfn id=dom-history-state><code>state</code></dfn> attribute of the
  <code id=the-history-interface:history-3-5><a href=#history-3>History</a></code> interface, on getting, must return the last value it was set to by the user
  agent. If this <code id=the-history-interface:history-3-6><a href=#history-3>History</a></code> object is associated with a <code id=the-history-interface:document-5><a href=dom.html#document>Document</a></code> that is
  not <a href=#fully-active id=the-history-interface:fully-active-4>fully active</a>, getting must instead throw a
  <a id=the-history-interface:securityerror-3 href=https://triple-underscore.github.io/WebIDL-ja.html#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a> <code id=the-history-interface:domexception-3><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>. Initially, its value must be
  null.</p>

  <p>When the <dfn id=dom-history-go><code>go(<var>delta</var>)</code></dfn> method is
  invoked, if <var>delta</var> is zero, the user agent must act as if the
  <code id=the-history-interface:dom-location-reload><a href=#dom-location-reload>location.reload()</a></code> method was called instead. Otherwise,
  the user agent must <a href=#traverse-the-history-by-a-delta id=the-history-interface:traverse-the-history-by-a-delta>traverse the history by a delta</a> whose value is
  <var>delta</var>. If this <code id=the-history-interface:history-3-7><a href=#history-3>History</a></code> object is associated with a <code id=the-history-interface:document-6><a href=dom.html#document>Document</a></code>
  that is not <a href=#fully-active id=the-history-interface:fully-active-5>fully active</a>, invoking must instead throw a
  <a id=the-history-interface:securityerror-4 href=https://triple-underscore.github.io/WebIDL-ja.html#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a> <code id=the-history-interface:domexception-4><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.</p>

  <p>When the <dfn id=dom-history-back><code>back()</code></dfn> method is invoked, the user
  agent must <a href=#traverse-the-history-by-a-delta id=the-history-interface:traverse-the-history-by-a-delta-2>traverse the history by a delta</a> −1. If this <code id=the-history-interface:history-3-8><a href=#history-3>History</a></code>
  object is associated with a <code id=the-history-interface:document-7><a href=dom.html#document>Document</a></code> that is not <a href=#fully-active id=the-history-interface:fully-active-6>fully active</a>,
  invoking must instead throw a <a id=the-history-interface:securityerror-5 href=https://triple-underscore.github.io/WebIDL-ja.html#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a>
  <code id=the-history-interface:domexception-5><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.</p>

  <p>When the <dfn id=dom-history-forward><code>forward()</code></dfn>method is invoked, the
  user agent must <a href=#traverse-the-history-by-a-delta id=the-history-interface:traverse-the-history-by-a-delta-3>traverse the history by a delta</a> +1. If this <code id=the-history-interface:history-3-9><a href=#history-3>History</a></code>
  object is associated with a <code id=the-history-interface:document-8><a href=dom.html#document>Document</a></code> that is not <a href=#fully-active id=the-history-interface:fully-active-7>fully active</a>,
  invoking must instead throw a <a id=the-history-interface:securityerror-6 href=https://triple-underscore.github.io/WebIDL-ja.html#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a>
  <code id=the-history-interface:domexception-6><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.</p>



  <hr>

  <p>Each <a href=#top-level-browsing-context id=the-history-interface:top-level-browsing-context-4>top-level browsing context</a> has a <dfn id=session-history-traversal-queue>session history traversal queue</dfn>,
  initially empty, to which <a href=webappapis.html#concept-task id=the-history-interface:concept-task>tasks</a> can be added.</p>

  <p>Each <a href=#top-level-browsing-context id=the-history-interface:top-level-browsing-context-5>top-level browsing context</a>, when created, must begin running
  the following algorithm, known as the <dfn id=session-history-event-loop>session history event loop</dfn> for that
  <a href=#top-level-browsing-context id=the-history-interface:top-level-browsing-context-6>top-level browsing context</a>, <a id=the-history-interface:in-parallel href=infrastructure.html#in-parallel>in parallel</a>:</p>

  <ol><li><p>Wait until this <a href=#top-level-browsing-context id=the-history-interface:top-level-browsing-context-7>top-level browsing context</a>'s <a href=#session-history-traversal-queue id=the-history-interface:session-history-traversal-queue>session history traversal
   queue</a> is not empty.</li><li><p>Pull the first <a href=webappapis.html#concept-task id=the-history-interface:concept-task-2>task</a> from this <a href=#top-level-browsing-context id=the-history-interface:top-level-browsing-context-8>top-level browsing
   context</a>'s <a href=#session-history-traversal-queue id=the-history-interface:session-history-traversal-queue-2>session history traversal queue</a>, and execute it.</li><li><p>Return to the first step of this algorithm.</p>

  </li></ol>

  <p>The <a href=#session-history-event-loop id=the-history-interface:session-history-event-loop>session history event loop</a> helps coordinate cross-browsing-context transitions
  of the <a href=#joint-session-history id=the-history-interface:joint-session-history-9>joint session history</a>: since each <a href=#browsing-context id=the-history-interface:browsing-context-2>browsing context</a> might, at any
  particular time, have a different <a id=the-history-interface:event-loop-2 href=webappapis.html#event-loop>event loop</a> (this can happen if the user agent has
  more than one <a id=the-history-interface:event-loop-3 href=webappapis.html#event-loop>event loop</a> per <a href=#unit-of-related-browsing-contexts id=the-history-interface:unit-of-related-browsing-contexts>unit of related browsing contexts</a>),
  transitions would otherwise have to involve cross-event-loop synchronisation.</p>

  <hr>

  <p>To <dfn id=traverse-the-history-by-a-delta>traverse the history by a delta</dfn> <var>delta</var>, the user agent must
  append a <a href=webappapis.html#concept-task id=the-history-interface:concept-task-3>task</a> to this <a href=#top-level-browsing-context id=the-history-interface:top-level-browsing-context-9>top-level browsing context</a>'s
  <a href=#session-history-traversal-queue id=the-history-interface:session-history-traversal-queue-3>session history traversal queue</a>, the <a href=webappapis.html#concept-task id=the-history-interface:concept-task-4>task</a>
  consisting of running the following steps:</p>

  <ol><li><p>If the index of the <a href=#current-entry-of-the-joint-session-history id=the-history-interface:current-entry-of-the-joint-session-history-2>current entry of the joint session history</a> plus <var>delta</var> is less than zero or greater than or equal to the number of items in the
   <a href=#joint-session-history id=the-history-interface:joint-session-history-10>joint session history</a>, then abort these steps.</p>

   </li><li><p>Let <var>specified entry</var> be the entry in the <a href=#joint-session-history id=the-history-interface:joint-session-history-11>joint session
   history</a> whose index is the sum of <var>delta</var> and the index of the
   <a href=#current-entry-of-the-joint-session-history id=the-history-interface:current-entry-of-the-joint-session-history-3>current entry of the joint session history</a>.</li><li><p>Let <var>specified browsing context</var> be the <a href=#browsing-context id=the-history-interface:browsing-context-3>browsing context</a> of
   the <var>specified entry</var>.</li><li><p>If the <var>specified browsing context</var>'s <a href=#active-document id=the-history-interface:active-document>active document</a>'s
   <a href=#unload-a-document id=the-history-interface:unload-a-document>unload a document</a> algorithm is currently running, abort these steps.</li><li>

    <p><a id=the-history-interface:queue-a-task href=webappapis.html#queue-a-task>Queue a task</a> that consists of running the following substeps. The relevant
    <a id=the-history-interface:event-loop-4 href=webappapis.html#event-loop>event loop</a> is that of the <var>specified browsing context</var>'s
    <a href=#active-document id=the-history-interface:active-document-2>active document</a>. The <a id=the-history-interface:task-source href=webappapis.html#task-source>task source</a> for the queued task is the
    <a id=the-history-interface:history-traversal-task-source href=webappapis.html#history-traversal-task-source>history traversal task source</a>.</p>

    <ol><li><p>If there is an ongoing attempt to navigate <var>specified browsing context</var>
     that has not yet <a href=#concept-navigate-mature id=the-history-interface:concept-navigate-mature>matured</a> (i.e. it has not passed the
     point of making its <code id=the-history-interface:document-9><a href=dom.html#document>Document</a></code> the <a href=#active-document id=the-history-interface:active-document-3>active document</a>), then cancel that
     attempt to navigate the <a href=#browsing-context id=the-history-interface:browsing-context-4>browsing context</a>.</li><li>

      <p>If the <var>specified browsing context</var>'s <a href=#active-document id=the-history-interface:active-document-4>active document</a> is not
      the same <code id=the-history-interface:document-10><a href=dom.html#document>Document</a></code> as the <code id=the-history-interface:document-11><a href=dom.html#document>Document</a></code> of the <var>specified
      entry</var>, then run these substeps:</p>

      <ol><li><p><var>specified browsing context</var>の<a href=#active-document id=the-history-interface:active-document-5>アクティブなドキュメント</a>を<a href=#prompt-to-unload-a-document id=the-history-interface:prompt-to-unload-a-document>アンロードするように要求する</a>。ユーザーが<a href=#refused-to-allow-the-document-to-be-unloaded id=the-history-interface:refused-to-allow-the-document-to-be-unloaded>文書をアンロードできるようにすることを拒否した</a>場合、これらの手順を中止する。</li><li><p>falseに設定する<var>recycle</var>パラメーターをもつ<var>specified browsing context</var>の<a href=#active-document id=the-history-interface:active-document-6>アクティブなドキュメント</a>を<a href=#unload-a-document id=the-history-interface:unload-a-document-2>アンロードする</a>。</li></ol>

     </li><li><p><a href=#traverse-the-history id=the-history-interface:traverse-the-history-2>Traverse the history</a> of the <var>specified browsing context</var> to
     the <var>specified entry</var>.</p>

    </li></ol>

   </li></ol>

  <p>When the user navigates through a <a href=#browsing-context id=the-history-interface:browsing-context-5>browsing context</a>, e.g. using a browser's back
  and forward buttons, the user agent must <a href=#traverse-the-history-by-a-delta id=the-history-interface:traverse-the-history-by-a-delta-4>traverse the history by a delta</a> equivalent
  to the action specified by the user.</p>

  <hr id=history-1> 

  <p>The <dfn id=dom-history-pushstate><code>pushState(<var>data</var>, <var>title</var>, <var>url</var>)</code></dfn> method adds a state object entry to
  the history.<div class=status><input onclick=toggleStatus(this) value=⋰ type=button><p class=support><strong>Support:</strong> <span class="chrome yes"><span>Chrome</span> <span>5+</span></span><span class="and_chr yes"><span>Chrome for Android</span> <span>50+</span></span><span class="and_uc partial"><span><span>UC Browser for Android</span> (limited) </span><span>9.9+</span></span><span class="ios_saf yes"><span>iOS Safari</span> <span>5.0-5.1+</span></span><span class="firefox yes"><span>Firefox</span> <span>4+</span></span><span class="ie yes"><span>IE</span> <span>10+</span></span><span class="op_mini no"><span>Opera Mini</span> <span>None</span></span><span class="android yes"><span>Android Browser</span> <span>4.2-4.3+</span></span><span class="edge yes"><span>Edge</span> <span>12+</span></span><span class="safari yes"><span>Safari</span> <span>6+</span></span><span class="opera yes"><span>Opera</span> <span>11.5+</span></span><span class="ie_mob yes"><span>IE Mobile</span> <span>10+</span></span><p class=caniuse>Source: <a href="http://caniuse.com/#feat=history">caniuse.com</a></div>

  <p>The <dfn id=dom-history-replacestate><code>replaceState(<var>data</var>, <var>title</var>, <var>url</var>)</code></dfn> method updates the state object,
  title, and optionally the <a id=the-history-interface:url href=https://triple-underscore.github.io/URL-ja.html#concept-url data-x-internal=url>URL</a> of the <a href=#current-entry id=the-history-interface:current-entry-3>current entry</a> in the history.</p>

  <p>When either of these methods is invoked, the user agent must run the following steps:</p>

  <ol><li><p>If this <code id=the-history-interface:history-3-10><a href=#history-3>History</a></code> object is associated with a <code id=the-history-interface:document-12><a href=dom.html#document>Document</a></code> that is
   not <a href=#fully-active id=the-history-interface:fully-active-8>fully active</a>, throw a <a id=the-history-interface:securityerror-7 href=https://triple-underscore.github.io/WebIDL-ja.html#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a>
   <code id=the-history-interface:domexception-7><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.</li><li><p>Optionally, abort these steps. (For example, the user agent might disallow calls to these
   methods that are invoked on a timer, or from event listeners that are not triggered in response
   to a clear user action, or that are invoked in rapid succession.)</li><li><p>Let <var>targetRealm</var> be this <code id=the-history-interface:history-3-11><a href=#history-3>History</a></code> object's <a id=the-history-interface:relevant-settings-object href=webappapis.html#relevant-settings-object>relevant settings
   object</a>'s <a href="webappapis.html#environment-settings-object's-realm" id="the-history-interface:environment-settings-object's-realm">Realm</a>.</li><li><p>Let <var>cloned data</var> be <a id=the-history-interface:structuredclone href=infrastructure.html#structuredclone>StructuredClone</a>(<var>data</var>,
   <var>targetRealm</var>). Rethrow any exceptions.</li><li>

    <p>If the third argument is not null, run these substeps:</p>

    <ol><li><a href=infrastructure.html#parse-a-url id=the-history-interface:parse-a-url>Parse</a> the value of the third argument, relative to the
     <a id=the-history-interface:entry-settings-object href=webappapis.html#entry-settings-object>entry settings object</a>.</li><li>If that fails, throw a <a id=the-history-interface:securityerror-8 href=https://triple-underscore.github.io/WebIDL-ja.html#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a> <code id=the-history-interface:domexception-8><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>
     and abort these steps.</li><li><p>Let <var>new URL</var> be the <a id=the-history-interface:resulting-url-record href=infrastructure.html#resulting-url-record>resulting URL record</a>.</li><li>Compare <var>new URL</var> to the document's <a href=https://triple-underscore.github.io/DOM4-ja.html#concept-document-url id="the-history-interface:the-document's-address" data-x-internal="the-document's-address">URL</a>. If any component of these two <a href=https://triple-underscore.github.io/URL-ja.html#concept-url id=the-history-interface:url-record data-x-internal=url-record>URL records</a> differ other than the <a href=https://triple-underscore.github.io/URL-ja.html#concept-url-path id=the-history-interface:concept-url-path data-x-internal=concept-url-path>path</a>,
     <a href=https://triple-underscore.github.io/URL-ja.html#concept-url-query id=the-history-interface:concept-url-query data-x-internal=concept-url-query>query</a>, and <a href=https://triple-underscore.github.io/URL-ja.html#concept-url-fragment id=the-history-interface:concept-url-fragment data-x-internal=concept-url-fragment>fragment</a> components, then throw a
     <a id=the-history-interface:securityerror-9 href=https://triple-underscore.github.io/WebIDL-ja.html#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a> <code id=the-history-interface:domexception-9><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code> and abort these steps.</li><li>If the <a href=https://triple-underscore.github.io/URL-ja.html#concept-url-origin id=the-history-interface:concept-url-origin data-x-internal=concept-url-origin>origin</a> of <var>new URL</var> is not the
     same as the <a href=#concept-origin id=the-history-interface:concept-origin>origin</a> of the <a id=the-history-interface:responsible-document href=webappapis.html#responsible-document>responsible document</a> specified by the
     <a id=the-history-interface:entry-settings-object-2 href=webappapis.html#entry-settings-object>entry settings object</a>, and either the <a href=https://triple-underscore.github.io/URL-ja.html#concept-url-path id=the-history-interface:concept-url-path-2 data-x-internal=concept-url-path>path</a>
     or <a href=https://triple-underscore.github.io/URL-ja.html#concept-url-query id=the-history-interface:concept-url-query-2 data-x-internal=concept-url-query>query</a> components of the two <a href=https://triple-underscore.github.io/URL-ja.html#concept-url id=the-history-interface:url-record-2 data-x-internal=url-record>URL records</a> compared in the previous step differ, throw a
     <a id=the-history-interface:securityerror-10 href=https://triple-underscore.github.io/WebIDL-ja.html#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a> <code id=the-history-interface:domexception-10><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code> and abort these steps.
     (This prevents sandboxed content from spoofing other pages on the same origin.)</li></ol>

   </li><li><p>If the third argument is null, then let <var>new URL</var> be the <a id=the-history-interface:url-2 href=https://triple-underscore.github.io/URL-ja.html#concept-url data-x-internal=url>URL</a>
   of the <a href=#current-entry id=the-history-interface:current-entry-4>current entry</a>.</li><li>

    <p>If the method invoked was the <code id=the-history-interface:dom-history-pushstate-3><a href=#dom-history-pushstate>pushState()</a></code>
    method:</p>

    <ol><li>

      <p>Remove all the entries in the <a href=#browsing-context id=the-history-interface:browsing-context-6>browsing context</a>'s <a href=#session-history id=the-history-interface:session-history-9>session history</a>
      after the <a href=#current-entry id=the-history-interface:current-entry-5>current entry</a>. If the <a href=#current-entry id=the-history-interface:current-entry-6>current entry</a> is the last entry in
      the session history, then no entries are removed.</p>

      <p class=note>This <a href=#history-notes>doesn't necessarily have to affect</a> the user
      agent's user interface.</p>

     </li><li><p>Remove any <a href=webappapis.html#concept-task id=the-history-interface:concept-task-5>tasks</a> queued by the <a id=the-history-interface:history-traversal-task-source-2 href=webappapis.html#history-traversal-task-source>history traversal
     task source</a> that are associated with any <code id=the-history-interface:document-13><a href=dom.html#document>Document</a></code> objects in the
     <a href=#top-level-browsing-context id=the-history-interface:top-level-browsing-context-10>top-level browsing context</a>'s <a href=#document-family id=the-history-interface:document-family>document family</a>.</li><li><p>If appropriate, update the <a href=#current-entry id=the-history-interface:current-entry-7>current entry</a> to reflect any state that the user
     agent wishes to persist. The entry is then said to be <a href=#an-entry-with-persisted-user-state id=the-history-interface:an-entry-with-persisted-user-state>an entry with persisted user
     state</a>.</li><li><p>Add a <a href=#state-object id=the-history-interface:state-object-2>state object</a> entry to the session history, after the <a href=#current-entry id=the-history-interface:current-entry-8>current
     entry</a>, with <var>cloned data</var> as the <a href=#state-object id=the-history-interface:state-object-3>state object</a>, the given
     <var>title</var> as the title, <var>new URL</var> as the <a id=the-history-interface:url-3 href=https://triple-underscore.github.io/URL-ja.html#concept-url data-x-internal=url>URL</a>
     of the entry, and the <a href=#scroll-restoration-mode id=the-history-interface:scroll-restoration-mode-5>scroll restoration mode</a> of the current entry in the
     <a href=#session-history id=the-history-interface:session-history-10>session history</a> as the scroll restoration mode.</li><li><p>Update the <a href=#current-entry id=the-history-interface:current-entry-9>current entry</a> to be this newly added entry.</li></ol>

    <p>Otherwise, if the method invoked was the <code id=the-history-interface:dom-history-replacestate-3><a href=#dom-history-replacestate>replaceState()</a></code> method:</p>

    <ol><li><p>Update the <a href=#current-entry id=the-history-interface:current-entry-10>current entry</a> in the session history so that <var>cloned data</var> is the entry's new state object, the given <var>title</var>
     is the new title, and <var>new URL</var> is the entry's new <a id=the-history-interface:url-4 href=https://triple-underscore.github.io/URL-ja.html#concept-url data-x-internal=url>URL</a>.</li></ol>

   </li><li><p>If the <a href=#current-entry id=the-history-interface:current-entry-11>current entry</a> in the session history represents a non-GET request
   (e.g. it was the result of a POST submission) then update it to instead represent a GET
   request.</li><li>

    <p>Set the document's <a href=https://triple-underscore.github.io/DOM4-ja.html#concept-document-url id="the-history-interface:the-document's-address-2" data-x-internal="the-document's-address">URL</a> to <var>new URL</var>.</p>

    <p class=note>Since this is neither a <a href=#navigate id=the-history-interface:navigate>navigation</a> of the
    <a href=#browsing-context id=the-history-interface:browsing-context-7>browsing context</a> nor a <a href=#traverse-the-history id=the-history-interface:traverse-the-history-3>history traversal</a>,
    it does not cause a <code id=the-history-interface:event-hashchange><a href=indices.html#event-hashchange>hashchange</a></code> event to be fired.</p>

   </li><li><p>Let <var>targetRealm</var> be this <code id=the-history-interface:history-3-12><a href=#history-3>History</a></code> object's <a id=the-history-interface:relevant-settings-object-2 href=webappapis.html#relevant-settings-object>relevant settings
   object</a>'s <a href="webappapis.html#environment-settings-object's-realm" id="the-history-interface:environment-settings-object's-realm-2">Realm</a>.</li><li>

    <p>Set <code id=the-history-interface:dom-history-state-3><a href=#dom-history-state>history.state</a></code> to
    <a id=the-history-interface:structuredclone-2 href=infrastructure.html#structuredclone>StructuredClone</a>(<var>cloned data</var>, <var>targetRealm</var>).</p> 

   </li><li>

    <p>Let the <a href=#latest-entry id=the-history-interface:latest-entry>latest entry</a> of the <code id=the-history-interface:document-14><a href=dom.html#document>Document</a></code> of the <a href=#current-entry id=the-history-interface:current-entry-12>current
    entry</a> be the <a href=#current-entry id=the-history-interface:current-entry-13>current entry</a>.</p>

   </li></ol>

  <p class=note>The <var>title</var> is purely advisory. User agents might use the title
  in the user interface.</p>

  <p>User agents may limit the number of state objects added to the session history per page. If a
  page hits the UA-defined limit, user agents must remove the entry immediately after the first
  entry for that <code id=the-history-interface:document-15><a href=dom.html#document>Document</a></code> object in the session history after having added the new
  entry. (Thus the state history acts as a FIFO buffer for eviction, but as a LIFO buffer for
  navigation.)</p>

  

  <div class=example>

   <p>ユーザーはいくつかの座標に常にあり、ユーザーが後で再開するための特定の座標に対応するページをブックマークできるような、ユーザーがラインに沿って移動できるゲームを考える。</p>

   <p>そのようなゲームでx=5位置を実装する静的ページは次のようになる：</p>

   <pre>&lt;!DOCTYPE HTML&gt;
&lt;!-- this is http://example.com/line?x=5 --&gt;
&lt;html lang="en"&gt;
&lt;title&gt;Line Game - 5&lt;/title&gt;
&lt;p&gt;You are at coordinate 5 on the line.&lt;/p&gt;
&lt;p&gt;
 &lt;a href="?x=6"&gt;Advance to 6&lt;/a&gt; or
 &lt;a href="?x=4"&gt;retreat to 4&lt;/a&gt;?
&lt;/p&gt;</pre>

   <p>このようなシステムの問題点は、毎回ユーザーがクリックするとページ全体をリロードする必要があることにある。ここで、代わりにスクリプトを使用して、リロードを行うための別の方法：</p>

   <pre>&lt;!DOCTYPE HTML&gt;
&lt;!-- this starts off as http://example.com/line?x=5 --&gt;
&lt;html lang="en"&gt;
&lt;title&gt;Line Game - 5&lt;/title&gt;
&lt;p&gt;You are at coordinate &lt;span id="coord"&gt;5&lt;/span&gt; on the line.&lt;/p&gt;
&lt;p&gt;
 &lt;a href="?x=6" onclick="go(1); return false;"&gt;Advance to 6&lt;/a&gt; or
 &lt;a href="?x=4" onclick="go(-1); return false;"&gt;retreat to 4&lt;/a&gt;?
&lt;/p&gt;
&lt;script&gt;
 var currentPage = 5; // prefilled by server
 function go(d) {
   setupPage(currentPage + d);
   history.pushState(currentPage, document.title, '?x=' + currentPage);
 }
 onpopstate = function(event) {
   setupPage(event.state);
 }
 function setupPage(page) {
   currentPage = page;
   document.title = 'Line Game - ' + currentPage;
   document.getElementById('coord').textContent = currentPage;
   document.links[0].href = '?x=' + (currentPage+1);
   document.links[0].textContent = 'Advance to ' + (currentPage+1);
   document.links[1].href = '?x=' + (currentPage-1);
   document.links[1].textContent = 'retreat to ' + (currentPage-1);
 }
&lt;/script&gt;</pre>

   <p>スクリプトをもたないシステムにおいて、前の例と同じように動作する。しかし、同じ体験に対するネットワークアクセスが存在しないので、スクリプトをサポート<em>する</em>ユーザーは現在はるかに速く移動できる。さらに、経験に反して、ユーザーは単にナイーブなスクリプトベースのアプローチ、ブックマーク、およびセッション履歴の移動が依然として動作する必要がある。</p>

   <p>上記の例において、<code id=the-history-interface:dom-history-pushstate-4><a href=#dom-history-pushstate>pushState()</a></code>メソッドへの<var>data</var>引数は、サーバに送信されるものと同じ情報であるが、スクリプトはURLにユーザーが移動するたびに解析する必要はないので、より便利な形式となる。</p>

  </div>

  <div class=example>

   <p>アプリケーションは、その時点で文書の<code id=the-history-interface:the-title-element><a href=semantics.html#the-title-element>title</a></code>要素の値として<a href=#session-history-entry id=the-history-interface:session-history-entry>セッション履歴エントリ</a>の同じタイトルを使用しないかもしれない。たとえば、これは<code id=the-history-interface:the-title-element-2><a href=semantics.html#the-title-element>title</a></code>要素内のブロックを示す単純なページである。明らかに、後方に以前の状態に移動する際にユーザーは時間内に戻らず、したがって、セッション履歴のタイトルに時間を置くことは不適切だろう。</p>

   <pre>&lt;!DOCTYPE HTML&gt;
&lt;HTML LANG=EN&gt;
&lt;TITLE&gt;Line&lt;/TITLE&gt;
&lt;SCRIPT&gt;
 setInterval(function () { document.title = 'Line - ' + new Date(); }, 1000);
 var i = 1;
 function inc() {
   set(i+1);
   history.pushState(i, 'Line - ' + i);
 }
 function set(newI) {
   i = newI;
   document.forms.F.I.value = newI;
 }
&lt;/SCRIPT&gt;
&lt;BODY ONPOPSTATE="set(event.state)"&gt;
&lt;FORM NAME=F&gt;
State: &lt;OUTPUT NAME=I&gt;1&lt;/OUTPUT&gt; &lt;INPUT VALUE="Increment" TYPE=BUTTON ONCLICK="inc()"&gt;
&lt;/FORM&gt;</pre>

  </div>

  <div class=example>
   <p>Most applications want to use the same <a href=#scroll-restoration-mode id=the-history-interface:scroll-restoration-mode-6>scroll restoration mode</a> value for all of
   their history entries. To achieve this they should set the <code id=the-history-interface:dom-history-scroll-restoration-3><a href=#dom-history-scroll-restoration>scrollRestoration</a></code> attribute as soon as possible
   (e.g., in the first <code id=the-history-interface:the-script-element><a href=scripting.html#the-script-element>script</a></code> element in the document's <code id=the-history-interface:the-head-element><a href=semantics.html#the-head-element>head</a></code> element) to
   ensure that any entry added to the history session gets the desired scroll restoration mode.</p>

   <pre>&lt;head&gt;
  &lt;script&gt;
       if ('scrollRestoration' in history)
            history.scrollRestoration = 'manual';
  &lt;/script&gt;
&lt;/head&gt;
   </pre>
  </div>


  

  <h4 id=history-notes>7.7.3 Implementation notes for session history</h4>
  

  <p><i>この節は非規範的である。</i></p>

  <p>The <code id=history-notes:history-3><a href=#history-3>History</a></code> interface is not meant to place restrictions on how implementations
  represent the session history to the user.</p>

  <p>For example, session history could be implemented in a tree-like manner, with each page having
  multiple "forward" pages. This specification doesn't define how the linear list of pages in the
  <code id=history-notes:dom-history><a href=#dom-history>history</a></code> object are derived from the actual session history as
  seen from the user's perspective.</p>

  <p>Similarly, a page containing two <code id=history-notes:the-iframe-element><a href=embedded-content.html#the-iframe-element>iframe</a></code>s has a <code id=history-notes:dom-history-2><a href=#dom-history>history</a></code> object distinct from the <code id=history-notes:the-iframe-element-2><a href=embedded-content.html#the-iframe-element>iframe</a></code>s' <code id=history-notes:dom-history-3><a href=#dom-history>history</a></code> objects, despite the fact that typical Web browsers present the
  user with just one "Back" button, with a session history that interleaves the navigation of the
  two inner frames and the outer page.</p>


  <p><strong>Security</strong>: It is suggested that to avoid letting a page "hijack" the history
  navigation facilities of a UA by abusing <code id=history-notes:dom-history-pushstate><a href=#dom-history-pushstate>pushState()</a></code>,
  the UA provide the user with a way to jump back to the previous page (rather than just going back
  to the previous state). For example, the back button could have a drop down showing just the pages
  in the session history, and not showing any of the states. Similarly, an aural browser could have
  two "back" commands, one that goes back to the previous state, and one that jumps straight back to
  the previous page.</p>

  <p>For both <code id=history-notes:dom-history-pushstate-2><a href=#dom-history-pushstate>pushState()</a></code> and <code id=history-notes:dom-history-replacestate><a href=#dom-history-replacestate>replaceState()</a></code>, user agents are encouraged to prevent
  abuse of these APIs via too-frequent calls or over-large state objects. As detailed above, the
  algorithm explicitly allows user agents to ignore any such calls when appropriate.</p>


  


  <h4 id=the-location-interface>7.7.4 <code id=the-location-interface:location><a href=#location>Location</a></code>インターフェイス</h4>

  <p>Each <code id=the-location-interface:window><a href=#window>Window</a></code> object is associated with a unique instance of a <code id=the-location-interface:location-2><a href=#location>Location</a></code>
  object, allocated when the <code id=the-location-interface:window-2><a href=#window>Window</a></code> object is created.</p>

  

  <p class=warning>The <code id=the-location-interface:location-3><a href=#location>Location</a></code> exotic object is defined through a mishmash of IDL,
  invocation of JavaScript internal methods post-creation, and overridden JavaScript internal
  methods. Coupled with its scary security policy, please take extra care while implementing
  this excrescence.</p>

  <p>To create a <code id=the-location-interface:location-4><a href=#location>Location</a></code> object, run these steps:</p>

  <ol><li><p>Let <var>location</var> be a new <code id=the-location-interface:location-5><a href=#location>Location</a></code> <a id=the-location-interface:platform-object href=https://triple-underscore.github.io/WebIDL-ja.html#dfn-platform-object data-x-internal=platform-object>platform
   object</a>.</li><li><p>Perform ! <var>location</var>.[[DefineOwnProperty]]("<code>toString</code>", {
   [[Value]]: <a id=the-location-interface:%objproto_tostring% href=https://tc39.github.io/ecma262/#sec-object.prototype.tostring data-x-internal=%objproto_tostring%>%ObjProto_toString%</a>,
   [[Writable]]: false,
   [[Enumerable]]: false,
   [[Configurable]]: false }).</li><li><p>Perform ! <var>location</var>.[[DefineOwnProperty]]("<code>toJSON</code>", {
   [[Value]]: undefined,
   [[Writable]]: false,
   [[Enumerable]]: false,
   [[Configurable]]: false }).</li><li><p>Perform ! <var>location</var>.[[DefineOwnProperty]]("<code>valueOf</code>", {
   [[Value]]: <a id=the-location-interface:%objproto_valueof% href=https://tc39.github.io/ecma262/#sec-object.prototype.valueof data-x-internal=%objproto_valueof%>%ObjProto_valueOf%</a>,
   [[Writable]]: false,
   [[Enumerable]]: false,
   [[Configurable]]: false }).</li><li><p>Perform ! <var>location</var>.[[DefineOwnProperty]](<a id=the-location-interface:@@toprimitive href=infrastructure.html#@@toprimitive>@@toPrimitive</a>, {
   [[Value]]: undefined,
   [[Writable]]: false,
   [[Enumerable]]: false,
   [[Configurable]]: false }).</li><li><p>Set the value of the [[<a href=#defaultproperties id=the-location-interface:defaultproperties>DefaultProperties</a>]] internal slot of
   <var>location</var> to <var>location</var>.[[OwnPropertyKeys]]().</li><li><p>Return <var>location</var>.</li></ol>

  

  <dl class=domintro><dt><var>document</var> . <code id=the-location-interface:dom-document-location><a href=#dom-document-location>location</a></code> [ = <var>value</var> ]<dt><var>window</var> . <code id=the-location-interface:dom-location><a href=#dom-location>location</a></code> [ = <var>value</var> ]<dd>

    <p>現在のページの位置と<code id=the-location-interface:location-6><a href=#location>Location</a></code>オブジェクトを返す。</p>

    <p>別のページにナビゲートするために、設定可能である。</p>

   </dl>

  

  <p>The <dfn id=dom-document-location><code>location</code></dfn> attribute of the
  <code id=the-location-interface:document><a href=dom.html#document>Document</a></code> interface must return the <code id=the-location-interface:location-7><a href=#location>Location</a></code> object for that
  <code id=the-location-interface:document-2><a href=dom.html#document>Document</a></code> object's global object, if it has a <a href=#concept-document-bc id=the-location-interface:concept-document-bc>browsing context</a>, and null otherwise.</p>

  <p>The <dfn id=dom-location><code>location</code></dfn> attribute of the <code id=the-location-interface:window-3><a href=#window>Window</a></code>
  interface must return the <code id=the-location-interface:location-8><a href=#location>Location</a></code> object for that <code id=the-location-interface:window-4><a href=#window>Window</a></code> object.</p>

  

  <p><code id=the-location-interface:location-9><a href=#location>Location</a></code> objects provide a representation of the <a href=https://triple-underscore.github.io/DOM4-ja.html#concept-document-url id="the-location-interface:the-document's-address" data-x-internal="the-document's-address">URL</a> of the <a href=#active-document id=the-location-interface:active-document>active document</a> of their
  <code id=the-location-interface:document-3><a href=dom.html#document>Document</a></code>'s <a href=#concept-document-bc id=the-location-interface:concept-document-bc-2>browsing context</a>, and allow the
  <a href=#current-entry id=the-location-interface:current-entry>current entry</a> of the <a href=#browsing-context id=the-location-interface:browsing-context>browsing context</a>'s session history to be changed,
  by adding or replacing entries in the <code id=the-location-interface:dom-history><a href=#dom-history>history</a></code> object.</p>

  <pre class=idl>interface <dfn id=location>Location</dfn> {
  [Unforgeable] stringifier attribute USVString <a href=#dom-location-href id=the-location-interface:dom-location-href>href</a>;
  [Unforgeable] readonly attribute USVString <a href=#dom-location-origin id=the-location-interface:dom-location-origin>origin</a>;
  [Unforgeable] attribute USVString <a href=#dom-location-protocol id=the-location-interface:dom-location-protocol>protocol</a>;
  [Unforgeable] attribute USVString <a href=#dom-location-host id=the-location-interface:dom-location-host>host</a>;
  [Unforgeable] attribute USVString <a href=#dom-location-hostname id=the-location-interface:dom-location-hostname>hostname</a>;
  [Unforgeable] attribute USVString <a href=#dom-location-port id=the-location-interface:dom-location-port>port</a>;
  [Unforgeable] attribute USVString <a href=#dom-location-pathname id=the-location-interface:dom-location-pathname>pathname</a>;
  [Unforgeable] attribute USVString <a href=#dom-location-search id=the-location-interface:dom-location-search>search</a>;
  [Unforgeable] attribute USVString <a href=#dom-location-hash id=the-location-interface:dom-location-hash>hash</a>;

  [Unforgeable] void <a href=#dom-location-assign id=the-location-interface:dom-location-assign>assign</a>(USVString url);
  [Unforgeable] void <a href=#dom-location-replace id=the-location-interface:dom-location-replace>replace</a>(USVString url);
  [Unforgeable] void <a href=#dom-location-reload id=the-location-interface:dom-location-reload>reload</a>();

  [Unforgeable, SameObject] readonly attribute FrozenArray&lt;USVString&gt; <a href=#dom-location-ancestororigins id=the-location-interface:dom-location-ancestororigins>ancestorOrigins</a>;
};</pre>

  <dl class=domintro><dt><var>location</var> . <code>toString()</code><dt><var>location</var> . <code id=the-location-interface:dom-location-href-2><a href=#dom-location-href>href</a></code><dd>
    <p>Returns the <code id=the-location-interface:location-10><a href=#location>Location</a></code> object's URL.</p>
    <p>Can be set, to navigate to the given URL.</p>
   <dt><var>location</var> . <code id=the-location-interface:dom-location-origin-2><a href=#dom-location-origin>origin</a></code><dd>
    <p>Returns the <code id=the-location-interface:location-11><a href=#location>Location</a></code> object's URL's origin.</p>
   <dt><var>location</var> . <code id=the-location-interface:dom-location-protocol-2><a href=#dom-location-protocol>protocol</a></code><dd>
    <p>Returns the <code id=the-location-interface:location-12><a href=#location>Location</a></code> object's URL's scheme.</p>
    <p>Can be set, to navigate to the same URL with a changed scheme.</p>
   <dt><var>location</var> . <code id=the-location-interface:dom-location-host-2><a href=#dom-location-host>host</a></code><dd>
    <p>Returns the <code id=the-location-interface:location-13><a href=#location>Location</a></code> object's URL's host and port (if different from the default
    port for the scheme).</p>
    <p>Can be set, to navigate to the same URL with a changed host and port.</p>
   <dt><var>location</var> . <code id=the-location-interface:dom-location-hostname-2><a href=#dom-location-hostname>hostname</a></code><dd>
    <p>Returns the <code id=the-location-interface:location-14><a href=#location>Location</a></code> object's URL's host.</p>
    <p>Can be set, to navigate to the same URL with a changed host.</p>
   <dt><var>location</var> . <code id=the-location-interface:dom-location-port-2><a href=#dom-location-port>port</a></code><dd>
    <p>Returns the <code id=the-location-interface:location-15><a href=#location>Location</a></code> object's URL's port.</p>
    <p>Can be set, to navigate to the same URL with a changed port.</p>
   <dt><var>location</var> . <code id=the-location-interface:dom-location-pathname-2><a href=#dom-location-pathname>pathname</a></code><dd>
    <p>Returns the <code id=the-location-interface:location-16><a href=#location>Location</a></code> object's URL's path.</p>
    <p>Can be set, to navigate to the same URL with a changed path.</p>
   <dt><var>location</var> . <code id=the-location-interface:dom-location-search-2><a href=#dom-location-search>search</a></code><dd>
    <p>Returns the <code id=the-location-interface:location-17><a href=#location>Location</a></code> object's URL's query (includes leading "<code>?</code>" if non-empty).</p>
    <p>Can be set, to navigate to the same URL with a changed query (ignores leading "<code>?</code>").</p>
   <dt><var>location</var> . <code id=the-location-interface:dom-location-hash-2><a href=#dom-location-hash>hash</a></code><dd>
    <p>Returns the <code id=the-location-interface:location-18><a href=#location>Location</a></code> object's URL's fragment (includes leading "<code>#</code>" if non-empty).</p>
    <p>Can be set, to navigate to the same URL with a changed fragment (ignores leading "<code>#</code>").</p>
   <dt><var>location</var> . <code id=the-location-interface:dom-location-assign-2><a href=#dom-location-assign>assign</a></code>(<var>url</var>)<dd>
    <p>Navigates to the given URL.</p>
   <dt><var>location</var> . <code id=the-location-interface:dom-location-replace-2><a href=#dom-location-replace>replace</a></code>(<var>url</var>)<dd>
    <p>Removes the current page from the session history and navigates to the given URL.</p>
   <dt><var>location</var> . <code id=the-location-interface:dom-location-reload-2><a href=#dom-location-reload>reload</a></code>()<dd>
    <p>現在のページをリロードする。</p>
   <dt><var>location</var> . <code id=the-location-interface:dom-location-ancestororigins-2><a href=#dom-location-ancestororigins>ancestorOrigins</a></code><dd>
    <p>Returns an array whose values are the origins of the ancestor <a href=#browsing-context id=the-location-interface:browsing-context-2>browsing contexts</a>, from the <a href=#parent-browsing-context id=the-location-interface:parent-browsing-context>parent browsing context</a> to the
    <a href=#top-level-browsing-context id=the-location-interface:top-level-browsing-context>top-level browsing context</a>.</p>
   </dl>

  

  <p>A <code id=the-location-interface:location-19><a href=#location>Location</a></code> object has an associated <dfn id=relevant-document data-noexport="">relevant
  <code>Document</code></dfn>, which is this <code id=the-location-interface:location-20><a href=#location>Location</a></code> object's associated
  <code id=the-location-interface:document-4><a href=dom.html#document>Document</a></code> object's <a href=#concept-document-bc id=the-location-interface:concept-document-bc-3>browsing context</a>'s
  <a href=#active-document id=the-location-interface:active-document-2>active document</a>.</p>

  <p>A <code id=the-location-interface:location-21><a href=#location>Location</a></code> object has an associated <dfn id=concept-location-url data-noexport="">url</dfn>, which is this <code id=the-location-interface:location-22><a href=#location>Location</a></code> object's
  <a href=#relevant-document id=the-location-interface:relevant-document>relevant <code>Document</code></a>'s <a href=https://triple-underscore.github.io/DOM4-ja.html#concept-document-url id="the-location-interface:the-document's-address-2" data-x-internal="the-document's-address">URL</a>.</p>

  <p>A <code id=the-location-interface:location-23><a href=#location>Location</a></code> object has an associated <dfn id=concept-location-ancestor-origins-array data-noexport="">ancestor origins array</dfn>. When a
  <code id=the-location-interface:location-24><a href=#location>Location</a></code> object is created, its <a href=#concept-location-ancestor-origins-array id=the-location-interface:concept-location-ancestor-origins-array>ancestor origins array</a> must be set to a
  <a id=the-location-interface:frozen-array href=https://triple-underscore.github.io/WebIDL-ja.html#dfn-frozen-array-type data-x-internal=frozen-array>frozen array</a> created from the list of strings that the following steps would
  produce:</p>

  <ol><li><p>Let <var>output</var> be an empty ordered list of strings.</li><li><p>Let <var>current</var> be the <a href=#concept-document-bc id=the-location-interface:concept-document-bc-4>browsing context</a>
   of the <code id=the-location-interface:document-5><a href=dom.html#document>Document</a></code> with which this <code id=the-location-interface:location-25><a href=#location>Location</a></code> object is associated.</li><li><p><i>Loop</i>: If <var>current</var> has no <a href=#parent-browsing-context id=the-location-interface:parent-browsing-context-2>parent browsing context</a>, jump to
   the step labeled <i>end</i>.</li><li><p>Let <var>current</var> be <var>current</var>'s <a href=#parent-browsing-context id=the-location-interface:parent-browsing-context-3>parent browsing
   context</a>.</li><li><p>Append the <a href=#unicode-serialisation-of-an-origin id=the-location-interface:unicode-serialisation-of-an-origin>Unicode serialisation</a>
   of <var>current</var>'s <a href=#active-document id=the-location-interface:active-document-3>active document</a>'s <a href=#concept-origin id=the-location-interface:concept-origin>origin</a> to <var>output</var>
   as a new value.</li><li><p><i>loop</i>にラベル付けされた手順に戻る。</li><li><p><i>End</i>: Return <var>output</var>.</li></ol>

  <p>A <code id=the-location-interface:location-26><a href=#location>Location</a></code> object has an associated <dfn id=location-object-setter-navigate><code>Location</code>-object-setter
  navigate</dfn> algorithm, which given a <var>url</var>, runs these steps:</p>

  <ol><li>
    <p>If any of the following conditions are met, let <var>replacement flag</var> be unset;
    otherwise, let it be set:</p>

    <ul class=brief><li>This <code id=the-location-interface:location-27><a href=#location>Location</a></code> object's <a href=#relevant-document id=the-location-interface:relevant-document-2>relevant <code>Document</code></a> has
     <a id=the-location-interface:completely-loaded href=syntax.html#completely-loaded>completely loaded</a>, or</li><li>In the <a href=webappapis.html#concept-task id=the-location-interface:concept-task>task</a> in which the algorithm is running, an
     <a id=the-location-interface:activation-behaviour href=interaction.html#activation-behaviour>activation behaviour</a> is currently being processed whose <code id=the-location-interface:event-click><a data-x-internal=event-click href=https://w3c.github.io/uievents/#event-type-click>click</a></code> event was <a href=infrastructure.html#concept-events-trusted id=the-location-interface:concept-events-trusted>trusted</a>, or</li><li>In the <a href=webappapis.html#concept-task id=the-location-interface:concept-task-2>task</a> in which the algorithm is running, the event
     listener for a <a href=infrastructure.html#concept-events-trusted id=the-location-interface:concept-events-trusted-2>trusted</a> <code id=the-location-interface:event-click-2><a data-x-internal=event-click href=https://w3c.github.io/uievents/#event-type-click>click</a></code> event is being handled.</li></ul>
   </li><li><p><a href=#location-object-navigate id=the-location-interface:location-object-navigate><code>Location</code>-object navigate</a>, given <var>url</var> and
   <var>replacement flag</var>.</li></ol>

  <p>To <dfn id=location-object-navigate><code>Location</code>-object navigate</dfn>, given a <var>url</var> and
  <var>replacement flag</var>, run these steps:</p>

  <ol><li><p>The <a href=#source-browsing-context id=the-location-interface:source-browsing-context>source browsing context</a> is the <a id=the-location-interface:responsible-browsing-context href=webappapis.html#responsible-browsing-context>responsible browsing context</a>
   specified by the <a id=the-location-interface:incumbent-settings-object href=webappapis.html#incumbent-settings-object>incumbent settings object</a>.</li><li>
    <p><a href=#navigate id=the-location-interface:navigate>Navigate</a> the <a href=#browsing-context id=the-location-interface:browsing-context-3>browsing context</a> to
    <var>url</var>, with the <var><a href=#exceptions-enabled id=the-location-interface:exceptions-enabled>exceptions enabled flag</a></var> set. Rethrow any
    exceptions.</p>

    <p>If the <var>replacement flag</var> is set or the <a href=#browsing-context id=the-location-interface:browsing-context-4>browsing context</a>'s
    <a href=#session-history id=the-location-interface:session-history>session history</a> contains only one <code id=the-location-interface:document-6><a href=dom.html#document>Document</a></code>, and that was the
    <code id=the-location-interface:about:blank><a href=infrastructure.html#about:blank>about:blank</a></code> <code id=the-location-interface:document-7><a href=dom.html#document>Document</a></code> created when the <a href=#browsing-context id=the-location-interface:browsing-context-5>browsing context</a>
    was created, then the navigation must be done with <a href=#replacement-enabled id=the-location-interface:replacement-enabled>replacement enabled</a>.</p>
    
   </li></ol>

  <p>The <dfn id=dom-location-href><code>href</code></dfn> attribute's getter must run these
  steps:</p>

  <ol><li><p>If this <code id=the-location-interface:location-28><a href=#location>Location</a></code> object's <a href=#relevant-document id=the-location-interface:relevant-document-3>relevant <code>Document</code></a>'s
   <a href=#concept-origin id=the-location-interface:concept-origin-2>origin</a> is not <a href=#same-origin-domain id=the-location-interface:same-origin-domain>same origin-domain</a> with the <a id=the-location-interface:entry-settings-object href=webappapis.html#entry-settings-object>entry settings
   object</a>'s <a href=#concept-origin id=the-location-interface:concept-origin-3>origin</a>, then throw a <a id=the-location-interface:securityerror href=https://triple-underscore.github.io/WebIDL-ja.html#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a>
   <code id=the-location-interface:domexception><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.</li><li><p>Return this <code id=the-location-interface:location-29><a href=#location>Location</a></code> object's <a href=#concept-location-url id=the-location-interface:concept-location-url>url</a>,
   <a href=https://triple-underscore.github.io/URL-ja.html#concept-url-serializer id=the-location-interface:concept-url-serialiser data-x-internal=concept-url-serialiser>serialised</a>.</li></ol>

  <p>The <code id=the-location-interface:dom-location-href-3><a href=#dom-location-href>href</a></code> attribute's setter must run these steps:</p>

  <ol><li><p><a href=infrastructure.html#parse-a-url id=the-location-interface:parse-a-url>Parse</a> the given value relative to the <a id=the-location-interface:entry-settings-object-2 href=webappapis.html#entry-settings-object>entry
   settings object</a>. If that failed, throw a <code id=the-location-interface:typeerror><a data-x-internal=typeerror href=https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-typeerror>TypeError</a></code> exception.</li><li><p><a href=#location-object-setter-navigate id=the-location-interface:location-object-setter-navigate><code>Location</code>-object-setter navigate</a> to the <a id=the-location-interface:resulting-url-record href=infrastructure.html#resulting-url-record>resulting URL
   record</a>.</li></ol>

  <p class=note>The <code id=the-location-interface:dom-location-href-4><a href=#dom-location-href>href</a></code> attribute setter intentionally
  has no security check.</p>

  <p>The <dfn id=dom-location-origin><code>origin</code></dfn> attribute's getter must run
  these steps:</p>

  <ol><li><p>If this <code id=the-location-interface:location-30><a href=#location>Location</a></code> object's <a href=#relevant-document id=the-location-interface:relevant-document-4>relevant <code>Document</code></a>'s
   <a href=#concept-origin id=the-location-interface:concept-origin-4>origin</a> is not <a href=#same-origin-domain id=the-location-interface:same-origin-domain-2>same origin-domain</a> with the <a id=the-location-interface:entry-settings-object-3 href=webappapis.html#entry-settings-object>entry settings
   object</a>'s <a href=#concept-origin id=the-location-interface:concept-origin-5>origin</a>, then throw a <a id=the-location-interface:securityerror-2 href=https://triple-underscore.github.io/WebIDL-ja.html#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a>
   <code id=the-location-interface:domexception-2><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.</li><li><p>Return the <a href=#unicode-serialisation-of-an-origin id=the-location-interface:unicode-serialisation-of-an-origin-2>Unicode serialization</a>
   of this <code id=the-location-interface:location-31><a href=#location>Location</a></code> object's <a href=#concept-location-url id=the-location-interface:concept-location-url-2>url</a>'s <a href=https://triple-underscore.github.io/URL-ja.html#concept-url-origin id=the-location-interface:concept-url-origin data-x-internal=concept-url-origin>origin</a>.</li></ol>

  <p class="note no-backref">It returns the Unicode rather than the ASCII serialisation for
  compatibility with <code id=the-location-interface:messageevent><a href=comms.html#messageevent>MessageEvent</a></code>.</p>

  <p>The <dfn id=dom-location-protocol><code>protocol</code></dfn> attribute's getter must run
  these steps:</p>

  <ol><li><p>If this <code id=the-location-interface:location-32><a href=#location>Location</a></code> object's <a href=#relevant-document id=the-location-interface:relevant-document-5>relevant <code>Document</code></a>'s
   <a href=#concept-origin id=the-location-interface:concept-origin-6>origin</a> is not <a href=#same-origin-domain id=the-location-interface:same-origin-domain-3>same origin-domain</a> with the <a id=the-location-interface:entry-settings-object-4 href=webappapis.html#entry-settings-object>entry settings
   object</a>'s <a href=#concept-origin id=the-location-interface:concept-origin-7>origin</a>, then throw a <a id=the-location-interface:securityerror-3 href=https://triple-underscore.github.io/WebIDL-ja.html#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a>
   <code id=the-location-interface:domexception-3><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.</li><li><p>Return this <code id=the-location-interface:location-33><a href=#location>Location</a></code> object's <a href=#concept-location-url id=the-location-interface:concept-location-url-3>url</a>'s <a href=https://triple-underscore.github.io/URL-ja.html#concept-url-scheme id=the-location-interface:concept-url-scheme data-x-internal=concept-url-scheme>scheme</a>,
   followed by "<code>:</code>".</li></ol>

  <p>The <code id=the-location-interface:dom-location-protocol-3><a href=#dom-location-protocol>protocol</a></code> attribute's setter must run these
  steps:</p>

  <ol><li><p>If this <code id=the-location-interface:location-34><a href=#location>Location</a></code> object's <a href=#relevant-document id=the-location-interface:relevant-document-6>relevant <code>Document</code></a>'s
   <a href=#concept-origin id=the-location-interface:concept-origin-8>origin</a> is not <a href=#same-origin-domain id=the-location-interface:same-origin-domain-4>same origin-domain</a> with the <a id=the-location-interface:entry-settings-object-5 href=webappapis.html#entry-settings-object>entry settings
   object</a>'s <a href=#concept-origin id=the-location-interface:concept-origin-9>origin</a>, then throw a <a id=the-location-interface:securityerror-4 href=https://triple-underscore.github.io/WebIDL-ja.html#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a>
   <code id=the-location-interface:domexception-4><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.</li><li><p>Let <var>copyURL</var> be a copy of this <code id=the-location-interface:location-35><a href=#location>Location</a></code> object's <a href=#concept-location-url id=the-location-interface:concept-location-url-4>url</a>.</li><li><p>Let <var>possibleFailure</var> be the result of <a href=https://triple-underscore.github.io/URL-ja.html#concept-basic-url-parser id=the-location-interface:basic-url-parser data-x-internal=basic-url-parser>basic URL
   parsing</a> the given value, followed by "<code>:</code>", with <var>copyURL</var>
   as <var>url</var> and <a id=the-location-interface:scheme-start-state href=https://triple-underscore.github.io/URL-ja.html#scheme-start-state data-x-internal=scheme-start-state>scheme start state</a> as <var>state override</var>.</li><li><p>If <var>possibleFailure</var> is failure, throw a <code id=the-location-interface:typeerror-2><a data-x-internal=typeerror href=https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-typeerror>TypeError</a></code>
   exception.</li><li><p>If <var>copyURL</var>'s <a href=https://triple-underscore.github.io/URL-ja.html#concept-url-scheme id=the-location-interface:concept-url-scheme-2 data-x-internal=concept-url-scheme>scheme</a> is not "<code>http</code>" or "<code>https</code>", terminate these steps.</li><li><p><a href=#location-object-setter-navigate id=the-location-interface:location-object-setter-navigate-2><code>Location</code>-object-setter navigate</a> to <var>copyURL</var>.</li></ol>

  <p>The <dfn id=dom-location-host><code>host</code></dfn> attribute's getter must run these
  steps:</p>

  <ol><li><p>If this <code id=the-location-interface:location-36><a href=#location>Location</a></code> object's <a href=#relevant-document id=the-location-interface:relevant-document-7>relevant <code>Document</code></a>'s
   <a href=#concept-origin id=the-location-interface:concept-origin-10>origin</a> is not <a href=#same-origin-domain id=the-location-interface:same-origin-domain-5>same origin-domain</a> with the <a id=the-location-interface:entry-settings-object-6 href=webappapis.html#entry-settings-object>entry settings
   object</a>'s <a href=#concept-origin id=the-location-interface:concept-origin-11>origin</a>, then throw a <a id=the-location-interface:securityerror-5 href=https://triple-underscore.github.io/WebIDL-ja.html#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a>
   <code id=the-location-interface:domexception-5><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.</li><li><p>Let <var>url</var> be this <code id=the-location-interface:location-37><a href=#location>Location</a></code> object's <a href=#concept-location-url id=the-location-interface:concept-location-url-5>url</a>.</li><li><p>If <var>url</var>'s <a href=https://triple-underscore.github.io/URL-ja.html#concept-url-host id=the-location-interface:concept-url-host data-x-internal=concept-url-host>host</a> is null, return the empty
   string.</li><li><p>If <var>url</var>'s <a href=https://triple-underscore.github.io/URL-ja.html#concept-url-port id=the-location-interface:concept-url-port data-x-internal=concept-url-port>port</a> is null, return
   <var>url</var>'s <a href=https://triple-underscore.github.io/URL-ja.html#concept-url-host id=the-location-interface:concept-url-host-2 data-x-internal=concept-url-host>host</a>, <a href=https://triple-underscore.github.io/URL-ja.html#concept-host-serializer id=the-location-interface:host-serialiser data-x-internal=host-serialiser>serialised</a>.</li><li><p>Return <var>url</var>'s <a href=https://triple-underscore.github.io/URL-ja.html#concept-url-host id=the-location-interface:concept-url-host-3 data-x-internal=concept-url-host>host</a>, <a href=https://triple-underscore.github.io/URL-ja.html#concept-host-serializer id=the-location-interface:host-serialiser-2 data-x-internal=host-serialiser>serialised</a>, followed by "<code>:</code>" and <var>url</var>'s <a href=https://triple-underscore.github.io/URL-ja.html#concept-url-port id=the-location-interface:concept-url-port-2 data-x-internal=concept-url-port>port</a>, <a href=https://triple-underscore.github.io/URL-ja.html#serialize-an-integer id=the-location-interface:serialise-an-integer data-x-internal=serialise-an-integer>serialised</a>.</li></ol>

  <p>The <code id=the-location-interface:dom-location-host-3><a href=#dom-location-host>host</a></code> attribute's setter must run these steps:</p>

  <ol><li><p>If this <code id=the-location-interface:location-38><a href=#location>Location</a></code> object's <a href=#relevant-document id=the-location-interface:relevant-document-8>relevant <code>Document</code></a>'s
   <a href=#concept-origin id=the-location-interface:concept-origin-12>origin</a> is not <a href=#same-origin-domain id=the-location-interface:same-origin-domain-6>same origin-domain</a> with the <a id=the-location-interface:entry-settings-object-7 href=webappapis.html#entry-settings-object>entry settings
   object</a>'s <a href=#concept-origin id=the-location-interface:concept-origin-13>origin</a>, then throw a <a id=the-location-interface:securityerror-6 href=https://triple-underscore.github.io/WebIDL-ja.html#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a>
   <code id=the-location-interface:domexception-6><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.</li><li><p>Let <var>copyURL</var> be a copy of this <code id=the-location-interface:location-39><a href=#location>Location</a></code> object's <a href=#concept-location-url id=the-location-interface:concept-location-url-6>url</a>.</li><li><p>If <var>copyURL</var>'s <a id=the-location-interface:cannot-be-a-base-url-flag href=https://triple-underscore.github.io/URL-ja.html#url-cannot-be-a-base-url-flag data-x-internal=cannot-be-a-base-url-flag>cannot-be-a-base-URL flag</a> is set, terminate these
   steps.</li><li><p><a href=https://triple-underscore.github.io/URL-ja.html#concept-basic-url-parser id=the-location-interface:basic-url-parser-2 data-x-internal=basic-url-parser>Basic URL parse</a> the given value, with
   <var>copyURL</var> as <var>url</var> and <a id=the-location-interface:host-state href=https://triple-underscore.github.io/URL-ja.html#host-state data-x-internal=host-state>host state</a> as <var>state
   override</var>.</li><li><p><a href=#location-object-setter-navigate id=the-location-interface:location-object-setter-navigate-3><code>Location</code>-object-setter navigate</a> to <var>copyURL</var>.</li></ol>

  <p>The <dfn id=dom-location-hostname><code>hostname</code></dfn> attribute's getter must
  run these steps:</p>

  <ol><li><p>If this <code id=the-location-interface:location-40><a href=#location>Location</a></code> object's <a href=#relevant-document id=the-location-interface:relevant-document-9>relevant <code>Document</code></a>'s
   <a href=#concept-origin id=the-location-interface:concept-origin-14>origin</a> is not <a href=#same-origin-domain id=the-location-interface:same-origin-domain-7>same origin-domain</a> with the <a id=the-location-interface:entry-settings-object-8 href=webappapis.html#entry-settings-object>entry settings
   object</a>'s <a href=#concept-origin id=the-location-interface:concept-origin-15>origin</a>, then throw a <a id=the-location-interface:securityerror-7 href=https://triple-underscore.github.io/WebIDL-ja.html#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a>
   <code id=the-location-interface:domexception-7><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.</li><li><p>If this <code id=the-location-interface:location-41><a href=#location>Location</a></code> object's <a href=#concept-location-url id=the-location-interface:concept-location-url-7>url</a>'s
   <a href=https://triple-underscore.github.io/URL-ja.html#concept-url-host id=the-location-interface:concept-url-host-4 data-x-internal=concept-url-host>host</a> is null, return the empty string.</li><li><p>Return this <code id=the-location-interface:location-42><a href=#location>Location</a></code> object's <a href=#concept-location-url id=the-location-interface:concept-location-url-8>url</a>'s <a href=https://triple-underscore.github.io/URL-ja.html#concept-url-host id=the-location-interface:concept-url-host-5 data-x-internal=concept-url-host>host</a>, <a href=https://triple-underscore.github.io/URL-ja.html#concept-host-serializer id=the-location-interface:host-serialiser-3 data-x-internal=host-serialiser>serialised</a>.</li></ol>

  <p>The <code id=the-location-interface:dom-location-hostname-3><a href=#dom-location-hostname>hostname</a></code> attribute's setter must run these
  steps:</p>

  <ol><li><p>If this <code id=the-location-interface:location-43><a href=#location>Location</a></code> object's <a href=#relevant-document id=the-location-interface:relevant-document-10>relevant <code>Document</code></a>'s
   <a href=#concept-origin id=the-location-interface:concept-origin-16>origin</a> is not <a href=#same-origin-domain id=the-location-interface:same-origin-domain-8>same origin-domain</a> with the <a id=the-location-interface:entry-settings-object-9 href=webappapis.html#entry-settings-object>entry settings
   object</a>'s <a href=#concept-origin id=the-location-interface:concept-origin-17>origin</a>, then throw a <a id=the-location-interface:securityerror-8 href=https://triple-underscore.github.io/WebIDL-ja.html#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a>
   <code id=the-location-interface:domexception-8><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.</li><li><p>Let <var>copyURL</var> be a copy of this <code id=the-location-interface:location-44><a href=#location>Location</a></code> object's <a href=#concept-location-url id=the-location-interface:concept-location-url-9>url</a>.</li><li><p>If <var>copyURL</var>'s <a id=the-location-interface:cannot-be-a-base-url-flag-2 href=https://triple-underscore.github.io/URL-ja.html#url-cannot-be-a-base-url-flag data-x-internal=cannot-be-a-base-url-flag>cannot-be-a-base-URL flag</a> is set, terminate these
   steps.</li><li><p><a href=https://triple-underscore.github.io/URL-ja.html#concept-basic-url-parser id=the-location-interface:basic-url-parser-3 data-x-internal=basic-url-parser>Basic URL parse</a> the given value, with
   <var>copyURL</var> as <var>url</var> and <a id=the-location-interface:hostname-state href=https://triple-underscore.github.io/URL-ja.html#hostname-state data-x-internal=hostname-state>hostname state</a> as <var>state
   override</var>.</li><li><p><a href=#location-object-setter-navigate id=the-location-interface:location-object-setter-navigate-4><code>Location</code>-object-setter navigate</a> to <var>copyURL</var>.</li></ol>

  <p>The <dfn id=dom-location-port><code>port</code></dfn> attribute's getter must run these
  steps:</p>

  <ol><li><p>If this <code id=the-location-interface:location-45><a href=#location>Location</a></code> object's <a href=#relevant-document id=the-location-interface:relevant-document-11>relevant <code>Document</code></a>'s
   <a href=#concept-origin id=the-location-interface:concept-origin-18>origin</a> is not <a href=#same-origin-domain id=the-location-interface:same-origin-domain-9>same origin-domain</a> with the <a id=the-location-interface:entry-settings-object-10 href=webappapis.html#entry-settings-object>entry settings
   object</a>'s <a href=#concept-origin id=the-location-interface:concept-origin-19>origin</a>, then throw a <a id=the-location-interface:securityerror-9 href=https://triple-underscore.github.io/WebIDL-ja.html#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a>
   <code id=the-location-interface:domexception-9><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.</li><li><p>If this <code id=the-location-interface:location-46><a href=#location>Location</a></code> object's <a href=#concept-location-url id=the-location-interface:concept-location-url-10>url</a>'s
   <a href=https://triple-underscore.github.io/URL-ja.html#concept-url-port id=the-location-interface:concept-url-port-3 data-x-internal=concept-url-port>port</a> is null, return the empty string.</li><li><p>Return this <code id=the-location-interface:location-47><a href=#location>Location</a></code> object's <a href=#concept-location-url id=the-location-interface:concept-location-url-11>url</a>'s <a href=https://triple-underscore.github.io/URL-ja.html#concept-url-port id=the-location-interface:concept-url-port-4 data-x-internal=concept-url-port>port</a>, <a href=https://triple-underscore.github.io/URL-ja.html#serialize-an-integer id=the-location-interface:serialise-an-integer-2 data-x-internal=serialise-an-integer>serialised</a>.</li></ol>

  <p>The <code id=the-location-interface:dom-location-port-3><a href=#dom-location-port>port</a></code> attribute's setter must run these steps:</p>

  <ol><li><p>If this <code id=the-location-interface:location-48><a href=#location>Location</a></code> object's <a href=#relevant-document id=the-location-interface:relevant-document-12>relevant <code>Document</code></a>'s
   <a href=#concept-origin id=the-location-interface:concept-origin-20>origin</a> is not <a href=#same-origin-domain id=the-location-interface:same-origin-domain-10>same origin-domain</a> with the <a id=the-location-interface:entry-settings-object-11 href=webappapis.html#entry-settings-object>entry settings
   object</a>'s <a href=#concept-origin id=the-location-interface:concept-origin-21>origin</a>, then throw a <a id=the-location-interface:securityerror-10 href=https://triple-underscore.github.io/WebIDL-ja.html#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a>
   <code id=the-location-interface:domexception-10><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.</li><li><p>Let <var>copyURL</var> be a copy of this <code id=the-location-interface:location-49><a href=#location>Location</a></code> object's <a href=#concept-location-url id=the-location-interface:concept-location-url-12>url</a>.</li><li><p>If <var>copyURL</var>'s <a href=https://triple-underscore.github.io/URL-ja.html#concept-url-host id=the-location-interface:concept-url-host-6 data-x-internal=concept-url-host>host</a> is null,
   <var>copyURL</var>'s <a id=the-location-interface:cannot-be-a-base-url-flag-3 href=https://triple-underscore.github.io/URL-ja.html#url-cannot-be-a-base-url-flag data-x-internal=cannot-be-a-base-url-flag>cannot-be-a-base-URL flag</a> is set, or <var>copyURL</var>'s <a href=https://triple-underscore.github.io/URL-ja.html#concept-url-scheme id=the-location-interface:concept-url-scheme-3 data-x-internal=concept-url-scheme>scheme</a> is "<code>file</code>", terminate these
   steps.</li><li><p><a href=https://triple-underscore.github.io/URL-ja.html#concept-basic-url-parser id=the-location-interface:basic-url-parser-4 data-x-internal=basic-url-parser>Basic URL parse</a> the given value, with
   <var>copyURL</var> as <var>url</var> and <a id=the-location-interface:port-state href=https://triple-underscore.github.io/URL-ja.html#port-state data-x-internal=port-state>port state</a> as <var>state
   override</var>.</li><li><p><a href=#location-object-setter-navigate id=the-location-interface:location-object-setter-navigate-5><code>Location</code>-object-setter navigate</a> to <var>copyURL</var>.</li></ol>

  <p>The <dfn id=dom-location-pathname><code>pathname</code></dfn> attribute's getter must
  run these steps:</p>

  <ol><li><p>If this <code id=the-location-interface:location-50><a href=#location>Location</a></code> object's <a href=#relevant-document id=the-location-interface:relevant-document-13>relevant <code>Document</code></a>'s
   <a href=#concept-origin id=the-location-interface:concept-origin-22>origin</a> is not <a href=#same-origin-domain id=the-location-interface:same-origin-domain-11>same origin-domain</a> with the <a id=the-location-interface:entry-settings-object-12 href=webappapis.html#entry-settings-object>entry settings
   object</a>'s <a href=#concept-origin id=the-location-interface:concept-origin-23>origin</a>, then throw a <a id=the-location-interface:securityerror-11 href=https://triple-underscore.github.io/WebIDL-ja.html#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a>
   <code id=the-location-interface:domexception-11><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.</li><li><p>Let <var>url</var> be this <code id=the-location-interface:location-51><a href=#location>Location</a></code> object's <a href=#concept-location-url id=the-location-interface:concept-location-url-13>url</a>.</li><li><p>If <var>url</var>'s <a id=the-location-interface:cannot-be-a-base-url-flag-4 href=https://triple-underscore.github.io/URL-ja.html#url-cannot-be-a-base-url-flag data-x-internal=cannot-be-a-base-url-flag>cannot-be-a-base-URL flag</a> is set, return the first string
   in <var>url</var>'s <a href=https://triple-underscore.github.io/URL-ja.html#concept-url-path id=the-location-interface:concept-url-path data-x-internal=concept-url-path>path</a>.</li><li><p>Return "<code>/</code>", followed by the strings in <var>url</var>'s <a href=https://triple-underscore.github.io/URL-ja.html#concept-url-path id=the-location-interface:concept-url-path-2 data-x-internal=concept-url-path>path</a> (including empty strings), separated from each other by
   "<code>/</code>".</li></ol>

  <p>The <code id=the-location-interface:dom-location-pathname-3><a href=#dom-location-pathname>pathname</a></code> attribute's setter must run these
  steps:</p>

  <ol><li><p>If this <code id=the-location-interface:location-52><a href=#location>Location</a></code> object's <a href=#relevant-document id=the-location-interface:relevant-document-14>relevant <code>Document</code></a>'s
   <a href=#concept-origin id=the-location-interface:concept-origin-24>origin</a> is not <a href=#same-origin-domain id=the-location-interface:same-origin-domain-12>same origin-domain</a> with the <a id=the-location-interface:entry-settings-object-13 href=webappapis.html#entry-settings-object>entry settings
   object</a>'s <a href=#concept-origin id=the-location-interface:concept-origin-25>origin</a>, then throw a <a id=the-location-interface:securityerror-12 href=https://triple-underscore.github.io/WebIDL-ja.html#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a>
   <code id=the-location-interface:domexception-12><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.</li><li><p>Let <var>copyURL</var> be a copy of this <code id=the-location-interface:location-53><a href=#location>Location</a></code> object's <a href=#concept-location-url id=the-location-interface:concept-location-url-14>url</a>.</li><li><p>If <var>copyURL</var>'s <a id=the-location-interface:cannot-be-a-base-url-flag-5 href=https://triple-underscore.github.io/URL-ja.html#url-cannot-be-a-base-url-flag data-x-internal=cannot-be-a-base-url-flag>cannot-be-a-base-URL flag</a> is set, terminate these
   steps.</li><li><p>Set <var>copyURL</var>'s <a href=https://triple-underscore.github.io/URL-ja.html#concept-url-path id=the-location-interface:concept-url-path-3 data-x-internal=concept-url-path>path</a> to the empty
   list.</li><li><p><a href=https://triple-underscore.github.io/URL-ja.html#concept-basic-url-parser id=the-location-interface:basic-url-parser-5 data-x-internal=basic-url-parser>Basic URL parse</a> the given value, with
   <var>copyURL</var> as <var>url</var> and <a id=the-location-interface:path-start-state href=https://triple-underscore.github.io/URL-ja.html#path-start-state data-x-internal=path-start-state>path start state</a> as <var>state
   override</var>.</li><li><p><a href=#location-object-setter-navigate id=the-location-interface:location-object-setter-navigate-6><code>Location</code>-object-setter navigate</a> to <var>copyURL</var>.</li></ol>

  <p>The <dfn id=dom-location-search><code>search</code></dfn> attribute's getter must run
  these steps:</p>

  <ol><li><p>If this <code id=the-location-interface:location-54><a href=#location>Location</a></code> object's <a href=#relevant-document id=the-location-interface:relevant-document-15>relevant <code>Document</code></a>'s
   <a href=#concept-origin id=the-location-interface:concept-origin-26>origin</a> is not <a href=#same-origin-domain id=the-location-interface:same-origin-domain-13>same origin-domain</a> with the <a id=the-location-interface:entry-settings-object-14 href=webappapis.html#entry-settings-object>entry settings
   object</a>'s <a href=#concept-origin id=the-location-interface:concept-origin-27>origin</a>, then throw a <a id=the-location-interface:securityerror-13 href=https://triple-underscore.github.io/WebIDL-ja.html#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a>
   <code id=the-location-interface:domexception-13><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.</li><li><p>If this <code id=the-location-interface:location-55><a href=#location>Location</a></code> object's <a href=#concept-location-url id=the-location-interface:concept-location-url-15>url</a>'s
   <a href=https://triple-underscore.github.io/URL-ja.html#concept-url-query id=the-location-interface:concept-url-query data-x-internal=concept-url-query>query</a> is either null or the empty string, return the
   empty string.</li><li><p>Return "<code>?</code>", followed by this <code id=the-location-interface:location-56><a href=#location>Location</a></code> object's <a href=#concept-location-url id=the-location-interface:concept-location-url-16>url</a>'s <a href=https://triple-underscore.github.io/URL-ja.html#concept-url-query id=the-location-interface:concept-url-query-2 data-x-internal=concept-url-query>query</a>.</li></ol>

  <p>The <code id=the-location-interface:dom-location-search-3><a href=#dom-location-search>search</a></code> attribute's setter must run these
  steps:</p>

  <ol><li><p>If this <code id=the-location-interface:location-57><a href=#location>Location</a></code> object's <a href=#relevant-document id=the-location-interface:relevant-document-16>relevant <code>Document</code></a>'s
   <a href=#concept-origin id=the-location-interface:concept-origin-28>origin</a> is not <a href=#same-origin-domain id=the-location-interface:same-origin-domain-14>same origin-domain</a> with the <a id=the-location-interface:entry-settings-object-15 href=webappapis.html#entry-settings-object>entry settings
   object</a>'s <a href=#concept-origin id=the-location-interface:concept-origin-29>origin</a>, then throw a <a id=the-location-interface:securityerror-14 href=https://triple-underscore.github.io/WebIDL-ja.html#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a>
   <code id=the-location-interface:domexception-14><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.</li><li><p>Let <var>copyURL</var> be a copy of this <code id=the-location-interface:location-58><a href=#location>Location</a></code> object's <a href=#concept-location-url id=the-location-interface:concept-location-url-17>url</a>.</li><li><p>If the given value is the empty string, set <var>copyURL</var>'s <a href=https://triple-underscore.github.io/URL-ja.html#concept-url-query id=the-location-interface:concept-url-query-3 data-x-internal=concept-url-query>query</a> to null.

   

   </li><li>
    <p>そうでなければ、以下のサブ手順を実行する：</p>

    <ol><li><p>Let <var>input</var> be the given value with a single leading "<code>?</code>"
     removed, if any.</li><li><p>Set <var>copyURL</var>'s <a href=https://triple-underscore.github.io/URL-ja.html#concept-url-query id=the-location-interface:concept-url-query-4 data-x-internal=concept-url-query>query</a> to the empty
     string.</li><li><p><a href=https://triple-underscore.github.io/URL-ja.html#concept-basic-url-parser id=the-location-interface:basic-url-parser-6 data-x-internal=basic-url-parser>Basic URL parse</a> <var>input</var>, with
     <var>copyURL</var> as <var>url</var> and <a id=the-location-interface:query-state href=https://triple-underscore.github.io/URL-ja.html#query-state data-x-internal=query-state>query state</a> as <var>state override</var>,
     and the <a href=#relevant-document id=the-location-interface:relevant-document-17>relevant <code>Document</code></a>'s <a id="the-location-interface:document's-character-encoding" href=https://triple-underscore.github.io/DOM4-ja.html#concept-document-encoding data-x-internal="document's-character-encoding">document's character
     encoding</a> as <var>encoding override</var>.</li></ol>
   </li><li><p><a href=#location-object-setter-navigate id=the-location-interface:location-object-setter-navigate-7><code>Location</code>-object-setter navigate</a> to <var>copyURL</var>.</li></ol>

  <p>The <dfn id=dom-location-hash><code>hash</code></dfn> attribute's getter must run these
  steps:</p>

  <ol><li><p>If this <code id=the-location-interface:location-59><a href=#location>Location</a></code> object's <a href=#relevant-document id=the-location-interface:relevant-document-18>relevant <code>Document</code></a>'s
   <a href=#concept-origin id=the-location-interface:concept-origin-30>origin</a> is not <a href=#same-origin-domain id=the-location-interface:same-origin-domain-15>same origin-domain</a> with the <a id=the-location-interface:entry-settings-object-16 href=webappapis.html#entry-settings-object>entry settings
   object</a>'s <a href=#concept-origin id=the-location-interface:concept-origin-31>origin</a>, then throw a <a id=the-location-interface:securityerror-15 href=https://triple-underscore.github.io/WebIDL-ja.html#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a>
   <code id=the-location-interface:domexception-15><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.</li><li><p>If this <code id=the-location-interface:location-60><a href=#location>Location</a></code> object's <a href=#concept-location-url id=the-location-interface:concept-location-url-18>url</a>'s
   <a href=https://triple-underscore.github.io/URL-ja.html#concept-url-fragment id=the-location-interface:concept-url-fragment data-x-internal=concept-url-fragment>fragment</a> is either null or the empty string, return
   the empty string.</li><li><p>Return "<code>#</code>", followed by this <code id=the-location-interface:location-61><a href=#location>Location</a></code> object's <a href=#concept-location-url id=the-location-interface:concept-location-url-19>url</a>'s <a href=https://triple-underscore.github.io/URL-ja.html#concept-url-fragment id=the-location-interface:concept-url-fragment-2 data-x-internal=concept-url-fragment>fragment</a>.</li></ol>

  <p>The <code id=the-location-interface:dom-location-hash-3><a href=#dom-location-hash>hash</a></code> attribute's setter must run these steps:</p>

  <ol><li><p>If this <code id=the-location-interface:location-62><a href=#location>Location</a></code> object's <a href=#relevant-document id=the-location-interface:relevant-document-19>relevant <code>Document</code></a>'s
   <a href=#concept-origin id=the-location-interface:concept-origin-32>origin</a> is not <a href=#same-origin-domain id=the-location-interface:same-origin-domain-16>same origin-domain</a> with the <a id=the-location-interface:entry-settings-object-17 href=webappapis.html#entry-settings-object>entry settings
   object</a>'s <a href=#concept-origin id=the-location-interface:concept-origin-33>origin</a>, then throw a <a id=the-location-interface:securityerror-16 href=https://triple-underscore.github.io/WebIDL-ja.html#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a>
   <code id=the-location-interface:domexception-16><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.</li><li><p>Let <var>copyURL</var> be a copy of this <code id=the-location-interface:location-63><a href=#location>Location</a></code> object's <a href=#concept-location-url id=the-location-interface:concept-location-url-20>url</a>.</li><li><p>If <var>copyURL</var>'s <a href=https://triple-underscore.github.io/URL-ja.html#concept-url-scheme id=the-location-interface:concept-url-scheme-4 data-x-internal=concept-url-scheme>scheme</a> is "<code>javascript</code>", terminate these steps.</li><li><p>If the given value is the empty string, set <var>copyURL</var>'s <a href=https://triple-underscore.github.io/URL-ja.html#concept-url-fragment id=the-location-interface:concept-url-fragment-3 data-x-internal=concept-url-fragment>fragment</a> to null.

   

   </li><li>
    <p>そうでなければ、以下のサブ手順を実行する：</p>

    <ol><li><p>Let <var>input</var> be the given value with a single leading "<code>#</code>"
     removed, if any.</li><li><p>Set <var>copyURL</var>'s <a href=https://triple-underscore.github.io/URL-ja.html#concept-url-fragment id=the-location-interface:concept-url-fragment-4 data-x-internal=concept-url-fragment>fragment</a> to the
     empty string.</li><li><p><a href=https://triple-underscore.github.io/URL-ja.html#concept-basic-url-parser id=the-location-interface:basic-url-parser-7 data-x-internal=basic-url-parser>Basic URL parse</a> <var>input</var>, with
     <var>copyURL</var> as <var>url</var> and <a id=the-location-interface:fragment-state href=https://triple-underscore.github.io/URL-ja.html#fragment-state data-x-internal=fragment-state>fragment state</a> as <var>state
     override</var>.</li></ol>
   </li><li><p><a href=#location-object-setter-navigate id=the-location-interface:location-object-setter-navigate-8><code>Location</code>-object-setter navigate</a> to <var>copyURL</var>.</li></ol>

  <hr>

  <p>When the <dfn id=dom-location-assign><code>assign(<var>url</var>)</code></dfn>
  method is invoked, the user agent must run the following steps:

  

  <ol><li><p>If this <code id=the-location-interface:location-64><a href=#location>Location</a></code> object's <a href=#relevant-document id=the-location-interface:relevant-document-20>relevant <code>Document</code></a>'s
   <a href=#concept-origin id=the-location-interface:concept-origin-34>origin</a> is not <a href=#same-origin-domain id=the-location-interface:same-origin-domain-17>same origin-domain</a> with the <a id=the-location-interface:entry-settings-object-18 href=webappapis.html#entry-settings-object>entry settings
   object</a>'s <a href=#concept-origin id=the-location-interface:concept-origin-35>origin</a>, then throw a <a id=the-location-interface:securityerror-17 href=https://triple-underscore.github.io/WebIDL-ja.html#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a>
   <code id=the-location-interface:domexception-17><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.</li><li><p><a href=infrastructure.html#parse-a-url id=the-location-interface:parse-a-url-2>Parse</a> <var>url</var> relative to the <a id=the-location-interface:entry-settings-object-19 href=webappapis.html#entry-settings-object>entry
   settings object</a>. If that failed, throw a <a id=the-location-interface:syntaxerror href=https://triple-underscore.github.io/WebIDL-ja.html#syntaxerror data-x-internal=syntaxerror>"<code>SyntaxError</code>"</a>
   <code id=the-location-interface:domexception-18><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.</li><li><p><a href=#location-object-navigate id=the-location-interface:location-object-navigate-2><code>Location</code>-object navigate</a> to the <a id=the-location-interface:resulting-url-record-2 href=infrastructure.html#resulting-url-record>resulting URL
   record</a>.</li></ol>

  <p>When the <dfn id=dom-location-replace><code>replace(<var>url</var>)</code></dfn>
  method is invoked, the user agent must run the following steps:

  

  <ol><li><p><a href=infrastructure.html#parse-a-url id=the-location-interface:parse-a-url-3>Parse</a> <var>url</var> relative to the <a id=the-location-interface:entry-settings-object-20 href=webappapis.html#entry-settings-object>entry
   settings object</a>. If that failed, throw a <a id=the-location-interface:syntaxerror-2 href=https://triple-underscore.github.io/WebIDL-ja.html#syntaxerror data-x-internal=syntaxerror>"<code>SyntaxError</code>"</a>
   <code id=the-location-interface:domexception-19><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.</li><li><p><a href=#location-object-navigate id=the-location-interface:location-object-navigate-3><code>Location</code>-object navigate</a> to the <a id=the-location-interface:resulting-url-record-3 href=infrastructure.html#resulting-url-record>resulting URL
   record</a> with the <var>replacement flag</var> set.</li></ol>

  <p class=note>The <code id=the-location-interface:dom-location-replace-3><a href=#dom-location-replace>replace()</a></code> method intentionally has
  no security check.</p>

  <p>When the <dfn id=dom-location-reload><code>reload()</code></dfn> method is invoked, the
  user agent must run the appropriate steps from the following list:</p>

  <dl class=switch><dt>If this <code id=the-location-interface:location-65><a href=#location>Location</a></code> object's <a href=#relevant-document id=the-location-interface:relevant-document-21>relevant <code>Document</code></a>'s
   <a href=#concept-origin id=the-location-interface:concept-origin-36>origin</a> is not <a href=#same-origin-domain id=the-location-interface:same-origin-domain-18>same origin-domain</a> with the <a id=the-location-interface:entry-settings-object-21 href=webappapis.html#entry-settings-object>entry settings
   object</a>'s <a href=#concept-origin id=the-location-interface:concept-origin-37>origin</a><dd><p>Throw a <a id=the-location-interface:securityerror-18 href=https://triple-underscore.github.io/WebIDL-ja.html#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a> <code id=the-location-interface:domexception-20><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.<dt>If the currently executing <a href=webappapis.html#concept-task id=the-location-interface:concept-task-3>task</a> is the dispatch of a <code id=the-location-interface:event-resize><a data-x-internal=event-resize href=https://triple-underscore.github.io/cssom-view-ja.html#eventdef-window-resize>resize</a></code> event in response to the user resizing the <a href=#browsing-context id=the-location-interface:browsing-context-6>browsing
   context</a><dd><p>Repaint the <a href=#browsing-context id=the-location-interface:browsing-context-7>browsing context</a> and abort these steps.<dt>If the <a href=#browsing-context id=the-location-interface:browsing-context-8>browsing context</a>'s <a href=#active-document id=the-location-interface:active-document-4>active document</a> is <a id=the-location-interface:an-iframe-srcdoc-document href=embedded-content.html#an-iframe-srcdoc-document>an
   <code>iframe</code> <code>srcdoc</code> document</a><dd><p><a href=embedded-content.html#process-the-iframe-attributes id=the-location-interface:process-the-iframe-attributes>Reprocess the <code>iframe</code>
   attributes</a> of the <a href=#browsing-context id=the-location-interface:browsing-context-9>browsing context</a>'s <a href=#browsing-context-container id=the-location-interface:browsing-context-container>browsing context
   container</a>.<dt>If the <a href=#browsing-context id=the-location-interface:browsing-context-10>browsing context</a>'s <a href=#active-document id=the-location-interface:active-document-5>active document</a> has its <a id=the-location-interface:reload-override-flag href=dom.html#reload-override-flag>reload
   override flag</a> set<dd><p>Perform <a id=the-location-interface:an-overridden-reload href=dom.html#an-overridden-reload>an overridden reload</a>, with the <a href=#browsing-context id=the-location-interface:browsing-context-11>browsing context</a> being
   navigated as the <a id=the-location-interface:responsible-browsing-context-2 href=webappapis.html#responsible-browsing-context>responsible browsing context</a>. Rethrow any exceptions.<dt>そうでなければ<dd><p><a href=#navigate id=the-location-interface:navigate-2>Navigate</a> the <a href=#browsing-context id=the-location-interface:browsing-context-12>browsing context</a> to
   the document's <a href=https://triple-underscore.github.io/DOM4-ja.html#concept-document-url id="the-location-interface:the-document's-address-3" data-x-internal="the-document's-address">URL</a> with the <var><a href=#exceptions-enabled id=the-location-interface:exceptions-enabled-2>exceptions
   enabled flag</a></var> set and <a href=#replacement-enabled id=the-location-interface:replacement-enabled-2>replacement enabled</a>. The <a href=#source-browsing-context id=the-location-interface:source-browsing-context-2>source browsing
   context</a> must be the <a href=#browsing-context id=the-location-interface:browsing-context-13>browsing context</a> being navigated. This is a
   <a href=#reload-triggered-navigation id=the-location-interface:reload-triggered-navigation>reload-triggered navigation</a>. Rethrow any exceptions.</dl>

  <p>When a user requests that the <a href=#active-document id=the-location-interface:active-document-6>active document</a> of a <a href=#browsing-context id=the-location-interface:browsing-context-14>browsing context</a>
  be reloaded through a user interface element, the user agent should <a href=#navigate id=the-location-interface:navigate-3>navigate</a> the <a href=#browsing-context id=the-location-interface:browsing-context-15>browsing context</a> to the same resource as that
  <code id=the-location-interface:document-8><a href=dom.html#document>Document</a></code>, with <a href=#replacement-enabled id=the-location-interface:replacement-enabled-3>replacement enabled</a>. In the case of non-idempotent
  methods (e.g. HTTP POST), the user agent should prompt the user to confirm the operation first,
  since otherwise transactions (e.g. purchases or database modifications) could be repeated. User
  agents may allow the user to explicitly override any caches when reloading. If <a href=#browsing-context id=the-location-interface:browsing-context-16>browsing
  context</a>'s <a href=#active-document id=the-location-interface:active-document-7>active document</a>'s <a id=the-location-interface:reload-override-flag-2 href=dom.html#reload-override-flag>reload override flag</a> is set, then the
  user agent may instead perform <a id=the-location-interface:an-overridden-reload-2 href=dom.html#an-overridden-reload>an overridden reload</a> rather than the navigation
  described in this paragraph (with the <a href=#browsing-context id=the-location-interface:browsing-context-17>browsing context</a> being reloaded as the
  <a href=#source-browsing-context id=the-location-interface:source-browsing-context-3>source browsing context</a>).</p>

  <hr>

  <p>The <dfn id=dom-location-ancestororigins><code>ancestorOrigins</code></dfn> attribute's
  getter must run these steps:

  

  <ol><li><p>If this <code id=the-location-interface:location-66><a href=#location>Location</a></code> object's <a href=#relevant-document id=the-location-interface:relevant-document-22>relevant <code>Document</code></a>'s
   <a href=#concept-origin id=the-location-interface:concept-origin-38>origin</a> is not <a href=#same-origin-domain id=the-location-interface:same-origin-domain-19>same origin-domain</a> with the <a id=the-location-interface:entry-settings-object-22 href=webappapis.html#entry-settings-object>entry settings
   object</a>'s <a href=#concept-origin id=the-location-interface:concept-origin-39>origin</a>, then throw a <a id=the-location-interface:securityerror-19 href=https://triple-underscore.github.io/WebIDL-ja.html#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a>
   <code id=the-location-interface:domexception-21><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.</li><li><p>Otherwise, return this <code id=the-location-interface:location-67><a href=#location>Location</a></code> object's <a href=#concept-location-ancestor-origins-array id=the-location-interface:concept-location-ancestor-origins-array-2>ancestor origins array</a>.</li></ol>

  <hr>

  <p>As explained earlier, the <code id=the-location-interface:location-68><a href=#location>Location</a></code> exotic object requires additional logic beyond
  IDL for security purposes. The internal slot and internal methods <code id=the-location-interface:location-69><a href=#location>Location</a></code> objects
  must implement are defined below.</p>

  <p>Every <code id=the-location-interface:location-70><a href=#location>Location</a></code> object has a [[<dfn id=defaultproperties>DefaultProperties</dfn>]] internal slot
  representing its own properties at time of its creation.</p>

  <h5 id=location-getprototypeof>7.7.4.1 [[GetPrototypeOf]] ( )</h5>

  <ol><li><p>If <a href=#isplatformobjectsameorigin-(-o-) id=location-getprototypeof:isplatformobjectsameorigin-(-o-)>IsPlatformObjectSameOrigin</a>(<b>this</b>) is true, then return !
   <a id=location-getprototypeof:ordinarygetprototypeof href=https://tc39.github.io/ecma262/#sec-ordinarygetprototypeof data-x-internal=ordinarygetprototypeof>OrdinaryGetPrototypeOf</a>(<b>this</b>).</li><li><p>Return null.</li></ol>

  <h5 id=location-setprototypeof>7.7.4.2 [[SetPrototypeOf]] ( <var>V</var> )</h5>

  <ol><li><p>Return false.</li></ol>

  <h5 id=location-isextensible>7.7.4.3 [[IsExtensible]] ( )</h5>

  <ol><li><p>Return true.</li></ol>

  <h5 id=location-preventextensions>7.7.4.4 [[PreventExtensions]] ( )</h5>

  <ol><li><p>Return false.</li></ol>

  <h5 id=location-getownproperty>7.7.4.5 [[GetOwnProperty]] ( <var>P</var> )</h5>

  <ol><li>
    <p>If <a href=#isplatformobjectsameorigin-(-o-) id=location-getownproperty:isplatformobjectsameorigin-(-o-)>IsPlatformObjectSameOrigin</a>(<b>this</b>) is true, then:</p>

    <ol><li><p>Let <var>desc</var> be <a id=location-getownproperty:ordinarygetownproperty href=https://tc39.github.io/ecma262/#sec-ordinarygetownproperty data-x-internal=ordinarygetownproperty>OrdinaryGetOwnProperty</a>(<b>this</b>,
     <var>P</var>).</li><li><p>If the value of the [[<a href=#defaultproperties id=location-getownproperty:defaultproperties>DefaultProperties</a>]] internal slot of <b>this</b>
     contains <var>P</var>, then set <var>desc</var>.[[Configurable]] to true.</li><li><p>Return <var>desc</var>.</li></ol>
   </li><li><p>Let <var>property</var> be ! <a href=#crossorigingetownpropertyhelper-(-o,-p-) id=location-getownproperty:crossorigingetownpropertyhelper-(-o,-p-)>CrossOriginGetOwnPropertyHelper</a>(<b>this</b>,
   <var>P</var>).</li><li><p>If <var>property</var> is not undefined, return <var>property</var>.</li><li><p>Throw a <a id=location-getownproperty:securityerror href=https://triple-underscore.github.io/WebIDL-ja.html#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a> <code id=location-getownproperty:domexception><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.</li></ol>

  <h5 id=location-defineownproperty>7.7.4.6 [[DefineOwnProperty]] ( <var>P</var>, <var>Desc</var> )</h5>

  <ol><li>
    <p>If <a href=#isplatformobjectsameorigin-(-o-) id=location-defineownproperty:isplatformobjectsameorigin-(-o-)>IsPlatformObjectSameOrigin</a>(<b>this</b>) is true, then:</p>

    <ol><li><p>If the value of the [[<a href=#defaultproperties id=location-defineownproperty:defaultproperties>DefaultProperties</a>]] internal slot of <b>this</b>
     contains <var>P</var>, then return false.</li><li><p>Return ? <a id=location-defineownproperty:ordinarydefineownproperty href=https://tc39.github.io/ecma262/#sec-ordinarydefineownproperty data-x-internal=ordinarydefineownproperty>OrdinaryDefineOwnProperty</a>(<b>this</b>, <var>P</var>,
     <var>Desc</var>).</li></ol>
   </li><li><p>Return false.</li></ol>

  <h5 id=location-get>7.7.4.7 [[Get]] ( <var>P</var>, <var>Receiver</var> )</h5>

  <ol><li><p>If <a href=#isplatformobjectsameorigin-(-o-) id=location-get:isplatformobjectsameorigin-(-o-)>IsPlatformObjectSameOrigin</a>(<b>this</b>) is true, then return ?
   <a id=location-get:ordinaryget href=https://tc39.github.io/ecma262/#sec-ordinaryget data-x-internal=ordinaryget>OrdinaryGet</a>(<b>this</b>, <var>P</var>, <var>Receiver</var>).</li><li><p>Return ? <a href=#crossoriginget-(-o,-p,-receiver-) id=location-get:crossoriginget-(-o,-p,-receiver-)>CrossOriginGet</a>(<b>this</b>, <var>P</var>,
   <var>Receiver</var>).</li></ol>

  <h5 id=location-set>7.7.4.8 [[Set]] ( <var>P</var>, <var>V</var>, <var>Receiver</var> )</h5>

  <ol><li><p>If <a href=#isplatformobjectsameorigin-(-o-) id=location-set:isplatformobjectsameorigin-(-o-)>IsPlatformObjectSameOrigin</a>(<b>this</b>) is true, then return ?
   <a id=location-set:ordinaryset href=https://tc39.github.io/ecma262/#sec-ordinaryset data-x-internal=ordinaryset>OrdinarySet</a>(<b>this</b>, <var>P</var>, <var>Receiver</var>).</li><li><p>Return ? <a href=#crossoriginset-(-o,-p,-v,-receiver-) id=location-set:crossoriginset-(-o,-p,-v,-receiver-)>CrossOriginSet</a>(<b>this</b>, <var>P</var>, <var>V</var>,
   <var>Receiver</var>).</li></ol>

  <h5 id=location-delete>7.7.4.9 [[Delete]] ( <var>P</var> )</h5>

  <ol><li><p>If <a href=#isplatformobjectsameorigin-(-o-) id=location-delete:isplatformobjectsameorigin-(-o-)>IsPlatformObjectSameOrigin</a>(<b>this</b>) is true, then return ?
   <a id=location-delete:ordinarydelete href=https://tc39.github.io/ecma262/#sec-ordinarydelete data-x-internal=ordinarydelete>OrdinaryDelete</a>(<b>this</b>, <var>P</var>).</li><li><p>Return false.</li></ol>

  <h5 id=location-ownpropertykeys>7.7.4.10 [[OwnPropertyKeys]] ( )</h5>

  <ol><li><p>If <a href=#isplatformobjectsameorigin-(-o-) id=location-ownpropertykeys:isplatformobjectsameorigin-(-o-)>IsPlatformObjectSameOrigin</a>(<b>this</b>) is true, then return !
   <a id=location-ownpropertykeys:ordinaryownpropertykeys href=https://tc39.github.io/ecma262/#sec-ordinaryownpropertykeys data-x-internal=ordinaryownpropertykeys>OrdinaryOwnPropertyKeys</a>(<b>this</b>).</li><li><p>Return ! <a href=#crossoriginownpropertykeys-(-o-) id=location-ownpropertykeys:crossoriginownpropertykeys-(-o-)>CrossOriginOwnPropertyKeys</a>(<b>this</b>).</li></ol>

  



  <h3 id=browsing-the-web>7.8 ウェブを閲覧する</h3>

  

  <h4 id=navigating-across-documents>7.8.1 Navigating across documents</h4>

  <p>Certain actions cause the <a href=#browsing-context id=navigating-across-documents:browsing-context>browsing context</a> to <i id=navigating-across-documents:navigate><a href=#navigate>navigate</a></i> to
  a new resource. A user agent may provide various ways for the user to explicitly cause a browsing
  context to navigate, in addition to those defined in this specification.</p>

  <p class=example>For example, <a href=semantics.html#following-hyperlinks-2 id=navigating-across-documents:following-hyperlinks-2>following a hyperlink</a>,
  <a href=forms.html#concept-form-submit id=navigating-across-documents:concept-form-submit>form submission</a>, and the <code id=navigating-across-documents:dom-open><a href=#dom-open>window.open()</a></code> and <code id=navigating-across-documents:dom-location-assign><a href=#dom-location-assign>location.assign()</a></code> methods can all cause a browsing context to
  navigate.</p>

  <p class=note>A <i>resource</i> has a URL, but that might not be the only information necessary
  to identify it. For example, a form submission that uses HTTP POST would also have the HTTP method
  and payload. Similarly, <a id=navigating-across-documents:an-iframe-srcdoc-document href=embedded-content.html#an-iframe-srcdoc-document>an <code>iframe</code> <code>srcdoc</code> document</a> needs to know the data it is to use.</p>

  <p>Navigation always involves <dfn id=source-browsing-context>source browsing context</dfn>, which is the browsing context which
  was responsible for starting the navigation.</p>

  
  
  <p>To <dfn id=navigate>navigate</dfn> a browsing context <var>browsingContext</var> to a resource
  <var>resource</var>, optionally with an <dfn id=exceptions-enabled><var>exceptions enabled
  flag</var></dfn>, the user agent must run these steps:</p>

  <ol><li id=sandboxLinks>
    <p>If the <a href=#source-browsing-context id=navigating-across-documents:source-browsing-context>source browsing context</a> is not <a href=#allowed-to-navigate id=navigating-across-documents:allowed-to-navigate>allowed to navigate</a>
    <var>browsingContext</var>, then:</p>

    <ol><li><p>If the <var><a href=#exceptions-enabled id=navigating-across-documents:exceptions-enabled>exceptions enabled flag</a></var> is set, then throw a
     <a id=navigating-across-documents:securityerror href=https://triple-underscore.github.io/WebIDL-ja.html#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a> <code id=navigating-across-documents:domexception><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.</li><li>
      <p>Otherwise, the user agent may instead offer to open <var>resource</var> in a new
      <a href=#top-level-browsing-context id=navigating-across-documents:top-level-browsing-context>top-level browsing context</a> or in the <a href=#top-level-browsing-context id=navigating-across-documents:top-level-browsing-context-2>top-level browsing context</a> of
      the <a href=#source-browsing-context id=navigating-across-documents:source-browsing-context-2>source browsing context</a>, at the user's option, in which case the user agent
      must <a href=#navigate id=navigating-across-documents:navigate-2>navigate</a> that designated <a href=#top-level-browsing-context id=navigating-across-documents:top-level-browsing-context-3>top-level
      browsing context</a> to <var>resource</var> as if the user had requested it
      independently.</p>

      <p class=note>Doing so, however, can be dangerous, as it means that the user is overriding
      the author's explicit request to sandbox the content.</p>
     </li></ol>
   </li><li><p>If there is a preexisting attempt to navigate <var>browsingContext</var>, and the
   <a href=#source-browsing-context id=navigating-across-documents:source-browsing-context-3>source browsing context</a> is the same as <var>browsingContext</var>, and that attempt
   is currently running the <a href=#unload-a-document id=navigating-across-documents:unload-a-document>unload a document</a> algorithm, and the <a href=#concept-origin id=navigating-across-documents:concept-origin>origin</a> of
   the <a id=navigating-across-documents:url href=https://triple-underscore.github.io/URL-ja.html#concept-url data-x-internal=url>URL</a> of the resource being loaded in that navigation is not the <a href=#same-origin id=navigating-across-documents:same-origin>same
   origin</a> as the <a href=#concept-origin id=navigating-across-documents:concept-origin-2>origin</a> of the <a id=navigating-across-documents:url-2 href=https://triple-underscore.github.io/URL-ja.html#concept-url data-x-internal=url>URL</a> of <var>resource</var>, then
   abort these steps without affecting the preexisting attempt to navigate
   <var>browsingContext</var>.</li><li><p>If a <a href=webappapis.html#concept-task id=navigating-across-documents:concept-task>task</a> queued by the <a href=#traverse-the-history-by-a-delta id=navigating-across-documents:traverse-the-history-by-a-delta>traverse the history by a
   delta</a> algorithm is running the <a href=#unload-a-document id=navigating-across-documents:unload-a-document-2>unload a document</a> algorithm for the
   <a href=#active-document id=navigating-across-documents:active-document>active document</a> of <var>browsingContext</var>, then abort these steps without
   affecting the <a href=#unload-a-document id=navigating-across-documents:unload-a-document-3>unload a document</a> algorithm or the aforementioned history traversal
   task.</li><li><p>If the <a href=#prompt-to-unload-a-document id=navigating-across-documents:prompt-to-unload-a-document>prompt to unload a document</a> algorithm is being run for the
   <a href=#active-document id=navigating-across-documents:active-document-2>active document</a> of <var>browsingContext</var>, then abort these steps without
   affecting the <a href=#prompt-to-unload-a-document id=navigating-across-documents:prompt-to-unload-a-document-2>prompt to unload a document</a> algorithm.</li><li>

    <p>Let <var>gone async</var> be false.</p>

    <p class=note>The <a href=#navigate-redirect-step><i>handle redirects</i></a> step later in
    this algorithm can in certain cases jump back to the step labeled <a href=#navigate-fragid-step><i>fragments</i></a>. Since, between those two steps, this
    algorithm goes from operating synchronously in the context of the calling <a href=webappapis.html#concept-task id=navigating-across-documents:concept-task-2>task</a> to operating <a id=navigating-across-documents:in-parallel href=infrastructure.html#in-parallel>in parallel</a> independent of the <a id=navigating-across-documents:event-loop href=webappapis.html#event-loop>event
    loop</a>, some of the intervening steps need to be able to handle both being run as part of a
    <a href=webappapis.html#concept-task id=navigating-across-documents:concept-task-3>task</a> and running <a id=navigating-across-documents:in-parallel-2 href=infrastructure.html#in-parallel>in parallel</a>. The
    <var>gone async</var> flag is thus used to make these steps aware of which mode they are
    operating in.</p>

   </li><li id=navigate-fragid-step><p><i>Fragments</i>: If this is not a
   <dfn id=reload-triggered-navigation>reload-triggered navigation</dfn>: apply the <a id=navigating-across-documents:url-parser href=https://triple-underscore.github.io/URL-ja.html#concept-url-parser data-x-internal=url-parser>URL parser</a> algorithm to the
   <a id=navigating-across-documents:absolute-url href=https://triple-underscore.github.io/URL-ja.html#syntax-url-absolute data-x-internal=absolute-url>absolute URL</a> of <var>resource</var> and the <a href=https://triple-underscore.github.io/DOM4-ja.html#concept-document-url id="navigating-across-documents:the-document's-address" data-x-internal="the-document's-address">URL</a> of the <a href=#active-document id=navigating-across-documents:active-document-3>active document</a> of
   <var>browsingContext</var>; if all the components of the resulting <a id=navigating-across-documents:url-record href=https://triple-underscore.github.io/URL-ja.html#concept-url data-x-internal=url-record>URL record</a>,
   ignoring any <a href=https://triple-underscore.github.io/URL-ja.html#concept-url-fragment id=navigating-across-documents:concept-url-fragment data-x-internal=concept-url-fragment>fragment</a> components, are identical, and
   <var>resource</var> is to be fetched using `<code>GET</code>`, and the <a id=navigating-across-documents:url-record-2 href=https://triple-underscore.github.io/URL-ja.html#concept-url data-x-internal=url-record>URL
   record</a> of <var>resource</var> has a <a href=https://triple-underscore.github.io/URL-ja.html#concept-url-fragment id=navigating-across-documents:concept-url-fragment-2 data-x-internal=concept-url-fragment>fragment</a>
   component that is not null (even if it is empty), then <a href=#scroll-to-fragid id=navigating-across-documents:scroll-to-fragid>navigate to
   that fragment</a> and abort these steps.</li><li><p>If <var>gone async</var> is false, cancel any preexisting but not yet <a href=#concept-navigate-mature id=navigating-across-documents:concept-navigate-mature>mature</a> attempt to navigate <var>browsingContext</var>,
   including canceling any instances of the <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-fetch id=navigating-across-documents:concept-fetch data-x-internal=concept-fetch>fetch</a> algorithm
   started by those attempts. If one of those attempts has already created and <a href=#initialise-the-document-object id=navigating-across-documents:initialise-the-document-object>initialised a new <code>Document</code> object</a>,
   <a href=#abort-a-document id=navigating-across-documents:abort-a-document>abort</a> that <code id=navigating-across-documents:document><a href=dom.html#document>Document</a></code> also. (Navigation
   attempts that have <a href=#concept-navigate-mature id=navigating-across-documents:concept-navigate-mature-2>matured</a> already have session
   history entries, and are therefore handled during the <a href=#update-the-session-history-with-the-new-page id=navigating-across-documents:update-the-session-history-with-the-new-page>update the session history with the
   new page</a> algorithm, later.)</li><li><p>If <var>resource</var> is to be handled using a mechanism that does not affect
   <var>browsingContext</var>, e.g., ignoring the navigation request altogether because the
   specified scheme is not one of the supported protocols, then abort these steps and <a href=#hand-off-to-external-software id=navigating-across-documents:hand-off-to-external-software>proceed with that mechanism instead</a>.</li><li>

    <p>If <var>gone async</var> is false, <a href=#prompt-to-unload-a-document id=navigating-across-documents:prompt-to-unload-a-document-3>prompt
    to unload</a> the <code id=navigating-across-documents:document-2><a href=dom.html#document>Document</a></code> object. If the user <a href=#refused-to-allow-the-document-to-be-unloaded id=navigating-across-documents:refused-to-allow-the-document-to-be-unloaded>refused to allow the
    document to be unloaded</a>, then abort these steps.</p>

    <p>If this instance of the <a href=#navigate id=navigating-across-documents:navigate-3>navigation</a> algorithm gets canceled
    while this step is running, the <a href=#prompt-to-unload-a-document id=navigating-across-documents:prompt-to-unload-a-document-4>prompt to unload a document</a> algorithm must
    nonetheless be run to completion.</p>

   </li><li><p>If <var>gone async</var> is false, <a href=#abort-a-document id=navigating-across-documents:abort-a-document-2>abort</a>
   the <a href=#active-document id=navigating-across-documents:active-document-4>active document</a> of <var>browsingContext</var>.</li><li>

    <p>If <var>resource</var> is to be handled by displaying some sort of inline content, e.g., an
    error message because the specified scheme is not one of the supported protocols, or an inline
    prompt to allow the user to select <a href=webappapis.html#dom-navigator-registerprotocolhandler id=navigating-across-documents:dom-navigator-registerprotocolhandler>a
    registered handler</a> for the given scheme, then <a href=#read-ua-inline id=navigating-across-documents:read-ua-inline>display
    the inline content</a> and abort these steps.</p>

    <p class=note>In the case of a registered handler being used, the algorithm will be reinvoked
    with a new URL to handle the request.</p>

   </li><li>

    <p>If <var>browsingContext</var> is a <a href=#nested-browsing-context id=navigating-across-documents:nested-browsing-context>nested browsing context</a>, then put it in the
    <a href=#delaying-load-events-mode id=navigating-across-documents:delaying-load-events-mode>delaying <code>load</code> events mode</a>.</p>

    <p>The user agent must take this <a href=#nested-browsing-context id=navigating-across-documents:nested-browsing-context-2>nested browsing context</a> out of the <a href=#delaying-load-events-mode id=navigating-across-documents:delaying-load-events-mode-2>delaying
    <code>load</code> events mode</a> when this <a href=#navigate id=navigating-across-documents:navigate-4>navigation</a> algorithm later <a href=#concept-navigate-mature id=navigating-across-documents:concept-navigate-mature-3>matures</a>, or when it terminates (whether due to having
    run all the steps, or being canceled, or being aborted), whichever happens first.</p>

    

   </li><li>

    <p>This is the step that attempts to obtain <var>resource</var>, if necessary. Jump to the first
    appropriate substep:</p>

    <dl><dt>If <var>resource</var> has already been obtained (e.g., because it is being used to
     populate an <code id=navigating-across-documents:the-object-element><a href=embedded-content.html#the-object-element>object</a></code> element's new <a href=#child-browsing-context id=navigating-across-documents:child-browsing-context>child browsing context</a>)<dd><p>Skip this step. The data is already available.<dt>If <var>resource</var> is a <a id=navigating-across-documents:url-3 href=https://triple-underscore.github.io/URL-ja.html#concept-url data-x-internal=url>URL</a> whose <a href=https://triple-underscore.github.io/URL-ja.html#concept-url-scheme id=navigating-across-documents:concept-url-scheme data-x-internal=concept-url-scheme>scheme</a> is <code id=navigating-across-documents:javascript-protocol><a href=#javascript-protocol>javascript</a></code><dd>

      

      <p><a id=navigating-across-documents:queue-a-task href=webappapis.html#queue-a-task>Queue a task</a> to run <dfn id=javascript-protocol>these
      "<code>javascript:</code> URL" steps</dfn>, associated with the <a href=#active-document id=navigating-across-documents:active-document-5>active document</a>
      of <var>browsingContext</var>:</p>

      <ol id=concept-js-deref><li><p>If the <a href=#concept-origin id=navigating-across-documents:concept-origin-3>origin</a> of the <a href=#source-browsing-context id=navigating-across-documents:source-browsing-context-4>source browsing context</a> is not the
       <a href=#same-origin id=navigating-across-documents:same-origin-2>same origin</a> as the <a href=#concept-origin id=navigating-across-documents:concept-origin-4>origin</a> of the <a href=#active-document id=navigating-across-documents:active-document-6>active document</a> of
       <var>browsingContext</var>, then let <var>result</var> be undefined, and jump to the step
       labeled <i>process result</i> below.</li><li><p>Let <var>urlRecord</var> be the result of running the <a id=navigating-across-documents:url-parser-2 href=https://triple-underscore.github.io/URL-ja.html#concept-url-parser data-x-internal=url-parser>URL parser</a> on the
       <a id=navigating-across-documents:url-4 href=https://triple-underscore.github.io/URL-ja.html#concept-url data-x-internal=url>URL</a> of <var>resource</var>.</li><li><p>Let <var>script source</var> be the empty string.</li><li><p>Append the first string of <var>urlRecord</var>'s <a href=https://triple-underscore.github.io/URL-ja.html#concept-url-path id=navigating-across-documents:concept-url-path data-x-internal=concept-url-path>path</a> component to <var>script source</var>.</li><li><p>If <var>urlRecord</var>'s <a href=https://triple-underscore.github.io/URL-ja.html#concept-url-query id=navigating-across-documents:concept-url-query data-x-internal=concept-url-query>query</a> component is
       not null, then first append a U+003F QUESTION MARK character (?) to <var>script source</var>,
       and then append <var>urlRecord</var>'s <a href=https://triple-underscore.github.io/URL-ja.html#concept-url-query id=navigating-across-documents:concept-url-query-2 data-x-internal=concept-url-query>query</a>
       component to <var>script source</var>.</li><li><p>If <var>urlRecord</var>'s <a href=https://triple-underscore.github.io/URL-ja.html#concept-url-fragment id=navigating-across-documents:concept-url-fragment-3 data-x-internal=concept-url-fragment>fragment</a>
       component is not null, then first append a U+0023 NUMBER SIGN character (#) to <var>script
       source</var>, and then append <var>urlRecord</var>'s <a href=https://triple-underscore.github.io/URL-ja.html#concept-url-fragment id=navigating-across-documents:concept-url-fragment-4 data-x-internal=concept-url-fragment>fragment</a> component to <var>script source</var>.</li><li><p>Replace <var>script source</var> with the result of applying the
       <a id=navigating-across-documents:percent-decode href=https://triple-underscore.github.io/URL-ja.html#percent-decode data-x-internal=percent-decode>percent decode</a> algorithm to <var>script source</var>.</li><li><p>Replace <var>script source</var> with the result of applying the <a id=navigating-across-documents:utf-8-decode href=https://triple-underscore.github.io/Encoding-ja.html#utf-8-decode data-x-internal=utf-8-decode>UTF-8
       decode</a> algorithm to <var>script source</var>.</li><li><p>Let <var>address</var> be the <a href=https://triple-underscore.github.io/DOM4-ja.html#concept-document-url id="navigating-across-documents:the-document's-address-2" data-x-internal="the-document's-address">URL</a> of the
       <a href=#active-document id=navigating-across-documents:active-document-7>active document</a> of <var>browsingContext</var>.</li><li><p>Let <var>settings</var> be the <a id=navigating-across-documents:relevant-settings-object href=webappapis.html#relevant-settings-object>relevant settings object</a> for the
       <a href=#active-document id=navigating-across-documents:active-document-8>active document</a> of <var>browsingContext</var>.</li><li><p>Let <var>script</var> be the result of <a id=navigating-across-documents:creating-a-classic-script href=webappapis.html#creating-a-classic-script>creating a classic script</a> given
       <var>script source</var> and <var>settings</var>.</li><li><p>Let <var>result</var> be the result of <a href=webappapis.html#run-a-classic-script id=navigating-across-documents:run-a-classic-script>running the
       classic script</a> <var>script</var>. If evaluation was unsuccessful, let
       <var>result</var> be undefined instead. (The result will also be undefined if <a href=webappapis.html#concept-bc-noscript id=navigating-across-documents:concept-bc-noscript>scripting is disabled</a>.)</li><li>

        <p><i>Process result</i>: If <a href=https://tc39.github.io/ecma262/#sec-ecmascript-data-types-and-values id=navigating-across-documents:js-type data-x-internal=js-type>Type</a>(<var>result</var>) is not
        String, then the result of obtaining the resource for the URL is a <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-response id=navigating-across-documents:concept-response data-x-internal=concept-response>response</a> whose <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-response-status id=navigating-across-documents:concept-response-status data-x-internal=concept-response-status>status</a> is <code>204</code>.</p>

        <p>Otherwise, the result of obtaining the resource for the URL is a <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-response id=navigating-across-documents:concept-response-2 data-x-internal=concept-response>response</a> whose <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-response-header-list id=navigating-across-documents:concept-response-header-list data-x-internal=concept-response-header-list>header list</a> consists of <code>Content-Type</code>/<code id=navigating-across-documents:text/html><a href=iana.html#text/html>text/html</a></code>, whose <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-response-body id=navigating-across-documents:concept-response-body data-x-internal=concept-response-body>body</a> is <var>result</var>, and whose <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-response-https-state id=navigating-across-documents:concept-response-https-state data-x-internal=concept-response-https-state>HTTPS state</a> is <var>settings</var>'s
        <a id=navigating-across-documents:https-state href=webappapis.html#https-state>HTTPS state</a>.</p>

        <p class=warning>The exact conversion between the JavaScript string <var>result</var> and
        the bytes that comprise a <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-response-body id=navigating-across-documents:concept-response-body-2 data-x-internal=concept-response-body>response body</a> is
        not yet specified, pending further investigation into user agent behavior. See <a href=https://github.com/whatwg/html/issues/1129>issue #1129</a>.</p>

        <p><a href=#navigate id=navigating-across-documents:navigate-5>ナビゲーションアルゴリズム</a>で<a href="#set-the-document's-address" id="navigating-across-documents:set-the-document's-address">文書のアドレスを設定する</a>時間が来ると、<a href=#override-url id=navigating-across-documents:override-url>上書きURL</a>として<var>address</var>を使用する。</p>

       </li></ol>

      <p>The <a id=navigating-across-documents:task-source href=webappapis.html#task-source>task source</a> for this <a href=webappapis.html#concept-task id=navigating-across-documents:concept-task-4>task</a> is the
      <a id=navigating-across-documents:dom-manipulation-task-source href=webappapis.html#dom-manipulation-task-source>DOM manipulation task source</a>.</p>

      <div class=example>

       <p>So for example a <a href=#javascript-protocol id=navigating-across-documents:javascript-protocol-2><code>javascript:</code> URL</a> in
       an <code id=navigating-across-documents:attr-hyperlink-href><a href=semantics.html#attr-hyperlink-href>href</a></code> attribute of an <code id=navigating-across-documents:the-a-element><a href=semantics.html#the-a-element>a</a></code> element
       would only be evaluated when the link was <a href=semantics.html#following-hyperlinks-2 id=navigating-across-documents:following-hyperlinks-2-2>followed</a>, while such a URL in the <code id=navigating-across-documents:attr-iframe-src><a href=embedded-content.html#attr-iframe-src>src</a></code> attribute of an <code id=navigating-across-documents:the-iframe-element><a href=embedded-content.html#the-iframe-element>iframe</a></code> element would be
       evaluated in the context of the <code id=navigating-across-documents:the-iframe-element-2><a href=embedded-content.html#the-iframe-element>iframe</a></code>'s own <a href=#nested-browsing-context id=navigating-across-documents:nested-browsing-context-3>nested browsing
       context</a> when the <code id=navigating-across-documents:the-iframe-element-3><a href=embedded-content.html#the-iframe-element>iframe</a></code> is being set up; once evaluated, its return value
       (if it was not void) would replace that <a href=#browsing-context id=navigating-across-documents:browsing-context-2>browsing context</a>'s <code id=navigating-across-documents:document-3><a href=dom.html#document>Document</a></code>, thus also
       changing the <code id=navigating-across-documents:window><a href=#window>Window</a></code> object of that <a href=#browsing-context id=navigating-across-documents:browsing-context-3>browsing context</a>.</p>

      </div>

     <dt>If <var>resource</var> is to be fetched using `<code>GET</code>`, and there are
     <a href=#relevant-application-cache id=navigating-across-documents:relevant-application-cache>relevant application caches</a> that are
     identified by a URL with the <a href=#same-origin id=navigating-across-documents:same-origin-3>same origin</a> as the URL in question, and that have
     this URL as one of their entries, excluding entries marked as <a href=#concept-appcache-foreign id=navigating-across-documents:concept-appcache-foreign>foreign</a>, and whose <a href=#concept-appcache-mode id=navigating-across-documents:concept-appcache-mode>mode</a> is <a href=#concept-appcache-mode-fast id=navigating-across-documents:concept-appcache-mode-fast>fast</a>, and the user agent is not in a mode where it
     will avoid using <a href=#application-cache id=navigating-across-documents:application-cache>application caches</a><dd>

      <p>Fetch <var>resource</var> from the <a href=#concept-appcache-selection id=navigating-across-documents:concept-appcache-selection>most
      appropriate application cache</a> of those that match.</p>

      <p class=example>For example, imagine an HTML page with an associated application cache
      displaying an image and a form, where the image is also used by several other application
      caches. If the user right-clicks on the image and chooses "View Image", then the user agent
      could decide to show the image from any of those caches, but it is likely that the most useful
      cache for the user would be the one that was used for the aforementioned HTML page. On the
      other hand, if the user submits the form, and the form does a POST submission, then the user
      agent will not use an application cache at all; the submission will be made to the
      network.</p>

      <p class=XXX>This still needs to be integrated with the Fetch
      standard. <a href=references.html#refsFETCH>[FETCH]</a></p>

     <dt>そうでなければ<dd>

      <ol><li><p>Let <var>request</var> be <var>resource</var>.</li><li><p>If <var>request</var> is a <a id=navigating-across-documents:url-5 href=https://triple-underscore.github.io/URL-ja.html#concept-url data-x-internal=url>URL</a>, set <var>request</var> to a new <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-request id=navigating-across-documents:concept-request data-x-internal=concept-request>request</a> whose <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-request-url id=navigating-across-documents:concept-request-url data-x-internal=concept-request-url>url</a>
       is <var>request</var>.</li><li><p>Set <var>request</var>'s <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-request-client id=navigating-across-documents:concept-request-client data-x-internal=concept-request-client>client</a> to the
       <a href=#source-browsing-context id=navigating-across-documents:source-browsing-context-5>source browsing context</a>'s <a href=#active-document id=navigating-across-documents:active-document-9>active document</a>'s <a id=navigating-across-documents:relevant-settings-object-2 href=webappapis.html#relevant-settings-object>relevant settings
       object</a>, <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-request-target-browsing-context id=navigating-across-documents:concept-request-target-browsing-context data-x-internal=concept-request-target-browsing-context>target browsing
       context</a> to <var>browsingContext</var>, <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-request-destination id=navigating-across-documents:concept-request-destination data-x-internal=concept-request-destination>destination</a> to "<code>document</code>",
       <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-request-mode id=navigating-across-documents:concept-request-mode data-x-internal=concept-request-mode>mode</a> to "<code>navigate</code>", <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-request-credentials-mode id=navigating-across-documents:concept-request-credentials-mode data-x-internal=concept-request-credentials-mode>credentials mode</a> to "<code>include</code>", <a id=navigating-across-documents:use-url-credentials-flag href=https://triple-underscore.github.io/Fetch-ja.html#concept-request-use-url-credentials-flag data-x-internal=use-url-credentials-flag>use-URL-credentials flag</a>, and <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-request-redirect-mode id=navigating-across-documents:concept-request-redirect-mode data-x-internal=concept-request-redirect-mode>redirect mode</a> to "<code>manual</code>".</li><li><p>Set <var>request</var>'s <a id=navigating-across-documents:omit-origin-header-flag href=https://triple-underscore.github.io/Fetch-ja.html#omit-origin-header-flag data-x-internal=omit-origin-header-flag>omit-<code>Origin</code>-header flag</a>.

       

       </li><li><p>If <var>request</var>'s <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-request-method id=navigating-across-documents:concept-request-method data-x-internal=concept-request-method>method</a> is not
       `<code>GET</code>`, or, if the <a href=#navigate id=navigating-across-documents:navigate-6>navigation algorithm</a>
       was invoked as a result of the <a href=forms.html#concept-form-submit id=navigating-across-documents:concept-form-submit-2>form submission
       algorithm</a>, then if there is an <a href=#concept-origin id=navigating-across-documents:concept-origin-5>origin</a> of the <a href=#active-document id=navigating-across-documents:active-document-10>active document</a>
       of the <a href=#source-browsing-context id=navigating-across-documents:source-browsing-context-6>source browsing context</a>, unset <var>request</var>'s
       <a id=navigating-across-documents:omit-origin-header-flag-2 href=https://triple-underscore.github.io/Fetch-ja.html#omit-origin-header-flag data-x-internal=omit-origin-header-flag>omit-<code>Origin</code>-header flag</a>.</li><li><p>Otherwise, if <var>browsingContext</var> is a <a href=#child-browsing-context id=navigating-across-documents:child-browsing-context-2>child browsing context</a>, and
       the <a href=#browsing-context-container id=navigating-across-documents:browsing-context-container>browsing context container</a> of <var>browsingContext</var> has a
       <a href=#browsing-context-scope-origin id=navigating-across-documents:browsing-context-scope-origin>browsing context scope origin</a>, set <var>request</var>'s <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-request-origin id=navigating-across-documents:concept-request-origin data-x-internal=concept-request-origin>origin</a> to that <a href=#browsing-context-scope-origin id=navigating-across-documents:browsing-context-scope-origin-2>browsing context scope
       origin</a> and unset <var>request</var>'s <a id=navigating-across-documents:omit-origin-header-flag-3 href=https://triple-underscore.github.io/Fetch-ja.html#omit-origin-header-flag data-x-internal=omit-origin-header-flag>omit-<code>Origin</code>-header
       flag</a>.</li><li><p><a href=https://triple-underscore.github.io/Fetch-ja.html#concept-fetch id=navigating-across-documents:concept-fetch-2 data-x-internal=concept-fetch>Fetch</a> <var>request</var>.</li></ol>

     </dl>

   </li><li>

    

    <p>If <var>gone async</var> is false, return to whatever algorithm invoked the
    navigation steps and continue running these steps <a id=navigating-across-documents:in-parallel-3 href=infrastructure.html#in-parallel>in parallel</a>.</p>

   </li><li><p>Let <var>gone async</var> be true.</li><li><p>Wait for one or more bytes to be available or for the user agent to establish that the
   resource in question is empty. During this time, the user agent may allow the user to cancel this
   navigation attempt or start other navigation attempts.</li><li id=navigate-redirect-step>

    <p><i>Handle redirects</i>: If fetching the resource results in a redirect, then return to <a href=#navigate-fragid-step>the step labeled <i>fragments</i></a> with the new resource, except
    that if the <a id=navigating-across-documents:url-6 href=https://triple-underscore.github.io/URL-ja.html#concept-url data-x-internal=url>URL</a> of the target of the redirect does not have a <a href=https://triple-underscore.github.io/URL-ja.html#concept-url-fragment id=navigating-across-documents:concept-url-fragment-5 data-x-internal=concept-url-fragment>fragment</a> and the <a id=navigating-across-documents:url-7 href=https://triple-underscore.github.io/URL-ja.html#concept-url data-x-internal=url>URL</a> of the resource that led
    to the redirect does, then the <a href=https://triple-underscore.github.io/URL-ja.html#concept-url-fragment id=navigating-across-documents:concept-url-fragment-6 data-x-internal=concept-url-fragment>fragment</a> of the
    resource that led to the redirect must be propagated to the <a id=navigating-across-documents:url-8 href=https://triple-underscore.github.io/URL-ja.html#concept-url data-x-internal=url>URL</a> of the target of
    the redirect.</p>

    <p class=example>So for instance, if the original URL was "<code>http://example.com/#!sample</code>" and "<code>http://example.com/</code>" is
    found to redirect to "<code>https://example.com/</code>", the URL of the new resource
    will be "<code>https://example.com/#!sample</code>".</p>

   </li><li>

    <p><strong>Fallback in prefer-online mode</strong>: If the resource was not fetched from an
    <a href=#application-cache id=navigating-across-documents:application-cache-2>application cache</a>, and was to be fetched using `<code>GET</code>`, and
    there are <a href=#relevant-application-cache id=navigating-across-documents:relevant-application-cache-2>relevant application caches</a> that are
    identified by a URL with the <a href=#same-origin id=navigating-across-documents:same-origin-4>same origin</a> as the URL in question, and that have this
    URL as one of their entries, excluding entries marked as <a href=#concept-appcache-foreign id=navigating-across-documents:concept-appcache-foreign-2>foreign</a>, and whose <a href=#concept-appcache-mode id=navigating-across-documents:concept-appcache-mode-2>mode</a> is <a href=#concept-appcache-mode-prefer-online id=navigating-across-documents:concept-appcache-mode-prefer-online>prefer-online</a>, and the user didn't cancel the
    navigation attempt during the earlier step, and the navigation attempt failed (e.g. the server
    returned a 4xx or 5xx status, or there was a DNS error), then:</p>

    <p>Let <var>candidate</var> be the resource identified by the URL in question from the
    <a href=#concept-appcache-selection id=navigating-across-documents:concept-appcache-selection-2>most appropriate application cache</a> of those that
    match.</p> 

    <p>If <var>candidate</var> is not marked as <a href=#concept-appcache-foreign id=navigating-across-documents:concept-appcache-foreign-3>foreign</a>, then the user agent must discard the failed
    load and instead continue along these steps using <var>candidate</var> as the resource.
    The user agent may indicate to the user that the original page load failed, and that the page
    used was a previously cached resource.</p>

    <p class=note>This does not affect the <i>address of the resource from which Request-URIs are
    obtained</i>, as used to set <a id="navigating-across-documents:the-document's-referrer" href="dom.html#the-document's-referrer">the document's referrer</a> in the <a href=#initialise-the-document-object id=navigating-across-documents:initialise-the-document-object-2>initialise the
    <code>Document</code> object</a> steps below; they still use the value as computed by the
    original fetch algorithm.</p>

   </li><li>

    <p><strong>Fallback for fallback entries</strong>: If the resource was not fetched from an
    <a href=#application-cache id=navigating-across-documents:application-cache-3>application cache</a>, and was to be fetched using `<code>GET</code>`, and
    its URL <a href=#concept-appcache-matches-fallback id=navigating-across-documents:concept-appcache-matches-fallback>matches the fallback namespace</a>
    of one or more <a href=#relevant-application-cache id=navigating-across-documents:relevant-application-cache-3>relevant application caches</a>, and
    the <a href=#concept-appcache-selection id=navigating-across-documents:concept-appcache-selection-3>most appropriate application cache</a> of those
    that match does not have an entry in its <a href=#concept-appcache-onlinesafelist id=navigating-across-documents:concept-appcache-onlinesafelist>online
    safelist</a> that has the <a href=#same-origin id=navigating-across-documents:same-origin-5>same origin</a> as the resource's URL and that is a
    <a id=navigating-across-documents:prefix-match href=infrastructure.html#prefix-match>prefix match</a> for the resource's URL, and the user didn't cancel the navigation
    attempt during the earlier step, and the navigation attempt failed (e.g. the server returned a
    4xx or 5xx status, or there was a DNS error), then:</p> 

    <p>Let <var>candidate</var> be the <a href=#concept-appcache-fallback id=navigating-across-documents:concept-appcache-fallback>fallback
    resource</a> specified for the <a href=#concept-appcache-fallback-ns id=navigating-across-documents:concept-appcache-fallback-ns>fallback
    namespace</a> in question. If multiple application caches match, the user agent must use the
    fallback of the <a href=#concept-appcache-selection id=navigating-across-documents:concept-appcache-selection-4>most appropriate application
    cache</a> of those that match.</p>

    <p>If <var>candidate</var> is not marked as <a href=#concept-appcache-foreign id=navigating-across-documents:concept-appcache-foreign-4>foreign</a>, then the user agent must discard the failed
    load and instead continue along these steps using <var>candidate</var> as the resource. The
    document's <a href=https://triple-underscore.github.io/DOM4-ja.html#concept-document-url id="navigating-across-documents:the-document's-address-3" data-x-internal="the-document's-address">URL</a>, if appropriate, will still be the
    originally requested URL, not the fallback URL, but the user agent may indicate to the user that
    the original page load failed, that the page used was a fallback resource, and what the URL of
    the fallback resource actually is.</p>

    <p class=note>This does not affect the <i>address of the resource from which Request-URIs are
    obtained</i>, as used to set <a id="navigating-across-documents:the-document's-referrer-2" href="dom.html#the-document's-referrer">the document's referrer</a> in the <a href=#initialise-the-document-object id=navigating-across-documents:initialise-the-document-object-3>initialise the
    <code>Document</code> object</a> steps below; they still use the value as computed by the
    original fetch algorithm.</p>

   </li><li>

    <p><i>Resource handling</i>: If the resource's out-of-band metadata (e.g. HTTP headers), not
    counting any <a href=infrastructure.html#content-type id=navigating-across-documents:content-type>type information</a> (such as the Content-Type HTTP
    header), requires some sort of processing that will not affect <var>browsingContext</var>, then
    perform that processing and abort these steps.</p>

    <div class=note>
     <p>Such processing might be triggered by, amongst other things, the following:</p>
     <ul class=brief><li>HTTP status codes (e.g. 204 No Content or 205 Reset Content)</li><li>Network errors (e.g. the network interface being unavailable)</li><li>Cryptographic protocol failures (e.g. an incorrect TLS certificate)</li></ul>
    </div>

    <p>Responses with HTTP `<code id=navigating-across-documents:http-content-disposition><a data-x-internal=http-content-disposition href=https://tools.ietf.org/html/rfc6266>Content-Disposition</a></code>`
    headers specifying the <code>attachment</code> disposition type must be handled
    <a id=navigating-across-documents:as-a-download href=semantics.html#as-a-download>as a download</a>.</p>

    

    <p>HTTP 401 responses that do not include a challenge recognised by the user agent must be
    processed as if they had no challenge, e.g. rendering the entity body as if the response had
    been 200 OK.</p>

    <p>User agents may show the entity body of an HTTP 401 response even when the response does
    include a recognised challenge, with the option to login being included in a non-modal fashion,
    to enable the information provided by the server to be used by the user before authenticating.
    Similarly, user agents should allow the user to authenticate (in a non-modal fashion) against
    authentication challenges included in other responses such as HTTP 200 OK responses, effectively
    allowing resources to present HTTP login forms without requiring their use.</p>

   </li><li><p>Let <var>type</var> be the <a href=https://mimesniff.spec.whatwg.org/#computed-mime-type id=navigating-across-documents:content-type-sniffing-2 data-x-internal=content-type-sniffing-2>computed type of
   the resource</a>.</li><li><p>If the user agent has been configured to process resources of the given <var>type</var> using some mechanism other than rendering the content in a <a href=#browsing-context id=navigating-across-documents:browsing-context-4>browsing
   context</a>, then skip this step. Otherwise, if the <var>type</var> is one of the
   following types, jump to the appropriate entry in the following list, and process the resource as
   described there:</p>

    <dl class=switch><dt>an <a id=navigating-across-documents:html-mime-type href=infrastructure.html#html-mime-type>HTML MIME type</a><dd>Follow the steps given in the <a href=#read-html id=navigating-across-documents:read-html>HTML document</a> section,
     and then, once they have completed, abort this <a href=#navigate id=navigating-across-documents:navigate-7>navigate</a> algorithm.<dt>an <a id=navigating-across-documents:xml-mime-type href=infrastructure.html#xml-mime-type>XML MIME type</a> that is not an <a href=#explicitly-supported-xml-type id=navigating-across-documents:explicitly-supported-xml-type>explicitly supported XML
     type</a><dd>Follow the steps given in the <a href=#read-xml id=navigating-across-documents:read-xml>XML document</a> section. If
     that section determines that the content is <em>not</em> to be displayed as a generic XML
     document, then proceed to the next step in this overall set of steps. Otherwise, once the steps
     given in the <a href=#read-xml id=navigating-across-documents:read-xml-2>XML document</a> section have completed, abort this
     <a href=#navigate id=navigating-across-documents:navigate-8>navigate</a> algorithm.<dt>a <a id=navigating-across-documents:javascript-mime-type href=scripting.html#javascript-mime-type>JavaScript MIME type</a><dt>a <a href=#json-mime-type id=navigating-across-documents:json-mime-type>JSON MIME type</a> that is not an <a href=#explicitly-supported-json-type id=navigating-across-documents:explicitly-supported-json-type>explicitly supported JSON
     type</a><dt>"<code id=navigating-across-documents:text/cache-manifest><a href=iana.html#text/cache-manifest>text/cache-manifest</a></code>"<dt>"<code id=navigating-across-documents:text/css><a href=indices.html#text/css>text/css</a></code>"<dt>"<code id=navigating-across-documents:text/plain><a data-x-internal=text/plain href=https://tools.ietf.org/html/rfc2046#section-4.1.3>text/plain</a></code>"<dt>"<code id=navigating-across-documents:text/vtt><a href=indices.html#text/vtt>text/vtt</a></code>"<dd>Follow the steps given in the <a href=#read-text id=navigating-across-documents:read-text>plain text file</a> section,
     and then, once they have completed, abort this <a href=#navigate id=navigating-across-documents:navigate-9>navigate</a> algorithm.<dt>"<code id=navigating-across-documents:multipart/x-mixed-replace><a href=iana.html#multipart/x-mixed-replace>multipart/x-mixed-replace</a></code>"<dd>Follow the steps given in the <a href=#read-multipart-x-mixed-replace id=navigating-across-documents:read-multipart-x-mixed-replace>multipart/x-mixed-replace</a> section, and then,
     once they have completed, abort this <a href=#navigate id=navigating-across-documents:navigate-10>navigate</a> algorithm.<dt>A supported image, video, or audio type<dd>Follow the steps given in the <a href=#read-media id=navigating-across-documents:read-media>media</a> section, and then,
     once they have completed, abort this <a href=#navigate id=navigating-across-documents:navigate-11>navigate</a> algorithm.<dt>A type that will use an external application to render the content in
     <var>browsingContext</var><dd>Follow the steps given in the <a href=#read-plugin id=navigating-across-documents:read-plugin>plugin</a> section, and then,
     once they have completed, abort this <a href=#navigate id=navigating-across-documents:navigate-12>navigate</a> algorithm.</dl>

    <p>An <dfn id=explicitly-supported-xml-type>explicitly supported XML type</dfn> is one for which the user agent is configured to
    use an external application to render the content (either a <a id=navigating-across-documents:plugin href=infrastructure.html#plugin>plugin</a> rendering
    directly in <var>browsingContext</var>, or a separate application), or one for which the user
    agent has dedicated processing rules (e.g. a Web browser with a built-in Atom feed viewer would
    be said to explicitly support the <code id=navigating-across-documents:application/atom+xml><a href=indices.html#application/atom+xml>application/atom+xml</a></code> MIME type), or one for which
    the user agent has a dedicated handler (e.g. one registered using <code id=navigating-across-documents:dom-navigator-registercontenthandler><a href=webappapis.html#dom-navigator-registercontenthandler>registerContentHandler()</a></code>).</p>

    <p>The term <dfn id=json-mime-type>JSON MIME type</dfn> is used to refer to the <a href=infrastructure.html#mime-type id=navigating-across-documents:mime-type>MIME
    types</a> <code id=navigating-across-documents:application/json><a href=indices.html#application/json>application/json</a></code>, <code id=navigating-across-documents:text/json><a href=indices.html#text/json>text/json</a></code>, and any <a id=navigating-across-documents:mime-type-2 href=infrastructure.html#mime-type>MIME
    type</a> whose subtype ends with the five characters "<code>+json</code>".

    

    <p>An <dfn id=explicitly-supported-json-type>explicitly supported JSON type</dfn> is one for which the user agent is configured to
    use an external application to render the content (either a <a id=navigating-across-documents:plugin-2 href=infrastructure.html#plugin>plugin</a> rendering
    directly in <var>browsingContext</var>, or a separate application), or one for which the user
    agent has dedicated processing rules, or one for which the user agent has a dedicated handler
    (e.g. one registered using <code id=navigating-across-documents:dom-navigator-registercontenthandler-2><a href=webappapis.html#dom-navigator-registercontenthandler>registerContentHandler()</a></code>).</p>

    <p><dfn id="set-the-document's-address">Setting the document's address</dfn>: If there is no
    <dfn id=override-url>override URL</dfn>, then any <code id=navigating-across-documents:document-4><a href=dom.html#document>Document</a></code> created by these steps must have its
    <a href=https://triple-underscore.github.io/DOM4-ja.html#concept-document-url id="navigating-across-documents:the-document's-address-4" data-x-internal="the-document's-address">URL</a> set to the <a id=navigating-across-documents:url-9 href=https://triple-underscore.github.io/URL-ja.html#concept-url data-x-internal=url>URL</a> that was
    originally to be fetched, ignoring any other data that was used to obtain the resource. However,
    if there <em>is</em> an <a href=#override-url id=navigating-across-documents:override-url-2>override URL</a>, then any <code id=navigating-across-documents:document-5><a href=dom.html#document>Document</a></code> created by
    these steps must have its <a href=https://triple-underscore.github.io/DOM4-ja.html#concept-document-url id="navigating-across-documents:the-document's-address-5" data-x-internal="the-document's-address">URL</a> set to that
    <a id=navigating-across-documents:url-10 href=https://triple-underscore.github.io/URL-ja.html#concept-url data-x-internal=url>URL</a> instead.</p>

    <p class=note>An <a href=#override-url id=navigating-across-documents:override-url-3>override URL</a> is set when <a href=#javascript-protocol id=navigating-across-documents:javascript-protocol-3>dereferencing a <code>javascript:</code> URL</a> and when
    performing <a id=navigating-across-documents:an-overridden-reload href=dom.html#an-overridden-reload>an overridden reload</a>.</p>

    <p><dfn id=initialise-the-document-object>Initialising a new <code>Document</code>
    object</dfn>: when a <code id=navigating-across-documents:document-6><a href=dom.html#document>Document</a></code> is created as part of the above steps, the user agent
    will be required to additionally run the following algorithm after creating the new object:</p>

    <ol><li>
      <p>If <var>browsingContext</var>'s only entry in its <a href=#session-history id=navigating-across-documents:session-history>session history</a> is the
      <code id=navigating-across-documents:about:blank><a href=infrastructure.html#about:blank>about:blank</a></code> <code id=navigating-across-documents:document-7><a href=dom.html#document>Document</a></code> that was added when <var>browsingContext</var>
      was <a href=#creating-a-new-browsing-context id=navigating-across-documents:creating-a-new-browsing-context>created</a>, and navigation is occurring
      with <a href=#replacement-enabled id=navigating-across-documents:replacement-enabled>replacement enabled</a>, and that <code id=navigating-across-documents:document-8><a href=dom.html#document>Document</a></code> has the <a href=#same-origin id=navigating-across-documents:same-origin-6>same
      origin</a> as the new <code id=navigating-across-documents:document-9><a href=dom.html#document>Document</a></code>, then</p>

      <ol><li><p>Let <var>window</var> be the <code id=navigating-across-documents:window-2><a href=#window>Window</a></code> object of that
       <code id=navigating-across-documents:document-10><a href=dom.html#document>Document</a></code>.</li><li><p>Change the <code id=navigating-across-documents:dom-document-2><a href=#dom-document-2>document</a></code>
       attribute of <var>window</var> to point to the new <code id=navigating-across-documents:document-11><a href=dom.html#document>Document</a></code>.</li></ol>
     </li><li>
      <p>Otherwise,</p>

      <ol><li>
        <p>Call the JavaScript <a href=https://tc39.github.io/ecma262/#sec-initializehostdefinedrealm id=navigating-across-documents:js-initializehostdefinedrealm data-x-internal=js-initializehostdefinedrealm>InitializeHostDefinedRealm()</a> abstract operation
        with the following customizations:</p>

        <ul><li><p>For the global object, create a new <code id=navigating-across-documents:window-3><a href=#window>Window</a></code> object
         <var>window</var>.</li><li><p>For the global <b>this</b> value, use <var>browsingContext</var>'s
         <code id=navigating-across-documents:windowproxy><a href=#windowproxy>WindowProxy</a></code> object.</li><li><p>Let <var>realm execution context</var> be the created <a id=navigating-across-documents:javascript-execution-context href=https://tc39.github.io/ecma262/#sec-execution-contexts data-x-internal=javascript-execution-context>JavaScript execution
         context</a>.</li><li><p>Do not obtain any source texts for scripts or modules.</li></ul>
       </li><li><p><a href=#set-up-a-browsing-context-environment-settings-object id=navigating-across-documents:set-up-a-browsing-context-environment-settings-object>Set up a browsing context environment settings object</a> with <var>realm
       execution context</var>, and let <var>settings object</var> be the result.</li><li><p>Set <var>window</var>'s <a href=#concept-document-window id=navigating-across-documents:concept-document-window>associated
       <code>Document</code></a> to the new <code id=navigating-across-documents:document-12><a href=dom.html#document>Document</a></code>.</li></ol>
     </li><li><p>Set <var>browsingContext</var>'s <code id=navigating-across-documents:windowproxy-2><a href=#windowproxy>WindowProxy</a></code> object's [[<a href=#concept-windowproxy-window id=navigating-across-documents:concept-windowproxy-window>Window</a>]] internal slot value to
     <var>window</var>.</li><li><p>Set the <code id=navigating-across-documents:document-13><a href=dom.html#document>Document</a></code>'s <a href=dom.html#concept-document-https-state id=navigating-across-documents:concept-document-https-state>HTTPS
     state</a> to the <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-response-https-state id=navigating-across-documents:concept-response-https-state-2 data-x-internal=concept-response-https-state>HTTPS state</a> of the
     resource used to generate the document.</li><li><p>Execute the <a id="navigating-across-documents:initialize-a-document's-csp-list" href=https://hashedhyphen.github.io/webappsec-specjp/csp/#initialize-document-csp data-x-internal="initialize-a-document's-csp-list">Initialize a <code>Document</code>'s CSP list</a>
     algorithm on the <code id=navigating-across-documents:document-14><a href=dom.html#document>Document</a></code> object and the resource used to generate the document.
     <a href=references.html#refsCSP>[CSP]</a></p>

     </li><li><p>Set <a id="navigating-across-documents:the-document's-referrer-3" href="dom.html#the-document's-referrer">the document's referrer</a> to the <i>address of the resource from which
     Request-URIs are obtained</i> as determined when the fetch algorithm obtained the resource, if
     that algorithm was used and determined such a value; otherwise, set it to the empty
     string.</li><li><p><a href=#implement-the-sandboxing id=navigating-across-documents:implement-the-sandboxing>Implement the sandboxing</a> for the <code id=navigating-across-documents:document-15><a href=dom.html#document>Document</a></code>.</li><li id=fullscreen-logic>

      <p>If the <a href=#active-sandboxing-flag-set id=navigating-across-documents:active-sandboxing-flag-set>active sandboxing flag set</a> of the <code id=navigating-across-documents:document-16><a href=dom.html#document>Document</a></code>'s
      <a href=#concept-document-bc id=navigating-across-documents:concept-document-bc>browsing context</a> or any of its <a href=#ancestor-browsing-context id=navigating-across-documents:ancestor-browsing-context>ancestor browsing contexts</a> (if any) have the
      <a href=#sandboxed-fullscreen-browsing-context-flag id=navigating-across-documents:sandboxed-fullscreen-browsing-context-flag>sandboxed fullscreen browsing context flag</a> set, then skip this step.</p>

      <p>If the <code id=navigating-across-documents:document-17><a href=dom.html#document>Document</a></code>'s <a href=#concept-document-bc id=navigating-across-documents:concept-document-bc-2>browsing context</a>
      has a <a href=#browsing-context-container id=navigating-across-documents:browsing-context-container-2>browsing context container</a> and either it is not an <code id=navigating-across-documents:the-iframe-element-4><a href=embedded-content.html#the-iframe-element>iframe</a></code>
      element, or it does not have the <code id=navigating-across-documents:attr-iframe-allowfullscreen><a href=embedded-content.html#attr-iframe-allowfullscreen>allowfullscreen</a></code> attribute specified, or its
      <code id=navigating-across-documents:document-18><a href=dom.html#document>Document</a></code> does not have the <a id=navigating-across-documents:fullscreen-enabled-flag href=https://fullscreen.spec.whatwg.org/#fullscreen-enabled-flag data-x-internal=fullscreen-enabled-flag>fullscreen enabled flag</a> set, then also
      skip this step.</p>

      <p>Otherwise, set the <code id=navigating-across-documents:document-19><a href=dom.html#document>Document</a></code>'s <a id=navigating-across-documents:fullscreen-enabled-flag-2 href=https://fullscreen.spec.whatwg.org/#fullscreen-enabled-flag data-x-internal=fullscreen-enabled-flag>fullscreen enabled flag</a>.</p>

    </li></ol>

   </li><li id=navigate-non-Document>

    <p><i>Non-document content</i>: If, given <var>type</var>, the new resource is to be
    handled by displaying some sort of inline content, e.g. a native rendering of the content, an
    error message because the specified type is not supported, or an inline prompt to allow the user
    to select <a href=webappapis.html#dom-navigator-registercontenthandler id=navigating-across-documents:dom-navigator-registercontenthandler-3>a registered handler</a> for
    the given type, then <a href=#read-ua-inline id=navigating-across-documents:read-ua-inline-2>display the inline content</a>, and
    then abort these steps.</p>

    <p class=note>In the case of a registered handler being used, the algorithm will be reinvoked
    with a new URL to handle the request.</p>

   </li><li><p>Otherwise, the document's <var>type</var> is such that the resource will not affect
   <var>browsingContext</var>, e.g., because the resource is to be handed to an external application
   or because it is an unknown type that will be processed <a id=navigating-across-documents:as-a-download-2 href=semantics.html#as-a-download>as a download</a>. <a href=#hand-off-to-external-software id=navigating-across-documents:hand-off-to-external-software-2>Process the resource appropriately</a>.</p>

  </li></ol>

  <p>When a resource is handled by <dfn id=hand-off-to-external-software>passing its URL or
  data to an external software package</dfn> separate from the user agent (e.g. handing a <code id=navigating-across-documents:mailto-protocol><a data-x-internal=mailto-protocol href=https://tools.ietf.org/html/rfc6068#section-2>mailto:</a></code> URL to a mail client, or a Word document to a word
  processor), user agents should attempt to mitigate the risk that this is an attempt to exploit the
  target software, e.g. by prompting the user to confirm that the <a href=#source-browsing-context id=navigating-across-documents:source-browsing-context-7>source browsing
  context</a>'s <a href=#active-document id=navigating-across-documents:active-document-11>active document</a>'s <a href=#concept-origin id=navigating-across-documents:concept-origin-6>origin</a> is to be allowed to invoke the
  specified software. In particular, if the <a href=#navigate id=navigating-across-documents:navigate-13>navigate</a> algorithm, when it was invoked,
  was not <a href=#allowed-to-show-a-popup id=navigating-across-documents:allowed-to-show-a-popup>allowed to show a popup</a>, the user agent should not invoke the external
  software package without prior user confirmation.</p>

  <p class=example>For example, there could be a vulnerability in the target software's URL
  handler which a hostile page would attempt to exploit by tricking a user into clicking a link.</p>

  <hr>

  <p>Some of the sections below, to which the above algorithm defers in certain cases, require the
  user agent to <dfn id=update-the-session-history-with-the-new-page>update the session history with the new page</dfn>. When a user agent is
  required to do this, it must <a id=navigating-across-documents:queue-a-task-2 href=webappapis.html#queue-a-task>queue a task</a> (associated with the <code id=navigating-across-documents:document-20><a href=dom.html#document>Document</a></code>
  object of the <a href=#current-entry id=navigating-across-documents:current-entry>current entry</a>, not the new one) to run the following steps:</p>

  <ol><li>

    <p><a href=#unload-a-document id=navigating-across-documents:unload-a-document-4>Unload</a> the <code id=navigating-across-documents:document-21><a href=dom.html#document>Document</a></code> object of the
    <a href=#current-entry id=navigating-across-documents:current-entry-2>current entry</a>, with the <var>recycle</var> parameter set to false.</p>

    <p>If this instance of the <a href=#navigate id=navigating-across-documents:navigate-14>navigation</a> algorithm is canceled while
    this step is running the <a href=#unload-a-document id=navigating-across-documents:unload-a-document-5>unload a document</a> algorithm, then the <a href=#unload-a-document id=navigating-across-documents:unload-a-document-6>unload a
    document</a> algorithm must be allowed to run to completion, but this instance of the <a href=#navigate id=navigating-across-documents:navigate-15>navigation</a> algorithm must not run beyond this step. (In particular, for
    instance, the cancelation of this algorithm does not abort any event dispatch or script
    execution occurring as part of unloading the document or its descendants.)</p>

   </li><li>

    <dl><dt>If the navigation was initiated for <dfn id=entry-update>entry update</dfn> of an entry<dd>

      <ol><li><p>Replace the <code id=navigating-across-documents:document-22><a href=dom.html#document>Document</a></code> of the entry being updated, and any other entries
       that referenced the same document as that entry, with the new <code id=navigating-across-documents:document-23><a href=dom.html#document>Document</a></code>.</li><li><p><a href=#traverse-the-history id=navigating-across-documents:traverse-the-history>Traverse the history</a> to the new entry.</li></ol>

      <p class=note>This can only happen if the entry being updated is not the <a href=#current-entry id=navigating-across-documents:current-entry-3>current
      entry</a>, and can never happen with <a href=#replacement-enabled id=navigating-across-documents:replacement-enabled-2>replacement enabled</a>. (It happens when the
      user tried to traverse to a session history entry that no longer had a <code id=navigating-across-documents:document-24><a href=dom.html#document>Document</a></code>
      object.)</p>

     <dt>そうでなければ<dd>

      <ol><li>

        <p>Remove all the entries in the <a href=#browsing-context id=navigating-across-documents:browsing-context-5>browsing context</a>'s <a href=#session-history id=navigating-across-documents:session-history-2>session
        history</a> after the <a href=#current-entry id=navigating-across-documents:current-entry-4>current entry</a>. If the <a href=#current-entry id=navigating-across-documents:current-entry-5>current entry</a> is
        the last entry in the session history, then no entries are removed.</p>

        <p class=note>This <a href=#history-notes>doesn't necessarily have to affect</a> the
        user agent's user interface.</p>

       </li><li><p>Append a new entry at the end of the <code id=navigating-across-documents:history-3><a href=#history-3>History</a></code> object representing the new
       resource and its <code id=navigating-across-documents:document-25><a href=dom.html#document>Document</a></code> object, related state, and the default <a href=#scroll-restoration-mode id=navigating-across-documents:scroll-restoration-mode>scroll
       restoration mode</a> of "<code id=navigating-across-documents:dom-scrollrestoration-auto><a href=#dom-scrollrestoration-auto>auto</a></code>".</li><li><p><a href=#traverse-the-history id=navigating-across-documents:traverse-the-history-2>Traverse the history</a> to the new entry. If the navigation was initiated
       with <a href=#replacement-enabled id=navigating-across-documents:replacement-enabled-3>replacement enabled</a>, then the traversal must itself be initiated with
       <a href=#replacement-enabled id=navigating-across-documents:replacement-enabled-4>replacement enabled</a>.</p>

       </li></ol>

     </dl>

   </li><li><p>The <a href=#navigate id=navigating-across-documents:navigate-16>navigation algorithm</a> has now <dfn id=concept-navigate-mature>matured</dfn>.</li><li><p><i>Fragment loop</i>: <a id=navigating-across-documents:spin-the-event-loop href=webappapis.html#spin-the-event-loop>Spin the event loop</a> for a user-agent-defined amount of
   time, as desired by the user agent implementor. (This is intended to allow the user agent to
   optimise the user experience in the face of performance concerns.)</li><li><p>If the <code id=navigating-across-documents:document-26><a href=dom.html#document>Document</a></code> object has no parser, or its parser has <a href=syntax.html#stop-parsing id=navigating-across-documents:stop-parsing>stopped parsing</a>, or the user agent has reason to believe the user is no longer
   interested in scrolling to the <a href=https://triple-underscore.github.io/URL-ja.html#concept-url-fragment id=navigating-across-documents:concept-url-fragment-7 data-x-internal=concept-url-fragment>fragment</a>, then abort
   these steps.</li><li><p><a href=#scroll-to-the-fragment-identifier id=navigating-across-documents:scroll-to-the-fragment-identifier>Scroll to the fragment</a> given in the document's <a href=https://triple-underscore.github.io/DOM4-ja.html#concept-document-url id="navigating-across-documents:the-document's-address-6" data-x-internal="the-document's-address">URL</a>. If this fails to find <a href=#the-indicated-part-of-the-document id=navigating-across-documents:the-indicated-part-of-the-document>an indicated part of the document</a>, then return to the <i>fragment
   loop</i> step.</li></ol>

  <p>The <a id=navigating-across-documents:task-source-2 href=webappapis.html#task-source>task source</a> for this <a href=webappapis.html#concept-task id=navigating-across-documents:concept-task-5>task</a> is the
  <a id=navigating-across-documents:networking-task-source href=webappapis.html#networking-task-source>networking task source</a>.</p>


  <h4 id=read-html>7.8.2 <dfn>Page load processing model for HTML files</dfn></h4>

  <p>When an HTML document is to be loaded in a <a href=#browsing-context id=read-html:browsing-context>browsing context</a>, the user agent must
  <a id=read-html:queue-a-task href=webappapis.html#queue-a-task>queue a task</a> to create a <code id=read-html:document><a href=dom.html#document>Document</a></code> object, mark it as being an <a href=https://triple-underscore.github.io/DOM4-ja.html#html-document id=read-html:html-documents data-x-internal=html-documents>HTML document</a>, set its <a href=https://triple-underscore.github.io/DOM4-ja.html#concept-document-content-type id=read-html:concept-document-content-type data-x-internal=concept-document-content-type>content type</a> to "<code>text/html</code>",
  <a href=#initialise-the-document-object id=read-html:initialise-the-document-object>initialise the <code>Document</code> object</a>, and finally create an <a id=read-html:html-parser href=syntax.html#html-parser>HTML
  parser</a> and associate it with the <code id=read-html:document-2><a href=dom.html#document>Document</a></code>. Each <a href=webappapis.html#concept-task id=read-html:concept-task>task</a> that the <a id=read-html:networking-task-source href=webappapis.html#networking-task-source>networking task source</a> places on the
  <a id=read-html:task-queue href=webappapis.html#task-queue>task queue</a> while fetching runs must then fill the parser's <a id=read-html:the-input-byte-stream href=syntax.html#the-input-byte-stream>input byte
  stream</a> with the fetched bytes and cause the <a id=read-html:html-parser-2 href=syntax.html#html-parser>HTML parser</a> to perform the
  appropriate processing of the input stream.</p>

  <p class=note>The <a id=read-html:the-input-byte-stream-2 href=syntax.html#the-input-byte-stream>input byte stream</a> converts bytes into characters for use in the
  <a href=syntax.html#tokenization id=read-html:tokenization>tokenizer</a>. This process relies, in part, on character encoding
  information found in the real <a href=infrastructure.html#content-type id=read-html:content-type>Content-Type metadata</a> of the
  resource; the computed type is not used for this purpose.</p>

  

  <p>When no more bytes are available, the user agent must <a id=read-html:queue-a-task-2 href=webappapis.html#queue-a-task>queue a task</a> for the parser
  to process the implied EOF character, which eventually causes a <code id=read-html:event-load><a href=indices.html#event-load>load</a></code> event to be fired.</p>

  <p>After creating the <code id=read-html:document-3><a href=dom.html#document>Document</a></code> object, but before any script execution, certainly
  before the parser <a href=syntax.html#stop-parsing id=read-html:stop-parsing>stops</a>, the user agent must <a href=#update-the-session-history-with-the-new-page id=read-html:update-the-session-history-with-the-new-page>update the
  session history with the new page</a>.</p>

  <p class=note><a href=#concept-appcache-init id=read-html:concept-appcache-init>Application cache selection</a> happens <a href=syntax.html#parser-appcache>in the HTML parser</a>.</p>

  <p>The <a id=read-html:task-source href=webappapis.html#task-source>task source</a> for the two tasks mentioned in this section must be the
  <a id=read-html:networking-task-source-2 href=webappapis.html#networking-task-source>networking task source</a>.</p>



  <h4 id=read-xml>7.8.3 <dfn>Page load processing model for XML files</dfn></h4><div class=status><input onclick=toggleStatus(this) value=⋰ type=button><p class=bugs><strong>Spec bugs:</strong> <a href="https://www.w3.org/Bugs/Public/show_bug.cgi?id=17976" title="xml-stylesheet with type=text/xsl needs to be handled explicitly">17976</a></div>

  <p>When faced with displaying an XML file inline, user agents must follow the requirements defined
  in the XML and Namespaces in XML recommendations, RFC 7303, DOM, and other relevant specifications
  to create a <code id=read-xml:document><a href=dom.html#document>Document</a></code> object and a corresponding <a id=read-xml:xml-parser href=xhtml.html#xml-parser>XML parser</a>. <a href=references.html#refsXML>[XML]</a> <a href=references.html#refsXMLNS>[XMLNS]</a> <a href=references.html#refsRFC7303>[RFC7303]</a> <a href=references.html#refsDOM>[DOM]</a></p>

  <p class=note>At the time of writing, the XML specification community had not actually yet
  specified how XML and the DOM interact.</p> 

  <p>After the <code id=read-xml:document-2><a href=dom.html#document>Document</a></code> is created, the user agent must <a href=#initialise-the-document-object id=read-xml:initialise-the-document-object>initialise the
  <code>Document</code> object</a>.</p>

  <p>The actual HTTP headers and other metadata, not the headers as mutated or implied by the
  algorithms given in this specification, are the ones that must be used when determining the
  character encoding according to the rules given in the above specifications. Once the character
  encoding is established, the <a id="read-xml:document's-character-encoding" href=https://triple-underscore.github.io/DOM4-ja.html#concept-document-encoding data-x-internal="document's-character-encoding">document's character encoding</a> must be set to that
  character encoding.</p>

  <p>If the <a id=read-xml:document-element href=https://triple-underscore.github.io/DOM4-ja.html#document-element data-x-internal=document-element>document element</a>, as parsed according to the XML specifications cited
  above, is found to be an <code id=read-xml:the-html-element><a href=semantics.html#the-html-element>html</a></code> element with an attribute <code id=read-xml:attr-html-manifest><a href=semantics.html#attr-html-manifest>manifest</a></code> whose value is not the empty string, then, as soon as
  the element is <a href=infrastructure.html#insert-an-element-into-a-document id=read-xml:insert-an-element-into-a-document>inserted into the document</a>,
  the user agent must <a href=infrastructure.html#parse-a-url id=read-xml:parse-a-url>parse</a> the value of that attribute relative
  to that element's <a id=read-xml:node-document href=https://triple-underscore.github.io/DOM4-ja.html#concept-node-document data-x-internal=node-document>node document</a>, and if that is successful, must apply the <a href=https://triple-underscore.github.io/URL-ja.html#concept-url-serializer id=read-xml:concept-url-serialiser data-x-internal=concept-url-serialiser>URL serialiser</a> algorithm to the <a id=read-xml:resulting-url-record href=infrastructure.html#resulting-url-record>resulting URL
  record</a> with the <i>exclude fragment flag</i> set to obtain <var>manifest URL</var>, and
  then run the <a href=#concept-appcache-init id=read-xml:concept-appcache-init>application cache selection algorithm</a>
  with <var>manifest URL</var> as the manifest URL, passing in the newly-created
  <code id=read-xml:document-3><a href=dom.html#document>Document</a></code>. Otherwise, if the attribute is absent, its value is the empty string, or
  parsing its value fails, then as soon as the <a id=read-xml:document-element-2 href=https://triple-underscore.github.io/DOM4-ja.html#document-element data-x-internal=document-element>document element</a> is <a href=infrastructure.html#insert-an-element-into-a-document id=read-xml:insert-an-element-into-a-document-2>inserted into the document</a>, the user agent must run the <a href=#concept-appcache-init id=read-xml:concept-appcache-init-2>application cache selection algorithm</a> with no manifest, and
  passing in the <code id=read-xml:document-4><a href=dom.html#document>Document</a></code>.</p>

  <p class=note>Because the processing of the <code id=read-xml:attr-html-manifest-2><a href=semantics.html#attr-html-manifest>manifest</a></code>
  attribute happens only once the <a id=read-xml:document-element-3 href=https://triple-underscore.github.io/DOM4-ja.html#document-element data-x-internal=document-element>document element</a> is parsed, any URLs referenced by
  processing instructions before the <a id=read-xml:document-element-4 href=https://triple-underscore.github.io/DOM4-ja.html#document-element data-x-internal=document-element>document element</a> (such as <code><?xml-stylesheet?></code> PIs) will be fetched from the network and cannot be
  cached.</p>

  <p>User agents may examine the namespace of the root <code id=read-xml:element><a data-x-internal=element href=https://triple-underscore.github.io/DOM4-ja.html#interface-element>Element</a></code> node of this
  <code id=read-xml:document-5><a href=dom.html#document>Document</a></code> object to perform namespace-based dispatch to alternative processing tools,
  e.g. determining that the content is actually a syndication feed and passing it to a feed handler.
  If such processing is to take place, abort the steps in this section, and jump to <a href=#navigate-non-Document>the next step</a> (labeled <i>non-document content</i>) in the
  <a href=#navigate id=read-xml:navigate>navigate</a> steps above.</p>

  <p>Otherwise, then, with the newly created <code id=read-xml:document-6><a href=dom.html#document>Document</a></code>, the user agent must <a href=#update-the-session-history-with-the-new-page id=read-xml:update-the-session-history-with-the-new-page>update
  the session history with the new page</a>. User agents may do this before the complete document
  has been parsed (thus achieving <i>incremental rendering</i>), and must do this before any scripts
  are to be executed.</p>

  <p>Error messages from the parse process (e.g. XML namespace well-formedness errors) may be
  reported inline by mutating the <code id=read-xml:document-7><a href=dom.html#document>Document</a></code>.</p>


  <h4 id=read-text>7.8.4 <dfn>Page load processing model for text files</dfn></h4>

  <p>When a plain text document is to be loaded in a <a href=#browsing-context id=read-text:browsing-context>browsing context</a>, the user agent
  must <a id=read-text:queue-a-task href=webappapis.html#queue-a-task>queue a task</a> to create a <code id=read-text:document><a href=dom.html#document>Document</a></code> object, mark it as being an <a href=https://triple-underscore.github.io/DOM4-ja.html#html-document id=read-text:html-documents data-x-internal=html-documents>HTML document</a>, set its <a href=https://triple-underscore.github.io/DOM4-ja.html#concept-document-content-type id=read-text:concept-document-content-type data-x-internal=concept-document-content-type>content type</a> to the <a href=https://mimesniff.spec.whatwg.org/#computed-mime-type id=read-text:content-type-sniffing-2 data-x-internal=content-type-sniffing-2>computed MIME type</a> of the resource (<var>type</var> in the
  <a href=#navigate id=read-text:navigate>navigate</a> algorithm), <a href=#initialise-the-document-object id=read-text:initialise-the-document-object>initialise the <code>Document</code> object</a>,
  create an <a id=read-text:html-parser href=syntax.html#html-parser>HTML parser</a>, associate it with the <code id=read-text:document-2><a href=dom.html#document>Document</a></code>, act as if the
  tokenizer had emitted a start tag token with the tag name "pre" followed by a single U+000A LINE
  FEED (LF) character, and switch the <a id=read-text:html-parser-2 href=syntax.html#html-parser>HTML parser</a>'s tokenizer to the <a id=read-text:plaintext-state href=syntax.html#plaintext-state>PLAINTEXT
  state</a>. Each <a href=webappapis.html#concept-task id=read-text:concept-task>task</a> that the <a id=read-text:networking-task-source href=webappapis.html#networking-task-source>networking task
  source</a> places on the <a id=read-text:task-queue href=webappapis.html#task-queue>task queue</a> while fetching runs must then fill the
  parser's <a id=read-text:the-input-byte-stream href=syntax.html#the-input-byte-stream>input byte stream</a> with the fetched bytes and cause the <a id=read-text:html-parser-3 href=syntax.html#html-parser>HTML
  parser</a> to perform the appropriate processing of the input stream.</p>

  <p>The rules for how to convert the bytes of the plain text document into actual characters, and
  the rules for actually rendering the text to the user, are defined by the specifications for the
  <a href=https://mimesniff.spec.whatwg.org/#computed-mime-type id=read-text:content-type-sniffing-2-2 data-x-internal=content-type-sniffing-2>computed MIME type</a> of the resource (<var>type</var>
  in the <a href=#navigate id=read-text:navigate-2>navigate</a> algorithm).</p>

  <p>The <a id="read-text:document's-character-encoding" href=https://triple-underscore.github.io/DOM4-ja.html#concept-document-encoding data-x-internal="document's-character-encoding">document's character encoding</a> must be set to the character encoding used to
  decode the document.</p>

  <p>Upon creation of the <code id=read-text:document-3><a href=dom.html#document>Document</a></code> object, the user agent must run the <a href=#concept-appcache-init id=read-text:concept-appcache-init>application cache selection algorithm</a> with no manifest, and
  passing in the newly-created <code id=read-text:document-4><a href=dom.html#document>Document</a></code>.</p>

  

  <p>When no more bytes are available, the user agent must <a id=read-text:queue-a-task-2 href=webappapis.html#queue-a-task>queue a task</a> for the parser
  to process the implied EOF character, which eventually causes a <code id=read-text:event-load><a href=indices.html#event-load>load</a></code> event to be fired.</p>

  <p>After creating the <code id=read-text:document-5><a href=dom.html#document>Document</a></code> object, but potentially before the page has finished
  parsing, the user agent must <a href=#update-the-session-history-with-the-new-page id=read-text:update-the-session-history-with-the-new-page>update the session history with the new page</a>.</p>

  <p>User agents may add content to the <code id=read-text:the-head-element><a href=semantics.html#the-head-element>head</a></code> element of the <code id=read-text:document-6><a href=dom.html#document>Document</a></code>, e.g.
  linking to a style sheet or a binding, providing script, giving the document a
  <code id=read-text:the-title-element><a href=semantics.html#the-title-element>title</a></code>, etc.</p>

  <p class=note>In particular, if the user agent supports the <code>Format=Flowed</code>
  feature of RFC 3676 then the user agent would need to apply extra styling to cause the text to
  wrap correctly and to handle the quoting feature. This could be performed using, e.g., a
  binding or a CSS extension.</p>

  <p>The <a id=read-text:task-source href=webappapis.html#task-source>task source</a> for the two tasks mentioned in this section must be the
  <a id=read-text:networking-task-source-2 href=webappapis.html#networking-task-source>networking task source</a>.</p>


  <h4 id=read-multipart-x-mixed-replace>7.8.5 <dfn>Page load processing model for <code>multipart/x-mixed-replace</code> resources</dfn></h4>

  <p>When a resource with the type <code id=read-multipart-x-mixed-replace:multipart/x-mixed-replace><a href=iana.html#multipart/x-mixed-replace>multipart/x-mixed-replace</a></code> is to be loaded in a
  <a href=#browsing-context id=read-multipart-x-mixed-replace:browsing-context>browsing context</a>, the user agent must parse the resource using the rules for
  multipart types. <a href=references.html#refsRFC2046>[RFC2046]</a></p>

  <p>For each body part obtained from the resource, the user agent must run a new instance of the
  <a href=#navigate id=read-multipart-x-mixed-replace:navigate>navigate</a> algorithm, starting from the <i>resource handling</i> step, using the new
  body part as the resource being navigated, with <a href=#replacement-enabled id=read-multipart-x-mixed-replace:replacement-enabled>replacement enabled</a> if a previous
  body part from the same resource resulted in a <code id=read-multipart-x-mixed-replace:document><a href=dom.html#document>Document</a></code> object being created and
  <a href=#initialise-the-document-object id=read-multipart-x-mixed-replace:initialise-the-document-object>initialised</a>, and otherwise using the same
  setup as the <a href=#navigate id=read-multipart-x-mixed-replace:navigate-2>navigate</a> attempt that caused this section to be invoked in the first
  place.</p>

  <p>For the purposes of algorithms processing these body parts as if they were complete stand-alone
  resources, the user agent must act as if there were no more bytes for those resources whenever the
  boundary following the body part is reached.</p>

  <p class=note>Thus, <code id=read-multipart-x-mixed-replace:event-load><a href=indices.html#event-load>load</a></code> events (and for that matter <code id=read-multipart-x-mixed-replace:event-unload><a href=indices.html#event-unload>unload</a></code> events) do fire for each body part loaded.</p>


  <h4 id=read-media>7.8.6 <dfn>Page load processing model for media</dfn></h4>

  <p>When an image, video, or audio resource is to be loaded in a <a href=#browsing-context id=read-media:browsing-context>browsing context</a>, the
  user agent should create a <code id=read-media:document><a href=dom.html#document>Document</a></code> object, mark it as being an <a href=https://triple-underscore.github.io/DOM4-ja.html#html-document id=read-media:html-documents data-x-internal=html-documents>HTML document</a>, set its <a href=https://triple-underscore.github.io/DOM4-ja.html#concept-document-content-type id=read-media:concept-document-content-type data-x-internal=concept-document-content-type>content
  type</a> to the <a href=https://mimesniff.spec.whatwg.org/#computed-mime-type id=read-media:content-type-sniffing-2 data-x-internal=content-type-sniffing-2>computed MIME type</a> of the
  resource (<var>type</var> in the <a href=#navigate id=read-media:navigate>navigate</a> algorithm), <a href=#initialise-the-document-object id=read-media:initialise-the-document-object>initialise the <code>
  Document</code> object</a>, append an <code id=read-media:the-html-element><a href=semantics.html#the-html-element>html</a></code> element to the <code id=read-media:document-2><a href=dom.html#document>Document</a></code>,
  append a <code id=read-media:the-head-element><a href=semantics.html#the-head-element>head</a></code> element and a <code id=read-media:the-body-element><a href=semantics.html#the-body-element>body</a></code> element to the <code id=read-media:the-html-element-2><a href=semantics.html#the-html-element>html</a></code>
  element, append an element <var>host element</var> for the media, as described below, to the
  <code id=read-media:the-body-element-2><a href=semantics.html#the-body-element>body</a></code> element, and set the appropriate attribute of the element <var>host
  element</var>, as described below, to the address of the image, video, or audio resource.</p>

  <p>The element <var>host element</var> to create for the media is the element given in
  the table below in the second cell of the row whose first cell describes the media. The
  appropriate attribute to set is the one given by the third cell in that same row.</p>

  <table><thead><tr><th>  Type of media
         
         </th><th>  Element for the media
         
         </th><th>  Appropriate attribute
    
    </th></tr><tr><td> 画像
         </td><td> <code id=read-media:the-img-element><a href=embedded-content.html#the-img-element>img</a></code>
         </td><td> <code id=read-media:attr-img-src><a href=embedded-content.html#attr-img-src>src</a></code>
    </td></tr><tr><td>  Video
         
         </td><td> <code id=read-media:the-video-element><a href=embedded-content.html#the-video-element>video</a></code>
         </td><td> <code id=read-media:attr-media-src><a href=embedded-content.html#attr-media-src>src</a></code>
    </td></tr><tr><td>  Audio
         
         </td><td> <code id=read-media:the-audio-element><a href=embedded-content.html#the-audio-element>audio</a></code>
         </td><td> <code id=read-media:attr-media-src-2><a href=embedded-content.html#attr-media-src>src</a></code>
  </td></tr></table>

  

  <p>Then, the user agent must act as if it had <a href=syntax.html#stop-parsing id=read-media:stop-parsing>stopped
  parsing</a>.</p>

  <p>Upon creation of the <code id=read-media:document-3><a href=dom.html#document>Document</a></code> object, the user agent must run the <a href=#concept-appcache-init id=read-media:concept-appcache-init>application cache selection algorithm</a> with no manifest, and
  passing in the newly-created <code id=read-media:document-4><a href=dom.html#document>Document</a></code>.</p>

  <p>After creating the <code id=read-media:document-5><a href=dom.html#document>Document</a></code> object, but potentially before the page has finished
  fully loading, the user agent must <a href=#update-the-session-history-with-the-new-page id=read-media:update-the-session-history-with-the-new-page>update the session history with the new page</a>.</p>

  <p>User agents may add content to the <code id=read-media:the-head-element-2><a href=semantics.html#the-head-element>head</a></code> element of the <code id=read-media:document-6><a href=dom.html#document>Document</a></code>, or
  attributes to the element <var>host element</var>, e.g. to link to a style sheet or a
  binding, to provide a script, to give the document a <code id=read-media:the-title-element><a href=semantics.html#the-title-element>title</a></code>, to make the media
  <a href=embedded-content.html#attr-media-autoplay id=read-media:attr-media-autoplay>autoplay</a>, etc.</p>


  <h4 id=read-plugin>7.8.7 <dfn>Page load processing model for content that uses plugins</dfn></h4>

  <p>When a resource that requires an external resource to be rendered is to be loaded in a
  <a href=#browsing-context id=read-plugin:browsing-context>browsing context</a>, the user agent should create a <code id=read-plugin:document><a href=dom.html#document>Document</a></code> object, mark
  it as being an <a href=https://triple-underscore.github.io/DOM4-ja.html#html-document id=read-plugin:html-documents data-x-internal=html-documents>HTML document</a> and mark it as being a
  <dfn id=plugin-document>plugin document</dfn>, set its <a href=https://triple-underscore.github.io/DOM4-ja.html#concept-document-content-type id=read-plugin:concept-document-content-type data-x-internal=concept-document-content-type>content
  type</a> to the <a href=https://mimesniff.spec.whatwg.org/#computed-mime-type id=read-plugin:content-type-sniffing-2 data-x-internal=content-type-sniffing-2>computed MIME type</a> of the
  resource (<var>type</var> in the <a href=#navigate id=read-plugin:navigate>navigate</a> algorithm), <a href=#initialise-the-document-object id=read-plugin:initialise-the-document-object>initialise the
  <code>Document</code> object</a>, append an <code id=read-plugin:the-html-element><a href=semantics.html#the-html-element>html</a></code> element to the
  <code id=read-plugin:document-2><a href=dom.html#document>Document</a></code>, append a <code id=read-plugin:the-head-element><a href=semantics.html#the-head-element>head</a></code> element and a <code id=read-plugin:the-body-element><a href=semantics.html#the-body-element>body</a></code> element to the
  <code id=read-plugin:the-html-element-2><a href=semantics.html#the-html-element>html</a></code> element, append an <code id=read-plugin:the-embed-element><a href=embedded-content.html#the-embed-element>embed</a></code> to the <code id=read-plugin:the-body-element-2><a href=semantics.html#the-body-element>body</a></code> element, and
  set the <code id=read-plugin:attr-embed-src><a href=embedded-content.html#attr-embed-src>src</a></code> attribute of the <code id=read-plugin:the-embed-element-2><a href=embedded-content.html#the-embed-element>embed</a></code> element to
  the address of the resource.</p>

  <p class=note>The term <a href=#plugin-document id=read-plugin:plugin-document>plugin document</a> is used by
  <cite>Content Security Policy</cite> as part of the mechanism that ensures <code id=read-plugin:the-iframe-element><a href=embedded-content.html#the-iframe-element>iframe</a></code>s
  can't be used to evade <code>plugin-types</code> directives. <a href=references.html#refsCSP>[CSP]</a></p>

  

  <p>Then, the user agent must act as if it had <a href=syntax.html#stop-parsing id=read-plugin:stop-parsing>stopped
  parsing</a>.</p>

  <p>Upon creation of the <code id=read-plugin:document-3><a href=dom.html#document>Document</a></code> object, the user agent must run the <a href=#concept-appcache-init id=read-plugin:concept-appcache-init>application cache selection algorithm</a> with no manifest, and
  passing in the newly-created <code id=read-plugin:document-4><a href=dom.html#document>Document</a></code>.</p>

  <p>After creating the <code id=read-plugin:document-5><a href=dom.html#document>Document</a></code> object, but potentially before the page has finished
  fully loading, the user agent must <a href=#update-the-session-history-with-the-new-page id=read-plugin:update-the-session-history-with-the-new-page>update the session history with the new page</a>.</p>

  <p>User agents may add content to the <code id=read-plugin:the-head-element-2><a href=semantics.html#the-head-element>head</a></code> element of the <code id=read-plugin:document-6><a href=dom.html#document>Document</a></code>, or
  attributes to the <code id=read-plugin:the-embed-element-3><a href=embedded-content.html#the-embed-element>embed</a></code> element, e.g. to link to a style sheet or a binding, or
  to give the document a <code id=read-plugin:the-title-element><a href=semantics.html#the-title-element>title</a></code>.</p>

  <p id=sandboxPluginNavigate class=note>If the <code id=read-plugin:document-7><a href=dom.html#document>Document</a></code>'s <a href=#active-sandboxing-flag-set id=read-plugin:active-sandboxing-flag-set>active sandboxing
  flag set</a> has its <a href=#sandboxed-plugins-browsing-context-flag id=read-plugin:sandboxed-plugins-browsing-context-flag>sandboxed plugins browsing context flag</a> set, the synthesized
  <code id=read-plugin:the-embed-element-4><a href=embedded-content.html#the-embed-element>embed</a></code> element will <a href=embedded-content.html#sandboxPluginEmbed>fail to render the content</a> if
  the relevant <a id=read-plugin:plugin href=infrastructure.html#plugin>plugin</a> cannot be <a href=infrastructure.html#concept-plugin-secure id=read-plugin:concept-plugin-secure>secured</a>.</p>


  <h4 id=read-ua-inline>7.8.8 <dfn>Page load processing model for inline
  content that doesn't have a DOM</dfn></h4>

  <p>When the user agent is to display a user agent page inline in a <a href=#browsing-context id=read-ua-inline:browsing-context>browsing context</a>,
  the user agent should create a <code id=read-ua-inline:document><a href=dom.html#document>Document</a></code> object, mark it as being an <a href=https://triple-underscore.github.io/DOM4-ja.html#html-document id=read-ua-inline:html-documents data-x-internal=html-documents>HTML document</a>, set its <a href=https://triple-underscore.github.io/DOM4-ja.html#concept-document-content-type id=read-ua-inline:concept-document-content-type data-x-internal=concept-document-content-type>content type</a> to "<code>text/html</code>",
  <a href=#initialise-the-document-object id=read-ua-inline:initialise-the-document-object>initialise the <code>Document</code> object</a>, and then either associate that
  <code id=read-ua-inline:document-2><a href=dom.html#document>Document</a></code> with a custom rendering that is not rendered using the normal
  <code id=read-ua-inline:document-3><a href=dom.html#document>Document</a></code> rendering rules, or mutate that <code id=read-ua-inline:document-4><a href=dom.html#document>Document</a></code> until it represents
  the content the user agent wants to render.</p>

  

  <p>Once the page has been set up, the user agent must act as if it had <a href=syntax.html#stop-parsing id=read-ua-inline:stop-parsing>stopped parsing</a>.</p>

  <p>Upon creation of the <code id=read-ua-inline:document-5><a href=dom.html#document>Document</a></code> object, the user agent must run the <a href=#concept-appcache-init id=read-ua-inline:concept-appcache-init>application cache selection algorithm</a> with no manifest,
  passing in the newly-created <code id=read-ua-inline:document-6><a href=dom.html#document>Document</a></code>.</p>

  <p>After creating the <code id=read-ua-inline:document-7><a href=dom.html#document>Document</a></code> object, but potentially before the page has been
  completely set up, the user agent must <a href=#update-the-session-history-with-the-new-page id=read-ua-inline:update-the-session-history-with-the-new-page>update the session history with the new
  page</a>.</p>



  <h4 id=scroll-to-fragid>7.8.9 <dfn>Navigating to a fragment</dfn></h4>

  <p>When a user agent is supposed to navigate to a <a href=https://triple-underscore.github.io/URL-ja.html#concept-url-fragment id=scroll-to-fragid:concept-url-fragment data-x-internal=concept-url-fragment>fragment</a>, then the user agent must
  run the following steps:</p>

  <ol><li>

    <p>Remove all the entries in the <a href=#browsing-context id=scroll-to-fragid:browsing-context>browsing context</a>'s <a href=#session-history id=scroll-to-fragid:session-history>session history</a>
    after the <a href=#current-entry id=scroll-to-fragid:current-entry>current entry</a>. If the <a href=#current-entry id=scroll-to-fragid:current-entry-2>current entry</a> is the last entry in the
    session history, then no entries are removed.</p>

    <p class=note>This <a href=#history-notes>doesn't necessarily have to affect</a> the user
    agent's user interface.</p>

   </li><li><p>Remove any <a href=webappapis.html#concept-task id=scroll-to-fragid:concept-task>tasks</a> queued by the <a id=scroll-to-fragid:history-traversal-task-source href=webappapis.html#history-traversal-task-source>history traversal
   task source</a> that are associated with any <code id=scroll-to-fragid:document><a href=dom.html#document>Document</a></code> objects in the
   <a href=#top-level-browsing-context id=scroll-to-fragid:top-level-browsing-context>top-level browsing context</a>'s <a href=#document-family id=scroll-to-fragid:document-family>document family</a>.</li><li><p>Append a new entry at the end of the <code id=scroll-to-fragid:history-3><a href=#history-3>History</a></code> object representing the new
   resource and its <code id=scroll-to-fragid:document-2><a href=dom.html#document>Document</a></code> object, related state, and current history <span>scroll
   restoration preference</span>. Its <a id=scroll-to-fragid:url href=https://triple-underscore.github.io/URL-ja.html#concept-url data-x-internal=url>URL</a> must be set to the address to which the user
   agent was <a href=#navigate id=scroll-to-fragid:navigate>navigating</a>. The title must be left unset.</li><li><p><a href=#traverse-the-history id=scroll-to-fragid:traverse-the-history>Traverse the history</a> to the new entry, with the <i>non-blocking events</i> flag
   set. This will <a href=#scroll-to-the-fragment-identifier id=scroll-to-fragid:scroll-to-the-fragment-identifier>scroll to the fragment</a> given in what is now the document's <a href=https://triple-underscore.github.io/DOM4-ja.html#concept-document-url id="scroll-to-fragid:the-document's-address" data-x-internal="the-document's-address">URL</a>.</li></ol>

  <p class=note>If the scrolling fails because the relevant <a href=https://triple-underscore.github.io/DOM4-ja.html#concept-id id=scroll-to-fragid:concept-id data-x-internal=concept-id>ID</a> has
  not yet been parsed, then the original <a href=#navigate id=scroll-to-fragid:navigate-2>navigation</a> algorithm will
  take care of the scrolling instead, as the last few steps of its <a href=#update-the-session-history-with-the-new-page id=scroll-to-fragid:update-the-session-history-with-the-new-page>update the session history
  with the new page</a> algorithm.</p>

  <hr>

  <p>When the user agent is required to <dfn id=scroll-to-the-fragment-identifier>scroll to the fragment</dfn> and <a href=#the-indicated-part-of-the-document id=scroll-to-fragid:the-indicated-part-of-the-document>the indicated part
  of the document</a>, if any, is <a id=scroll-to-fragid:being-rendered href=rendering.html#being-rendered>being rendered</a>, the user agent must either change
  the scrolling position of the document using the following algorithm, or perform some other action
  such that <a href=#the-indicated-part-of-the-document id=scroll-to-fragid:the-indicated-part-of-the-document-2>the indicated part of the document</a> is brought to the user's attention. If
  there is no indicated part, or if the indicated part is not <a id=scroll-to-fragid:being-rendered-2 href=rendering.html#being-rendered>being rendered</a>, then the
  user agent must do nothing. The aforementioned algorithm is as follows:</p>

  <ol><li><p>Let <var>target</var> be <a href=#the-indicated-part-of-the-document id=scroll-to-fragid:the-indicated-part-of-the-document-3>the indicated part of the
   document</a>, as defined below.</li><li><p>If <var>target</var> is the top of the document, then <a id=scroll-to-fragid:scroll-to-the-beginning-of-the-document href=https://triple-underscore.github.io/cssom-view-ja.html#scroll-to-the-beginning-of-the-document data-x-internal=scroll-to-the-beginning-of-the-document>scroll to the
   beginning of the document</a> for the <code id=scroll-to-fragid:document-3><a href=dom.html#document>Document</a></code>, and abort these steps. <a href=references.html#refsCSSOMVIEW>[CSSOMVIEW]</a></li><li><p>Use the <a id=scroll-to-fragid:scroll-an-element-into-view href=https://triple-underscore.github.io/cssom-view-ja.html#scroll-an-element-into-view data-x-internal=scroll-an-element-into-view>scroll an element into view</a> algorithm to scroll <var>target</var> into view, with the <var>align to top flag</var> set. <a href=references.html#refsCSSOMVIEW>[CSSOMVIEW]</a></li><li><p>Run the <a id=scroll-to-fragid:focusing-steps href=interaction.html#focusing-steps>focusing steps</a> for that element, with the <code id=scroll-to-fragid:document-4><a href=dom.html#document>Document</a></code>'s
   <a id=scroll-to-fragid:viewport href=https://momdo.github.io/css2/visuren.html#viewport data-x-internal=viewport>viewport</a> as the <i>fallback target</i>.</li><li><p>Move the <a id=scroll-to-fragid:sequential-focus-navigation-starting-point href=interaction.html#sequential-focus-navigation-starting-point>sequential focus navigation starting point</a> to <var>target</var>.</p>

  </li></ol>

  <p><dfn id=the-indicated-part-of-the-document>The indicated part of the document</dfn> is the one that the <a href=https://triple-underscore.github.io/URL-ja.html#concept-url-fragment id=scroll-to-fragid:concept-url-fragment-2 data-x-internal=concept-url-fragment>fragment</a>, if any, identifies. The semantics of the <a href=https://triple-underscore.github.io/URL-ja.html#concept-url-fragment id=scroll-to-fragid:concept-url-fragment-3 data-x-internal=concept-url-fragment>fragment</a> in terms of mapping it to a specific DOM Node is
  defined by the specification that defines the <a id=scroll-to-fragid:mime-type href=infrastructure.html#mime-type>MIME type</a> used by the
  <code id=scroll-to-fragid:document-5><a href=dom.html#document>Document</a></code> (for example, the processing of <a href=https://triple-underscore.github.io/URL-ja.html#concept-url-fragment id=scroll-to-fragid:concept-url-fragment-4 data-x-internal=concept-url-fragment>fragments</a> for <a href=infrastructure.html#xml-mime-type id=scroll-to-fragid:xml-mime-type>XML MIME types</a> is the responsibility of RFC7303). <a href=references.html#refsRFC7303>[RFC7303]</a></p>

  <p>For HTML documents (and <a href=infrastructure.html#html-mime-type id=scroll-to-fragid:html-mime-type>HTML MIME types</a>), the following
  processing model must be followed to determine what <a href=#the-indicated-part-of-the-document id=scroll-to-fragid:the-indicated-part-of-the-document-4>the indicated part of the
  document</a> is.</p>

  <ol><li><p>Apply the <a id=scroll-to-fragid:url-parser href=https://triple-underscore.github.io/URL-ja.html#concept-url-parser data-x-internal=url-parser>URL parser</a> algorithm to the <a id=scroll-to-fragid:url-2 href=https://triple-underscore.github.io/URL-ja.html#concept-url data-x-internal=url>URL</a>, and let <var>fragid</var> be the <a href=https://triple-underscore.github.io/URL-ja.html#concept-url-fragment id=scroll-to-fragid:concept-url-fragment-5 data-x-internal=concept-url-fragment>fragment</a> component of the
   resulting <a id=scroll-to-fragid:url-record href=https://triple-underscore.github.io/URL-ja.html#concept-url data-x-internal=url-record>URL record</a>.</li><li><p>If <var>fragid</var> is the empty string, then <a href=#the-indicated-part-of-the-document id=scroll-to-fragid:the-indicated-part-of-the-document-5>the indicated part of the
   document</a> is the top of the document; stop the algorithm here.</li><li><p>Let <var>fragid bytes</var> be the result of <a href=https://triple-underscore.github.io/URL-ja.html#percent-decode id=scroll-to-fragid:percent-decode data-x-internal=percent-decode>percent-decoding</a> <var>fragid</var>.</li><li><p>Let <var>decoded fragid</var> be the result of running <a id=scroll-to-fragid:utf-8-decode-without-bom-or-fail href=https://triple-underscore.github.io/Encoding-ja.html#utf-8-decode-without-bom-or-fail data-x-internal=utf-8-decode-without-bom-or-fail>UTF-8 decode without BOM or
   fail</a> on <var>fragid bytes</var>. If <var>decoded fragid</var> is failure, jump to the step
   labeled <i>no decoded fragid</i>.</li><li><p>If there is an element in the DOM that has an <a href=https://triple-underscore.github.io/DOM4-ja.html#concept-id id=scroll-to-fragid:concept-id-2 data-x-internal=concept-id>ID</a> exactly
   equal to <var>decoded fragid</var>, then the first such element in <a id=scroll-to-fragid:tree-order href=https://triple-underscore.github.io/DOM4-ja.html#concept-tree-order data-x-internal=tree-order>tree order</a> is
   <a href=#the-indicated-part-of-the-document id=scroll-to-fragid:the-indicated-part-of-the-document-6>the indicated part of the document</a>; stop the algorithm here.</li><li><p><i>No decoded fragid</i>: If there is an <code id=scroll-to-fragid:the-a-element><a href=semantics.html#the-a-element>a</a></code> element in the DOM that has a <code id=scroll-to-fragid:attr-a-name><a href=obsolete.html#attr-a-name>name</a></code> attribute whose value is exactly equal to <var>fragid</var> (<em>not</em> <var>decoded fragid</var>), then the first such
   element in <a id=scroll-to-fragid:tree-order-2 href=https://triple-underscore.github.io/DOM4-ja.html#concept-tree-order data-x-internal=tree-order>tree order</a> is <a href=#the-indicated-part-of-the-document id=scroll-to-fragid:the-indicated-part-of-the-document-7>the indicated part of the document</a>; stop the algorithm
   here.</li><li><p>If <var>fragid</var> is an <a id=scroll-to-fragid:ascii-case-insensitive href=infrastructure.html#ascii-case-insensitive>ASCII case-insensitive</a> match for the
   string <code>top</code>, then <a href=#the-indicated-part-of-the-document id=scroll-to-fragid:the-indicated-part-of-the-document-8>the indicated part of the document</a> is the top
   of the document; stop the algorithm here.</li><li><p>Otherwise, there is no <a href=#the-indicated-part-of-the-document id=scroll-to-fragid:the-indicated-part-of-the-document-9>indicated part of
   the document</a>.</li></ol>

  <p>For the purposes of the interaction of HTML with Selectors' <dfn id=selector-target data-noexport=""><code>:target</code></dfn> <a id=scroll-to-fragid:pseudo-class href=https://triple-underscore.github.io/selectors4-ja.html#pseudo-class data-x-internal=pseudo-class>pseudo-class</a>, the
  <dfn id=target-element><i>target element</i></dfn> is <a href=#the-indicated-part-of-the-document id=scroll-to-fragid:the-indicated-part-of-the-document-10>the indicated part of the document</a>, if that is an
  element; otherwise there is no <i id=scroll-to-fragid:target-element><a href=#target-element>target element</a></i>.
  <a href=references.html#refsSELECTORS>[SELECTORS]</a></p>

  <p>The <a id=scroll-to-fragid:task-source href=webappapis.html#task-source>task source</a> for the task mentioned in this section must be the <a id=scroll-to-fragid:dom-manipulation-task-source href=webappapis.html#dom-manipulation-task-source>DOM
  manipulation task source</a>.</p>

  



  <h4 id=history-traversal>7.8.10 履歴走査</h4> 

  

  <p>When a user agent is required to <dfn id=traverse-the-history>traverse the history</dfn> to a <var>specified
  entry</var>, optionally with <a href=#replacement-enabled id=history-traversal:replacement-enabled>replacement enabled</a>, and optionally with the
  <i>non-blocking events</i> flag set, the user agent must act as follows.</p>

  <p class=note>This algorithm is not just invoked when <a href=#traverse-the-history-by-a-delta id=history-traversal:traverse-the-history-by-a-delta>explicitly going back or forwards in the session history</a> — it is also invoked
  in other situations, for example when <a href=#navigate id=history-traversal:navigate>navigating a browsing context</a>,
  as part of <a href=#update-the-session-history-with-the-new-page id=history-traversal:update-the-session-history-with-the-new-page>updating the session history
  with the new page</a>.</p>

  <ol><li>

    <p>If there is no longer a <code id=history-traversal:document><a href=dom.html#document>Document</a></code> object for the entry in question,
    <a href=#navigate id=history-traversal:navigate-2>navigate</a> the <a href=#browsing-context id=history-traversal:browsing-context>browsing
    context</a> to the resource for that entry to perform an <a href=#entry-update id=history-traversal:entry-update>entry update</a> of that
    entry, and abort these steps. The "<a href=#navigate id=history-traversal:navigate-3>navigate</a>" algorithm reinvokes this "traverse"
    algorithm to complete the traversal, at which point there <em>is</em> a <code id=history-traversal:document-2><a href=dom.html#document>Document</a></code>
    object and so this step gets skipped. The navigation must be done using the same <a href=#source-browsing-context id=history-traversal:source-browsing-context>source
    browsing context</a> as was used the first time this entry was created. (This can never
    happen with <a href=#replacement-enabled id=history-traversal:replacement-enabled-2>replacement enabled</a>.)</p>

    <p class=note>If the resource was obtained using a non-idempotent action, for example a POST
    form submission, or if the resource is no longer available, for example because the computer is
    now offline and the page wasn't cached, navigating to it again might not be possible. In this
    case, the navigation will result in a different page than previously; for example, it might be
    an error message explaining the problem or offering to resubmit the form.</p>

   </li><li><p>If the <a href=#current-entry id=history-traversal:current-entry>current entry</a>'s title was not set by the <code id=history-traversal:dom-history-pushstate><a href=#dom-history-pushstate>pushState()</a></code> or <code id=history-traversal:dom-history-replacestate><a href=#dom-history-replacestate>replaceState()</a></code> methods, then set its title to the value
   returned by the <code id=history-traversal:document.title><a href=dom.html#document.title>document.title</a></code> IDL attribute.</li><li><p>If appropriate, update the <a href=#current-entry id=history-traversal:current-entry-2>current entry</a> in the <a href=#browsing-context id=history-traversal:browsing-context-2>browsing
   context</a>'s <code id=history-traversal:document-3><a href=dom.html#document>Document</a></code> object's <code id=history-traversal:history-3><a href=#history-3>History</a></code> object to reflect any state
   that the user agent wishes to persist. The entry is then said to be <a href=#an-entry-with-persisted-user-state id=history-traversal:an-entry-with-persisted-user-state>an entry with persisted
   user state</a>.</li><li><p>If the <var>specified entry</var> has a different <code id=history-traversal:document-4><a href=dom.html#document>Document</a></code> object
   than the <a href=#current-entry id=history-traversal:current-entry-3>current entry</a>, then run the following substeps:</p>

    <ol><li><p>Remove any <a href=webappapis.html#concept-task id=history-traversal:concept-task>tasks</a> queued by the <a id=history-traversal:history-traversal-task-source href=webappapis.html#history-traversal-task-source>history traversal
     task source</a> that are associated with any <code id=history-traversal:document-5><a href=dom.html#document>Document</a></code> objects in the
     <a href=#top-level-browsing-context id=history-traversal:top-level-browsing-context>top-level browsing context</a>'s <a href=#document-family id=history-traversal:document-family>document family</a>.</li><li>

      <p>If the <a href=#concept-origin id=history-traversal:concept-origin>origin</a> of the <code id=history-traversal:document-6><a href=dom.html#document>Document</a></code> of the <var>specified
      entry</var> is not the <a href=#same-origin id=history-traversal:same-origin>same</a> as the <a href=#concept-origin id=history-traversal:concept-origin-2>origin</a> of the
      <code id=history-traversal:document-7><a href=dom.html#document>Document</a></code> of the <a href=#current-entry id=history-traversal:current-entry-4>current entry</a>, then run the following
      sub-sub-steps:</p>

      <ol><li><p>The current <a href=#browsing-context-name id=history-traversal:browsing-context-name>browsing context name</a> must be stored with all the entries in
       the history that are associated with <code id=history-traversal:document-8><a href=dom.html#document>Document</a></code> objects with the <a href=#same-origin id=history-traversal:same-origin-2>same
       origin</a> as the <a href=#active-document id=history-traversal:active-document>active document</a> <em>and</em> that are contiguous with the
       <a href=#current-entry id=history-traversal:current-entry-5>current entry</a>.</li><li id=resetBCName><p>If the browsing context is a <a href=#top-level-browsing-context id=history-traversal:top-level-browsing-context-2>top-level browsing context</a>,
       but not an <a href=#auxiliary-browsing-context id=history-traversal:auxiliary-browsing-context>auxiliary browsing context</a>, then the browsing context's
       <a href=#browsing-context-name id=history-traversal:browsing-context-name-2>browsing context name</a> must be unset.</li></ol>

     </li><li id=appcache-history-2><p>Make the <var>specified entry</var>'s
     <code id=history-traversal:document-9><a href=dom.html#document>Document</a></code> object the <a href=#active-document id=history-traversal:active-document-2>active document</a> of the <a href=#browsing-context id=history-traversal:browsing-context-3>browsing
     context</a>.</li><li>

      <p>If the <var>specified entry</var> has a <a href=#browsing-context-name id=history-traversal:browsing-context-name-3>browsing context name</a> stored
      with it, then run the following sub-sub-steps:</p>

      <ol><li><p>Set the browsing context's <a href=#browsing-context-name id=history-traversal:browsing-context-name-4>browsing context name</a> to the name stored with
       the specified entry.</li><li><p>Clear any <a href=#browsing-context-name id=history-traversal:browsing-context-name-5>browsing context names</a> stored
       with all entries in the history that are associated with <code id=history-traversal:document-10><a href=dom.html#document>Document</a></code> objects with
       the <a href=#same-origin id=history-traversal:same-origin-3>same origin</a> as the new <a href=#active-document id=history-traversal:active-document-3>active document</a> and that are contiguous
       with the specified entry.</li></ol>

     </li><li id=history-autocomplete><p>If the <var>specified entry</var>'s
     <code id=history-traversal:document-11><a href=dom.html#document>Document</a></code> has any form controls whose <a id=history-traversal:autofill-field-name href=forms.html#autofill-field-name>autofill field name</a> is "<code id=history-traversal:attr-fe-autocomplete-off><a href=forms.html#attr-fe-autocomplete-off>off</a></code>", invoke the <a href=forms.html#concept-form-reset-control id=history-traversal:concept-form-reset-control>reset algorithm</a> of each of those elements.</li><li>

      <p>If the <a id=history-traversal:current-document-readiness href=dom.html#current-document-readiness>current document readiness</a> of the <var>specified entry</var>'s
      <code id=history-traversal:document-12><a href=dom.html#document>Document</a></code> is "<code>complete</code>", <a id=history-traversal:queue-a-task href=webappapis.html#queue-a-task>queue a task</a> to run
      the following sub-sub-steps:</p>

      <ol><li><p>If the <code id=history-traversal:document-13><a href=dom.html#document>Document</a></code>'s <a href=#page-showing id=history-traversal:page-showing>page showing</a> flag is true, then abort this
       task (i.e. don't fire the event below).</li><li><p>Set the <code id=history-traversal:document-14><a href=dom.html#document>Document</a></code>'s <a href=#page-showing id=history-traversal:page-showing-2>page showing</a> flag to true.</li><li>

        <p>Run any <dfn id=session-history-document-visibility-change-steps>session history document visibility change steps</dfn> for <code id=history-traversal:document-15><a href=dom.html#document>Document</a></code> that
        are defined by <a id=history-traversal:other-applicable-specifications href=infrastructure.html#other-applicable-specifications>other applicable specifications</a>.</p>

        <p class=note>This is specifically intended for use by the Page Visibility specification. <a href=references.html#refsPAGEVIS>[PAGEVIS]</a></p>

       </li><li><p><a href=infrastructure.html#concept-event-fire id=history-traversal:concept-event-fire>Fire</a> a <a href=infrastructure.html#concept-events-trusted id=history-traversal:concept-events-trusted>trusted</a> event with the name <code id=history-traversal:event-pageshow><a href=indices.html#event-pageshow>pageshow</a></code> at the <code id=history-traversal:window><a href=#window>Window</a></code> object of that
       <code id=history-traversal:document-16><a href=dom.html#document>Document</a></code>, with <i id=history-traversal:concept-event-target-override><a href=infrastructure.html#concept-event-target-override>target override</a></i> set to the <code id=history-traversal:document-17><a href=dom.html#document>Document</a></code>
       object,
       using the <code id=history-traversal:pagetransitionevent><a href=#pagetransitionevent>PageTransitionEvent</a></code> interface, with the <code id=history-traversal:dom-pagetransitionevent-persisted><a href=#dom-pagetransitionevent-persisted>persisted</a></code> attribute initialised to true.
       This event must not bubble, must not be cancelable, and has no default action.</li></ol>

      

     </li></ol>

   </li><li><p>Set the document's <a href=https://triple-underscore.github.io/DOM4-ja.html#concept-document-url id="history-traversal:the-document's-address" data-x-internal="the-document's-address">URL</a> to the URL of the
   <var>specified entry</var>.</li><li><p>If the <var>specified entry</var> has a URL whose <a href=https://triple-underscore.github.io/URL-ja.html#concept-url-fragment id=history-traversal:concept-url-fragment data-x-internal=concept-url-fragment>fragment</a> differs from that of the
   <a href=#current-entry id=history-traversal:current-entry-6>current entry</a>'s when compared in a <a id=history-traversal:case-sensitive href=infrastructure.html#case-sensitive>case-sensitive</a> manner, and the two
   share the same <code id=history-traversal:document-18><a href=dom.html#document>Document</a></code> object, then let <var>hash changed</var> be true, and let
   <var>old URL</var> be the URL of the <a href=#current-entry id=history-traversal:current-entry-7>current entry</a> and <var>new URL</var> be the URL
   of the <var>specified entry</var>. Otherwise, let <var>hash changed</var> be false.</li><li><p>If the traversal was initiated with <dfn id=replacement-enabled>replacement enabled</dfn>, remove the entry
   immediately before the <var>specified entry</var> in the session history.</li><li><p>If the <var>specified entry</var> is not <a href=#an-entry-with-persisted-user-state id=history-traversal:an-entry-with-persisted-user-state-2>an entry with persisted user
   state</a>, but its URL has a <a href=https://triple-underscore.github.io/URL-ja.html#concept-url-fragment id=history-traversal:concept-url-fragment-2 data-x-internal=concept-url-fragment>fragment</a>,
   <a href=#scroll-to-the-fragment-identifier id=history-traversal:scroll-to-the-fragment-identifier>scroll to the fragment</a>.</li><li><p>If the entry is <a href=#an-entry-with-persisted-user-state id=history-traversal:an-entry-with-persisted-user-state-3>an entry with persisted user state</a>, the user agent may
   <a href=#restore-persisted-user-state id=history-traversal:restore-persisted-user-state>restore persisted user state</a> and update
   aspects of the document and its rendering.</li><li><p>Let <var>targetRealm</var> be the <a id=history-traversal:current-realm-record href=https://tc39.github.io/ecma262/#current-realm data-x-internal=current-realm-record>current Realm Record</a>.</li><li><p>If the entry is a <a href=#state-object id=history-traversal:state-object>state object</a> entry, let <var>state</var> be
   <a id=history-traversal:structuredclone href=infrastructure.html#structuredclone>StructuredClone</a>(that state object, <var>targetRealm</var>). Otherwise, let
   <var>state</var> be null.</li><li><p>Set <code id=history-traversal:dom-history-state><a href=#dom-history-state>history.state</a></code> to <var>state</var>.</li><li><p>Let <var>state changed</var> be true if the <code id=history-traversal:document-19><a href=dom.html#document>Document</a></code> of the <var>specified entry</var> has a <a href=#latest-entry id=history-traversal:latest-entry>latest entry</a>, and that entry is not the <var>specified entry</var>; otherwise let it be false.</p>

   </li><li><p>Let the <a href=#latest-entry id=history-traversal:latest-entry-2>latest entry</a> of the <code id=history-traversal:document-20><a href=dom.html#document>Document</a></code> of the <var>specified entry</var> be the <var>specified entry</var>.</li><li>

    <p>If the <i>non-blocking events</i> flag is not set, then run the following steps
    <a id=history-traversal:immediately href=infrastructure.html#immediately>immediately</a>. Otherwise, the <i>non-blocking events</i> flag is set; <a id=history-traversal:queue-a-task-2 href=webappapis.html#queue-a-task>queue a task</a>
    to run the following substeps instead.</p>

    <ol><li><p>If <var>state changed</var> is true, <a href=infrastructure.html#concept-event-fire id=history-traversal:concept-event-fire-2>fire</a> a <a href=infrastructure.html#concept-events-trusted id=history-traversal:concept-events-trusted-2>trusted</a>
     event with the name <code id=history-traversal:event-popstate><a href=indices.html#event-popstate>popstate</a></code> at the <code id=history-traversal:window-2><a href=#window>Window</a></code>
     object of the <code id=history-traversal:document-21><a href=dom.html#document>Document</a></code>, using the <code id=history-traversal:popstateevent><a href=#popstateevent>PopStateEvent</a></code> interface, with the
     <code id=history-traversal:dom-popstateevent-state><a href=#dom-popstateevent-state>state</a></code> attribute initialised to the value of <var>state</var>. This event must bubble but not be cancelable and has no default
     action.</li><li><p>If <var>hash changed</var> is true, then <a href=infrastructure.html#concept-event-fire id=history-traversal:concept-event-fire-3>fire</a> a <a href=infrastructure.html#concept-events-trusted id=history-traversal:concept-events-trusted-3>trusted</a>
     event with the name <code id=history-traversal:event-hashchange><a href=indices.html#event-hashchange>hashchange</a></code> at the <a href=#browsing-context id=history-traversal:browsing-context-4>browsing
     context</a>'s <code id=history-traversal:window-3><a href=#window>Window</a></code> object, using the <code id=history-traversal:hashchangeevent><a href=#hashchangeevent>HashChangeEvent</a></code> interface,
     with the <code id=history-traversal:dom-hashchangeevent-oldurl><a href=#dom-hashchangeevent-oldurl>oldURL</a></code> attribute initialised to <var>old URL</var> and the <code id=history-traversal:dom-hashchangeevent-newurl><a href=#dom-hashchangeevent-newurl>newURL</a></code> attribute
     initialised to <var>new URL</var>. This event must bubble but not be cancelable and
     has no default action.</li></ol>

   </li><li><p>The <a href=#current-entry id=history-traversal:current-entry-8>current entry</a> is now the <var>specified entry</var>.</li></ol>

  <p>上記のタスクに対する<a id=history-traversal:task-source href=webappapis.html#task-source>タスクソース</a>は、<a id=history-traversal:dom-manipulation-task-source href=webappapis.html#dom-manipulation-task-source>DOM操作タスクソース</a>である。</p>

  

  <h5 id=persisted-user-state-restoration>7.8.10.1 Persisted user state restoration</h5>
  

  <p>When the user agent is to <dfn id=restore-persisted-user-state>restore persisted user state</dfn> from a history entry, it must
  run the following steps immediately:</p>

  <ol><li><p>If the entry has a <a href=#scroll-restoration-mode id=persisted-user-state-restoration:scroll-restoration-mode>scroll restoration mode</a>, let <var>scrollRestoration</var>
   be that. Otherwise let <var>scrollRestoration</var> be "<code id=persisted-user-state-restoration:dom-scrollrestoration-auto><a href=#dom-scrollrestoration-auto>auto</a></code>"</li><li><p>If <var>scrollRestoration</var> is "<code id=persisted-user-state-restoration:dom-scrollrestoration-manual><a href=#dom-scrollrestoration-manual>manual</a></code>" the user agent should not restore the scroll
   position for the <code id=persisted-user-state-restoration:document><a href=dom.html#document>Document</a></code> or any of its scrollable regions, with the exception of
   any nested browsing contexts whose scroll restoration is controlled by their own history entry's
   <a href=#scroll-restoration-mode id=persisted-user-state-restoration:scroll-restoration-mode-2>scroll restoration mode</a>, otherwise, it may do so.</li><li><p>Optionally, update other aspects of the document and its rendering, for instance values of
   form fields, that the user agent had previously recorded.</li></ol>
  

  
  <p class=note>This can even include updating the <code id=persisted-user-state-restoration:the-dir-attribute><a href=dom.html#the-dir-attribute>dir</a></code> attribute
  of <code id=persisted-user-state-restoration:the-textarea-element><a href=forms.html#the-textarea-element>textarea</a></code> elements or <code id=persisted-user-state-restoration:the-input-element><a href=forms.html#the-input-element>input</a></code> elements whose <code id=persisted-user-state-restoration:attr-input-type><a href=forms.html#attr-input-type>type</a></code> attribute is in either the <a href="forms.html#text-(type=text)-state-and-search-state-(type=search)" id="persisted-user-state-restoration:text-(type=text)-state-and-search-state-(type=search)">Text</a> state or the <a href="forms.html#text-(type=text)-state-and-search-state-(type=search)" id="persisted-user-state-restoration:text-(type=text)-state-and-search-state-(type=search)-2">Search</a> state, if the persisted state includes the
  directionality of user input in such controls.</p>

  <p class=note>Not restoring the scroll position by user agent does not imply that the scroll
  position will be left at any particular value (e.g., (0,0)). The actual scroll position depends on
  the navigation type and the user agent's particular caching strategy. So web applications should
  not assume any particular scroll position but rather should set it to what they want it to be.</p>

  <h5 id=the-popstateevent-interface>7.8.10.2 The <code id=the-popstateevent-interface:popstateevent><a href=#popstateevent>PopStateEvent</a></code> interface</h5>

  <pre class=idl>[Constructor(DOMString type, optional <a href=#popstateeventinit id=the-popstateevent-interface:popstateeventinit>PopStateEventInit</a> eventInitDict), Exposed=(Window,Worker)]
interface <dfn id=popstateevent>PopStateEvent</dfn> : <a id=the-popstateevent-interface:event href=https://triple-underscore.github.io/DOM4-ja.html#interface-event data-x-internal=event>Event</a> {
  readonly attribute any <a href=#dom-popstateevent-state id=the-popstateevent-interface:dom-popstateevent-state>state</a>;
};

dictionary <dfn id=popstateeventinit>PopStateEventInit</dfn> : <a id=the-popstateevent-interface:eventinit href=https://triple-underscore.github.io/DOM4-ja.html#dictdef-eventinit data-x-internal=eventinit>EventInit</a> {
  any state = null;
};</pre>

  <dl class=domintro><dt><var>event</var> . <code id=the-popstateevent-interface:dom-popstateevent-state-2><a href=#dom-popstateevent-state>state</a></code><dd>

    <p><code id=the-popstateevent-interface:dom-history-pushstate><a href=#dom-history-pushstate>pushState()</a></code>または<code id=the-popstateevent-interface:dom-history-replacestate><a href=#dom-history-replacestate>replaceState()</a></code>へ提供される情報のコピーを返す。</p>

   </dl>

  

  <p>The <dfn id=dom-popstateevent-state><code>state</code></dfn> attribute must return the
  value it was initialised to. It represents the context information for the event, or null, if the
  state represented is the initial state of the <code id=the-popstateevent-interface:document><a href=dom.html#document>Document</a></code>.</p>

  


  <h5 id=the-hashchangeevent-interface>7.8.10.3 The <code id=the-hashchangeevent-interface:hashchangeevent><a href=#hashchangeevent>HashChangeEvent</a></code> interface</h5><div class=status><input onclick=toggleStatus(this) value=⋰ type=button><p class=support><strong>Support:</strong> <span class="chrome yes"><span>Chrome</span> <span>5+</span></span><span class="and_chr yes"><span>Chrome for Android</span> <span>50+</span></span><span class="and_uc yes"><span>UC Browser for Android</span> <span>9.9+</span></span><span class="ios_saf yes"><span>iOS Safari</span> <span>4.0-4.1+</span></span><span class="firefox yes"><span>Firefox</span> <span>3.6+</span></span><span class="ie yes"><span>IE</span> <span>8+</span></span><span class="op_mini no"><span>Opera Mini</span> <span>None</span></span><span class="android yes"><span>Android Browser</span> <span>2.2+</span></span><span class="edge yes"><span>Edge</span> <span>12+</span></span><span class="safari yes"><span>Safari</span> <span>5+</span></span><span class="opera yes"><span>Opera</span> <span>10.6+</span></span><span class="ie_mob yes"><span>IE Mobile</span> <span>10+</span></span><p class=caniuse>Source: <a href="http://caniuse.com/#feat=hashchange">caniuse.com</a></div>

  <pre class=idl>[Constructor(DOMString type, optional <a href=#hashchangeeventinit id=the-hashchangeevent-interface:hashchangeeventinit>HashChangeEventInit</a> eventInitDict), Exposed=(Window,Worker)]
interface <dfn id=hashchangeevent>HashChangeEvent</dfn> : <a id=the-hashchangeevent-interface:event href=https://triple-underscore.github.io/DOM4-ja.html#interface-event data-x-internal=event>Event</a> {
  readonly attribute USVString <a href=#dom-hashchangeevent-oldurl id=the-hashchangeevent-interface:dom-hashchangeevent-oldurl>oldURL</a>;
  readonly attribute USVString <a href=#dom-hashchangeevent-newurl id=the-hashchangeevent-interface:dom-hashchangeevent-newurl>newURL</a>;
};

dictionary <dfn id=hashchangeeventinit>HashChangeEventInit</dfn> : <a id=the-hashchangeevent-interface:eventinit href=https://triple-underscore.github.io/DOM4-ja.html#dictdef-eventinit data-x-internal=eventinit>EventInit</a> {
  USVString oldURL = "";
  USVString newURL = "";
};</pre>

  <dl class=domintro><dt><var>event</var> . <code id=the-hashchangeevent-interface:dom-hashchangeevent-oldurl-2><a href=#dom-hashchangeevent-oldurl>oldURL</a></code><dd>

    <p>以前に現在であった<a href=#session-history-entry id=the-hashchangeevent-interface:session-history-entry>セッション履歴のエントリ</a>の<a id=the-hashchangeevent-interface:url href=https://triple-underscore.github.io/URL-ja.html#concept-url data-x-internal=url>URL</a>を返す。</p>

   <dt><var>event</var> . <code id=the-hashchangeevent-interface:dom-hashchangeevent-newurl-2><a href=#dom-hashchangeevent-newurl>newURL</a></code><dd>

    <p>今現在である<a href=#session-history-entry id=the-hashchangeevent-interface:session-history-entry-2>セッション履歴のエントリ</a>の<a id=the-hashchangeevent-interface:url-2 href=https://triple-underscore.github.io/URL-ja.html#concept-url data-x-internal=url>URL</a>を返す。</p>

   </dl>

  

  <p><dfn id=dom-hashchangeevent-oldurl><code>oldURL</code></dfn>属性は、属性が初期化された値を返さなければならない。It represents context information for the event, specifically the URL of the <a href=#session-history-entry id=the-hashchangeevent-interface:session-history-entry-3>session history entry</a> that was traversed from.</p>

  <p><dfn id=dom-hashchangeevent-newurl><code>newURL</code></dfn>属性は、属性が初期化された値を返さなければならない。It represents context information for the event, specifically the URL of the <a href=#session-history-entry id=the-hashchangeevent-interface:session-history-entry-4>session history entry</a> that was traversed to.</p>

  


  <h5 id=the-pagetransitionevent-interface>7.8.10.4 The <code id=the-pagetransitionevent-interface:pagetransitionevent><a href=#pagetransitionevent>PageTransitionEvent</a></code> interface</h5>

  <pre class=idl>[Constructor(DOMString type, optional <a href=#pagetransitioneventinit id=the-pagetransitionevent-interface:pagetransitioneventinit>PageTransitionEventInit</a> eventInitDict), Exposed=(Window,Worker)]
interface <dfn id=pagetransitionevent>PageTransitionEvent</dfn> : <a id=the-pagetransitionevent-interface:event href=https://triple-underscore.github.io/DOM4-ja.html#interface-event data-x-internal=event>Event</a> {
  readonly attribute boolean <a href=#dom-pagetransitionevent-persisted id=the-pagetransitionevent-interface:dom-pagetransitionevent-persisted>persisted</a>;
};

dictionary <dfn id=pagetransitioneventinit>PageTransitionEventInit</dfn> : <a id=the-pagetransitionevent-interface:eventinit href=https://triple-underscore.github.io/DOM4-ja.html#dictdef-eventinit data-x-internal=eventinit>EventInit</a> {
  boolean persisted = false;
};</pre>

  <dl class=domintro><dt><var>event</var> . <code id=the-pagetransitionevent-interface:dom-pagetransitionevent-persisted-2><a href=#dom-pagetransitionevent-persisted>persisted</a></code><dd>

    <p><code id=the-pagetransitionevent-interface:event-pageshow><a href=indices.html#event-pageshow>pageshow</a></code>に対して、ページが新しく読み込まれている（および<code id=the-pagetransitionevent-interface:event-load><a href=indices.html#event-load>load</a></code>イベントが発生する）場合にfalseを返す。そうでなければ、trueを返す。</p>

    <p><code id=the-pagetransitionevent-interface:event-pagehide><a href=indices.html#event-pagehide>pagehide</a></code>イベントに対して、ページが最後の時間まで出かける場合はfalseを返す。そうでなければ、（何もページを最上にしないよう共謀しない場合）、ユーザーがこのページに戻る場合、ページが再利用されるかもしれないことを意味し、trueを返す。</p>

    <p>最上でないページを含む可能性があるもの：</p>

    <ul class=brief><li><code id=the-pagetransitionevent-interface:dom-document-open><a href=webappapis.html#dom-document-open>document.open()</a></code>
     </li><li><code id=the-pagetransitionevent-interface:event-beforeunload><a href=indices.html#event-beforeunload>beforeunload</a></code>イベントの待ち
     </li><li><code id=the-pagetransitionevent-interface:event-unload><a href=indices.html#event-unload>unload</a></code>イベントの待ち
     </li><li>最上でない<code id=the-pagetransitionevent-interface:the-iframe-element><a href=embedded-content.html#the-iframe-element>iframe</a></code>を持っている
     </li><li>アクティブな<code id=the-pagetransitionevent-interface:websocket><a href=comms.html#websocket>WebSocket</a></code>オブジェクト
     </li><li><a href=#abort-a-document id=the-pagetransitionevent-interface:abort-a-document><code>Document</code>の中止</a>
    </li></ul>

   </dl>

  

  <p><dfn id=dom-pagetransitionevent-persisted><code>persisted</code></dfn>属性は、属性が初期化された値を返さなければならない。It represents the context information for the event.</p>

  



  <h4 id=unloading-documents>7.8.11 文書の解放</h4>

  

  <p>A <code id=unloading-documents:document><a href=dom.html#document>Document</a></code> has a <dfn id=concept-document-salvageable><i>salvageable</i></dfn> state, which must initially be
  true, a <dfn id=fired-unload>fired unload</dfn> flag, which must initially be false, and a <dfn id=page-showing>page showing</dfn>
  flag, which must initially be false. The <a href=#page-showing id=unloading-documents:page-showing>page showing</a> flag is used to ensure that
  scripts receive <code id=unloading-documents:event-pageshow><a href=indices.html#event-pageshow>pageshow</a></code> and <code id=unloading-documents:event-pagehide><a href=indices.html#event-pagehide>pagehide</a></code> events in a consistent manner (e.g. that they never
  receive two <code id=unloading-documents:event-pagehide-2><a href=indices.html#event-pagehide>pagehide</a></code> events in a row without an intervening
  <code id=unloading-documents:event-pageshow-2><a href=indices.html#event-pageshow>pageshow</a></code>, or vice versa).</p>

  <p><a href=webappapis.html#event-loop id=unloading-documents:event-loop>Event loops</a> have a <dfn id=termination-nesting-level>termination nesting level</dfn>
  counter, which must initially be zero.</p>

  <p>When a user agent is to <dfn id=prompt-to-unload-a-document>prompt to unload a document</dfn>, it must run the following
  steps.</p>

  <ol><li><p>Increase the <a id=unloading-documents:event-loop-2 href=webappapis.html#event-loop>event loop</a>'s <a href=#termination-nesting-level id=unloading-documents:termination-nesting-level>termination nesting level</a> by
   one.</li><li><p>Increase the <code id=unloading-documents:document-2><a href=dom.html#document>Document</a></code>'s <a id=unloading-documents:ignore-opens-during-unload-counter href=webappapis.html#ignore-opens-during-unload-counter>ignore-opens-during-unload counter</a> by
   one.</li><li><p>Let <var>event</var> be a new <a href=infrastructure.html#concept-events-trusted id=unloading-documents:concept-events-trusted>trusted</a>
   <code id=unloading-documents:beforeunloadevent><a href=#beforeunloadevent>BeforeUnloadEvent</a></code> event object with the name <code id=unloading-documents:event-beforeunload><a href=indices.html#event-beforeunload>beforeunload</a></code>, which does not bubble but is cancelable.</li><li><p><i>Dispatch</i>: <a href=infrastructure.html#concept-event-dispatch id=unloading-documents:concept-event-dispatch>Dispatch</a> <var>event</var> at the <code id=unloading-documents:document-3><a href=dom.html#document>Document</a></code>'s <code id=unloading-documents:window><a href=#window>Window</a></code> object.</li><li><p>Decrease the <a id=unloading-documents:event-loop-3 href=webappapis.html#event-loop>event loop</a>'s <a href=#termination-nesting-level id=unloading-documents:termination-nesting-level-2>termination nesting level</a> by
   one.</li><li><p>If any event listeners were triggered by the earlier <i>dispatch</i> step, then set the
   <code id=unloading-documents:document-4><a href=dom.html#document>Document</a></code>'s <i id=unloading-documents:concept-document-salvageable><a href=#concept-document-salvageable>salvageable</a></i> state to
   false.</li><li>

    <p>If the <code id=unloading-documents:document-5><a href=dom.html#document>Document</a></code>'s <a href=#active-sandboxing-flag-set id=unloading-documents:active-sandboxing-flag-set>active sandboxing flag set</a> does not have its
    <a href=#sandboxed-modals-flag id=unloading-documents:sandboxed-modals-flag>sandboxed modals flag</a> set, and the <code id=unloading-documents:dom-beforeunloadevent-returnvalue><a href=#dom-beforeunloadevent-returnvalue>returnValue</a></code> attribute of the <var>event</var>
    object is not the empty string, or if the event was canceled, then the user agent should ask the
    user to confirm that they wish to unload the document.</p>

    <p class=note>The message shown to the user is not customizable, but instead determined by
    the user agent. In particular, the actual value of the <code id=unloading-documents:dom-beforeunloadevent-returnvalue-2><a href=#dom-beforeunloadevent-returnvalue>returnValue</a></code> attribute is ignored.</p>

    <p>The user agent must <a id=unloading-documents:pause href=webappapis.html#pause>pause</a> while waiting for the user's response.</p>

    <p>If the user did not confirm the page navigation, then the user agent <dfn id=refused-to-allow-the-document-to-be-unloaded>refused to allow
    the document to be unloaded</dfn>.</p>

   </li><li><p>If this algorithm was invoked by another instance of the "prompt to unload a document"
   algorithm (i.e. through the steps below that invoke this algorithm for all descendant browsing
   contexts), then jump to the step labeled <i>end</i>.</li><li><p>Let <var>descendants</var> be the <a href=#list-of-the-descendant-browsing-contexts id=unloading-documents:list-of-the-descendant-browsing-contexts>list of the descendant browsing
   contexts</a> of the <code id=unloading-documents:document-6><a href=dom.html#document>Document</a></code>.</li><li>

    <p>If <var>descendants</var> is not an empty list, then for each <a href=#browsing-context id=unloading-documents:browsing-context>browsing
    context</a> <var>b</var> in <var>descendants</var> run the following
    substeps:</p>

    <ol><li><p><a href=#prompt-to-unload-a-document id=unloading-documents:prompt-to-unload-a-document>Prompt to unload</a> the <a href=#active-document id=unloading-documents:active-document>active
     document</a> of the <a href=#browsing-context id=unloading-documents:browsing-context-2>browsing context</a> <var>b</var>. If the user
     <a href=#refused-to-allow-the-document-to-be-unloaded id=unloading-documents:refused-to-allow-the-document-to-be-unloaded>refused to allow the document to be unloaded</a>, then the user implicitly also <a href=#refused-to-allow-the-document-to-be-unloaded id=unloading-documents:refused-to-allow-the-document-to-be-unloaded-2>refused to allow <em>this</em> document to
     be unloaded</a>; jump to the step labeled <i>end</i>.</p>

     </li><li><p>If the <i id=unloading-documents:concept-document-salvageable-2><a href=#concept-document-salvageable>salvageable</a></i> state of the <a href=#active-document id=unloading-documents:active-document-2>active
     document</a> of the <a href=#browsing-context id=unloading-documents:browsing-context-3>browsing context</a> <var>b</var> is false, then set
     the <i id=unloading-documents:concept-document-salvageable-3><a href=#concept-document-salvageable>salvageable</a></i> state of <em>this</em> document to
     false also.</li></ol>

   </li><li><p><i>End</i>: Decrease the <code id=unloading-documents:document-7><a href=dom.html#document>Document</a></code>'s <a id=unloading-documents:ignore-opens-during-unload-counter-2 href=webappapis.html#ignore-opens-during-unload-counter>ignore-opens-during-unload
   counter</a> by one.</li></ol>

  <p>When a user agent is to <dfn id=unload-a-document>unload a document</dfn>, it must run the following steps. These
  steps are passed an argument, <var>recycle</var>, which is either true or false,
  indicating whether the <code id=unloading-documents:document-8><a href=dom.html#document>Document</a></code> object is going to be re-used. (This is set by the
  <code id=unloading-documents:dom-document-open><a href=webappapis.html#dom-document-open>document.open()</a></code> method.)</p>

  <ol><li><p>Increase the <a id=unloading-documents:event-loop-4 href=webappapis.html#event-loop>event loop</a>'s <a href=#termination-nesting-level id=unloading-documents:termination-nesting-level-3>termination nesting level</a> by
   one.</li><li><p>Increase the <code id=unloading-documents:document-9><a href=dom.html#document>Document</a></code>'s <a id=unloading-documents:ignore-opens-during-unload-counter-3 href=webappapis.html#ignore-opens-during-unload-counter>ignore-opens-during-unload counter</a> by
   one.</li><li><p>If the <code id=unloading-documents:document-10><a href=dom.html#document>Document</a></code>'s <a href=#page-showing id=unloading-documents:page-showing-2>page showing</a> flag is false, then jump to the
   step labeled <i>unload event</i> below (i.e. skip firing the <code id=unloading-documents:event-pagehide-3><a href=indices.html#event-pagehide>pagehide</a></code> event and don't rerun the <a href=#unloading-document-visibility-change-steps id=unloading-documents:unloading-document-visibility-change-steps>unloading document
   visibility change steps</a>).</li><li><p>Set the <code id=unloading-documents:document-11><a href=dom.html#document>Document</a></code>'s <a href=#page-showing id=unloading-documents:page-showing-3>page showing</a> flag to false.</li><li><p><a href=infrastructure.html#concept-event-fire id=unloading-documents:concept-event-fire>Fire</a> a <a href=infrastructure.html#concept-events-trusted id=unloading-documents:concept-events-trusted-2>trusted</a> event with the name <code id=unloading-documents:event-pagehide-4><a href=indices.html#event-pagehide>pagehide</a></code> at the <code id=unloading-documents:window-2><a href=#window>Window</a></code> object of the
   <code id=unloading-documents:document-12><a href=dom.html#document>Document</a></code>, with <i id=unloading-documents:concept-event-target-override><a href=infrastructure.html#concept-event-target-override>target override</a></i> set to the <code id=unloading-documents:document-13><a href=dom.html#document>Document</a></code>
   object, using the <code id=unloading-documents:pagetransitionevent><a href=#pagetransitionevent>PageTransitionEvent</a></code> interface,
   with the <code id=unloading-documents:dom-pagetransitionevent-persisted><a href=#dom-pagetransitionevent-persisted>persisted</a></code> attribute initialised
   to true if the <code id=unloading-documents:document-14><a href=dom.html#document>Document</a></code> object's <i id=unloading-documents:concept-document-salvageable-4><a href=#concept-document-salvageable>salvageable</a></i> state is true, and false otherwise. This
   event must not bubble, must not be cancelable, and has no default action.</li><li>

    <p>Run any <dfn id=unloading-document-visibility-change-steps>unloading document visibility change steps</dfn> for <code id=unloading-documents:document-15><a href=dom.html#document>Document</a></code> that
    are defined by <a id=unloading-documents:other-applicable-specifications href=infrastructure.html#other-applicable-specifications>other applicable specifications</a>.</p>

    <p class=note>This is specifically intended for use by the Page Visibility specification. <a href=references.html#refsPAGEVIS>[PAGEVIS]</a></p>

   </li><li><p><i>Unload event</i>: If the <code id=unloading-documents:document-16><a href=dom.html#document>Document</a></code>'s <a href=#fired-unload id=unloading-documents:fired-unload>fired unload</a> flag is
   false, <a id=unloading-documents:fire-a-simple-event href=webappapis.html#fire-a-simple-event>fire a simple event</a> named <code id=unloading-documents:event-unload><a href=indices.html#event-unload>unload</a></code> at the
   <code id=unloading-documents:document-17><a href=dom.html#document>Document</a></code>'s <code id=unloading-documents:window-3><a href=#window>Window</a></code> object, with <i id=unloading-documents:concept-event-target-override-2><a href=infrastructure.html#concept-event-target-override>target override</a></i> set to the
   <code id=unloading-documents:document-18><a href=dom.html#document>Document</a></code> object.</li><li><p>Decrease the <a id=unloading-documents:event-loop-5 href=webappapis.html#event-loop>event loop</a>'s <a href=#termination-nesting-level id=unloading-documents:termination-nesting-level-4>termination nesting level</a> by
   one.</li><li><p>If any event listeners were triggered by the earlier <i>unload event</i> step, then set
   the <code id=unloading-documents:document-19><a href=dom.html#document>Document</a></code> object's <i id=unloading-documents:concept-document-salvageable-5><a href=#concept-document-salvageable>salvageable</a></i> state
   to false and set the <code id=unloading-documents:document-20><a href=dom.html#document>Document</a></code>'s <a href=#fired-unload id=unloading-documents:fired-unload-2>fired unload</a> flag to true.</li><li><p>Run any <a href=#unloading-document-cleanup-steps id=unloading-documents:unloading-document-cleanup-steps>unloading document cleanup steps</a> for <code id=unloading-documents:document-21><a href=dom.html#document>Document</a></code> that are
   defined by this specification and <a id=unloading-documents:other-applicable-specifications-2 href=infrastructure.html#other-applicable-specifications>other applicable specifications</a>.</li><li><p>If this algorithm was invoked by another instance of the "unload a document" algorithm
   (i.e. by the steps below that invoke this algorithm for all descendant browsing contexts), then
   jump to the step labeled <i>end</i>.</li><li><p>Let <var>descendants</var> be the <a href=#list-of-the-descendant-browsing-contexts id=unloading-documents:list-of-the-descendant-browsing-contexts-2>list of the descendant browsing
   contexts</a> of the <code id=unloading-documents:document-22><a href=dom.html#document>Document</a></code>.</li><li>

    <p>If <var>descendants</var> is not an empty list, then for each <a href=#browsing-context id=unloading-documents:browsing-context-4>browsing
    context</a> <var>b</var> in <var>descendants</var> run the following
    substeps:</p>

    <ol><li><p><a href=#unload-a-document id=unloading-documents:unload-a-document>Unload</a> the <a href=#active-document id=unloading-documents:active-document-3>active document</a> of the
     <a href=#browsing-context id=unloading-documents:browsing-context-5>browsing context</a> <var>b</var> with the <var>recycle</var>
     parameter set to false.</li><li><p>If the <i id=unloading-documents:concept-document-salvageable-6><a href=#concept-document-salvageable>salvageable</a></i> state of the <a href=#active-document id=unloading-documents:active-document-4>active
     document</a> of the <a href=#browsing-context id=unloading-documents:browsing-context-6>browsing context</a> <var>b</var> is false, then set
     the <i id=unloading-documents:concept-document-salvageable-7><a href=#concept-document-salvageable>salvageable</a></i> state of <em>this</em> document to
     false also.</li></ol>

   </li><li><p>If both the <code id=unloading-documents:document-23><a href=dom.html#document>Document</a></code>'s <i id=unloading-documents:concept-document-salvageable-8><a href=#concept-document-salvageable>salvageable</a></i> state and <var>recycle</var> are
   false, then the <code id=unloading-documents:document-24><a href=dom.html#document>Document</a></code>'s <a href=#concept-document-bc id=unloading-documents:concept-document-bc>browsing
   context</a> must <a href=#discard-a-document id=unloading-documents:discard-a-document>discard the
   <code>Document</code></a>.</li><li><p><i>End</i>: Decrease the <code id=unloading-documents:document-25><a href=dom.html#document>Document</a></code>'s <a id=unloading-documents:ignore-opens-during-unload-counter-4 href=webappapis.html#ignore-opens-during-unload-counter>ignore-opens-during-unload
   counter</a> by one.</li></ol>

  <p>This specification defines the following <dfn id=unloading-document-cleanup-steps>unloading document cleanup steps</dfn>. Other
  specifications can define more.</p>

  <ol><li>

    <p><a id=unloading-documents:make-disappear href=comms.html#make-disappear>Make disappear</a> any <code id=unloading-documents:websocket><a href=comms.html#websocket>WebSocket</a></code> objects that were created by the <code id=unloading-documents:dom-websocket><a href=comms.html#dom-websocket>WebSocket()</a></code> constructor from the
    <code id=unloading-documents:document-26><a href=dom.html#document>Document</a></code>'s <code id=unloading-documents:window-4><a href=#window>Window</a></code> object.</p>

    <p>If this affected any <code id=unloading-documents:websocket-2><a href=comms.html#websocket>WebSocket</a></code> objects, then set <code id=unloading-documents:document-27><a href=dom.html#document>Document</a></code>'s <i id=unloading-documents:concept-document-salvageable-9><a href=#concept-document-salvageable>salvageable</a></i> state to false.</p>

   </li><li><p>If the <code id=unloading-documents:document-28><a href=dom.html#document>Document</a></code>'s <i id=unloading-documents:concept-document-salvageable-10><a href=#concept-document-salvageable>salvageable</a></i>
   state is false, <a href=comms.html#concept-eventsource-forcibly-close id=unloading-documents:concept-eventsource-forcibly-close>forcibly close</a> any
   <code id=unloading-documents:eventsource><a href=comms.html#eventsource>EventSource</a></code> objects that whose constructor was invoked from the
   <code id=unloading-documents:document-29><a href=dom.html#document>Document</a></code>'s <code id=unloading-documents:window-5><a href=#window>Window</a></code> object.</li><li><p>If the <code id=unloading-documents:document-30><a href=dom.html#document>Document</a></code>'s <i id=unloading-documents:concept-document-salvageable-11><a href=#concept-document-salvageable>salvageable</a></i>
   state is false, empty the <code id=unloading-documents:document-31><a href=dom.html#document>Document</a></code>'s <code id=unloading-documents:window-6><a href=#window>Window</a></code>'s <a id=unloading-documents:list-of-active-timers href=webappapis.html#list-of-active-timers>list of active
   timers</a>.</li></ol>

  



  <h5 id=the-beforeunloadevent-interface>7.8.11.1 The <code id=the-beforeunloadevent-interface:beforeunloadevent><a href=#beforeunloadevent>BeforeUnloadEvent</a></code> interface</h5>

  <pre class=idl>interface <dfn id=beforeunloadevent>BeforeUnloadEvent</dfn> : <a id=the-beforeunloadevent-interface:event href=https://triple-underscore.github.io/DOM4-ja.html#interface-event data-x-internal=event>Event</a> {
  attribute DOMString <a href=#dom-beforeunloadevent-returnvalue id=the-beforeunloadevent-interface:dom-beforeunloadevent-returnvalue>returnValue</a>;
};</pre>

  <p class=note>There are no <code id=the-beforeunloadevent-interface:beforeunloadevent-2><a href=#beforeunloadevent>BeforeUnloadEvent</a></code>-specific initialisation methods.</p>

  <p>The <code id=the-beforeunloadevent-interface:beforeunloadevent-3><a href=#beforeunloadevent>BeforeUnloadEvent</a></code> interface is a legacy interface which allows <a href=#prompt-to-unload-a-document id=the-beforeunloadevent-interface:prompt-to-unload-a-document>prompting to unload the document</a> to be controlled
  not only by canceling the event, but by setting the <code id=the-beforeunloadevent-interface:dom-beforeunloadevent-returnvalue-2><a href=#dom-beforeunloadevent-returnvalue>returnValue</a></code> attribute to a value besides the
  empty string. Authors should use the <code id=the-beforeunloadevent-interface:dom-event-preventdefault><a data-x-internal=dom-event-preventdefault href=https://triple-underscore.github.io/DOM4-ja.html#dom-event-preventdefault>preventDefault()</a></code> method, or other means of canceling
  events, instead of using <code id=the-beforeunloadevent-interface:dom-beforeunloadevent-returnvalue-3><a href=#dom-beforeunloadevent-returnvalue>returnValue</a></code>.</p>

  

  <p>The <dfn id=dom-beforeunloadevent-returnvalue><code>returnValue</code></dfn> attribute
  controls the process of <a href=#prompt-to-unload-a-document id=the-beforeunloadevent-interface:prompt-to-unload-a-document-2>prompting to unload the
  document</a>. When the event is created, the attribute must be set to
  the empty string. On getting, it must return the last value it was set to. On setting, the
  attribute must be set to the new value.</p>

  <p class=note>This attribute is a <code>DOMString</code> only for historical reasons.
  Any value besides the empty string will be treated as a request to ask the user for
  confirmation.</p>

  


  

  <h4 id=aborting-a-document-load>7.8.12 Aborting a document load</h4>

  <p>If a <code id=aborting-a-document-load:document><a href=dom.html#document>Document</a></code> is <dfn id=abort-a-document>aborted</dfn>, the user agent must
  run the following steps:</p>

  <ol><li><p><a href=#abort-a-document id=aborting-a-document-load:abort-a-document>Abort</a> the <a href=#active-document id=aborting-a-document-load:active-document>active
   documents</a> of every <a href=#child-browsing-context id=aborting-a-document-load:child-browsing-context>child browsing context</a>. If this results in any of those
   <code id=aborting-a-document-load:document-2><a href=dom.html#document>Document</a></code> objects having their <i id=aborting-a-document-load:concept-document-salvageable><a href=#concept-document-salvageable>salvageable</a></i> state set to false, then set this
   <code id=aborting-a-document-load:document-3><a href=dom.html#document>Document</a></code>'s <i id=aborting-a-document-load:concept-document-salvageable-2><a href=#concept-document-salvageable>salvageable</a></i> state to false
   also.</li><li><p>Cancel any instances of the <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-fetch id=aborting-a-document-load:concept-fetch data-x-internal=concept-fetch>fetch</a> algorithm in the
   context of this <code id=aborting-a-document-load:document-4><a href=dom.html#document>Document</a></code>, discarding any <a href=webappapis.html#concept-task id=aborting-a-document-load:concept-task>tasks</a>
   <a href=webappapis.html#queue-a-task id=aborting-a-document-load:queue-a-task>queued</a> for them, and discarding any further data received from
   the network for them. If this resulted in any instances of the <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-fetch id=aborting-a-document-load:concept-fetch-2 data-x-internal=concept-fetch>fetch</a> algorithm being canceled or any <a href=webappapis.html#queue-a-task id=aborting-a-document-load:queue-a-task-2>queued</a> <a href=webappapis.html#concept-task id=aborting-a-document-load:concept-task-2>tasks</a> or any network data getting
   discarded, then set the <code id=aborting-a-document-load:document-5><a href=dom.html#document>Document</a></code>'s <i id=aborting-a-document-load:concept-document-salvageable-3><a href=#concept-document-salvageable>salvageable</a></i> state to false.</li><li><p>If the <code id=aborting-a-document-load:document-6><a href=dom.html#document>Document</a></code> has an <a id=aborting-a-document-load:active-parser href=dom.html#active-parser>active parser</a>, then <a href=syntax.html#abort-a-parser id=aborting-a-document-load:abort-a-parser>abort that parser</a> and set the <code id=aborting-a-document-load:document-7><a href=dom.html#document>Document</a></code>'s <i id=aborting-a-document-load:concept-document-salvageable-4><a href=#concept-document-salvageable>salvageable</a></i> state to false.</li></ol>

  <p>User agents may allow users to explicitly invoke the <a href=#abort-a-document id=aborting-a-document-load:abort-a-document-2>abort a
  document</a> algorithm for a <code id=aborting-a-document-load:document-8><a href=dom.html#document>Document</a></code>. If the user does so, then, if that
  <code id=aborting-a-document-load:document-9><a href=dom.html#document>Document</a></code> is an <a href=#active-document id=aborting-a-document-load:active-document-2>active document</a>, the user agent should <a id=aborting-a-document-load:queue-a-task-3 href=webappapis.html#queue-a-task>queue a
  task</a> to <a id=aborting-a-document-load:fire-a-simple-event href=webappapis.html#fire-a-simple-event>fire a simple event</a> named <code id=aborting-a-document-load:event-abort><a href=indices.html#event-abort>abort</a></code> at
  that <code id=aborting-a-document-load:document-10><a href=dom.html#document>Document</a></code>'s <code id=aborting-a-document-load:window><a href=#window>Window</a></code> object before invoking the <a href=#abort-a-document id=aborting-a-document-load:abort-a-document-3>abort</a> algorithm.</p>

  

  



  <h3 id=offline>7.9 オフラインウェブアプリケーション</h3><div class=status><input onclick=toggleStatus(this) value=⋰ type=button><p class=support><strong>Support:</strong> <span class="chrome yes"><span>Chrome</span> <span>4+</span></span><span class="and_chr yes"><span>Chrome for Android</span> <span>50+</span></span><span class="and_uc yes"><span>UC Browser for Android</span> <span>9.9+</span></span><span class="ios_saf yes"><span>iOS Safari</span> <span>3.2+</span></span><span class="firefox yes"><span>Firefox</span> <span>3.5+</span></span><span class="ie yes"><span>IE</span> <span>10+</span></span><span class="op_mini no"><span>Opera Mini</span> <span>None</span></span><span class="android yes"><span>Android Browser</span> <span>2.1+</span></span><span class="edge yes"><span>Edge</span> <span>12+</span></span><span class="safari yes"><span>Safari</span> <span>4+</span></span><span class="opera yes"><span>Opera</span> <span>10.6+</span></span><span class="ie_mob yes"><span>IE Mobile</span> <span>10+</span></span><p class=caniuse>Source: <a href="http://caniuse.com/#feat=offline-apps">caniuse.com</a></div> 

  <p class=critical>This feature is in the process of being removed from the Web platform. (This
  is a long process that takes many years.) Using any of the offline Web application features at
  this time is highly discouraged. Use service workers instead. <a href=references.html#refsSW>[SW]</a></p>

  

  <h4 id=introduction-9>7.9.1 導入</h4>

  <p><i>この節は非規範的である。</i></p>

  <p>ネットワーク接続が利用できない場合―たとえば、ユーザーがISPのカバレッジエリアの外に移動しているため―でも、ユーザーにウェブアプリケーションおよび文書との対話を継続できるようにするために、著者は、オフラインで作業し、オフラインで使用のためにファイルのコピーを保持するためにユーザーのブラウザーになる、ウェブアプリケーション用に必要とされるファイルの一覧を示したマニフェストを提供できる。</p>

  <p>これを説明するために、HTMLページ"<code>clock1.html</code>"、CSSスタイルシート"<code>clock.css</code>"、およびJavaScriptスクリプト"<code>clock.js</code>"から成る単純な時計アプレットを考えてみる。</p>

  <p>マニフェストを追加する前に、これらの3つのファイルは次のようになる：</p>

  <pre>&lt;!-- clock1.html --&gt;
&lt;!DOCTYPE HTML&gt;
&lt;html&gt;
 &lt;head&gt;
  &lt;title&gt;Clock&lt;/title&gt;
  &lt;script src="clock.js"&gt;&lt;/script&gt;
  &lt;link rel="stylesheet" href="clock.css"&gt;
 &lt;/head&gt;
 &lt;body&gt;
  &lt;p&gt;The time is: &lt;output id="clock"&gt;&lt;/output&gt;&lt;/p&gt;
 &lt;/body&gt;
&lt;/html&gt;</pre>
  <pre>/* clock.css */
output { font: 2em sans-serif; }</pre>
  <pre>/* clock.js */
setInterval(function () {
    document.getElementById('clock').value = new Date();
}, 1000);</pre>

  <p>ユーザーがオフライン時に"<code>clock1.html</code>"ページを開こうとする場合、しかし、（ローカルキャッシュにまだ持つ場合を除いて）ユーザーエージェントはエラーとともに失敗する。</p>

  <p>著者は、代わりに"<code>clock.appcache</code>"という、3つのファイルのマニフェストを提供できる：</p>

  <pre>CACHE MANIFEST
clock2.html
clock.css
clock.js
</pre>

  <p>HTMLファイルへの小さな変化とともに、（<code id=introduction-9:text/cache-manifest><a href=iana.html#text/cache-manifest>text/cache-manifest</a></code>で提供される）マニフェストがアプリケーションにリンクされている：</p>

  <pre>&lt;!-- clock2.html --&gt;
&lt;!DOCTYPE HTML&gt;
&lt;html manifest="clock.appcache"&gt;
 &lt;head&gt;
  &lt;title&gt;Clock&lt;/title&gt;
  &lt;script src="clock.js"&gt;&lt;/script&gt;
  &lt;link rel="stylesheet" href="clock.css"&gt;
 &lt;/head&gt;
 &lt;body&gt;
  &lt;p&gt;The time is: &lt;output id="clock"&gt;&lt;/output&gt;&lt;/p&gt;
 &lt;/body&gt;
&lt;/html&gt;</pre>

  <p>さて、ユーザーがページに行く場合、ブラウザーはファイルをキャッシュし、ユーザーがオフラインである場合でも、それらを使用できるようにする。</p>

  <p class=note>著者はまた、マニフェストのメインページを含めることを推奨するが、実際にマニフェストを参照されるページは、明示的に言及されない場合でも、自動的にキャッシュされる。</p>

  <p class=note>"no-store"ディレクティブ例外とともに、TLSで供給される（<code id=introduction-9:https-protocol><a data-x-internal=https-protocol href=https://triple-underscore.github.io/RFC7230-ja.html#section-2.7.2>https:</a></code>を使用して暗号化される）キャッシュページでのHTTPキャッシュヘッダーと制限は、マニフェストによって上書きされる。したがって、ページは、ユーザーエージェントがそれを更新する前にアプリケーションキャッシュから期限切れにならず、TLS経由で提供されるアプリケーションはオフラインで動作させることができる。</p>

  <p><a href=https://html.spec.whatwg.org/demos/offline/clock/clock2.html>この例をオンラインで見る</a>。</p>



  <h5 id=supporting-offline-caching-for-legacy-applications>7.9.1.1 レガシーアプリケーションへのオフラインキャッシュのサポート</h5>

  <p><i>この節は非規範的である。</i></p>

  <p>マニフェストに記載されかつアプリケーションキャッシュに格納されたロジック（マークアップ、スクリプト、スタイルシート、画像など）とともに、アプリケーションに対する有限数の静的HTMLページとともに、およびウェブストレージまたはサーバ側にインデックス付けされたデータベースに格納されたアプリケーションおよびユーザーデーターとともに、アプリケーションロジックがアプリケーションとユーザーデータから別れる場合、アプリケーションキャッシュ機能は最も機能的に動作し、ウェブソケット、<code id=supporting-offline-caching-for-legacy-applications:xmlhttprequest><a data-x-internal=xmlhttprequest href=https://triple-underscore.github.io/XHR-ja.html#xmlhttprequest>XMLHttpRequest</a></code>、サーバに送信されるイベント、または他の同様の機構を使用して動的に更新される。</p>

  <p>このモデルはユーザーに対して高速な経験をもたらす：（おそらく古いデータを示しつつ）アプリケーション即時に読み込み、ネットワークがそれを可能にするように、新鮮なデータを高速に得られる。</p>

  <p>しかし、レガシーアプリケーションは、サーバから新しいHTMLページで得られた各操作とともに、ユーザーデータおよびロジックがHTMLと一緒に混合されるように設計される傾向にある。</p>

  <div class=example>

   <p>たとえば、ニュースアプリケーションを考えてみよう。このようなアプリケーションの典型的なアーキテクチャーは、アプリケーションキャッシュ機能を使用しない場合、ユーザーはメインページをフェッチし、サーバーは現在の見出しとユーザーインタフェースロジックを一緒に混合した動的に生成されるページを返す。</p>

   <p>しかし、アプリケーションキャッシュ機能のために設計されたニュースアプリケーションは、ロジックでのみ構成されるメインページを代わりに持つだろうし、メインページがサーバとは別にデータをフェッチしているだろう。たとえば、<code id=supporting-offline-caching-for-legacy-applications:xmlhttprequest-2><a data-x-internal=xmlhttprequest href=https://triple-underscore.github.io/XHR-ja.html#xmlhttprequest>XMLHttpRequest</a></code>を使用して。</p>

  </div>

  <p>混合コンテンツモデルは、アプリケーションのキャッシュ機能とともにうまく動作しない：コンテンツがキャッシュされているので、常にキャッシュが更新された前回から古いデータを見て、ユーザーにもたらすだろう。</p>

  <p>分離されたモデルと同じ速さで、従来のモデルを動作させる方法がないが、それは少なくとも<a href=#concept-appcache-mode-prefer-online id=supporting-offline-caching-for-legacy-applications:concept-appcache-mode-prefer-online>好ましいオンライン</a><a href=#concept-appcache-mode id=supporting-offline-caching-for-legacy-applications:concept-appcache-mode>アプリケーションキャッシュモード</a>を使用してオフライン利用で使用するために改造<em>できる</em>。これを行うには、<a href=#concept-appcache-manifest id=supporting-offline-caching-for-legacy-applications:concept-appcache-manifest>アプリケーションキャッシュマニフェスト</a>でオフライン作業をしたいHTMLページによって使用されるすべての静的リソースを一覧表示し、HTMLファイルからそのマニフェストを選択する<code id=supporting-offline-caching-for-legacy-applications:attr-html-manifest><a href=semantics.html#attr-html-manifest>manifest</a></code>属性を使用し、マニフェストの一番下に次の行を追加する：</p>

  <pre>SETTINGS:
prefer-online
NETWORK:
*</pre>

  <p>ユーザーがオフラインである際に、許可するすべてのリソースが通常アクセスされるマニフェストに記載されていない一方で、これは、<a href=#concept-appcache-master id=supporting-offline-caching-for-legacy-applications:concept-appcache-master>マスターエントリ</a>にのみ使用される<a href=#application-cache id=supporting-offline-caching-for-legacy-applications:application-cache>アプリケーションキャッシュ</a>を引き起こし、（本質的にマニフェストに記載されているリソースをピン留めする）分割不能なHTTPキャッシュとして使用されるアプリケーションキャッシュを引き起こす。</p>



  <h5 id=appcacheevents>7.9.1.2 イベントの概要</h5>

  <p><i>この節は非規範的である。</i></p>

  <p>ユーザーがマニフェストを宣言するページを訪問する際に、ブラウザーはキャッシュを更新しようとする。これは、ユーザーエージェントが最後にそれを見てからマニフェストが変更された場合、それが言及されているすべてのリソースを再ダウンロードして改めてキャッシュし、マニフェストのコピーを取得することによってこれを行う。</p>

  <p>これが起こっているように、ユーザーに適切な方法で通知できるように、イベントの数は、キャッシュの更新の状態へと更新されたスクリプトを保つために<code id=appcacheevents:applicationcache><a href=#applicationcache>ApplicationCache</a></code>オブジェクトで発火する。イベントは次のとおり：</p>

  <table><thead><tr><th> イベント名
     </th><th> インターフェイス
     </th><th> 発火条件
     </th><th> 次のイベント
   <tbody></th></tr><tr><td> <dfn id=event-appcache-checking><code>checking</code></dfn>
     </td><td> <code id=appcacheevents:event><a data-x-internal=event href=https://triple-underscore.github.io/DOM4-ja.html#interface-event>Event</a></code>
     </td><td> ユーザーエージェントは、更新をチェックする、または初回のマニフェストをダウンロードしようとしている。<strong>これは、常にシーケンスの最初のイベントである。</strong>
     </td><td> <code id=appcacheevents:event-appcache-noupdate><a href=#event-appcache-noupdate>noupdate</a></code>、<code id=appcacheevents:event-appcache-downloading><a href=#event-appcache-downloading>downloading</a></code>、<code id=appcacheevents:event-appcache-obsolete><a href=#event-appcache-obsolete>obsolete</a></code>、<code id=appcacheevents:event-appcache-error><a href=#event-appcache-error>error</a></code>

    </td></tr><tr><td> <dfn id=event-appcache-noupdate><code>noupdate</code></dfn>
     </td><td> <code id=appcacheevents:event-2><a data-x-internal=event href=https://triple-underscore.github.io/DOM4-ja.html#interface-event>Event</a></code>
     </td><td> マニフェストは変更されなかった。
     </td><td> シーケンス内の最後のイベント。

    </td></tr><tr><td> <dfn id=event-appcache-downloading><code>downloading</code></dfn>
     </td><td> <code id=appcacheevents:event-3><a data-x-internal=event href=https://triple-underscore.github.io/DOM4-ja.html#interface-event>Event</a></code>
     </td><td> ユーザーエージェントは更新を発見し、それをフェッチしている、または初回のマニフェストで記載されたリソースをダウンロードしている。
     </td><td> <code id=appcacheevents:event-appcache-progress><a href=#event-appcache-progress>progress</a></code>、<code id=appcacheevents:event-appcache-error-2><a href=#event-appcache-error>error</a></code>、<code id=appcacheevents:event-appcache-cached><a href=#event-appcache-cached>cached</a></code>、<code id=appcacheevents:event-appcache-updateready><a href=#event-appcache-updateready>updateready</a></code>

    </td></tr><tr><td> <dfn id=event-appcache-progress><code>progress</code></dfn>
     </td><td> <code id=appcacheevents:progressevent><a data-x-internal=progressevent href=https://triple-underscore.github.io/XHR-ja.html#interface-progressevent>ProgressEvent</a></code>
     </td><td> ユーザーエージェントは、マニフェストで記載されたリソースをダウンロードしている。イベントオブジェクトの<code id=appcacheevents:dom-progressevent-total><a data-x-internal=dom-progressevent-total href=https://triple-underscore.github.io/XHR-ja.html#dom-progressevent-total>total</a></code>属性は、ダウンロードされたファイルの合計数を返す。イベントオブジェクトの<code id=appcacheevents:dom-progressevent-loaded><a data-x-internal=dom-progressevent-loaded href=https://triple-underscore.github.io/XHR-ja.html#dom-progressevent-loaded>loaded</a></code>属性は、これまでに処理されたファイルの数を返す。
     </td><td> <code id=appcacheevents:event-appcache-progress-2><a href=#event-appcache-progress>progress</a></code>、<code id=appcacheevents:event-appcache-error-3><a href=#event-appcache-error>error</a></code>、<code id=appcacheevents:event-appcache-cached-2><a href=#event-appcache-cached>cached</a></code>、<code id=appcacheevents:event-appcache-updateready-2><a href=#event-appcache-updateready>updateready</a></code>

    </td></tr><tr><td> <dfn id=event-appcache-cached><code>cached</code></dfn>
     </td><td> <code id=appcacheevents:event-4><a data-x-internal=event href=https://triple-underscore.github.io/DOM4-ja.html#interface-event>Event</a></code>
     </td><td> マニフェストに記載されたリソースがダウンロードされ、アプリケーションがキャッシュされた。
     </td><td> シーケンス内の最後のイベント。

    </td></tr><tr><td> <dfn id=event-appcache-updateready><code>updateready</code></dfn>
     </td><td> <code id=appcacheevents:event-5><a data-x-internal=event href=https://triple-underscore.github.io/DOM4-ja.html#interface-event>Event</a></code>
     </td><td> マニフェストに記載されたリソースは新しく再ダウンロードされており、スクリプトは新しいキャッシュに切り替えるために<code id=appcacheevents:dom-appcache-swapcache><a href=#dom-appcache-swapcache>swapCache()</a></code>を使用できる。
     </td><td> シーケンス内の最後のイベント。

    </td></tr><tr><td> <dfn id=event-appcache-obsolete><code>obsolete</code></dfn>
     </td><td> <code id=appcacheevents:event-6><a data-x-internal=event href=https://triple-underscore.github.io/DOM4-ja.html#interface-event>Event</a></code>
     </td><td> マニフェストは404または410ページになっていることが判明し、アプリケーションのキャッシュを削除している。
     </td><td> シーケンス内の最後のイベント。

    </td></tr><tr><td rowspan=4> <dfn id=event-appcache-error><code>error</code></dfn>
     </td><td rowspan=4> <code id=appcacheevents:event-7><a data-x-internal=event href=https://triple-underscore.github.io/DOM4-ja.html#interface-event>Event</a></code>
     </td><td> マニフェストが404または410ページだったので、アプリケーションをキャッシュする試みが中止された。
     </td><td rowspan=3> シーケンス内の最後のイベント。

    </td></tr><tr><td> マニフェストは変更されなかったが、マニフェストを参照するページが正しくダウンロードでなかった。

    </td></tr><tr><td> マニフェストに記載されたリソースを取得するときに致命的なエラーが発生した。

    </td></tr><tr><td> 更新されている間にマニフェストが変更された。
     </td><td> ユーザーエージェントは、再び一時的にファイルを取得しようする。

  </td></tr></table>

  <p>これらのイベントはキャンセル可能である。それらのデフォルトアクションは、ダウンロードの進捗情報を表示するためのユーザーエージェントに対するものである。ページが独自のアップデートのUIが表示する場合、イベントのキャンセルは、冗長な進捗情報の表示からユーザーエージェントを防ぐだろう。</p>



  

  <h4 id=appcache>7.9.2 Application caches</h4> 

  <p>An <dfn id=application-cache>application cache</dfn> is a set of cached resources consisting of:</p>

  <ul><li>

    <p>One or more resources (including their out-of-band metadata, such as HTTP headers, if any),
    identified by URLs, each falling into one (or more) of the following categories:</p>

    <dl><dt><dfn id=concept-appcache-master>Master entries</dfn>

     <dd><p class=note>These are documents that were added to the cache because a <a href=#browsing-context id=appcache:browsing-context>browsing
     context</a> was <a href=#navigate id=appcache:navigate>navigated</a> to that document and the document
     indicated that this was its cache, using the <code id=appcache:attr-html-manifest><a href=semantics.html#attr-html-manifest>manifest</a></code>
     attribute.</p>


     <dt><dfn id=concept-appcache-manifest>The manifest</dfn>

     <dd><p class=note>This is the resource corresponding to the URL that was given in a master
     entry's <code id=appcache:the-html-element><a href=semantics.html#the-html-element>html</a></code> element's <code id=appcache:attr-html-manifest-2><a href=semantics.html#attr-html-manifest>manifest</a></code> attribute.
     The manifest is fetched and processed during the <a href=#application-cache-download-process id=appcache:application-cache-download-process>application cache download
     process</a>. All the <a href=#concept-appcache-master id=appcache:concept-appcache-master>master entries</a> have the
     <a href=#same-origin id=appcache:same-origin>same origin</a> as the manifest.</p>


     <dt><dfn id=concept-appcache-explicit>Explicit entries</dfn>

     <dd><p class=note>These are the resources that were listed in the cache's <a href=#concept-appcache-manifest id=appcache:concept-appcache-manifest>manifest</a> in an <a href=#concept-appcache-manifest-explicit id=appcache:concept-appcache-manifest-explicit>explicit section</a>.</p>


     <dt><dfn id=concept-appcache-fallback>Fallback entries</dfn>

     <dd><p class=note>These are the resources that were listed in the cache's <a href=#concept-appcache-manifest id=appcache:concept-appcache-manifest-2>manifest</a> in a <a href=#concept-appcache-manifest-fallback id=appcache:concept-appcache-manifest-fallback>fallback section</a>.</p>


    </dl>

    <p><a href=#concept-appcache-explicit id=appcache:concept-appcache-explicit>Explicit entries</a> and <a href=#concept-appcache-fallback id=appcache:concept-appcache-fallback>Fallback entries</a> can be marked as <dfn id=concept-appcache-foreign>foreign</dfn>, which means that they have a <code id=appcache:attr-html-manifest-3><a href=semantics.html#attr-html-manifest>manifest</a></code> attribute but that it doesn't point at this cache's
    <a href=#concept-appcache-manifest id=appcache:concept-appcache-manifest-3>manifest</a>.</p>

    <p class=note>A URL in the list can be flagged with multiple different types, and thus an
    entry can end up being categorised as multiple entries. For example, an entry can be a manifest
    entry and an explicit entry at the same time, if the manifest is listed within the manifest.</p>

   </li><li>

    <p>Zero or more <dfn id=concept-appcache-fallback-ns>fallback namespaces</dfn>, each of
    which is mapped to a <a href=#concept-appcache-fallback id=appcache:concept-appcache-fallback-2>fallback entry</a>.</p>

    <p class=note>These are URLs used as <a href=#concept-appcache-matches-fallback id=appcache:concept-appcache-matches-fallback>prefix
    match patterns</a> for resources that are to be fetched from the network if possible, or to
    be replaced by the corresponding <a href=#concept-appcache-fallback id=appcache:concept-appcache-fallback-3>fallback entry</a>
    if not. Each namespace URL has the <a href=#same-origin id=appcache:same-origin-2>same origin</a> as <a href=#concept-appcache-manifest id=appcache:concept-appcache-manifest-4>the manifest</a>.</p>

   </li><li>

    <p>Zero or more URLs that form the <dfn id=concept-appcache-onlinesafelist>online
    safelist namespaces</dfn>.</p>

    <p class=note>These are used as prefix match patterns, and declare URLs for which the user
    agent will ignore the application cache, instead fetching them normally (i.e. from the network
    or local HTTP cache as appropriate).</p>

   </li><li>

    <p>An <dfn id=concept-appcache-onlinesafelist-wildcard>online safelist wildcard
    flag</dfn>, which is either <i>open</i> or <i>blocking</i>.</p>

    <p class=note>The <i>open</i> state indicates that any URL not listed as cached is to
    be implicitly treated as being in the <a href=#concept-appcache-onlinesafelist id=appcache:concept-appcache-onlinesafelist>online
    safelist namespaces</a>; the <i>blocking</i> state indicates that URLs not listed
    explicitly in the manifest are to be treated as unavailable.</p>

   </li><li>

    <p>A <dfn id=concept-appcache-mode>cache mode flag</dfn>, which is either in the <dfn id=concept-appcache-mode-fast><i>fast</i></dfn> state or the <dfn id=concept-appcache-mode-prefer-online><i>prefer-online</i></dfn> state.</p>

   </li></ul>

  <p>Each <a href=#application-cache id=appcache:application-cache>application cache</a> has a <dfn id=concept-appcache-completeness>completeness flag</dfn>, which is either <i>complete</i> or
  <i>incomplete</i>.</p>

  <hr>

  <p>An <dfn id=application-cache-group>application cache group</dfn> is a group of <a href=#application-cache id=appcache:application-cache-2>application
  caches</a>, identified by the <a id=appcache:absolute-url href=https://triple-underscore.github.io/URL-ja.html#syntax-url-absolute data-x-internal=absolute-url>absolute URL</a> of a resource <a href=#concept-appcache-manifest id=appcache:concept-appcache-manifest-5>manifest</a> which is used to populate the caches in the
  group.</p>

  <p>An <a href=#application-cache id=appcache:application-cache-3>application cache</a> is <dfn id=concept-appcache-newer>newer</dfn> than
  another if it was created after the other (in other words, <a href=#application-cache id=appcache:application-cache-4>application caches</a> in an <a href=#application-cache-group id=appcache:application-cache-group>application cache group</a> have a chronological
  order).</p>

  <p>Only the newest <a href=#application-cache id=appcache:application-cache-5>application cache</a> in an <a href=#application-cache-group id=appcache:application-cache-group-2>application cache group</a> can
  have its <a href=#concept-appcache-completeness id=appcache:concept-appcache-completeness>completeness flag</a> set to
  <i>incomplete</i>; the others are always all <i>complete</i>.</p>

  <p>Each <a href=#application-cache-group id=appcache:application-cache-group-3>application cache group</a> has an <dfn id=concept-appcache-status>update
  status</dfn>, which is one of the following: <i>idle</i>, <i>checking</i>, <i>downloading</i>.</p>

  <p>A <dfn id=relevant-application-cache>relevant application cache</dfn> is an <a href=#application-cache id=appcache:application-cache-6>application cache</a> that is the <a href=#concept-appcache-newer id=appcache:concept-appcache-newer>newest</a> in its <a href=#application-cache-group id=appcache:application-cache-group-4>group</a> to be <i>complete</i>.</p>

  <p>Each <a href=#application-cache-group id=appcache:application-cache-group-5>application cache group</a> has a <dfn id=concept-appcache-pending-masters>list of pending master entries</dfn>. Each entry in this
  list consists of a resource and a corresponding <code id=appcache:document><a href=dom.html#document>Document</a></code> object. It is used during
  the <a href=#application-cache-download-process id=appcache:application-cache-download-process-2>application cache download process</a> to ensure that new master entries are cached
  even if the <a href=#application-cache-download-process id=appcache:application-cache-download-process-3>application cache download process</a> was already running for their
  <a href=#application-cache-group id=appcache:application-cache-group-6>application cache group</a> when they were loaded.</p>

  <p>An <a href=#application-cache-group id=appcache:application-cache-group-7>application cache group</a> can be marked as <dfn id=concept-appcache-obsolete>obsolete</dfn>, meaning that it must be ignored when looking at
  what <a href=#application-cache-group id=appcache:application-cache-group-8>application cache groups</a> exist.</p>

  <hr>

  <p>A <dfn id=cache-host>cache host</dfn> is a <code id=appcache:document-2><a href=dom.html#document>Document</a></code> or a <code id=appcache:sharedworkerglobalscope><a href=workers.html#sharedworkerglobalscope>SharedWorkerGlobalScope</a></code>
  object. A <a href=#cache-host id=appcache:cache-host>cache host</a> can be associated with an <a href=#application-cache id=appcache:application-cache-7>application cache</a>.</p>

  <p>A <code id=appcache:document-3><a href=dom.html#document>Document</a></code> initially is not associated with an <a href=#application-cache id=appcache:application-cache-8>application cache</a>, but
  can become associated with one early during the page load process, when steps <a href=syntax.html#parser-appcache>in the parser</a> and in the <a href=#navigate id=appcache:navigate-2>navigation</a>
  sections cause <a href=#concept-appcache-init id=appcache:concept-appcache-init>cache selection</a> to occur.</p>

  <p>A <code id=appcache:sharedworkerglobalscope-2><a href=workers.html#sharedworkerglobalscope>SharedWorkerGlobalScope</a></code> can be associated with an <a href=#application-cache id=appcache:application-cache-9>application cache</a>
  when it is created.</p>

  <p>Each <a href=#cache-host id=appcache:cache-host-2>cache host</a> has an associated <code id=appcache:applicationcache><a href=#applicationcache>ApplicationCache</a></code> object.</p>

  <hr>

  <p>Multiple <a href=#application-cache id=appcache:application-cache-10>application caches</a> in different <a href=#application-cache-group id=appcache:application-cache-group-9>application cache groups</a> can contain the same resource,
  e.g. if the manifests all reference that resource. If the user agent is to <dfn id=concept-appcache-selection>select an application cache</dfn> from a list of <a href=#relevant-application-cache id=appcache:relevant-application-cache>relevant application caches</a> that contain a resource, the
  user agent must use the application cache that the user most likely wants to see the resource
  from, taking into account the following:</p>

  <ul><li>which application cache was most recently updated,

   

   </li><li>which application cache was being used to display the resource from which the user decided to
   look at the new resource, and

   

   </li><li>which application cache the user prefers.

  

  </li></ul>

  <hr>

  <p>A URL <dfn id=concept-appcache-matches-fallback>matches a fallback namespace</dfn> if
  there exists a <a href=#relevant-application-cache id=appcache:relevant-application-cache-2>relevant application cache</a> whose <a href=#concept-appcache-manifest id=appcache:concept-appcache-manifest-6>manifest</a>'s URL has the <a href=#same-origin id=appcache:same-origin-3>same origin</a> as the
  URL in question, and that has a <a href=#concept-appcache-fallback-ns id=appcache:concept-appcache-fallback-ns>fallback
  namespace</a> that is a <a id=appcache:prefix-match href=infrastructure.html#prefix-match>prefix match</a> for the URL being examined. If multiple
  fallback namespaces match the same URL, the longest one is the one that matches. A URL looking for
  a fallback namespace can match more than one application cache at a time, but only matches one
  namespace in each cache.</p>

  <div class=example>

   <p>If a manifest <code>http://example.com/app1/manifest</code> declares that <code>http://example.com/resources/images</code> is a fallback namespace, and the user
   navigates to <code>HTTP://EXAMPLE.COM:80/resources/images/cat.png</code>, then the user
   agent will decide that the application cache identified by <code>http://example.com/app1/manifest</code> contains a namespace with a match for that
   URL.</p>

   

  </div>

  



  <h4 id=manifests>7.9.3 キャッシュマニフェスト構文</h4>


  <h5 id=some-sample-manifests>7.9.3.1 サンプルマニフェスト</h5>

  <p><i>この節は非規範的である。</i></p>

  <div class=example>

   <p>This example manifest requires two images and a style sheet to be cached and safelists a CGI
   script.</p>

   <pre>CACHE MANIFEST
# the above line is required

# this is a comment
# there can be as many of these anywhere in the file
# they are all ignored
  # comments can have spaces before them
  # but must be alone on the line

# blank lines are ignored too

# these are files that need to be cached they can either be listed
# first, or a "CACHE:" header could be put before them, as is done
# lower down.
images/sound-icon.png
images/background.png
# note that each file has to be put on its own line

# here is a file for the online safelist -- it isn't cached, and
# references to this file will bypass the cache, always hitting the
# network (or trying to, if the user is offline).
NETWORK:
comm.cgi

# here is another set of files to cache, this time just the CSS file.
CACHE:
style/default.css</pre>

   <p>同様に次のように記述することができる：</p>

   <pre>CACHE MANIFEST
NETWORK:
comm.cgi
CACHE:
style/default.css
images/sound-icon.png
images/background.png</pre>

  </div>

  <div class=example>

   <p>オフラインアプリケーションキャッシュマニフェストは、絶対パスまたは絶対URLを使用することができる：</p>

   <pre>CACHE MANIFEST

/main/home
/main/app.js
/settings/home
/settings/app.js
http://img.example.com/logo.png
http://img.example.com/check.png
http://img.example.com/cross.png</pre>

  </div>

  <div class=example>

   <p>次のマニフェストは、ユーザーがオフラインの間にサイト上の任意のページに表示されている汎用のエラーページを定義する。これはまた、<a href=#concept-appcache-onlinesafelist-wildcard id=some-sample-manifests:concept-appcache-onlinesafelist-wildcard>オンラインセーフリストワイルドカードフラグ</a>が<i>open</i>であることを指定し、他のサイト上のリソースにアクセスがブロックされないことを意味する。（汎用フォールバック名前空間なので、同じサイト上のリソースがすでにブロックされない。）</p>

   <p>このマニフェスト上のすべてのページのように、同じページにヒットする後続はキャッシュからすぐに読み込まれるので、それらが取得されるようにローカルでキャッシュされるだろう。マニフェストが変更されるまで、これらのページは、再度サーバから取得されることはない。マニフェストが変更される際、次にすべてのファイルが再ダウンロードされる。</p>

   <p>スタイルシートや画像などのようなサブリソースは、しかし、通常のHTTPキャッシングセマンティックスを使用してのみキャッシュされる。</p>

   <pre>CACHE MANIFEST
FALLBACK:
/ /offline.html
NETWORK:
*</pre>

  </div>



  <h5 id=writing-cache-manifests>7.9.3.2 キャッシュマニフェストの記述</h5>

  <p>マニフェストは、<code id=writing-cache-manifests:text/cache-manifest><a href=iana.html#text/cache-manifest>text/cache-manifest</a></code><a id=writing-cache-manifests:mime-type href=infrastructure.html#mime-type>MIMEタイプ</a>を使用して配信しなければならない。<code id=writing-cache-manifests:text/cache-manifest-2><a href=iana.html#text/cache-manifest>text/cache-manifest</a></code><a id=writing-cache-manifests:mime-type-2 href=infrastructure.html#mime-type>MIMEタイプ</a>を使用して配信されるすべてのリソースは、この節で説明するように、アプリケーションキャッシュマニフェストの構文に従わなければならない。</p>

  <p>アプリケーションキャッシュマニフェストは、テキストがUTF-8を使用してエンコードされるテキストファイルである。アプリケーションキャッシュマニフェストでのデータは行ベースである。Newlines must be represented by U+000A LINE FEED (LF) characters, U+000D CARRIAGE RETURN (CR) characters, or U+000D CARRIAGE RETURN (CR) U+000A LINE FEED (LF) pairs. <a href=references.html#refsENCODING>[ENCODING]</a></p>

  <p class=note>これは、すべての<code>text/*</code>型が唯一のCRLF改行を許可する必要がある、RFC 2046の<a id=writing-cache-manifests:willful-violation href=introduction.html#willful-violation>故意の違反</a>である。しかし、この要件は時代遅れである。CR、LFおよびCRLFの改行の使用は一般的に支持されており、実際に時にCRLFはテキストエディターでサポートされ<em>ない</em>。<a href=references.html#refsRFC2046>[RFC2046]</a></p>

  <p>The first line of an application cache manifest must consist of the string "CACHE", a single U+0020 SPACE character, the string "MANIFEST", and either a U+0020 SPACE character, a U+0009 CHARACTER TABULATION (tab) character, a U+000A LINE FEED (LF) character, or a U+000D CARRIAGE RETURN (CR) character. The first line may optionally be preceded by a U+FEFF BYTE ORDER MARK (BOM) character. 他のテキストが最初の行にある場合、無視される。</p>

  <p>後続の行がもしあれば、すべて次のいずれかでなければならない：</p>

  <dl><dt>空白行
   <dd>
    <p>Blank lines must consist of zero or more U+0020 SPACE and
    U+0009 CHARACTER TABULATION (tab) characters only.</p>

   <dt>コメント
   <dd>
    <p>Comment lines must consist of zero or more U+0020 SPACE and U+0009 CHARACTER TABULATION (tab)
    characters, followed by a single U+0023 NUMBER SIGN character (#), followed by zero or more
    characters other than U+000A LINE FEED (LF) and U+000D CARRIAGE RETURN (CR) characters.</p>

    <p class=note>コメントは自身のみで行になければならない。If they were to be included on a line with a URL, the "#" would be mistaken for part of a <a href=https://triple-underscore.github.io/URL-ja.html#concept-url-fragment id=writing-cache-manifests:concept-url-fragment data-x-internal=concept-url-fragment>fragment</a>.</p>

   <dt>セクションヘッダー
   <dd>

    <p>セクションヘッダーは、現在のセクションを変更する。可能な4つのセクションヘッダーが存在する：

    <dl><dt><code>CACHE:</code>
     <dd><dfn id=concept-appcache-manifest-explicit>明示的なセクション</dfn>に切り替える。

     <dt><code>FALLBACK:</code>
     <dd><dfn id=concept-appcache-manifest-fallback>代替セクション</dfn>に切り替える。

     <dt><code>NETWORK:</code>
     <dd>Switches to the <dfn id=concept-appcache-manifest-network>online safelist section</dfn>.

     

     <dt><code>SETTINGS:</code>
     <dd><dfn id=concept-appcache-manifest-settings>設定セクション</dfn>に切り替える。

    </dl>

    <p>Section header lines must consist of zero or more U+0020 SPACE and U+0009 CHARACTER
    TABULATION (tab) characters, followed by one of the names above (including the U+003A COLON
    character (:)) followed by zero or more U+0020 SPACE and U+0009 CHARACTER TABULATION (tab)
    characters.</p>

    <p>皮肉なことに、デフォルトでは、現在のセクションは、<a href=#concept-appcache-manifest-explicit id=writing-cache-manifests:concept-appcache-manifest-explicit>明示的なセクション</a>である。</p>

   <dt>現在のセクションのデータ
   <dd>

    <p>データ行が取得しなければならない形式は、現在のセクションに依存する。</p>

    <p>When the current section is the <a href=#concept-appcache-manifest-explicit id=writing-cache-manifests:concept-appcache-manifest-explicit-2>explicit
    section</a>, data lines must consist of zero or more U+0020 SPACE and U+0009 CHARACTER
    TABULATION (tab) characters, a <a id=writing-cache-manifests:valid-url href=infrastructure.html#valid-url>valid URL</a> identifying a resource other than the
    manifest itself, and then zero or more U+0020 SPACE and U+0009 CHARACTER TABULATION (tab)
    characters.</p>

    <p>When the current section is the <a href=#concept-appcache-manifest-fallback id=writing-cache-manifests:concept-appcache-manifest-fallback>fallback
    section</a>, data lines must consist of zero or more U+0020 SPACE and U+0009 CHARACTER
    TABULATION (tab) characters, a <a id=writing-cache-manifests:valid-url-2 href=infrastructure.html#valid-url>valid URL</a> identifying a resource other than the
    manifest itself, one or more U+0020 SPACE and U+0009 CHARACTER TABULATION (tab) characters,
    another <a id=writing-cache-manifests:valid-url-3 href=infrastructure.html#valid-url>valid URL</a> identifying a resource other than the manifest itself, and then
    zero or more U+0020 SPACE and U+0009 CHARACTER TABULATION (tab) characters.</p>

    <p>When the current section is the <a href=#concept-appcache-manifest-network id=writing-cache-manifests:concept-appcache-manifest-network>online
    safelist section</a>, data lines must consist of zero or more U+0020 SPACE and U+0009
    CHARACTER TABULATION (tab) characters, either a single U+002A ASTERISK character (*)  or a <a id=writing-cache-manifests:valid-url-4 href=infrastructure.html#valid-url>valid URL</a> identifying a resource
    other than the manifest itself, and then zero or more U+0020 SPACE and U+0009 CHARACTER
    TABULATION (tab) characters.</p>

    <p>When the current section is the <a href=#concept-appcache-manifest-settings id=writing-cache-manifests:concept-appcache-manifest-settings>settings
    section</a>, data lines must consist of zero or more U+0020 SPACE and U+0009 CHARACTER
    TABULATION (tab) characters, a <a href=#concept-appcache-manifest-setting id=writing-cache-manifests:concept-appcache-manifest-setting>setting</a>,
    and then zero or more U+0020 SPACE and U+0009 CHARACTER TABULATION (tab) characters.</p>

    <p>現在のところ1つの<dfn id=concept-appcache-manifest-setting>設定</dfn>のみが定義される：</p>

    <dl><dt>キャッシュモード設定<dd>これは、文字列"<code>prefer-online</code>"で構成される。この文字列は、<a href=#concept-appcache-mode id=writing-cache-manifests:concept-appcache-mode>キャッシュモード</a>を<a href=#concept-appcache-mode-prefer-online id=writing-cache-manifests:concept-appcache-mode-prefer-online>優先オンライン</a>に設定する。（<a href=#concept-appcache-mode id=writing-cache-manifests:concept-appcache-mode-2>キャッシュモード</a>はデフォルトで<a href=#concept-appcache-mode-fast id=writing-cache-manifests:concept-appcache-mode-fast>高速</a>になる。）</dl>

    <p><a href=#concept-appcache-manifest-settings id=writing-cache-manifests:concept-appcache-manifest-settings-2>設定セクション</a>内で、各<a href=#concept-appcache-manifest-setting id=writing-cache-manifests:concept-appcache-manifest-setting-2>設定</a>は1回以上出現してはならない。</p>



  </dl>

  <p>マニフェストは、複数回のセクションを含んでもよい。セクションは空であってもよい。</p>

  <p><a href=#concept-appcache-fallback-ns id=writing-cache-manifests:concept-appcache-fallback-ns>フォールバック名前空間</a>自体に関連付けられたフォールバックページであるURL、およびそれらの名前空間は、データ行の最初のURLである名前空間、および2番目のURLであるフォールバックページ対応する、<a href=#concept-appcache-manifest-fallback id=writing-cache-manifests:concept-appcache-manifest-fallback-2>フォールバックセクション</a>で指定されなければならない。キャッシュされる他のすべてのページは、<a href=#concept-appcache-manifest-explicit id=writing-cache-manifests:concept-appcache-manifest-explicit-3>明示的なセクション</a>に記載されなければならない。</p>

  <p><a href=#concept-appcache-fallback-ns id=writing-cache-manifests:concept-appcache-fallback-ns-2>フォールバック名前空間</a>および<a href=#concept-appcache-fallback id=writing-cache-manifests:concept-appcache-fallback>フォールバックエントリ</a>は、マニフェスト自身と<a href=#same-origin id=writing-cache-manifests:same-origin>同じ生成元</a>を持たなければならない。<a href=#concept-appcache-fallback-ns id=writing-cache-manifests:concept-appcache-fallback-ns-3>Fallback namespaces</a> must also be <span>in the same path</span> as the manifest's URL.</p>

  <p><a href=#concept-appcache-fallback-ns id=writing-cache-manifests:concept-appcache-fallback-ns-4>フォールバック名前空間</a>は、複数回記載されてはならない。</p>

  <p>ユーザーエージェントが<a href=#concept-appcache-onlinesafelist id=writing-cache-manifests:concept-appcache-onlinesafelist>オンラインセーフリスト</a>に入れる名前空間は、すべて<a href=#concept-appcache-manifest-network id=writing-cache-manifests:concept-appcache-manifest-network-2>オンラインセーフリストセクション</a>で指定されなければならない。(This is needed for any URL that the page is intending to use to communicate back to the server.) To specify that all URLs are automatically safelisted in this way, a U+002A ASTERISK character (*) may be specified as one of the URLs. </p>

  <p>Authors should not include namespaces in the <a href=#concept-appcache-onlinesafelist id=writing-cache-manifests:concept-appcache-onlinesafelist-2>online safelist</a> for which another namespace in
  the <a href=#concept-appcache-onlinesafelist id=writing-cache-manifests:concept-appcache-onlinesafelist-3>online safelist</a> is a <a id=writing-cache-manifests:prefix-match href=infrastructure.html#prefix-match>prefix
  match</a>.</p>

  <p><a href=https://triple-underscore.github.io/URL-ja.html#syntax-url-relative id=writing-cache-manifests:relative-url data-x-internal=relative-url>相対URL</a>はマニフェスト自身のURLを基準に指定されなければならない。マニフェスト内のすべてのURLは、（明示的または暗黙的に、<a href=https://triple-underscore.github.io/URL-ja.html#syntax-url-relative id=writing-cache-manifests:relative-url-2 data-x-internal=relative-url>相対URL</a>を使用して）マニフェスト自身と同じ<a href=https://triple-underscore.github.io/URL-ja.html#concept-url-scheme id=writing-cache-manifests:concept-url-scheme data-x-internal=concept-url-scheme>scheme</a>を持たなければならない。<a href=references.html#refsURL>[URL]</a></p>

  <p>URLs in manifests must not have <a href=https://triple-underscore.github.io/URL-ja.html#concept-url-fragment id=writing-cache-manifests:concept-url-fragment-2 data-x-internal=concept-url-fragment>fragments</a> (i.e. the
  U+0023 NUMBER SIGN character isn't allowed in URLs in manifests).</p>

  <p><a href=#concept-appcache-fallback-ns id=writing-cache-manifests:concept-appcache-fallback-ns-5>Fallback namespaces</a> and namespaces in the
  <a href=#concept-appcache-onlinesafelist id=writing-cache-manifests:concept-appcache-onlinesafelist-4>online safelist</a> are matched by <a id=writing-cache-manifests:prefix-match-2 href=infrastructure.html#prefix-match>prefix
  match</a>.</p>


  

  <h5 id=parsing-cache-manifests>7.9.3.3 Parsing cache manifests</h5>

  <p>When a user agent is to <dfn id=parse-a-manifest>parse a manifest</dfn>, it means that the user agent must run the
  following steps:</p>

  <ol><li>

    <p><a id=parsing-cache-manifests:utf-8-decode href=https://triple-underscore.github.io/Encoding-ja.html#utf-8-decode data-x-internal=utf-8-decode>UTF-8 decode</a> the byte stream corresponding with the manifest to be parsed.</p>

    <p class=note>The <a id=parsing-cache-manifests:utf-8-decode-2 href=https://triple-underscore.github.io/Encoding-ja.html#utf-8-decode data-x-internal=utf-8-decode>UTF-8 decode</a> algorithm strips a leading BOM, if any.</p>

    

   </li><li><p>Let <var>base URL</var> be the <a id=parsing-cache-manifests:absolute-url href=https://triple-underscore.github.io/URL-ja.html#syntax-url-absolute data-x-internal=absolute-url>absolute URL</a> representing the
   manifest.</li><li><p>Apply the <a id=parsing-cache-manifests:url-parser href=https://triple-underscore.github.io/URL-ja.html#concept-url-parser data-x-internal=url-parser>URL parser</a> to <var>base URL</var>, and let <var>manifest path</var>
   be the <a href=https://triple-underscore.github.io/URL-ja.html#concept-url-path id=parsing-cache-manifests:concept-url-path data-x-internal=concept-url-path>path</a> component thus obtained.</li><li><p>Remove all the characters in <var>manifest path</var> after the last U+002F SOLIDUS
   character (/), if any. (The first character and the last character in <var>manifest path</var>
   after this step will both be slashes, the URL path separator character.)</li><li><p>Apply the <a id=parsing-cache-manifests:url-parser-2 href=https://triple-underscore.github.io/URL-ja.html#concept-url-parser data-x-internal=url-parser>URL parser</a> steps to the <var>base URL</var>, so that the
   components from its <a id=parsing-cache-manifests:url-record href=https://triple-underscore.github.io/URL-ja.html#concept-url data-x-internal=url-record>URL record</a> can be used by the subsequent steps of this
   algorithm.</li><li><p>Let <var>explicit URLs</var> be an initially empty list of <a href=https://triple-underscore.github.io/URL-ja.html#syntax-url-absolute id=parsing-cache-manifests:absolute-url-2 data-x-internal=absolute-url>absolute URLs</a> for <a href=#concept-appcache-explicit id=parsing-cache-manifests:concept-appcache-explicit>explicit
   entries</a>.</li><li><p>Let <var>fallback URLs</var> be an initially empty mapping of <a href=#concept-appcache-fallback-ns id=parsing-cache-manifests:concept-appcache-fallback-ns>fallback namespaces</a> to <a href=https://triple-underscore.github.io/URL-ja.html#syntax-url-absolute id=parsing-cache-manifests:absolute-url-3 data-x-internal=absolute-url>absolute URLs</a> for <a href=#concept-appcache-fallback id=parsing-cache-manifests:concept-appcache-fallback>fallback
   entries</a>.</li><li><p>Let <var>online safelist namespaces</var> be an initially empty list of <a href=https://triple-underscore.github.io/URL-ja.html#syntax-url-absolute id=parsing-cache-manifests:absolute-url-4 data-x-internal=absolute-url>absolute URLs</a> for an <a href=#concept-appcache-onlinesafelist id=parsing-cache-manifests:concept-appcache-onlinesafelist>online safelist</a>.</li><li><p>Let <var>online safelist wildcard flag</var> be <i>blocking</i>.  </li><li><p>Let <var>cache mode flag</var> be <i>fast</i>.  </li><li><p>Let <var>input</var> be the decoded text of the manifest's byte stream.</li><li><p>Let <var>position</var> be a pointer into <var>input</var>, initially
   pointing at the first character.</li><li><p>If the characters starting from <var>position</var> are "CACHE", followed by a
   U+0020 SPACE character, followed by "MANIFEST", then advance <var>position</var> to the
   next character after those. Otherwise, this isn't a cache manifest; abort this algorithm with a
   failure while checking for the magic signature.</li><li><p>If the character at <var>position</var> is neither a U+0020 SPACE character, a
   U+0009 CHARACTER TABULATION (tab) character, U+000A LINE FEED (LF) character, nor a U+000D
   CARRIAGE RETURN (CR) character, then this isn't a cache manifest; abort this algorithm with a
   failure while checking for the magic signature.</li><li><p>This is a cache manifest. The algorithm cannot fail beyond
   this point (though bogus lines can get ignored).</li><li><p><a id=parsing-cache-manifests:collect-a-sequence-of-characters href=infrastructure.html#collect-a-sequence-of-characters>Collect a sequence of characters</a> that are <em>not</em> U+000A LINE FEED (LF)
   or U+000D CARRIAGE RETURN (CR) characters, and ignore those characters. (Extra text on the first
   line, after the signature, is ignored.)</li><li><p>Let <var>mode</var> be "explicit".</li><li><p><i>Start of line</i>: If <var>position</var> is past the end of <var>input</var>, then jump to the last step. Otherwise, <a id=parsing-cache-manifests:collect-a-sequence-of-characters-2 href=infrastructure.html#collect-a-sequence-of-characters>collect a sequence of
   characters</a> that are U+000A LINE FEED (LF), U+000D CARRIAGE RETURN (CR), U+0020 SPACE, or
   U+0009 CHARACTER TABULATION (tab) characters.</li><li><p>Now, <a id=parsing-cache-manifests:collect-a-sequence-of-characters-3 href=infrastructure.html#collect-a-sequence-of-characters>collect a sequence of characters</a> that are <em>not</em> U+000A LINE FEED
   (LF) or U+000D CARRIAGE RETURN (CR) characters, and let the result be <var>line</var>.</li><li><p>Drop any trailing U+0020 SPACE and U+0009 CHARACTER TABULATION (tab) characters at the end
   of <var>line</var>.</li><li><p>If <var>line</var> is the empty string, then jump back to the step labeled <i>start
   of line</i>.</li><li><p>If the first character in <var>line</var> is a U+0023 NUMBER SIGN character (#),
   then jump back to the step labeled <i>start of line</i>.</li><li><p>If <var>line</var> equals "CACHE:" (the word "CACHE" followed by a U+003A COLON
   character (:)), then set <var>mode</var> to "explicit" and jump back to the step labeled
   <i>start of line</i>.</li><li><p>If <var>line</var> equals "FALLBACK:" (the word "FALLBACK" followed by a U+003A
   COLON character (:)), then set <var>mode</var> to "fallback" and jump back to the step
   labeled <i>start of line</i>.</li><li><p>If <var>line</var> equals "NETWORK:" (the word "NETWORK" followed by a U+003A
   COLON character (:)), then set <var>mode</var> to "online safelist" and jump back to
   the step labeled <i>start of line</i>.</li><li><p>If <var>line</var> equals "SETTINGS:" (the word "SETTINGS" followed by a U+003A
   COLON character (:)), then set <var>mode</var> to "settings" and jump back to the step
   labeled <i>start of line</i>.</li><li><p>If <var>line</var> ends with a U+003A COLON character (:), then set <var>mode</var> to "unknown" and jump back to the step labeled <i>start of line</i>.</li><li><p>This is either a data line or it is syntactically incorrect.</li><li><p>Let <var>position</var> be a pointer into <var>line</var>, initially
   pointing at the start of the string.</li><li><p>Let <var>tokens</var> be a list of strings, initially empty.</li><li>

    <p>While <var>position</var> doesn't point past the end of <var>line</var>:</p>

    <ol><li><p>Let <var>current token</var> be an empty string.</li><li><p>While <var>position</var> doesn't point past the end of <var>line</var> and the character at <var>position</var> is neither a U+0020 SPACE
     nor a U+0009 CHARACTER TABULATION (tab) character, add the character at <var>position</var> to <var>current token</var> and advance <var>position</var> to the next character in <var>input</var>.</li><li><p>Add <var>current token</var> to the <var>tokens</var> list.</li><li><p>While <var>position</var> doesn't point past the end of <var>line</var> and the character at <var>position</var> is either a U+0020 SPACE
     or a U+0009 CHARACTER TABULATION (tab) character, advance <var>position</var> to the
     next character in <var>input</var>.</li></ol>

   </li><li>

    <p>Process <var>tokens</var> as follows:</p>

    <dl class=switch><dt>If <var>mode</var> is "explicit"<dd>

      <p>Let <var>urlRecord</var> be the result of <a href=https://triple-underscore.github.io/URL-ja.html#concept-url-parser id=parsing-cache-manifests:url-parser-3 data-x-internal=url-parser>parsing</a> the
      first item in <var>tokens</var> with <var>base URL</var>; ignore the rest.</p>

      <p>If <var>urlRecord</var> is failure, then jump back to the step labeled <i>start of
      line</i>.</p>

      <p>If <var>urlRecord</var> has a different <a href=https://triple-underscore.github.io/URL-ja.html#concept-url-scheme id=parsing-cache-manifests:concept-url-scheme data-x-internal=concept-url-scheme>scheme</a>
      component than <var>base URL</var> (the manifest's URL), then jump back to the step labeled
      <i>start of line</i>.</p>

      <p>Let <var>new URL</var> be the result of applying the <a href=https://triple-underscore.github.io/URL-ja.html#concept-url-serializer id=parsing-cache-manifests:concept-url-serialiser data-x-internal=concept-url-serialiser>URL serialiser</a> algorithm to <var>urlRecord</var>, with
      the <i>exclude fragment flag</i> set.</p>

      <p>Add <var>new URL</var> to the <var>explicit URLs</var>.</p>

     <dt>If <var>mode</var> is "fallback"<dd>

      <p>Let <var>part one</var> be the first token in <var>tokens</var>, and let
      <var>part two</var> be the second token in <var>tokens</var>.</p>

      <p>Let <var>urlRecordOne</var> be the result of <a href=https://triple-underscore.github.io/URL-ja.html#concept-url-parser id=parsing-cache-manifests:url-parser-4 data-x-internal=url-parser>parsing</a>
      <var>part one</var> with <var>base URL</var>.</p>

      <p>Let <var>urlRecordTwo</var> be the result of <a href=https://triple-underscore.github.io/URL-ja.html#concept-url-parser id=parsing-cache-manifests:url-parser-5 data-x-internal=url-parser>parsing</a>
      <var>part two</var> with <var>base URL</var>.</p>

      <p>If either <var>urlRecordOne</var> or <var>urlRecordTwo</var> is failure, then jump back to the
      step labeled <i>start of line</i>.</p>

      <p>If the <a href=https://triple-underscore.github.io/URL-ja.html#concept-url-origin id=parsing-cache-manifests:concept-url-origin data-x-internal=concept-url-origin>origin</a> of either <var>urlRecordOne</var> or
      <var>urlRecordTwo</var> is not <a href=#same-origin id=parsing-cache-manifests:same-origin>same origin</a> with the manifest's URL <a href=https://triple-underscore.github.io/URL-ja.html#concept-url-origin id=parsing-cache-manifests:concept-url-origin-2 data-x-internal=concept-url-origin>origin</a>, then jump back to the step labeled <i>start of
      line</i>.</p>

      <p>Let <var>part one path</var> be the <a href=https://triple-underscore.github.io/URL-ja.html#concept-url-path id=parsing-cache-manifests:concept-url-path-2 data-x-internal=concept-url-path>path</a> component
      of <var>urlRecordOne</var>.</p>

      <p>If <var>manifest path</var> is not a <a id=parsing-cache-manifests:prefix-match href=infrastructure.html#prefix-match>prefix match</a> for <var>part one
      path</var>, then jump back to the step labeled <i>start of line</i>.</p> 


      <p>Let <var>part one</var> be the result of applying the <a href=https://triple-underscore.github.io/URL-ja.html#concept-url-serializer id=parsing-cache-manifests:concept-url-serialiser-2 data-x-internal=concept-url-serialiser>URL serialiser</a> algorithm to <var>urlRecordOne</var>,
      with the <i>exclude fragment flag</i> set.</p>

      <p>Let <var>part two</var> be the result of applying the <a href=https://triple-underscore.github.io/URL-ja.html#concept-url-serializer id=parsing-cache-manifests:concept-url-serialiser-3 data-x-internal=concept-url-serialiser>URL serialiser</a> algorithm to <var>urlRecordTwo</var>,
      with the <i>exclude fragment flag</i> set.</p>

      <p>If <var>part one</var> is already in the <var>fallback URLs</var> mapping
      as a <a href=#concept-appcache-fallback-ns id=parsing-cache-manifests:concept-appcache-fallback-ns-2>fallback namespace</a>, then jump back to
      the step labeled <i>start of line</i>.</p>

      <p>Otherwise, add <var>part one</var> to the <var>fallback URLs</var>
      mapping as a <a href=#concept-appcache-fallback-ns id=parsing-cache-manifests:concept-appcache-fallback-ns-3>fallback namespace</a>, mapped to
      <var>part two</var> as the <a href=#concept-appcache-fallback id=parsing-cache-manifests:concept-appcache-fallback-2>fallback
      entry</a>.</p>

     <dt>If <var>mode</var> is "online safelist"<dd>

      <p>If the first item in <var>tokens</var> is a U+002A ASTERISK character (*), then
      set <var>online safelist wildcard flag</var> to <i>open</i> and jump back
      to the step labeled <i>start of line</i>.</p>

      <p>Otherwise, let <var>urlRecord</var> be the result of <a href=https://triple-underscore.github.io/URL-ja.html#concept-url-parser id=parsing-cache-manifests:url-parser-6 data-x-internal=url-parser>parsing</a> the first item in <var>tokens</var> with <var>base URL</var>.</p>

      <p>If <var>urlRecord</var> is failure, then jump back to the step labeled <i>start of
      line</i>.</p>

      <p>If <var>urlRecord</var> has a different <a href=https://triple-underscore.github.io/URL-ja.html#concept-url-scheme id=parsing-cache-manifests:concept-url-scheme-2 data-x-internal=concept-url-scheme>scheme</a>
      component than <var>base URL</var> (the manifest's URL), then jump back to the step labeled
      <i>start of line</i>.</p>

      <p>Let <var>new URL</var> be the result of applying the <a href=https://triple-underscore.github.io/URL-ja.html#concept-url-serializer id=parsing-cache-manifests:concept-url-serialiser-4 data-x-internal=concept-url-serialiser>URL serialiser</a> algorithm to <var>urlRecord</var>, with
      the <i>exclude fragment flag</i> set.</p>

      <p>Add <var>new URL</var> to the <var>online safelist namespaces</var>.</p>

     <dt>If <var>mode</var> is "settings"<dd>

      <p>If <var>tokens</var> contains a single token, and that token is a
      <a id=parsing-cache-manifests:case-sensitive href=infrastructure.html#case-sensitive>case-sensitive</a> match for the string "<code>prefer-online</code>", then
      set <var>cache mode flag</var> to <i>prefer-online</i> and jump back to the
      step labeled <i>start of line</i>.</p>

      <p>Otherwise, the line is an unsupported setting: do nothing; the line is ignored.</p>

     <dt>If <var>mode</var> is "unknown"<dd>

      <p>何もしない。The line is ignored.</p>

     </dl>

   </li><li><p>Jump back to the step labeled <i>start of line</i>. (That step jumps to the next, and last,
   step when the end of the file is reached.)</li><li><p>Return the <var>explicit URLs</var> list, the <var>fallback URLs</var>
   mapping, the <var>online safelist namespaces</var>, the <var>online safelist
   wildcard flag</var>, and the <var>cache mode flag</var>.</li></ol>

  <div class=note>

   <p>The resource that declares the manifest (with the <code id=parsing-cache-manifests:attr-html-manifest><a href=semantics.html#attr-html-manifest>manifest</a></code> attribute) will always get taken from the cache,
   whether it is listed in the cache or not, even if it is listed in an <a href=#concept-appcache-onlinesafelist id=parsing-cache-manifests:concept-appcache-onlinesafelist-2>online safelist namespace</a>.</p>

   <p>If a resource is listed in the <a href=#concept-appcache-manifest-explicit id=parsing-cache-manifests:concept-appcache-manifest-explicit>explicit
   section</a> or as a <a href=#concept-appcache-fallback id=parsing-cache-manifests:concept-appcache-fallback-3>fallback entry</a> in the <a href=#concept-appcache-manifest-fallback id=parsing-cache-manifests:concept-appcache-manifest-fallback>fallback section</a>, the resource will always be
   taken from the cache, regardless of any other matching entries in the <a href=#concept-appcache-fallback-ns id=parsing-cache-manifests:concept-appcache-fallback-ns-4>fallback namespaces</a> or <a href=#concept-appcache-onlinesafelist id=parsing-cache-manifests:concept-appcache-onlinesafelist-3>online safelist namespaces</a>.</p>

   <p>When a <a href=#concept-appcache-fallback-ns id=parsing-cache-manifests:concept-appcache-fallback-ns-5>fallback namespace</a> and an <a href=#concept-appcache-onlinesafelist id=parsing-cache-manifests:concept-appcache-onlinesafelist-4>online safelist namespace</a> overlap, the <a href=#concept-appcache-onlinesafelist id=parsing-cache-manifests:concept-appcache-onlinesafelist-5>online safelist namespace</a> has priority.</p>

   <p>The <a href=#concept-appcache-onlinesafelist-wildcard id=parsing-cache-manifests:concept-appcache-onlinesafelist-wildcard>online safelist wildcard
   flag</a> is applied last, only for URLs that match neither the <a href=#concept-appcache-onlinesafelist id=parsing-cache-manifests:concept-appcache-onlinesafelist-6>online safelist namespace</a> nor the <a href=#concept-appcache-fallback-ns id=parsing-cache-manifests:concept-appcache-fallback-ns-6>fallback namespace</a> and that are not listed in the
   <a href=#concept-appcache-manifest-explicit id=parsing-cache-manifests:concept-appcache-manifest-explicit-2>explicit section</a>.</p>

  </div>


  <h4 id=downloading-or-updating-an-application-cache>7.9.4 Downloading or updating an application cache</h4>

  <p>When the user agent is required (by other parts of this specification) to start the
  <dfn id=application-cache-download-process>application cache download process</dfn> for an <a id=downloading-or-updating-an-application-cache:absolute-url href=https://triple-underscore.github.io/URL-ja.html#syntax-url-absolute data-x-internal=absolute-url>absolute URL</a> purported to
  identify a <a href=#concept-appcache-manifest id=downloading-or-updating-an-application-cache:concept-appcache-manifest>manifest</a>, or for an <a href=#application-cache-group id=downloading-or-updating-an-application-cache:application-cache-group>application
  cache group</a>, potentially given a particular <a href=#cache-host id=downloading-or-updating-an-application-cache:cache-host>cache host</a>, and potentially given
  a <a href=#concept-appcache-master id=downloading-or-updating-an-application-cache:concept-appcache-master>master</a> resource, the user agent must run the steps
  below. These steps are always run <a id=downloading-or-updating-an-application-cache:in-parallel href=infrastructure.html#in-parallel>in parallel</a> with the <a id=downloading-or-updating-an-application-cache:event-loop href=webappapis.html#event-loop>event loop</a>
  <a href=webappapis.html#concept-task id=downloading-or-updating-an-application-cache:concept-task>tasks</a>.</p>

  <p>Some of these steps have requirements that only apply if the user agent <dfn id=shows-caching-progress>shows caching
  progress</dfn>. Support for this is optional. Caching progress UI could consist of a progress bar
  or message panel in the user agent's interface, or an overlay, or something else. Certain events
  fired during the <a href=#application-cache-download-process id=downloading-or-updating-an-application-cache:application-cache-download-process>application cache download process</a> allow the script to override the
  display of such an interface. (Such events are delayed until after the <code id=downloading-or-updating-an-application-cache:event-load><a href=indices.html#event-load>load</a></code> event has fired.)

  The goal of this is to allow Web applications to provide more
  seamless update mechanisms, hiding from the user the mechanics of the application cache mechanism.
  User agents may display user interfaces independent of this, but are encouraged to not show
  prominent update progress notifications for applications that cancel the relevant events.</p>

  <p>The <a href=#application-cache-download-process id=downloading-or-updating-an-application-cache:application-cache-download-process-2>application cache download process</a> steps are as follows:

  

  <ol><li><p>Optionally, wait until the permission to start the <a href=#application-cache-download-process id=downloading-or-updating-an-application-cache:application-cache-download-process-3>application cache download
   process</a> has been obtained from the user and until the user agent is confident that the
   network is available. This could include doing nothing until the user explicitly opts-in to
   caching the site, or could involve prompting the user for permission. The algorithm might never
   get past this point. (This step is particularly intended to be used by user agents running on
   severely space-constrained devices or in highly privacy-sensitive environments).</li><li>

    <p>Atomically, so as to avoid race conditions, perform the following substeps:</p>

    <ol><li>

      <p>Pick the appropriate substeps:</p>

      <dl class=switch><dt>If these steps were invoked with an <a id=downloading-or-updating-an-application-cache:absolute-url-2 href=https://triple-underscore.github.io/URL-ja.html#syntax-url-absolute data-x-internal=absolute-url>absolute URL</a> purported to identify a
       <a href=#concept-appcache-manifest id=downloading-or-updating-an-application-cache:concept-appcache-manifest-2>manifest</a><dd>

        <p>Let <var>manifest URL</var> be that <a id=downloading-or-updating-an-application-cache:absolute-url-3 href=https://triple-underscore.github.io/URL-ja.html#syntax-url-absolute data-x-internal=absolute-url>absolute URL</a>.</p>

        <p>If there is no <a href=#application-cache-group id=downloading-or-updating-an-application-cache:application-cache-group-2>application cache group</a> identified by <var>manifest
        URL</var>, then create a new <a href=#application-cache-group id=downloading-or-updating-an-application-cache:application-cache-group-3>application cache group</a> identified by <var>manifest URL</var>. Initially, it has no <a href=#application-cache id=downloading-or-updating-an-application-cache:application-cache>application caches</a>. One will be created later in this algorithm.</p>

       <dt>If these steps were invoked with an <a href=#application-cache-group id=downloading-or-updating-an-application-cache:application-cache-group-4>application cache group</a><dd>

        <p>Let <var>manifest URL</var> be the <a id=downloading-or-updating-an-application-cache:absolute-url-4 href=https://triple-underscore.github.io/URL-ja.html#syntax-url-absolute data-x-internal=absolute-url>absolute URL</a> of the <a href=#concept-appcache-manifest id=downloading-or-updating-an-application-cache:concept-appcache-manifest-3>manifest</a> used to identify the <a href=#application-cache-group id=downloading-or-updating-an-application-cache:application-cache-group-5>application
        cache group</a> to be updated.</p>

        <p>If that <a href=#application-cache-group id=downloading-or-updating-an-application-cache:application-cache-group-6>application cache group</a> is <a href=#concept-appcache-obsolete id=downloading-or-updating-an-application-cache:concept-appcache-obsolete>obsolete</a>, then abort this instance of the
        <a href=#application-cache-download-process id=downloading-or-updating-an-application-cache:application-cache-download-process-4>application cache download process</a>. This can happen if another instance of this
        algorithm found the manifest to be 404 or 410 while this algorithm was waiting in the first
        step above.</p>

       </dl>

     </li><li><p>Let <var>cache group</var> be the <a href=#application-cache-group id=downloading-or-updating-an-application-cache:application-cache-group-7>application cache group</a>
     identified by <var>manifest URL</var>.</li><li><p>If these steps were invoked with a <a href=#concept-appcache-master id=downloading-or-updating-an-application-cache:concept-appcache-master-2>master</a>
     resource, then add the resource, along with the resource's <code id=downloading-or-updating-an-application-cache:document><a href=dom.html#document>Document</a></code>, to <var>cache group</var>'s <a href=#concept-appcache-pending-masters id=downloading-or-updating-an-application-cache:concept-appcache-pending-masters>list of pending
     master entries</a>.</li><li><p>If these steps were invoked with a <a href=#cache-host id=downloading-or-updating-an-application-cache:cache-host-2>cache host</a>, and the <a href=#concept-appcache-status id=downloading-or-updating-an-application-cache:concept-appcache-status>status</a> of <var>cache group</var> is
     <i>checking</i> or <i>downloading</i>, then <a href=#queue-a-post-load-task id=downloading-or-updating-an-application-cache:queue-a-post-load-task>queue a post-load task</a> to <a id=downloading-or-updating-an-application-cache:fire-a-simple-event href=webappapis.html#fire-a-simple-event>fire a
     simple event</a> named <code id=downloading-or-updating-an-application-cache:event-appcache-checking><a href=#event-appcache-checking>checking</a></code> that is
     cancelable at the <code id=downloading-or-updating-an-application-cache:applicationcache><a href=#applicationcache>ApplicationCache</a></code> singleton of that <a href=#cache-host id=downloading-or-updating-an-application-cache:cache-host-3>cache host</a>. The
     default action of this event must be, if the user agent <a href=#shows-caching-progress id=downloading-or-updating-an-application-cache:shows-caching-progress>shows caching progress</a>,
     the display of some sort of user interface indicating to the user that the user agent is
     checking to see if it can download the application.</li><li><p>If these steps were invoked with a <a href=#cache-host id=downloading-or-updating-an-application-cache:cache-host-4>cache host</a>, and the <a href=#concept-appcache-status id=downloading-or-updating-an-application-cache:concept-appcache-status-2>status</a> of <var>cache group</var> is
     <i>downloading</i>, then also <a href=#queue-a-post-load-task id=downloading-or-updating-an-application-cache:queue-a-post-load-task-2>queue a post-load task</a> to <a id=downloading-or-updating-an-application-cache:fire-a-simple-event-2 href=webappapis.html#fire-a-simple-event>fire a simple
     event</a> named <code id=downloading-or-updating-an-application-cache:event-appcache-downloading><a href=#event-appcache-downloading>downloading</a></code> that is
     cancelable at the <code id=downloading-or-updating-an-application-cache:applicationcache-2><a href=#applicationcache>ApplicationCache</a></code> singleton of that <a href=#cache-host id=downloading-or-updating-an-application-cache:cache-host-5>cache host</a>. The
     default action of this event must be, if the user agent <a href=#shows-caching-progress id=downloading-or-updating-an-application-cache:shows-caching-progress-2>shows caching progress</a>,
     the display of some sort of user interface indicating to the user the application is being
     downloaded.</li><li><p>If the <a href=#concept-appcache-status id=downloading-or-updating-an-application-cache:concept-appcache-status-3>status</a> of the <var>cache
     group</var> is either <i>checking</i> or <i>downloading</i>, then abort this instance of the
     <a href=#application-cache-download-process id=downloading-or-updating-an-application-cache:application-cache-download-process-5>application cache download process</a>, as an update is already in progress.</li><li><p>Set the <a href=#concept-appcache-status id=downloading-or-updating-an-application-cache:concept-appcache-status-4>status</a> of <var>cache
     group</var> to <i>checking</i>.</p>

     </li><li><p>For each <a href=#cache-host id=downloading-or-updating-an-application-cache:cache-host-6>cache host</a> associated with an <a href=#application-cache id=downloading-or-updating-an-application-cache:application-cache-2>application cache</a> in
     <var>cache group</var>, <a href=#queue-a-post-load-task id=downloading-or-updating-an-application-cache:queue-a-post-load-task-3>queue a post-load task</a> to <a id=downloading-or-updating-an-application-cache:fire-a-simple-event-3 href=webappapis.html#fire-a-simple-event>fire a simple
     event</a> that is cancelable named <code id=downloading-or-updating-an-application-cache:event-appcache-checking-2><a href=#event-appcache-checking>checking</a></code> at
     the <code id=downloading-or-updating-an-application-cache:applicationcache-3><a href=#applicationcache>ApplicationCache</a></code> singleton of the <a href=#cache-host id=downloading-or-updating-an-application-cache:cache-host-7>cache host</a>. The default action
     of these events must be, if the user agent <a href=#shows-caching-progress id=downloading-or-updating-an-application-cache:shows-caching-progress-3>shows caching progress</a>, the display of
     some sort of user interface indicating to the user that the user agent is checking for the
     availability of updates.</li></ol>

    <p class=note>The remainder of the steps run <a id=downloading-or-updating-an-application-cache:in-parallel-2 href=infrastructure.html#in-parallel>in parallel</a>.</p>

    <p>If <var>cache group</var> already has an <a href=#application-cache id=downloading-or-updating-an-application-cache:application-cache-3>application cache</a> in it, then
    this is an <dfn id=concept-appcache-upgrade>upgrade attempt</dfn>. Otherwise, this is a
    <dfn id=concept-appcache-cache>cache attempt</dfn>.</p>

   </li><li><p>If this is a <a href=#concept-appcache-cache id=downloading-or-updating-an-application-cache:concept-appcache-cache>cache attempt</a>, then this
   algorithm was invoked with a <a href=#cache-host id=downloading-or-updating-an-application-cache:cache-host-8>cache host</a>; <a href=#queue-a-post-load-task id=downloading-or-updating-an-application-cache:queue-a-post-load-task-4>queue a post-load task</a> to
   <a id=downloading-or-updating-an-application-cache:fire-a-simple-event-4 href=webappapis.html#fire-a-simple-event>fire a simple event</a> named <code id=downloading-or-updating-an-application-cache:event-appcache-checking-3><a href=#event-appcache-checking>checking</a></code> that
   is cancelable at the <code id=downloading-or-updating-an-application-cache:applicationcache-4><a href=#applicationcache>ApplicationCache</a></code> singleton of that <a href=#cache-host id=downloading-or-updating-an-application-cache:cache-host-9>cache host</a>. The
   default action of this event must be, if the user agent <a href=#shows-caching-progress id=downloading-or-updating-an-application-cache:shows-caching-progress-4>shows caching progress</a>, the
   display of some sort of user interface indicating to the user that the user agent is checking for
   the availability of updates.</li><li><p>Let <var>request</var> be a new <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-request id=downloading-or-updating-an-application-cache:concept-request data-x-internal=concept-request>request</a> whose
   <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-request-url id=downloading-or-updating-an-application-cache:concept-request-url data-x-internal=concept-request-url>url</a> is <var>manifest URL</var>, <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-request-client id=downloading-or-updating-an-application-cache:concept-request-client data-x-internal=concept-request-client>client</a> is null, <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-request-destination id=downloading-or-updating-an-application-cache:concept-request-destination data-x-internal=concept-request-destination>destination</a> is "<code>subresource</code>",
   <a id=downloading-or-updating-an-application-cache:omit-origin-header-flag href=https://triple-underscore.github.io/Fetch-ja.html#omit-origin-header-flag data-x-internal=omit-origin-header-flag>omit-<code>Origin</code>-header flag</a> is set, <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-request-referrer id=downloading-or-updating-an-application-cache:concept-request-referrer data-x-internal=concept-request-referrer>referrer</a> is "<code>no-referrer</code>",
   <a id=downloading-or-updating-an-application-cache:synchronous-flag href=https://triple-underscore.github.io/Fetch-ja.html#synchronous-flag data-x-internal=synchronous-flag>synchronous flag</a> is set, <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-request-credentials-mode id=downloading-or-updating-an-application-cache:concept-request-credentials-mode data-x-internal=concept-request-credentials-mode>credentials
   mode</a> is "<code>include</code>", and whose <a id=downloading-or-updating-an-application-cache:use-url-credentials-flag href=https://triple-underscore.github.io/Fetch-ja.html#concept-request-use-url-credentials-flag data-x-internal=use-url-credentials-flag>use-URL-credentials
   flag</a> is set.</li><li>

    <p><i>Fetching the manifest</i>: Let <var>manifest</var> be the result of <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-fetch id=downloading-or-updating-an-application-cache:concept-fetch data-x-internal=concept-fetch>fetching</a> <var>request</var>. HTTP caching semantics should be
    honored for this request.</p>

    <p>Parse <var>manifest</var>'s <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-response-body id=downloading-or-updating-an-application-cache:concept-response-body data-x-internal=concept-response-body>body</a> according to the
    <a href=#parse-a-manifest id=downloading-or-updating-an-application-cache:parse-a-manifest>rules for parsing manifests</a>, obtaining a list of
    <a href=#concept-appcache-explicit id=downloading-or-updating-an-application-cache:concept-appcache-explicit>explicit entries</a>, <a href=#concept-appcache-fallback id=downloading-or-updating-an-application-cache:concept-appcache-fallback>fallback entries</a> and the <a href=#concept-appcache-fallback-ns id=downloading-or-updating-an-application-cache:concept-appcache-fallback-ns>fallback namespaces</a> that map to them, entries for
    the <a href=#concept-appcache-onlinesafelist id=downloading-or-updating-an-application-cache:concept-appcache-onlinesafelist>online safelist</a>, and values for the
    <a href=#concept-appcache-onlinesafelist-wildcard id=downloading-or-updating-an-application-cache:concept-appcache-onlinesafelist-wildcard>online safelist wildcard flag</a>
    and the <a href=#concept-appcache-mode id=downloading-or-updating-an-application-cache:concept-appcache-mode>cache mode flag</a>.</p>

    <p class=note>The <a id=downloading-or-updating-an-application-cache:mime-type href=infrastructure.html#mime-type>MIME type</a> of the resource is ignored — it is assumed to
    be <code id=downloading-or-updating-an-application-cache:text/cache-manifest><a href=iana.html#text/cache-manifest>text/cache-manifest</a></code>. In the future, if new manifest formats are supported, the
    different types will probably be distinguished on the basis of the file signatures (for the
    current format, that is the "<code>CACHE&nbsp;MANIFEST</code>" string at the top of the
    file).</p>

   </li><li>

    <p>If <i>fetching the manifest</i> fails due to a 404 or 410 response status, then run these
    substeps:</p>

    <ol><li><p>Mark <var>cache group</var> as <a href=#concept-appcache-obsolete id=downloading-or-updating-an-application-cache:concept-appcache-obsolete-2>obsolete</a>. This <var>cache group</var> no
     longer exists for any purpose other than the processing of <code id=downloading-or-updating-an-application-cache:document-2><a href=dom.html#document>Document</a></code> objects
     already associated with an <a href=#application-cache id=downloading-or-updating-an-application-cache:application-cache-4>application cache</a> in the <var>cache
     group</var>.</li><li><p>Let <var>task list</var> be an empty list of <a href=webappapis.html#concept-task id=downloading-or-updating-an-application-cache:concept-task-2>tasks</a>.</p>

     </li><li><p>For each <a href=#cache-host id=downloading-or-updating-an-application-cache:cache-host-10>cache host</a> associated with an <a href=#application-cache id=downloading-or-updating-an-application-cache:application-cache-5>application cache</a> in
     <var>cache group</var>, create a <a href=webappapis.html#concept-task id=downloading-or-updating-an-application-cache:concept-task-3>task</a> to <a id=downloading-or-updating-an-application-cache:fire-a-simple-event-5 href=webappapis.html#fire-a-simple-event>fire
     a simple event</a> named <code id=downloading-or-updating-an-application-cache:event-appcache-obsolete><a href=#event-appcache-obsolete>obsolete</a></code> that is
     cancelable at the <code id=downloading-or-updating-an-application-cache:applicationcache-5><a href=#applicationcache>ApplicationCache</a></code> singleton of the <a href=#cache-host id=downloading-or-updating-an-application-cache:cache-host-11>cache host</a>, and
     append it to <var>task list</var>. The default action of these events must be, if the
     user agent <a href=#shows-caching-progress id=downloading-or-updating-an-application-cache:shows-caching-progress-5>shows caching progress</a>, the display of some sort of user interface
     indicating to the user that the application is no longer available for offline use.</li><li><p>For each entry in <var>cache group</var>'s <a href=#concept-appcache-pending-masters id=downloading-or-updating-an-application-cache:concept-appcache-pending-masters-2>list of pending master entries</a>, create a <a href=webappapis.html#concept-task id=downloading-or-updating-an-application-cache:concept-task-4>task</a> to <a id=downloading-or-updating-an-application-cache:fire-a-simple-event-6 href=webappapis.html#fire-a-simple-event>fire a simple event</a> that is cancelable named
     <code id=downloading-or-updating-an-application-cache:event-appcache-error><a href=#event-appcache-error>error</a></code> (not <code id=downloading-or-updating-an-application-cache:event-appcache-obsolete-2><a href=#event-appcache-obsolete>obsolete</a></code>!) at the <code id=downloading-or-updating-an-application-cache:applicationcache-6><a href=#applicationcache>ApplicationCache</a></code>
     singleton of the <code id=downloading-or-updating-an-application-cache:document-3><a href=dom.html#document>Document</a></code> for this entry, if there still is one, and append it to
     <var>task list</var>. The default action of this event must be, if the user agent
     <a href=#shows-caching-progress id=downloading-or-updating-an-application-cache:shows-caching-progress-6>shows caching progress</a>, the display of some sort of user interface indicating to
     the user that the user agent failed to save the application for offline use.</li><li><p>If <var>cache group</var> has an <a href=#application-cache id=downloading-or-updating-an-application-cache:application-cache-6>application cache</a> whose <a href=#concept-appcache-completeness id=downloading-or-updating-an-application-cache:concept-appcache-completeness>completeness flag</a> is <i>incomplete</i>, then
     discard that <a href=#application-cache id=downloading-or-updating-an-application-cache:application-cache-7>application cache</a>.</p>

     </li><li><p>If appropriate, remove any user interface indicating that an update for this cache is in
     progress.</li><li><p>Let the <a href=#concept-appcache-status id=downloading-or-updating-an-application-cache:concept-appcache-status-5>status</a> of <var>cache
     group</var> be <i>idle</i>.</li><li><p>For each <a href=webappapis.html#concept-task id=downloading-or-updating-an-application-cache:concept-task-5>task</a> in <var>task list</var>, <a href=#queue-a-post-load-task id=downloading-or-updating-an-application-cache:queue-a-post-load-task-5>queue that task as a post-load task</a>.</li><li><p>Abort the <a href=#application-cache-download-process id=downloading-or-updating-an-application-cache:application-cache-download-process-6>application cache download process</a>.</li></ol>

   </li><li>

    <p>Otherwise, if <i>fetching the manifest</i> fails in some other way (e.g. the server returns
    another 4xx or 5xx response, or there is a DNS error, or the connection times out, or the user
    cancels the download, or the parser for manifests fails when checking the magic signature), or
    if the server returned a redirect, then run the <a href=#cache-failure-steps id=downloading-or-updating-an-application-cache:cache-failure-steps>cache failure steps</a>. <a href=references.html#refsHTTP>[HTTP]</a></p>

   </li><li>

    <p>If this is an <a href=#concept-appcache-upgrade id=downloading-or-updating-an-application-cache:concept-appcache-upgrade>upgrade attempt</a> and the newly
    downloaded <var>manifest</var> is byte-for-byte identical to the manifest found in the
    <a href=#concept-appcache-newer id=downloading-or-updating-an-application-cache:concept-appcache-newer>newest</a> <a href=#application-cache id=downloading-or-updating-an-application-cache:application-cache-8>application cache</a> in <var>cache
    group</var>, or the response status is <code>304</code>, then run these substeps:</p>

    <ol><li><p>Let <var>cache</var> be the <a href=#concept-appcache-newer id=downloading-or-updating-an-application-cache:concept-appcache-newer-2>newest</a>
     <a href=#application-cache id=downloading-or-updating-an-application-cache:application-cache-9>application cache</a> in <var>cache group</var>.</li><li><p>Let <var>task list</var> be an empty list of <a href=webappapis.html#concept-task id=downloading-or-updating-an-application-cache:concept-task-6>tasks</a>.</p>

     </li><li>

      <p>For each entry in <var>cache group</var>'s <a href=#concept-appcache-pending-masters id=downloading-or-updating-an-application-cache:concept-appcache-pending-masters-3>list of pending master entries</a>, wait for the
      resource for this entry to have either completely downloaded or failed.</p>

      <p>If the download failed (e.g. the server returns a 4xx or 5xx response, or there is a DNS
      error, the connection times out, or the user cancels the download), or if the resource is
      labeled with the "no-store" cache directive, then create a <a href=webappapis.html#concept-task id=downloading-or-updating-an-application-cache:concept-task-7>task</a> to <a id=downloading-or-updating-an-application-cache:fire-a-simple-event-7 href=webappapis.html#fire-a-simple-event>fire a simple event</a> that is cancelable named
      <code id=downloading-or-updating-an-application-cache:event-appcache-error-2><a href=#event-appcache-error>error</a></code> at the <code id=downloading-or-updating-an-application-cache:applicationcache-7><a href=#applicationcache>ApplicationCache</a></code>
      singleton of the <code id=downloading-or-updating-an-application-cache:document-4><a href=dom.html#document>Document</a></code> for this entry, if there still is one, and append it to
      <var>task list</var>. The default action of this event must be, if the user agent <a href=#shows-caching-progress id=downloading-or-updating-an-application-cache:shows-caching-progress-7>shows
      caching progress</a>, the display of some sort of user interface indicating to the user
      that the user agent failed to save the application for offline use.</p>

      <p>Otherwise, associate the <code id=downloading-or-updating-an-application-cache:document-5><a href=dom.html#document>Document</a></code> for this entry with <var>cache</var>; store the resource for this entry in <var>cache</var>, if it
      isn't already there, and categorise its entry as a <a href=#concept-appcache-master id=downloading-or-updating-an-application-cache:concept-appcache-master-3>master entry</a>. If applying the <a id=downloading-or-updating-an-application-cache:url-parser href=https://triple-underscore.github.io/URL-ja.html#concept-url-parser data-x-internal=url-parser>URL parser</a>
      algorithm to the resource's <a id=downloading-or-updating-an-application-cache:url href=https://triple-underscore.github.io/URL-ja.html#concept-url data-x-internal=url>URL</a> results in a <a id=downloading-or-updating-an-application-cache:url-record href=https://triple-underscore.github.io/URL-ja.html#concept-url data-x-internal=url-record>URL record</a> that has a
      non-null <a href=https://triple-underscore.github.io/URL-ja.html#concept-url-fragment id=downloading-or-updating-an-application-cache:concept-url-fragment data-x-internal=concept-url-fragment>fragment</a> component, the <a id=downloading-or-updating-an-application-cache:url-2 href=https://triple-underscore.github.io/URL-ja.html#concept-url data-x-internal=url>URL</a>
      used for the entry in <var>cache</var> must instead be the <a id=downloading-or-updating-an-application-cache:absolute-url-5 href=https://triple-underscore.github.io/URL-ja.html#syntax-url-absolute data-x-internal=absolute-url>absolute URL</a>
      obtained from applying the <a href=https://triple-underscore.github.io/URL-ja.html#concept-url-serializer id=downloading-or-updating-an-application-cache:concept-url-serialiser data-x-internal=concept-url-serialiser>URL serialiser</a>
      algorithm to the <a id=downloading-or-updating-an-application-cache:url-record-2 href=https://triple-underscore.github.io/URL-ja.html#concept-url data-x-internal=url-record>URL record</a> with the <i>exclude fragment flag</i> set
      (application caches never include <a href=https://triple-underscore.github.io/URL-ja.html#concept-url-fragment id=downloading-or-updating-an-application-cache:concept-url-fragment-2 data-x-internal=concept-url-fragment>fragments</a>).</p>

     </li><li><p>For each <a href=#cache-host id=downloading-or-updating-an-application-cache:cache-host-12>cache host</a> associated with an <a href=#application-cache id=downloading-or-updating-an-application-cache:application-cache-10>application cache</a> in
     <var>cache group</var>, create a <a href=webappapis.html#concept-task id=downloading-or-updating-an-application-cache:concept-task-8>task</a> to <a id=downloading-or-updating-an-application-cache:fire-a-simple-event-8 href=webappapis.html#fire-a-simple-event>fire
     a simple event</a> that is cancelable named <code id=downloading-or-updating-an-application-cache:event-appcache-noupdate><a href=#event-appcache-noupdate>noupdate</a></code> at the <code id=downloading-or-updating-an-application-cache:applicationcache-8><a href=#applicationcache>ApplicationCache</a></code> singleton
     of the <a href=#cache-host id=downloading-or-updating-an-application-cache:cache-host-13>cache host</a>, and append it to <var>task list</var>. The default
     action of these events must be, if the user agent <a href=#shows-caching-progress id=downloading-or-updating-an-application-cache:shows-caching-progress-8>shows caching progress</a>, the
     display of some sort of user interface indicating to the user that the application is up to
     date.</li><li><p>Empty <var>cache group</var>'s <a href=#concept-appcache-pending-masters id=downloading-or-updating-an-application-cache:concept-appcache-pending-masters-4>list of pending master entries</a>.</li><li><p>If appropriate, remove any user interface indicating that an update for this cache is in
     progress.</li><li><p>Let the <a href=#concept-appcache-status id=downloading-or-updating-an-application-cache:concept-appcache-status-6>status</a> of <var>cache
     group</var> be <i>idle</i>.</li><li><p>For each <a href=webappapis.html#concept-task id=downloading-or-updating-an-application-cache:concept-task-9>task</a> in <var>task list</var>, <a href=#queue-a-post-load-task id=downloading-or-updating-an-application-cache:queue-a-post-load-task-6>queue that task as a post-load task</a>.</li><li><p>Abort the <a href=#application-cache-download-process id=downloading-or-updating-an-application-cache:application-cache-download-process-7>application cache download process</a>.</li></ol>

   </li><li><p>Let <var>new cache</var> be a newly created <a href=#application-cache id=downloading-or-updating-an-application-cache:application-cache-11>application cache</a> in
   <var>cache group</var>. Set its <a href=#concept-appcache-completeness id=downloading-or-updating-an-application-cache:concept-appcache-completeness-2>completeness
   flag</a> to <i>incomplete</i>.</li><li><p>For each entry in <var>cache group</var>'s <a href=#concept-appcache-pending-masters id=downloading-or-updating-an-application-cache:concept-appcache-pending-masters-5>list of pending master entries</a>, associate the
   <code id=downloading-or-updating-an-application-cache:document-6><a href=dom.html#document>Document</a></code> for this entry with <var>new cache</var>.</li><li><p>Set the <a href=#concept-appcache-status id=downloading-or-updating-an-application-cache:concept-appcache-status-7>status</a> of <var>cache
   group</var> to <i>downloading</i>.</li><li><p>For each <a href=#cache-host id=downloading-or-updating-an-application-cache:cache-host-14>cache host</a> associated with an <a href=#application-cache id=downloading-or-updating-an-application-cache:application-cache-12>application cache</a> in <var>cache group</var>, <a href=#queue-a-post-load-task id=downloading-or-updating-an-application-cache:queue-a-post-load-task-7>queue a post-load task</a> to <a id=downloading-or-updating-an-application-cache:fire-a-simple-event-9 href=webappapis.html#fire-a-simple-event>fire a simple
   event</a> that is cancelable named <code id=downloading-or-updating-an-application-cache:event-appcache-downloading-2><a href=#event-appcache-downloading>downloading</a></code>
   at the <code id=downloading-or-updating-an-application-cache:applicationcache-9><a href=#applicationcache>ApplicationCache</a></code> singleton of the <a href=#cache-host id=downloading-or-updating-an-application-cache:cache-host-15>cache host</a>. The default action
   of these events must be, if the user agent <a href=#shows-caching-progress id=downloading-or-updating-an-application-cache:shows-caching-progress-9>shows caching progress</a>, the display of
   some sort of user interface indicating to the user that a new version is being
   downloaded.</li><li><p>Let <var>file list</var> be an empty list of URLs with flags.</li><li><p>Add all the URLs in the list of <a href=#concept-appcache-explicit id=downloading-or-updating-an-application-cache:concept-appcache-explicit-2>explicit
   entries</a> obtained by parsing <var>manifest</var> to <var>file list</var>,
   each flagged with "explicit entry".</li><li><p>Add all the URLs in the list of <a href=#concept-appcache-fallback id=downloading-or-updating-an-application-cache:concept-appcache-fallback-2>fallback
   entries</a> obtained by parsing <var>manifest</var> to <var>file list</var>,
   each flagged with "fallback entry".</li><li><p>If this is an <a href=#concept-appcache-upgrade id=downloading-or-updating-an-application-cache:concept-appcache-upgrade-2>upgrade attempt</a>, then add all
   the URLs of <a href=#concept-appcache-master id=downloading-or-updating-an-application-cache:concept-appcache-master-4>master entries</a> in the <a href=#concept-appcache-newer id=downloading-or-updating-an-application-cache:concept-appcache-newer-3>newest</a> <a href=#application-cache id=downloading-or-updating-an-application-cache:application-cache-13>application cache</a> in <var>cache group</var> whose <a href=#concept-appcache-completeness id=downloading-or-updating-an-application-cache:concept-appcache-completeness-3>completeness
   flag</a> is <i>complete</i> to <var>file list</var>, each flagged with "master
   entry".</li><li><p>If any URL is in <var>file list</var> more than once, then merge the entries into
   one entry for that URL, that entry having all the flags that the original entries had.</li><li>

    <p>For each URL in <var>file list</var>, run the following steps. These steps may be
    run in parallel for two or more of the URLs at a time. If, while running these steps, the
    <code id=downloading-or-updating-an-application-cache:applicationcache-10><a href=#applicationcache>ApplicationCache</a></code> object's <code id=downloading-or-updating-an-application-cache:dom-appcache-abort><a href=#dom-appcache-abort>abort()</a></code> method
    <a href=#send-a-signal id=downloading-or-updating-an-application-cache:send-a-signal>sends a signal</a> to this instance of the <a href=#application-cache-download-process id=downloading-or-updating-an-application-cache:application-cache-download-process-8>application
    cache download process</a> algorithm, then run the <a href=#cache-failure-steps id=downloading-or-updating-an-application-cache:cache-failure-steps-2>cache failure steps</a>
    instead.</p>

    <ol><li>

      <p>If the resource URL being processed was flagged as neither an "explicit entry" nor or a
      "fallback entry", then the user agent may skip this URL.</p>

      <p class=note>This is intended to allow user agents to expire resources not listed in the
      manifest from the cache. Generally, implementors are urged to use an approach that expires
      lesser-used resources first.</p>

     </li><li><p>For each <a href=#cache-host id=downloading-or-updating-an-application-cache:cache-host-16>cache host</a> associated with an <a href=#application-cache id=downloading-or-updating-an-application-cache:application-cache-14>application cache</a> in
     <var>cache group</var>, <a href=#queue-a-progress-post-load-task id=downloading-or-updating-an-application-cache:queue-a-progress-post-load-task>queue a progress post-load task</a> to <a href=infrastructure.html#concept-event-fire id=downloading-or-updating-an-application-cache:concept-event-fire>fire</a> a <a href=infrastructure.html#concept-events-trusted id=downloading-or-updating-an-application-cache:concept-events-trusted>trusted</a>
     event with the name <code id=downloading-or-updating-an-application-cache:event-appcache-progress><a href=#event-appcache-progress>progress</a></code>, which does not
     bubble, which is cancelable, and which uses the <code id=downloading-or-updating-an-application-cache:progressevent><a data-x-internal=progressevent href=https://triple-underscore.github.io/XHR-ja.html#interface-progressevent>ProgressEvent</a></code> interface, at the
     <code id=downloading-or-updating-an-application-cache:applicationcache-11><a href=#applicationcache>ApplicationCache</a></code> singleton of the <a href=#cache-host id=downloading-or-updating-an-application-cache:cache-host-17>cache host</a>. The <code id=downloading-or-updating-an-application-cache:dom-progressevent-lengthcomputable><a data-x-internal=dom-progressevent-lengthcomputable href=https://triple-underscore.github.io/XHR-ja.html#dom-progressevent-lengthcomputable>lengthComputable</a></code> attribute must be set to
     true, the <code id=downloading-or-updating-an-application-cache:dom-progressevent-total><a data-x-internal=dom-progressevent-total href=https://triple-underscore.github.io/XHR-ja.html#dom-progressevent-total>total</a></code> attribute must be set to the
     number of files in <var>file list</var>, and the <code id=downloading-or-updating-an-application-cache:dom-progressevent-loaded><a data-x-internal=dom-progressevent-loaded href=https://triple-underscore.github.io/XHR-ja.html#dom-progressevent-loaded>loaded</a></code> attribute must be set to the number of files in
     <var>file list</var> that have been either downloaded or skipped so far. The default
     action of these events must be, if the user agent <a href=#shows-caching-progress id=downloading-or-updating-an-application-cache:shows-caching-progress-10>shows caching progress</a>, the
     display of some sort of user interface indicating to the user that a file is being downloaded
     in preparation for updating the application. <a href=references.html#refsXHR>[XHR]</a></li><li><p>Let <var>request</var> be a new <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-request id=downloading-or-updating-an-application-cache:concept-request-2 data-x-internal=concept-request>request</a> whose
     <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-request-url id=downloading-or-updating-an-application-cache:concept-request-url-2 data-x-internal=concept-request-url>url</a> is URL, <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-request-client id=downloading-or-updating-an-application-cache:concept-request-client-2 data-x-internal=concept-request-client>client</a> is null, <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-request-destination id=downloading-or-updating-an-application-cache:concept-request-destination-2 data-x-internal=concept-request-destination>destination</a> is "<code>subresource</code>", <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-request-origin id=downloading-or-updating-an-application-cache:concept-request-origin data-x-internal=concept-request-origin>origin</a> is
     <var>manifest URL</var>'s <a href=#concept-origin id=downloading-or-updating-an-application-cache:concept-origin>origin</a>, <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-request-referrer id=downloading-or-updating-an-application-cache:concept-request-referrer-2 data-x-internal=concept-request-referrer>referrer</a> is "<code>no-referrer</code>",
     <a id=downloading-or-updating-an-application-cache:synchronous-flag-2 href=https://triple-underscore.github.io/Fetch-ja.html#synchronous-flag data-x-internal=synchronous-flag>synchronous flag</a> is set, <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-request-credentials-mode id=downloading-or-updating-an-application-cache:concept-request-credentials-mode-2 data-x-internal=concept-request-credentials-mode>credentials mode</a> is "<code>include</code>", <a id=downloading-or-updating-an-application-cache:use-url-credentials-flag-2 href=https://triple-underscore.github.io/Fetch-ja.html#concept-request-use-url-credentials-flag data-x-internal=use-url-credentials-flag>use-URL-credentials flag</a> is set, and <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-request-redirect-mode id=downloading-or-updating-an-application-cache:concept-request-redirect-mode data-x-internal=concept-request-redirect-mode>redirect mode</a> is "<code>manual</code>".</li><li><p><a href=https://triple-underscore.github.io/Fetch-ja.html#concept-fetch id=downloading-or-updating-an-application-cache:concept-fetch-2 data-x-internal=concept-fetch>Fetch</a> <var>request</var>. If this is an
     <a href=#concept-appcache-upgrade id=downloading-or-updating-an-application-cache:concept-appcache-upgrade-3>upgrade attempt</a>, then use the <a href=#concept-appcache-newer id=downloading-or-updating-an-application-cache:concept-appcache-newer-4>newest</a> <a href=#application-cache id=downloading-or-updating-an-application-cache:application-cache-15>application cache</a> in <var>cache
     group</var> as an HTTP cache, and honor HTTP caching semantics (such as expiration, ETags, and
     so forth) with respect to that cache. User agents may also have other caches in place that are
     also honored.</li><li>

      <p>If the previous step fails (e.g. the server returns a 4xx or 5xx response, or there is a
      DNS error, or the connection times out, or the user cancels the download), or if the server
      returned a redirect, or if the resource is labeled with the "no-store" cache directive, then
      run the first appropriate step from the following list: <a href=references.html#refsHTTP>[HTTP]</a></p>

      <dl class=switch><dt>If the URL being processed was flagged as an "explicit entry" or a "fallback entry"<dd>

        <p>If these steps are being run in parallel for any other URLs in <var>file
        list</var>, then abort these steps for those other URLs. Run the <a href=#cache-failure-steps id=downloading-or-updating-an-application-cache:cache-failure-steps-3>cache failure
        steps</a>.</p>

        <p class=note>Redirects are fatal because they are either indicative of a network problem
        (e.g. a captive portal); or would allow resources to be added to the cache under URLs that
        differ from any URL that the networking model will allow access to, leaving orphan entries;
        or would allow resources to be stored under URLs different than their true URLs. All of
        these situations are bad.</p>

       <dt>If the error was a 404 or 410 HTTP response<dt>If the resource was labeled with the "no-store" cache directive<dd>

        <p>Skip this resource. It is dropped from the cache.</p>

       <dt>そうでなければ<dd>

        <p>Copy the resource and its metadata from the <a href=#concept-appcache-newer id=downloading-or-updating-an-application-cache:concept-appcache-newer-5>newest</a> <a href=#application-cache id=downloading-or-updating-an-application-cache:application-cache-16>application cache</a> in <var>cache group</var> whose <a href=#concept-appcache-completeness id=downloading-or-updating-an-application-cache:concept-appcache-completeness-4>completeness
        flag</a> is <i>complete</i>, and act as if that was the fetched resource, ignoring the
        resource obtained from the network.</p>

       </dl>

      <p>User agents may warn the user of these errors as an aid to development.</p>

      <p class=note>These rules make errors for resources listed in the manifest fatal, while
      making it possible for other resources to be removed from caches when they are removed from
      the server, without errors, and making non-manifest resources survive server-side errors.</p>

      <p class=note>Except for the "no-store" directive, HTTP caching rules that would cause a
      file to be expired or otherwise not cached are ignored for the purposes of the
      <a href=#application-cache-download-process id=downloading-or-updating-an-application-cache:application-cache-download-process-9>application cache download process</a>.</p>

     </li><li>

      <p>Otherwise, the fetching succeeded. Store the resource in the <var>new
      cache</var>.</p>

      <p>If the user agent is not able to store the resource (e.g. because of quota restrictions),
      the user agent may prompt the user or try to resolve the problem in some other manner (e.g.
      automatically pruning content in other caches). If the problem cannot be resolved, the user
      agent must run the <a href=#cache-failure-steps id=downloading-or-updating-an-application-cache:cache-failure-steps-4>cache failure steps</a>.</p>

     </li><li><p>If the URL being processed was flagged as an "explicit entry" in <var>file
     list</var>, then categorise the entry as an <a href=#concept-appcache-explicit id=downloading-or-updating-an-application-cache:concept-appcache-explicit-3>explicit
     entry</a>.</li><li><p>If the URL being processed was flagged as a "fallback entry" in <var>file
     list</var>, then categorise the entry as a <a href=#concept-appcache-fallback id=downloading-or-updating-an-application-cache:concept-appcache-fallback-3>fallback
     entry</a>.</li><li><p>If the URL being processed was flagged as an "master entry" in <var>file
     list</var>, then categorise the entry as a <a href=#concept-appcache-master id=downloading-or-updating-an-application-cache:concept-appcache-master-5>master
     entry</a>.</li><li><p>As an optimization, if the resource is an HTML or XML file whose <a id=downloading-or-updating-an-application-cache:document-element href=https://triple-underscore.github.io/DOM4-ja.html#document-element data-x-internal=document-element>document
     element</a> is an <code id=downloading-or-updating-an-application-cache:the-html-element><a href=semantics.html#the-html-element>html</a></code> element with a <code id=downloading-or-updating-an-application-cache:attr-html-manifest><a href=semantics.html#attr-html-manifest>manifest</a></code> attribute whose value doesn't match the manifest
     URL of the application cache being processed, then the user agent should mark the entry as
     being <a href=#concept-appcache-foreign id=downloading-or-updating-an-application-cache:concept-appcache-foreign>foreign</a>.</p>

    </li></ol>

   </li><li><p>For each <a href=#cache-host id=downloading-or-updating-an-application-cache:cache-host-18>cache host</a> associated with an <a href=#application-cache id=downloading-or-updating-an-application-cache:application-cache-17>application cache</a> in <var>cache group</var>, <a href=#queue-a-progress-post-load-task id=downloading-or-updating-an-application-cache:queue-a-progress-post-load-task-2>queue a progress post-load task</a> to <a href=infrastructure.html#concept-event-fire id=downloading-or-updating-an-application-cache:concept-event-fire-2>fire</a> a <a href=infrastructure.html#concept-events-trusted id=downloading-or-updating-an-application-cache:concept-events-trusted-2>trusted</a>
   event with the name <code id=downloading-or-updating-an-application-cache:event-appcache-progress-2><a href=#event-appcache-progress>progress</a></code>, which does not bubble,
   which is cancelable, and which uses the <code id=downloading-or-updating-an-application-cache:progressevent-2><a data-x-internal=progressevent href=https://triple-underscore.github.io/XHR-ja.html#interface-progressevent>ProgressEvent</a></code> interface, at the
   <code id=downloading-or-updating-an-application-cache:applicationcache-12><a href=#applicationcache>ApplicationCache</a></code> singleton of the <a href=#cache-host id=downloading-or-updating-an-application-cache:cache-host-19>cache host</a>. The <code id=downloading-or-updating-an-application-cache:dom-progressevent-lengthcomputable-2><a data-x-internal=dom-progressevent-lengthcomputable href=https://triple-underscore.github.io/XHR-ja.html#dom-progressevent-lengthcomputable>lengthComputable</a></code> attribute must be set to
   true, the <code id=downloading-or-updating-an-application-cache:dom-progressevent-total-2><a data-x-internal=dom-progressevent-total href=https://triple-underscore.github.io/XHR-ja.html#dom-progressevent-total>total</a></code> and the <code id=downloading-or-updating-an-application-cache:dom-progressevent-loaded-2><a data-x-internal=dom-progressevent-loaded href=https://triple-underscore.github.io/XHR-ja.html#dom-progressevent-loaded>loaded</a></code> attributes must be set to the number of files in
   <var>file list</var>. The default action of these events must be, if the user agent
   <a href=#shows-caching-progress id=downloading-or-updating-an-application-cache:shows-caching-progress-11>shows caching progress</a>, the display of some sort of user interface indicating to the
   user that all the files have been downloaded. <a href=references.html#refsXHR>[XHR]</a></li><li><p>Store the list of <a href=#concept-appcache-fallback-ns id=downloading-or-updating-an-application-cache:concept-appcache-fallback-ns-2>fallback namespaces</a>,
   and the URLs of the <a href=#concept-appcache-fallback id=downloading-or-updating-an-application-cache:concept-appcache-fallback-4>fallback entries</a> that they map
   to, in <var>new cache</var>.</li><li><p>Store the URLs that form the new <a href=#concept-appcache-onlinesafelist id=downloading-or-updating-an-application-cache:concept-appcache-onlinesafelist-2>online
   safelist</a> in <var>new cache</var>.</li><li><p>Store the value of the new <a href=#concept-appcache-onlinesafelist-wildcard id=downloading-or-updating-an-application-cache:concept-appcache-onlinesafelist-wildcard-2>online
   safelist wildcard flag</a> in <var>new cache</var>.</li><li><p>Store the value of the new <a href=#concept-appcache-mode id=downloading-or-updating-an-application-cache:concept-appcache-mode-2>cache mode flag</a> in
   <var>new cache</var>.</li><li>

    <p>For each entry in <var>cache group</var>'s <a href=#concept-appcache-pending-masters id=downloading-or-updating-an-application-cache:concept-appcache-pending-masters-6>list of pending master entries</a>, wait for the
    resource for this entry to have either completely downloaded or failed.</p>

    <p>If the download failed (e.g. the server returns a 4xx or 5xx response, or there is a DNS
    error, the connection times out, or the user cancels the download), or if the resource is
    labeled with the "no-store" cache directive, then run these substeps:</p>

    <ol><li><p>Unassociate the <code id=downloading-or-updating-an-application-cache:document-7><a href=dom.html#document>Document</a></code> for this entry from <var>new
     cache</var>.</li><li><p><a href=#queue-a-post-load-task id=downloading-or-updating-an-application-cache:queue-a-post-load-task-8>Queue a post-load task</a> to <a id=downloading-or-updating-an-application-cache:fire-a-simple-event-10 href=webappapis.html#fire-a-simple-event>fire a simple event</a> that is
     cancelable named <code id=downloading-or-updating-an-application-cache:event-appcache-error-3><a href=#event-appcache-error>error</a></code> at the
     <code id=downloading-or-updating-an-application-cache:applicationcache-13><a href=#applicationcache>ApplicationCache</a></code> singleton of the <code id=downloading-or-updating-an-application-cache:document-8><a href=dom.html#document>Document</a></code> for this entry, if there
     still is one. The default action of this event must be, if the user agent <a href=#shows-caching-progress id=downloading-or-updating-an-application-cache:shows-caching-progress-12>shows caching
     progress</a>, the display of some sort of user interface indicating to the user that the
     user agent failed to save the application for offline use.</p>

     </li><li>

      <p>If this is a <a href=#concept-appcache-cache id=downloading-or-updating-an-application-cache:concept-appcache-cache-2>cache attempt</a> and this entry is
      the last entry in <var>cache group</var>'s <a href=#concept-appcache-pending-masters id=downloading-or-updating-an-application-cache:concept-appcache-pending-masters-7>list of pending master entries</a>, then run these
      further substeps:</p>

      <ol><li><p>Discard <var>cache group</var> and its only <a href=#application-cache id=downloading-or-updating-an-application-cache:application-cache-18>application cache</a>,
       <var>new cache</var>.</p>

       </li><li><p>If appropriate, remove any user interface indicating that an update for this cache is
       in progress.</li><li><p>Abort the <a href=#application-cache-download-process id=downloading-or-updating-an-application-cache:application-cache-download-process-10>application cache download process</a>.</li></ol>

     </li><li><p>Otherwise, remove this entry from <var>cache group</var>'s <a href=#concept-appcache-pending-masters id=downloading-or-updating-an-application-cache:concept-appcache-pending-masters-8>list of pending master entries</a>.</li></ol>

    <p>Otherwise, store the resource for this entry in <var>new cache</var>, if it isn't
    already there, and categorise its entry as a <a href=#concept-appcache-master id=downloading-or-updating-an-application-cache:concept-appcache-master-6>master
    entry</a>.</p>

   </li><li><p>Let <var>request</var> be a new <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-request id=downloading-or-updating-an-application-cache:concept-request-3 data-x-internal=concept-request>request</a> whose
   <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-request-url id=downloading-or-updating-an-application-cache:concept-request-url-3 data-x-internal=concept-request-url>url</a> is <var>manifest URL</var>, <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-request-client id=downloading-or-updating-an-application-cache:concept-request-client-3 data-x-internal=concept-request-client>client</a> is null, <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-request-destination id=downloading-or-updating-an-application-cache:concept-request-destination-3 data-x-internal=concept-request-destination>destination</a> is "<code>subresource</code>",
   <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-request-referrer id=downloading-or-updating-an-application-cache:concept-request-referrer-3 data-x-internal=concept-request-referrer>referrer</a> is "<code>no-referrer</code>",
   <a id=downloading-or-updating-an-application-cache:synchronous-flag-3 href=https://triple-underscore.github.io/Fetch-ja.html#synchronous-flag data-x-internal=synchronous-flag>synchronous flag</a> is set, <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-request-credentials-mode id=downloading-or-updating-an-application-cache:concept-request-credentials-mode-3 data-x-internal=concept-request-credentials-mode>credentials
   mode</a> is "<code>include</code>", and whose <a id=downloading-or-updating-an-application-cache:use-url-credentials-flag-3 href=https://triple-underscore.github.io/Fetch-ja.html#concept-request-use-url-credentials-flag data-x-internal=use-url-credentials-flag>use-URL-credentials
   flag</a> is set.</li><li>

    <p>Let <var>second manifest</var> be the result of <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-fetch id=downloading-or-updating-an-application-cache:concept-fetch-3 data-x-internal=concept-fetch>fetching</a> <var>request</var>. HTTP caching semantics should again
    be honored for this request.</p>

    <p class=note>Since caching can be honored, authors are encouraged to avoid setting the cache
    headers on the manifest in such a way that the user agent would simply not contact the network
    for this second request; otherwise, the user agent would not notice if the cache had changed
    during the cache update process.</p>

   </li><li>

    <p>If the previous step failed for any reason, or if the fetching attempt involved a redirect,
    or if <var>second manifest</var> and <var>manifest</var> are not byte-for-byte
    identical, then schedule a rerun of the entire algorithm with the same parameters after a short
    delay, and run the <a href=#cache-failure-steps id=downloading-or-updating-an-application-cache:cache-failure-steps-5>cache failure steps</a>.</p>

   </li><li>

    <p>Otherwise, store <var>manifest</var> in <var>new cache</var>, if it's not
    there already, and categorise its entry as <a href=#concept-appcache-manifest id=downloading-or-updating-an-application-cache:concept-appcache-manifest-4>the
    manifest</a>.</p>

   </li><li><p>Set the <a href=#concept-appcache-completeness id=downloading-or-updating-an-application-cache:concept-appcache-completeness-5>completeness flag</a> of <var>new cache</var> to <i>complete</i>.</li><li><p>Let <var>task list</var> be an empty list of <a href=webappapis.html#concept-task id=downloading-or-updating-an-application-cache:concept-task-10>tasks</a>.</p>

   </li><li>

    <p>If this is a <a href=#concept-appcache-cache id=downloading-or-updating-an-application-cache:concept-appcache-cache-3>cache attempt</a>, then for each
    <a href=#cache-host id=downloading-or-updating-an-application-cache:cache-host-20>cache host</a> associated with an <a href=#application-cache id=downloading-or-updating-an-application-cache:application-cache-19>application cache</a> in <var>cache
    group</var>, create a <a href=webappapis.html#concept-task id=downloading-or-updating-an-application-cache:concept-task-11>task</a> to <a id=downloading-or-updating-an-application-cache:fire-a-simple-event-11 href=webappapis.html#fire-a-simple-event>fire a simple event</a>
    that is cancelable named <code id=downloading-or-updating-an-application-cache:event-appcache-cached><a href=#event-appcache-cached>cached</a></code> at the
    <code id=downloading-or-updating-an-application-cache:applicationcache-14><a href=#applicationcache>ApplicationCache</a></code> singleton of the <a href=#cache-host id=downloading-or-updating-an-application-cache:cache-host-21>cache host</a>, and append it to <var>task list</var>. The default action of these events must be, if the user agent
    <a href=#shows-caching-progress id=downloading-or-updating-an-application-cache:shows-caching-progress-13>shows caching progress</a>, the display of some sort of user interface indicating to
    the user that the application has been cached and that they can now use it offline.</p>

    <p>Otherwise, it is an <a href=#concept-appcache-upgrade id=downloading-or-updating-an-application-cache:concept-appcache-upgrade-4>upgrade attempt</a>. For each
    <a href=#cache-host id=downloading-or-updating-an-application-cache:cache-host-22>cache host</a> associated with an <a href=#application-cache id=downloading-or-updating-an-application-cache:application-cache-20>application cache</a> in <var>cache
    group</var>, create a <a href=webappapis.html#concept-task id=downloading-or-updating-an-application-cache:concept-task-12>task</a> to <a id=downloading-or-updating-an-application-cache:fire-a-simple-event-12 href=webappapis.html#fire-a-simple-event>fire a simple event</a>
    that is cancelable named <code id=downloading-or-updating-an-application-cache:event-appcache-updateready><a href=#event-appcache-updateready>updateready</a></code> at the
    <code id=downloading-or-updating-an-application-cache:applicationcache-15><a href=#applicationcache>ApplicationCache</a></code> singleton of the <a href=#cache-host id=downloading-or-updating-an-application-cache:cache-host-23>cache host</a>, and append it to <var>task list</var>. The default action of these events must be, if the user agent
    <a href=#shows-caching-progress id=downloading-or-updating-an-application-cache:shows-caching-progress-14>shows caching progress</a>, the display of some sort of user interface indicating to
    the user that a new version is available and that they can activate it by reloading the
    page.</p>

   </li><li><p>If appropriate, remove any user interface indicating that an update for this cache is in
   progress.</li><li><p>Set the <a href=#concept-appcache-status id=downloading-or-updating-an-application-cache:concept-appcache-status-8>update status</a> of <var>cache
   group</var> to <i>idle</i>.</li><li><p>For each <a href=webappapis.html#concept-task id=downloading-or-updating-an-application-cache:concept-task-13>task</a> in <var>task list</var>, <a href=#queue-a-post-load-task id=downloading-or-updating-an-application-cache:queue-a-post-load-task-9>queue that task as a post-load task</a>.</li></ol>

  <p>The <dfn id=cache-failure-steps>cache failure steps</dfn> are as follows:</p>

  <ol><li><p>Let <var>task list</var> be an empty list of <a href=webappapis.html#concept-task id=downloading-or-updating-an-application-cache:concept-task-14>tasks</a>.</p>

   </li><li>

    <p>For each entry in <var>cache group</var>'s <a href=#concept-appcache-pending-masters id=downloading-or-updating-an-application-cache:concept-appcache-pending-masters-9>list of pending master entries</a>, run the
    following further substeps. These steps may be run in parallel for two or more entries at a
    time.</p>

    <ol><li><p>Wait for the resource for this entry to have either completely downloaded or failed.</p>

     </li><li><p>Unassociate the <code id=downloading-or-updating-an-application-cache:document-9><a href=dom.html#document>Document</a></code> for this entry from its <a href=#application-cache id=downloading-or-updating-an-application-cache:application-cache-21>application
     cache</a>, if it has one.</li><li><p>Create a <a href=webappapis.html#concept-task id=downloading-or-updating-an-application-cache:concept-task-15>task</a> to <a id=downloading-or-updating-an-application-cache:fire-a-simple-event-13 href=webappapis.html#fire-a-simple-event>fire a simple event</a> that
     is cancelable named <code id=downloading-or-updating-an-application-cache:event-appcache-error-4><a href=#event-appcache-error>error</a></code> at the
     <code id=downloading-or-updating-an-application-cache:applicationcache-16><a href=#applicationcache>ApplicationCache</a></code> singleton of the <code id=downloading-or-updating-an-application-cache:document-10><a href=dom.html#document>Document</a></code> for this entry, if there
     still is one, and append it to <var>task list</var>. The default action of these
     events must be, if the user agent <a href=#shows-caching-progress id=downloading-or-updating-an-application-cache:shows-caching-progress-15>shows caching progress</a>, the display of some sort
     of user interface indicating to the user that the user agent failed to save the application for
     offline use.</p>

    </li></ol>

   </li><li><p>For each <a href=#cache-host id=downloading-or-updating-an-application-cache:cache-host-24>cache host</a> still associated with an <a href=#application-cache id=downloading-or-updating-an-application-cache:application-cache-22>application cache</a>
   in <var>cache group</var>, create a <a href=webappapis.html#concept-task id=downloading-or-updating-an-application-cache:concept-task-16>task</a> to <a id=downloading-or-updating-an-application-cache:fire-a-simple-event-14 href=webappapis.html#fire-a-simple-event>fire
   a simple event</a> that is cancelable named <code id=downloading-or-updating-an-application-cache:event-appcache-error-5><a href=#event-appcache-error>error</a></code> at
   the <code id=downloading-or-updating-an-application-cache:applicationcache-17><a href=#applicationcache>ApplicationCache</a></code> singleton of the <a href=#cache-host id=downloading-or-updating-an-application-cache:cache-host-25>cache host</a>, and append it to <var>task list</var>. The default action of these events must be, if the user agent
   <a href=#shows-caching-progress id=downloading-or-updating-an-application-cache:shows-caching-progress-16>shows caching progress</a>, the display of some sort of user interface indicating to the
   user that the user agent failed to save the application for offline use.</li><li><p>Empty <var>cache group</var>'s <a href=#concept-appcache-pending-masters id=downloading-or-updating-an-application-cache:concept-appcache-pending-masters-10>list of pending master entries</a>.</li><li><p>If <var>cache group</var> has an <a href=#application-cache id=downloading-or-updating-an-application-cache:application-cache-23>application cache</a> whose <a href=#concept-appcache-completeness id=downloading-or-updating-an-application-cache:concept-appcache-completeness-6>completeness flag</a> is <i>incomplete</i>, then discard
   that <a href=#application-cache id=downloading-or-updating-an-application-cache:application-cache-24>application cache</a>.</p>

   </li><li><p>If appropriate, remove any user interface indicating that an update for this cache is in
   progress.</li><li><p>Let the <a href=#concept-appcache-status id=downloading-or-updating-an-application-cache:concept-appcache-status-9>status</a> of <var>cache
   group</var> be <i>idle</i>.</li><li><p>If this was a <a href=#concept-appcache-cache id=downloading-or-updating-an-application-cache:concept-appcache-cache-4>cache attempt</a>, discard <var>cache group</var> altogether.</p>

   </li><li><p>For each <a href=webappapis.html#concept-task id=downloading-or-updating-an-application-cache:concept-task-17>task</a> in <var>task list</var>, <a href=#queue-a-post-load-task id=downloading-or-updating-an-application-cache:queue-a-post-load-task-10>queue that task as a post-load task</a>.</li><li><p>Abort the <a href=#application-cache-download-process id=downloading-or-updating-an-application-cache:application-cache-download-process-11>application cache download process</a>.</li></ol>

  <p>Attempts to fetch resources as part of the <a href=#application-cache-download-process id=downloading-or-updating-an-application-cache:application-cache-download-process-12>application cache download process</a> may
  be done with cache-defeating semantics, to avoid problems with stale or inconsistent intermediary
  caches.</p>

  <hr>

  <p>User agents may invoke the <a href=#application-cache-download-process id=downloading-or-updating-an-application-cache:application-cache-download-process-13>application cache download process</a>, in the background,
  for any <a href=#application-cache-group id=downloading-or-updating-an-application-cache:application-cache-group-8>application cache group</a>, at any time (with no <a href=#cache-host id=downloading-or-updating-an-application-cache:cache-host-26>cache host</a>). This
  allows user agents to keep caches primed and to update caches even before the user visits a
  site.</p>

  <hr>

  <p>Each <code id=downloading-or-updating-an-application-cache:document-11><a href=dom.html#document>Document</a></code> has a list of <dfn id=pending-application-cache-download-process-tasks>pending application cache download process
  tasks</dfn> that is used to delay events fired by the algorithm above until the document's <code id=downloading-or-updating-an-application-cache:event-load-2><a href=indices.html#event-load>load</a></code> event has fired. When the <code id=downloading-or-updating-an-application-cache:document-12><a href=dom.html#document>Document</a></code> is created, the
  list must be empty.</p>

  <p>When the steps above say to <dfn id=queue-a-post-load-task>queue a post-load task</dfn> <var>task</var>, where
  <var>task</var> is a <a href=webappapis.html#concept-task id=downloading-or-updating-an-application-cache:concept-task-18>task</a> that dispatches an event on a
  target <code id=downloading-or-updating-an-application-cache:applicationcache-18><a href=#applicationcache>ApplicationCache</a></code> object <var>target</var>, the user agent must run
  the appropriate steps from the following list:</p>

  <dl><dt>If <var>target</var>'s <a id=downloading-or-updating-an-application-cache:node-document href=https://triple-underscore.github.io/DOM4-ja.html#concept-node-document data-x-internal=node-document>node document</a> is
   <a id=downloading-or-updating-an-application-cache:ready-for-post-load-tasks href=syntax.html#ready-for-post-load-tasks>ready for post-load tasks</a><dd><p><a href=webappapis.html#queue-a-task id=downloading-or-updating-an-application-cache:queue-a-task>Queue</a> the task <var>task</var>.<dt>そうでなければ<dd><p>Add <var>task</var> to <var>target</var>'s <a id=downloading-or-updating-an-application-cache:node-document-2 href=https://triple-underscore.github.io/DOM4-ja.html#concept-node-document data-x-internal=node-document>node document</a>'s list
   of <a href=#pending-application-cache-download-process-tasks id=downloading-or-updating-an-application-cache:pending-application-cache-download-process-tasks>pending application cache download process tasks</a>.</dl>

  <p>When the steps above say to <dfn id=queue-a-progress-post-load-task>queue a progress post-load task</dfn> <var>task</var>, where
  <var>task</var> is a <a href=webappapis.html#concept-task id=downloading-or-updating-an-application-cache:concept-task-19>task</a> that dispatches an event on a
  target <code id=downloading-or-updating-an-application-cache:applicationcache-19><a href=#applicationcache>ApplicationCache</a></code> object <var>target</var>, the user agent must run
  the following steps:</p>

  <ol><li><p>If there is a <var>task</var> in <var>target</var>'s <a id=downloading-or-updating-an-application-cache:node-document-3 href=https://triple-underscore.github.io/DOM4-ja.html#concept-node-document data-x-internal=node-document>node document</a>'s list
   of <a href=#pending-application-cache-download-process-tasks id=downloading-or-updating-an-application-cache:pending-application-cache-download-process-tasks-2>pending application cache download process tasks</a> that is labeled as a
   <i>progress task</i>, then remove that task from the list.</li><li><p>Label <var>task</var> as a <i>progress task</i>.</li><li><p><a href=#queue-a-post-load-task id=downloading-or-updating-an-application-cache:queue-a-post-load-task-11>Queue a post-load task</a> <var>task</var>.</li></ol>

  <p>The <a id=downloading-or-updating-an-application-cache:task-source href=webappapis.html#task-source>task source</a> for these <a href=webappapis.html#concept-task id=downloading-or-updating-an-application-cache:concept-task-20>tasks</a> is the
  <a id=downloading-or-updating-an-application-cache:networking-task-source href=webappapis.html#networking-task-source>networking task source</a>.</p>




  <h4 id=the-application-cache-selection-algorithm>7.9.5 The application cache selection algorithm</h4>

  <p>When the <dfn id=concept-appcache-init>application cache selection algorithm</dfn>
  algorithm is invoked with a <code id=the-application-cache-selection-algorithm:document><a href=dom.html#document>Document</a></code> <var>document</var> and optionally a
  manifest <a id=the-application-cache-selection-algorithm:url href=https://triple-underscore.github.io/URL-ja.html#concept-url data-x-internal=url>URL</a> <var>manifest URL</var>, the user agent must run the first
  applicable set of steps from the following list:</p>

  <dl class=switch><dt>If there is a <var>manifest URL</var>, and <var>document</var> was loaded
   from an <a href=#application-cache id=the-application-cache-selection-algorithm:application-cache>application cache</a>, and the URL of the <a href=#concept-appcache-manifest id=the-application-cache-selection-algorithm:concept-appcache-manifest>manifest</a> of that cache's <a href=#application-cache-group id=the-application-cache-selection-algorithm:application-cache-group>application cache
   group</a> is <em>not</em> the same as <var>manifest URL</var><dd>

    <p>Mark the entry for the resource from which <var>document</var> was taken in the
    <a href=#application-cache id=the-application-cache-selection-algorithm:application-cache-2>application cache</a> from which it was loaded as <a href=#concept-appcache-foreign id=the-application-cache-selection-algorithm:concept-appcache-foreign>foreign</a>.</p>

    <p>Restart the current navigation from the top of the <a href=#navigate id=the-application-cache-selection-algorithm:navigate>navigation
    algorithm</a>, undoing any changes that were made as part of the initial load (changes can be
    avoided by ensuring that the step to <a href=#update-the-session-history-with-the-new-page id=the-application-cache-selection-algorithm:update-the-session-history-with-the-new-page>update the session history with the new page</a>
    is only ever completed <em>after</em> this <a href=#concept-appcache-init id=the-application-cache-selection-algorithm:concept-appcache-init>application cache
    selection algorithm</a> is run, though this is not required).</p>

    <p class=note>The navigation will not result in the same resource being loaded, because
    "foreign" entries are never picked during navigation.</p>

    <p>User agents may notify the user of the inconsistency between the cache manifest and the
    document's own metadata, to aid in application development.</p>

   <dt>If <var>document</var> was loaded from an <a href=#application-cache id=the-application-cache-selection-algorithm:application-cache-3>application cache</a>, and that
   <a href=#application-cache id=the-application-cache-selection-algorithm:application-cache-4>application cache</a> still exists (it is not now <a href=#concept-appcache-obsolete id=the-application-cache-selection-algorithm:concept-appcache-obsolete>obsolete</a>)<dd>

    <p>Associate <var>document</var> with the <a href=#application-cache id=the-application-cache-selection-algorithm:application-cache-5>application cache</a> from which it
    was loaded. Invoke, in the background, the <a href=#application-cache-download-process id=the-application-cache-selection-algorithm:application-cache-download-process>application cache download process</a> for
    that <a href=#application-cache id=the-application-cache-selection-algorithm:application-cache-6>application cache</a>'s <a href=#application-cache-group id=the-application-cache-selection-algorithm:application-cache-group-2>application cache group</a>, with <var>document</var> as the <a href=#cache-host id=the-application-cache-selection-algorithm:cache-host>cache host</a>.</p>

   <dt>If <var>document</var>  was loaded using `<code>GET</code>`, and, there is a
   <var>manifest URL</var>, and <var>manifest URL</var> has the <a href=#same-origin id=the-application-cache-selection-algorithm:same-origin>same origin</a> as
   <var>document</var><dd>

    <p>Invoke, in the background, the <a href=#application-cache-download-process id=the-application-cache-selection-algorithm:application-cache-download-process-2>application cache download process</a> for <var>manifest URL</var>, with <var>document</var> as the <a href=#cache-host id=the-application-cache-selection-algorithm:cache-host-2>cache host</a>
    and with the resource from which <var>document</var> was parsed as the <a href=#concept-appcache-master id=the-application-cache-selection-algorithm:concept-appcache-master>master</a> resource.</p>

    <p>If there are <a href=#relevant-application-cache id=the-application-cache-selection-algorithm:relevant-application-cache>relevant application caches</a> that
    are identified by a URL with the <a href=#same-origin id=the-application-cache-selection-algorithm:same-origin-2>same origin</a> as the URL of <var>document</var>, and that have this URL as one of their entries, excluding entries
    marked as <a href=#concept-appcache-foreign id=the-application-cache-selection-algorithm:concept-appcache-foreign-2>foreign</a>, then the user agent should use
    the <a href=#concept-appcache-selection id=the-application-cache-selection-algorithm:concept-appcache-selection>most appropriate application cache</a> of those
    that match as an HTTP cache for any subresource loads. User agents may also have other caches in
    place that are also honored.</p>

   <dt>そうでなければ<dd>

    <p>The <code id=the-application-cache-selection-algorithm:document-2><a href=dom.html#document>Document</a></code> is not associated with any <a href=#application-cache id=the-application-cache-selection-algorithm:application-cache-7>application cache</a>.</p>

    <p>If there was a <var>manifest URL</var>, the user agent may report to the user that
    it was ignored, to aid in application development.</p>

   </dl>



  <h4 id=changesToNetworkingModel>7.9.6 Changes to the networking model</h4>

  <p class=XXX>If "AppCache" is not removed as a feature this
  section needs to be integrated into the Fetch standard.</p>

  <p>When a <a href=#cache-host id=changesToNetworkingModel:cache-host>cache host</a> is associated with an <a href=#application-cache id=changesToNetworkingModel:application-cache>application cache</a> whose <a href=#concept-appcache-completeness id=changesToNetworkingModel:concept-appcache-completeness>completeness flag</a> is <i>complete</i>, any and all
  loads for resources related to that <a href=#cache-host id=changesToNetworkingModel:cache-host-2>cache host</a> other than those for <a href=#child-browsing-context id=changesToNetworkingModel:child-browsing-context>child browsing contexts</a> must go through the following steps
  instead of immediately invoking the mechanisms appropriate to that resource's scheme:</p>

  <ol><li><p>If the resource is not to be fetched using the GET method, or if applying the <a id=changesToNetworkingModel:url-parser href=https://triple-underscore.github.io/URL-ja.html#concept-url-parser data-x-internal=url-parser>URL
   parser</a> algorithm to both its <a id=changesToNetworkingModel:url href=https://triple-underscore.github.io/URL-ja.html#concept-url data-x-internal=url>URL</a> and the <a href=#application-cache id=changesToNetworkingModel:application-cache-2>application cache</a>'s
   <a href=#concept-appcache-manifest id=changesToNetworkingModel:concept-appcache-manifest>manifest</a>'s URL results in two <a href=https://triple-underscore.github.io/URL-ja.html#concept-url id=changesToNetworkingModel:url-record data-x-internal=url-record>URL records</a> with different <a href=https://triple-underscore.github.io/URL-ja.html#concept-url-scheme id=changesToNetworkingModel:concept-url-scheme data-x-internal=concept-url-scheme>scheme</a>
   components, then fetch the resource normally and abort these steps.</li><li><p>If the resource's URL is <a href=#concept-appcache-master id=changesToNetworkingModel:concept-appcache-master>a master entry</a>,
   <a href=#concept-appcache-manifest id=changesToNetworkingModel:concept-appcache-manifest-2>the manifest</a>, <a href=#concept-appcache-explicit id=changesToNetworkingModel:concept-appcache-explicit>an explicit entry</a>, or <a href=#concept-appcache-fallback id=changesToNetworkingModel:concept-appcache-fallback>a fallback entry</a> in the <a href=#application-cache id=changesToNetworkingModel:application-cache-3>application cache</a>,
   then get the resource from the cache (instead of fetching it), and abort these steps.</li><li><p>If there is an entry in the <a href=#application-cache id=changesToNetworkingModel:application-cache-4>application cache</a>'s <a href=#concept-appcache-onlinesafelist id=changesToNetworkingModel:concept-appcache-onlinesafelist>online safelist</a> that has the <a href=#same-origin id=changesToNetworkingModel:same-origin>same
   origin</a> as the resource's URL and that is a <a id=changesToNetworkingModel:prefix-match href=infrastructure.html#prefix-match>prefix match</a> for the resource's
   URL, then fetch the resource normally and abort these steps.</li><li>

    <p>If the resource's URL has the <a href=#same-origin id=changesToNetworkingModel:same-origin-2>same origin</a> as the manifest's URL, and there is a
    <a href=#concept-appcache-fallback-ns id=changesToNetworkingModel:concept-appcache-fallback-ns>fallback namespace</a> <var>f</var> in
    the <a href=#application-cache id=changesToNetworkingModel:application-cache-5>application cache</a> that is a <a id=changesToNetworkingModel:prefix-match-2 href=infrastructure.html#prefix-match>prefix match</a> for the resource's URL,
    then:</p>

    <p>Fetch the resource normally. If this results in a redirect to a resource with another
    <a href=#concept-origin id=changesToNetworkingModel:concept-origin>origin</a> (indicative of a captive portal), or a 4xx or 5xx status code, or if there
    were network errors (but not if the user canceled the download), then instead get, from the
    cache, the resource of the <a href=#concept-appcache-fallback id=changesToNetworkingModel:concept-appcache-fallback-2>fallback entry</a>
    corresponding to the <a href=#concept-appcache-fallback-ns id=changesToNetworkingModel:concept-appcache-fallback-ns-2>fallback namespace</a>
    <var>f</var>. Abort these steps.</p>

   </li><li><p>If the <a href=#application-cache id=changesToNetworkingModel:application-cache-6>application cache</a>'s <a href=#concept-appcache-onlinesafelist-wildcard id=changesToNetworkingModel:concept-appcache-onlinesafelist-wildcard>online safelist wildcard flag</a> is
   <i>open</i>, then fetch the resource normally and abort these steps.</li><li><p>Fail the resource load as if there had been a generic network error.</li></ol>

  <p class=note>The above algorithm ensures that so long as the <a href=#concept-appcache-onlinesafelist-wildcard id=changesToNetworkingModel:concept-appcache-onlinesafelist-wildcard-2>online safelist wildcard flag</a> is
  <i>blocking</i>, resources that are not present in the <a href=#concept-appcache-manifest id=changesToNetworkingModel:concept-appcache-manifest-3>manifest</a> will always fail to load (at least, after the
  <a href=#application-cache id=changesToNetworkingModel:application-cache-7>application cache</a> has been primed the first time), making the testing of offline
  applications simpler.</p>

  


  

  <h4 id=expiring-application-caches>7.9.7 Expiring application caches</h4>

  <p>As a general rule, user agents should not expire application caches, except on request from the
  user, or after having been left unused for an extended period of time.</p>

  <p>Application caches and cookies have similar implications with respect to privacy (e.g. if the
  site can identify the user when providing the cache, it can store data in the cache that can be
  used for cookie resurrection). Implementors are therefore encouraged to expose application caches
  in a manner related to HTTP cookies, allowing caches to be expunged together with cookies and
  other origin-specific data.</p>

  <p class=example>For example, a user agent could have a "delete site-specific data" feature that
  clears all cookies, application caches, local storage, databases, etc, from an origin all at
  once.</p>

  


  

  <h4 id=disk-space>7.9.8 Disk space</h4>

  <p>User agents should consider applying constraints on disk usage of <a href=#application-cache id=disk-space:application-cache>application caches</a>, and care should be taken to ensure that the restrictions cannot
  be easily worked around using subdomains.</p>

  <p>User agents should allow users to see how much space each domain is using, and may offer the
  user the ability to delete specific <a href=#application-cache id=disk-space:application-cache-2>application caches</a>.</p>

  <p>For predictability, quotas should be based on the uncompressed size of data stored.</p>
  

  <p class=note>How quotas are presented to the user is not defined by this specification. User
  agents are encouraged to provide features such as allowing a user to indicate that certain sites
  are trusted to use more than the default quota, e.g. by presenting a non-modal user interface
  while a cache is being updated, or by having an explicit safelist in the user agent's
  configuration interface.</p>

  



  <h4 id=security-concerns-with-offline-applications-caches>7.9.9 Security concerns with offline applications caches</h4>

  <p><i>この節は非規範的である。</i></p>

  <p>The main risk introduced by offline application caches is that an injection attack can be
  elevated into persistent site-wide page replacement. This attack involves using an injection
  vulnerability to upload two files to the victim site. The first file is an application cache
  manifest consisting of just a fallback entry pointing to the second file, which is an HTML page
  whose manifest is declared as that first file. Once the user has been directed to that second
  file, all subsequent accesses to any file covered by the given fallback namespace while either the
  user or the site is offline will instead show that second file. Targeted denial-of-service
  attacks or cookie bombing attacks (where the client is made to send so many cookies that the
  server refuses to process the request) can be used to ensure that the site appears offline.</p>

  <p>To mitigate this, manifests can only specify fallbacks that are in the same path as the
  manifest itself. This means that a content injection upload vulnerability in a particular
  directory on a server can only be escalated to a take-over of that directory and its
  subdirectories. If there is no way to inject a file into the root directory, the entire site
  cannot be taken over.</p>

  <p>If a site has been attacked in this way, simply removing the offending manifest might eventually
  clear the problem, since the next time the manifest is updated, a 404 error will be seen, and the
  user agent will clear the cache. "Eventually" is the key word here, however; while the attack on
  the user or server is ongoing, such that connections from an affected user to the affected site
  are blocked, the user agent will simply assume that the user is offline and will continue to use
  the hostile manifest. Unfortunately, if a cookie bombing attack has also been used, merely
  removing the manifest is insufficient; in addition, the server has to be configured to return a
  404 or 410 response instead of the 413 "Request Entity Too Large" response.</p>

  <p>TLS does not inherently protect a site from this attack, since the attack relies on content
  being served from the server itself. Not using application caches also does not prevent this
  attack, since the attack relies on an attacker-provided manifest.</p>



  <h4 id=application-cache-api>7.9.10 アプリケーションキャッシュAPI</h4>

  <pre class=idl>[Exposed=(Window,SharedWorker)]
interface <dfn id=applicationcache>ApplicationCache</dfn> : <a id=application-cache-api:eventtarget href=https://triple-underscore.github.io/DOM4-ja.html#interface-eventtarget data-x-internal=eventtarget>EventTarget</a> {

  // <a href=#concept-appcache-status id=application-cache-api:concept-appcache-status>update status</a>
  const unsigned short <a href=#dom-appcache-uncached id=application-cache-api:dom-appcache-uncached>UNCACHED</a> = 0;
  const unsigned short <a href=#dom-appcache-idle id=application-cache-api:dom-appcache-idle>IDLE</a> = 1;
  const unsigned short <a href=#dom-appcache-checking id=application-cache-api:dom-appcache-checking>CHECKING</a> = 2;
  const unsigned short <a href=#dom-appcache-downloading id=application-cache-api:dom-appcache-downloading>DOWNLOADING</a> = 3;
  const unsigned short <a href=#dom-appcache-updateready id=application-cache-api:dom-appcache-updateready>UPDATEREADY</a> = 4;
  const unsigned short <a href=#dom-appcache-obsolete id=application-cache-api:dom-appcache-obsolete>OBSOLETE</a> = 5;
  readonly attribute unsigned short <a href=#dom-appcache-status id=application-cache-api:dom-appcache-status>status</a>;

  // updates
  void <a href=#dom-appcache-update id=application-cache-api:dom-appcache-update>update</a>();
  void <a href=#dom-appcache-abort id=application-cache-api:dom-appcache-abort>abort</a>();
  void <a href=#dom-appcache-swapcache id=application-cache-api:dom-appcache-swapcache>swapCache</a>();

  // events
  attribute <a id=application-cache-api:eventhandler href=webappapis.html#eventhandler>EventHandler</a> <a href=#handler-appcache-onchecking id=application-cache-api:handler-appcache-onchecking>onchecking</a>;
  attribute <a id=application-cache-api:eventhandler-2 href=webappapis.html#eventhandler>EventHandler</a> <a href=#handler-appcache-onerror id=application-cache-api:handler-appcache-onerror>onerror</a>;
  attribute <a id=application-cache-api:eventhandler-3 href=webappapis.html#eventhandler>EventHandler</a> <a href=#handler-appcache-onnoupdate id=application-cache-api:handler-appcache-onnoupdate>onnoupdate</a>;
  attribute <a id=application-cache-api:eventhandler-4 href=webappapis.html#eventhandler>EventHandler</a> <a href=#handler-appcache-ondownloading id=application-cache-api:handler-appcache-ondownloading>ondownloading</a>;
  attribute <a id=application-cache-api:eventhandler-5 href=webappapis.html#eventhandler>EventHandler</a> <a href=#handler-appcache-onprogress id=application-cache-api:handler-appcache-onprogress>onprogress</a>;
  attribute <a id=application-cache-api:eventhandler-6 href=webappapis.html#eventhandler>EventHandler</a> <a href=#handler-appcache-onupdateready id=application-cache-api:handler-appcache-onupdateready>onupdateready</a>;
  attribute <a id=application-cache-api:eventhandler-7 href=webappapis.html#eventhandler>EventHandler</a> <a href=#handler-appcache-oncached id=application-cache-api:handler-appcache-oncached>oncached</a>;
  attribute <a id=application-cache-api:eventhandler-8 href=webappapis.html#eventhandler>EventHandler</a> <a href=#handler-appcache-onobsolete id=application-cache-api:handler-appcache-onobsolete>onobsolete</a>;
};</pre>

  <dl class=domintro><dt><var>cache</var> = <var>window</var> . <code id=application-cache-api:dom-applicationcache><a href=#dom-applicationcache>applicationCache</a></code><dd>

    <p>（ウィンドウで）その<code id=application-cache-api:window><a href=#window>Window</a></code>の<a href=#active-document id=application-cache-api:active-document>アクティブドキュメント</a>に適用する<code id=application-cache-api:applicationcache><a href=#applicationcache>ApplicationCache</a></code>オブジェクトを返す。</p>

   <dt><var>cache</var> = <var>self</var> . <code id=application-cache-api:dom-applicationcache-2><a href=#dom-applicationcache>applicationCache</a></code><dd>

    <p>（共有ワーカーで）現在の共有ワーカーに適用する<code id=application-cache-api:applicationcache-2><a href=#applicationcache>ApplicationCache</a></code>オブジェクトを返す。</p>

   <dt><var>cache</var> . <code id=application-cache-api:dom-appcache-status-2><a href=#dom-appcache-status>status</a></code><dd>

    <p>以下に定義された定数で与えられるように、アプリケーションキャッシュの現在のステータスを返す。</p>

   <dt><var>cache</var> . <code id=application-cache-api:dom-appcache-update-2><a href=#dom-appcache-update>update</a></code>()<dd>

    <p><a href=#application-cache-download-process id=application-cache-api:application-cache-download-process>アプリケーションキャッシュのダウンロードプロセス</a>を起動する。</p>

    <p>Throws an <a id=application-cache-api:invalidstateerror href=https://triple-underscore.github.io/WebIDL-ja.html#invalidstateerror data-x-internal=invalidstateerror>"<code>InvalidStateError</code>"</a> <code id=application-cache-api:domexception><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code> if there is
    no application cache to update.</p>

    <p>ユーザーエージェントは通常、自動的に<a href=#application-cache id=application-cache-api:application-cache>アプリケーションキャッシュ</a>を更新する処理をするので、通常このメソッドを呼び出す必要はない。</p>

    <p>このメソッドは、長期のアプリケーションのような状況で役立つ。たとえば、ウェブメールアプリケーションは一度に何週間もブラウザータブで開いたままかもしれない。このようなアプリケーションは、毎日更新をテストできるだろう。</p>

   <dt><var>cache</var> . <code id=application-cache-api:dom-appcache-abort-2><a href=#dom-appcache-abort>abort</a></code>()<dd>

    <p><a href=#application-cache-download-process id=application-cache-api:application-cache-download-process-2>アプリケーションキャッシュのダウンロード処理</a>を中止する。</p>

    <p>このメソッドは、（帯域幅が限られるためなどで）ユーザーが更新を停止したい場合に、独自のキャッシング進捗UIを表示するウェブアプリケーションで使用されることを意図する。</p>

   <dt><var>cache</var> . <code id=application-cache-api:dom-appcache-swapcache-2><a href=#dom-appcache-swapcache>swapCache</a></code>()<dd>

    <p>新しいものが存在する場合、最新のアプリケーションキャッシュに切り替わる。If there isn't, throws an <a id=application-cache-api:invalidstateerror-2 href=https://triple-underscore.github.io/WebIDL-ja.html#invalidstateerror data-x-internal=invalidstateerror>"<code>InvalidStateError</code>"</a> <code id=application-cache-api:domexception-2><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.</p>

    <p>これは、以前にロードされたリソースが再読み込みされることはない。たとえば、画像が急にリロードされないと、スタイルシートやスクリプトが再解析または再評価されない。唯一の変更点は、キャッシュされたリソースに対する後続の要求が新しいコピーを取得することである。</p>

    <p>このメソッドが呼び出される前に<code id=application-cache-api:event-appcache-updateready><a href=#event-appcache-updateready>updateready</a></code>イベントが発火する。一度発火すると、ウェブアプリケーションは、その余暇で、より最近のアップデートで一つに基礎となるキャッシュを切り替えるためにこのメソッドを呼び出す。これを適切に使うためには、アプリケーションは動作に新しい機能をもたらすことができるようにする必要がある。たとえば、新しい機能を有効にするためにスクリプトをリロードするなど。</p>

    <p><code id=application-cache-api:dom-appcache-swapcache-3><a href=#dom-appcache-swapcache>swapCache()</a></code>の代替は、<code id=application-cache-api:dom-location-reload><a href=#dom-location-reload>location.reload()</a></code>を使用して、ユーザーに適した時点で単にページ全体をリロードすることである。</p>

   </dl>

  

  <p>There is a one-to-one mapping from <a href=#cache-host id=application-cache-api:cache-host>cache hosts</a> to
  <code id=application-cache-api:applicationcache-3><a href=#applicationcache>ApplicationCache</a></code> objects. The <dfn id=dom-applicationcache><code>applicationCache</code></dfn> attribute on <code id=application-cache-api:window-2><a href=#window>Window</a></code>
  objects must return the <code id=application-cache-api:applicationcache-4><a href=#applicationcache>ApplicationCache</a></code> object associated with the
  <code id=application-cache-api:window-3><a href=#window>Window</a></code> object's <a href=#active-document id=application-cache-api:active-document-2>active document</a>. The <dfn id=dom-sharedworkerglobalscope-applicationcache><code>applicationCache</code></dfn> attribute
  on <code id=application-cache-api:sharedworkerglobalscope><a href=workers.html#sharedworkerglobalscope>SharedWorkerGlobalScope</a></code> objects must return the <code id=application-cache-api:applicationcache-5><a href=#applicationcache>ApplicationCache</a></code>
  object associated with the worker.</p>

  <p class=note>A <code id=application-cache-api:window-4><a href=#window>Window</a></code> or <code id=application-cache-api:sharedworkerglobalscope-2><a href=workers.html#sharedworkerglobalscope>SharedWorkerGlobalScope</a></code> object has an
  associated <code id=application-cache-api:applicationcache-6><a href=#applicationcache>ApplicationCache</a></code> object even if that <a href=#cache-host id=application-cache-api:cache-host-2>cache host</a> has no actual
  <a href=#application-cache id=application-cache-api:application-cache-2>application cache</a>.</p>

  <hr>

  <p>The <dfn id=dom-appcache-status><code>status</code></dfn> attribute, on getting, must
  return the current state of the <a href=#application-cache id=application-cache-api:application-cache-3>application cache</a> that the
  <code id=application-cache-api:applicationcache-7><a href=#applicationcache>ApplicationCache</a></code> object's <a href=#cache-host id=application-cache-api:cache-host-3>cache host</a> is associated with, if any. This
  must be the appropriate value from the following list:</p>

  

  <dl><dt><dfn id=dom-appcache-uncached><code>UNCACHED</code></dfn>（数値0）<dd><p><code id=application-cache-api:applicationcache-8><a href=#applicationcache>ApplicationCache</a></code>オブジェクトの<a href=#cache-host id=application-cache-api:cache-host-4>キャッシュホスト</a>は、この時点で<a href=#application-cache id=application-cache-api:application-cache-4>アプリケーションキャッシュ</a>に関連付けられていない。<dt><dfn id=dom-appcache-idle><code>IDLE</code></dfn>（数値1）<dd><p><code id=application-cache-api:applicationcache-9><a href=#applicationcache>ApplicationCache</a></code>オブジェクトの<a href=#cache-host id=application-cache-api:cache-host-5>キャッシュホスト</a>は、<a href=#application-cache-group id=application-cache-api:application-cache-group>アプリケーションキャッシュグループ</a>の<a href=#concept-appcache-status id=application-cache-api:concept-appcache-status-2>更新ステータス</a>が<i>idle</i>である<a href=#application-cache id=application-cache-api:application-cache-5>アプリケーションキャッシュ</a>に関連付けられ、その<a href=#application-cache id=application-cache-api:application-cache-6>アプリケーションキャッシュ</a>は、その<a href=#application-cache-group id=application-cache-api:application-cache-group-2>アプリケーションキャッシュグループ</a>の<a href=#concept-appcache-newer id=application-cache-api:concept-appcache-newer>最新の</a>キャッシュであり、<a href=#application-cache-group id=application-cache-api:application-cache-group-3>アプリケーションキャッシュグループ</a>は、<a href=#concept-appcache-obsolete id=application-cache-api:concept-appcache-obsolete>obsolete</a>とマークされない。<dt><dfn id=dom-appcache-checking><code>CHECKING</code></dfn>（数値2）<dd><p><code id=application-cache-api:applicationcache-10><a href=#applicationcache>ApplicationCache</a></code>オブジェクトの<a href=#cache-host id=application-cache-api:cache-host-6>キャッシュホスト</a>は、<a href=#application-cache-group id=application-cache-api:application-cache-group-4>アプリケーションキャッシュグループ</a>の<a href=#concept-appcache-status id=application-cache-api:concept-appcache-status-3>更新ステータス</a>が<i>checking</i>である<a href=#application-cache id=application-cache-api:application-cache-7>アプリケーションキャッシュ</a>に関連付けられる。<dt><dfn id=dom-appcache-downloading><code>DOWNLOADING</code></dfn>（数値3）<dd><p><code id=application-cache-api:applicationcache-11><a href=#applicationcache>ApplicationCache</a></code>オブジェクトの<a href=#cache-host id=application-cache-api:cache-host-7>キャッシュホスト</a>は、<a href=#application-cache-group id=application-cache-api:application-cache-group-5>アプリケーションキャッシュグループ</a>の<a href=#concept-appcache-status id=application-cache-api:concept-appcache-status-4>更新ステータス</a>が<i>downloading</i>である<a href=#application-cache id=application-cache-api:application-cache-8>アプリケーションキャッシュ</a>に関連付けられる。<dt><dfn id=dom-appcache-updateready><code>UPDATEREADY</code></dfn>（数値4）<dd><p><code id=application-cache-api:applicationcache-12><a href=#applicationcache>ApplicationCache</a></code>オブジェクトの<a href=#cache-host id=application-cache-api:cache-host-8>キャッシュホスト</a>は、<a href=#application-cache-group id=application-cache-api:application-cache-group-6>アプリケーションキャッシュグループ</a>の<a href=#concept-appcache-status id=application-cache-api:concept-appcache-status-5>更新ステータス</a>が<i>idle</i>である<a href=#application-cache id=application-cache-api:application-cache-9>アプリケーションキャッシュ</a>に関連付けられ、その<a href=#application-cache-group id=application-cache-api:application-cache-group-7>アプリケーションキャッシュグループ</a>が<a href=#concept-appcache-obsolete id=application-cache-api:concept-appcache-obsolete-2>obsolete</a>としてマークされないが、その<a href=#application-cache id=application-cache-api:application-cache-10>アプリケーションキャッシュ</a>は、そのグループ内の<a href=#concept-appcache-newer id=application-cache-api:concept-appcache-newer-2>最新の</a>キャッシュでは<em>ない</em>。<dt><dfn id=dom-appcache-obsolete><code>OBSOLETE</code></dfn>（数値5）<dd><p><code id=application-cache-api:applicationcache-13><a href=#applicationcache>ApplicationCache</a></code>オブジェクトの<a href=#cache-host id=application-cache-api:cache-host-9>キャッシュホスト</a>は、<a href=#application-cache-group id=application-cache-api:application-cache-group-8>アプリケーションキャッシュグループ</a>が<a href=#concept-appcache-obsolete id=application-cache-api:concept-appcache-obsolete-3>obsolete</a>とマークされる<a href=#application-cache id=application-cache-api:application-cache-11>アプリケーションキャッシュ</a>に関連付けられる。</dl>

  

  <hr>

  <p>If the <dfn id=dom-appcache-update><code>update()</code></dfn> method is invoked, the user
  agent must invoke the <a href=#application-cache-download-process id=application-cache-api:application-cache-download-process-3>application cache download process</a>, in the background, for the
  <a href=#application-cache-group id=application-cache-api:application-cache-group-9>application cache group</a> of the <a href=#application-cache id=application-cache-api:application-cache-12>application cache</a> with which the
  <code id=application-cache-api:applicationcache-14><a href=#applicationcache>ApplicationCache</a></code> object's <a href=#cache-host id=application-cache-api:cache-host-10>cache host</a> is associated, but without giving
  that <a href=#cache-host id=application-cache-api:cache-host-11>cache host</a> to the algorithm. If there is no such <a href=#application-cache id=application-cache-api:application-cache-13>application cache</a>,
  or if its <a href=#application-cache-group id=application-cache-api:application-cache-group-10>application cache group</a> is marked as <a href=#concept-appcache-obsolete id=application-cache-api:concept-appcache-obsolete-4>obsolete</a>, then the method must throw an
  <a id=application-cache-api:invalidstateerror-3 href=https://triple-underscore.github.io/WebIDL-ja.html#invalidstateerror data-x-internal=invalidstateerror>"<code>InvalidStateError</code>"</a> <code id=application-cache-api:domexception-3><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code> instead.</p>

  <p>If the <dfn id=dom-appcache-abort><code>abort()</code></dfn> method is invoked, the user
  agent must <dfn id=send-a-signal>send a signal</dfn> to the current <a href=#application-cache-download-process id=application-cache-api:application-cache-download-process-4>application cache download process</a>
  for the <a href=#application-cache-group id=application-cache-api:application-cache-group-11>application cache group</a> of the <a href=#application-cache id=application-cache-api:application-cache-14>application cache</a> with which the
  <code id=application-cache-api:applicationcache-15><a href=#applicationcache>ApplicationCache</a></code> object's <a href=#cache-host id=application-cache-api:cache-host-12>cache host</a> is associated, if any. If there is
  no such <a href=#application-cache id=application-cache-api:application-cache-15>application cache</a>, or it does not have a current <a href=#application-cache-download-process id=application-cache-api:application-cache-download-process-5>application cache
  download process</a>, then do nothing.</p>

  <p>If the <dfn id=dom-appcache-swapcache><code>swapCache()</code></dfn> method is invoked,
  the user agent must run the following steps:

  

  <ol><li><p>Check that <code id=application-cache-api:applicationcache-16><a href=#applicationcache>ApplicationCache</a></code> object's <a href=#cache-host id=application-cache-api:cache-host-13>cache host</a> is associated
   with an <a href=#application-cache id=application-cache-api:application-cache-16>application cache</a>. If it is not, then throw an
   <a id=application-cache-api:invalidstateerror-4 href=https://triple-underscore.github.io/WebIDL-ja.html#invalidstateerror data-x-internal=invalidstateerror>"<code>InvalidStateError</code>"</a> <code id=application-cache-api:domexception-4><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code> and abort these
   steps.</li><li><p>Let <var>cache</var> be the <a href=#application-cache id=application-cache-api:application-cache-17>application cache</a> with which the
   <code id=application-cache-api:applicationcache-17><a href=#applicationcache>ApplicationCache</a></code> object's <a href=#cache-host id=application-cache-api:cache-host-14>cache host</a> is associated. (By definition,
   this is the same as the one that was found in the previous step.)</li><li><p>If <var>cache</var>'s <a href=#application-cache-group id=application-cache-api:application-cache-group-12>application cache group</a> is marked as <a href=#concept-appcache-obsolete id=application-cache-api:concept-appcache-obsolete-5>obsolete</a>, then unassociate the
   <code id=application-cache-api:applicationcache-18><a href=#applicationcache>ApplicationCache</a></code> object's <a href=#cache-host id=application-cache-api:cache-host-15>cache host</a> from <var>cache</var> and
   abort these steps. (Resources will now load from the network instead of the cache.)</li><li><p>Check that there is an application cache in the same <a href=#application-cache-group id=application-cache-api:application-cache-group-13>application cache group</a>
   as <var>cache</var> whose <a href=#concept-appcache-completeness id=application-cache-api:concept-appcache-completeness>completeness
   flag</a> is <i>complete</i> and that is <a href=#concept-appcache-newer id=application-cache-api:concept-appcache-newer-3>newer</a> than
   <var>cache</var>. If there is not, then throw an <a id=application-cache-api:invalidstateerror-5 href=https://triple-underscore.github.io/WebIDL-ja.html#invalidstateerror data-x-internal=invalidstateerror>"<code>InvalidStateError</code>"</a>
   <code id=application-cache-api:domexception-5><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code> exception and abort these steps.</li><li><p>Let <var>new cache</var> be the <a href=#concept-appcache-newer id=application-cache-api:concept-appcache-newer-4>newest</a> <a href=#application-cache id=application-cache-api:application-cache-18>application cache</a> in the same
   <a href=#application-cache-group id=application-cache-api:application-cache-group-14>application cache group</a> as <var>cache</var> whose <a href=#concept-appcache-completeness id=application-cache-api:concept-appcache-completeness-2>completeness flag</a> is <i>complete</i>.</li><li><p>Unassociate the <code id=application-cache-api:applicationcache-19><a href=#applicationcache>ApplicationCache</a></code> object's <a href=#cache-host id=application-cache-api:cache-host-16>cache host</a> from <var>cache</var> and instead associate it with <var>new cache</var>.</li></ol>

  <p>The following are the <a id=application-cache-api:event-handlers href=webappapis.html#event-handlers>event handlers</a> (and their corresponding <a href=webappapis.html#event-handler-event-type id=application-cache-api:event-handler-event-type>event handler event types</a>) that must be
  supported, as <a id=application-cache-api:event-handler-idl-attributes href=webappapis.html#event-handler-idl-attributes>event handler IDL attributes</a>, by all objects implementing the
  <code id=application-cache-api:applicationcache-20><a href=#applicationcache>ApplicationCache</a></code> interface:</p>

  <table><thead><tr><th><a href=webappapis.html#event-handlers id=application-cache-api:event-handlers-2>イベントハンドラ</a> </th><th><a id=application-cache-api:event-handler-event-type-2 href=webappapis.html#event-handler-event-type>イベントハンドライベント型</a>
   <tbody></th></tr><tr><td><dfn id=handler-appcache-onchecking><code>onchecking</code></dfn> </td><td> <code id=application-cache-api:event-appcache-checking><a href=#event-appcache-checking>checking</a></code>
    </td></tr><tr><td><dfn id=handler-appcache-onerror><code>onerror</code></dfn> </td><td> <code id=application-cache-api:event-appcache-error><a href=#event-appcache-error>error</a></code>
    </td></tr><tr><td><dfn id=handler-appcache-onnoupdate><code>onnoupdate</code></dfn> </td><td> <code id=application-cache-api:event-appcache-noupdate><a href=#event-appcache-noupdate>noupdate</a></code>
    </td></tr><tr><td><dfn id=handler-appcache-ondownloading><code>ondownloading</code></dfn> </td><td> <code id=application-cache-api:event-appcache-downloading><a href=#event-appcache-downloading>downloading</a></code>
    </td></tr><tr><td><dfn id=handler-appcache-onprogress><code>onprogress</code></dfn> </td><td> <code id=application-cache-api:event-appcache-progress><a href=#event-appcache-progress>progress</a></code>
    </td></tr><tr><td><dfn id=handler-appcache-onupdateready><code>onupdateready</code></dfn> </td><td> <code id=application-cache-api:event-appcache-updateready-2><a href=#event-appcache-updateready>updateready</a></code>
    </td></tr><tr><td><dfn id=handler-appcache-oncached><code>oncached</code></dfn> </td><td> <code id=application-cache-api:event-appcache-cached><a href=#event-appcache-cached>cached</a></code>
    </td></tr><tr><td><dfn id=handler-appcache-onobsolete><code>onobsolete</code></dfn> </td><td> <code id=application-cache-api:event-appcache-obsolete><a href=#event-appcache-obsolete>obsolete</a></code>
  </td></tr></table>

  


  <h4 id=navigator.online>7.9.11 <span id=browser-state>Browser state</span></h4><div class=status><input onclick=toggleStatus(this) value=⋰ type=button><p class=support><strong>Support:</strong> <span class="chrome yes"><span>Chrome</span> <span>14+</span></span><span class="and_chr yes"><span>Chrome for Android</span> <span>50+</span></span><span class="and_uc partial"><span><span>UC Browser for Android</span> (limited) </span><span>9.9+</span></span><span class="ios_saf yes"><span>iOS Safari</span> <span>4.2-4.3+</span></span><span class="firefox yes"><span>Firefox</span> <span>41+</span></span><span class="ie yes"><span>IE</span> <span>9+</span></span><span class="op_mini no"><span>Opera Mini</span> <span>None</span></span><span class="android yes"><span>Android Browser</span> <span>2.3+</span></span><span class="edge yes"><span>Edge</span> <span>12+</span></span><span class="safari yes"><span>Safari</span> <span>5+</span></span><span class="opera yes"><span>Opera</span> <span>15+</span></span><span class="ie_mob yes"><span>IE Mobile</span> <span>10+</span></span><p class=caniuse>Source: <a href="http://caniuse.com/#feat=online-status">caniuse.com</a></div>

  <pre class=idl>[NoInterfaceObject, Exposed=(Window,Worker)]
interface <dfn id=navigatoronline>NavigatorOnLine</dfn> {
  readonly attribute boolean <a href=#dom-navigator-online id=navigator.online:dom-navigator-online>onLine</a>;
};</pre>

  <dl class=domintro><dt><var>window</var> . <code id=navigator.online:dom-navigator><a href=webappapis.html#dom-navigator>navigator</a></code> . <code id=navigator.online:dom-navigator-online-2><a href=#dom-navigator-online>onLine</a></code><dd>

    <p>ユーザーエージェントが正確にオフラインである（ネットワークから切断されている）場合にfalseを返すユーザーエージェントがオンラインかもしれない場合にtrueを返す。</p>

    <p>この属性値が変更される場合、イベント<code id=navigator.online:event-online><a href=indices.html#event-online>online</a></code>および<code id=navigator.online:event-offline><a href=indices.html#event-offline>offline</a></code>が発火する。</p>

   </dl>

  

  <p>The <dfn id=dom-navigator-online><code>navigator.onLine</code></dfn> attribute must return
  false if the user agent will not contact the network when the user follows links or when a script
  requests a remote page (or knows that such an attempt would fail), and must return true
  otherwise.</p>

  <p>When the value that would be returned by the <code id=navigator.online:dom-navigator-online-3><a href=#dom-navigator-online>navigator.onLine</a></code> attribute of a <code id=navigator.online:window><a href=#window>Window</a></code> or
  <code id=navigator.online:workerglobalscope><a href=workers.html#workerglobalscope>WorkerGlobalScope</a></code> changes from true to false, the user agent must <a id=navigator.online:queue-a-task href=webappapis.html#queue-a-task>queue a
  task</a> to <a id=navigator.online:fire-a-simple-event href=webappapis.html#fire-a-simple-event>fire a simple event</a> named <code id=navigator.online:event-offline-2><a href=indices.html#event-offline>offline</a></code>
  at the <code id=navigator.online:window-2><a href=#window>Window</a></code> or <code id=navigator.online:workerglobalscope-2><a href=workers.html#workerglobalscope>WorkerGlobalScope</a></code> object.</p>

  <p>On the other hand, when the value that would be returned by the <code id=navigator.online:dom-navigator-online-4><a href=#dom-navigator-online>navigator.onLine</a></code> attribute of a <code id=navigator.online:window-3><a href=#window>Window</a></code> or
  <code id=navigator.online:workerglobalscope-3><a href=workers.html#workerglobalscope>WorkerGlobalScope</a></code> changes from false to true, the user agent must <a id=navigator.online:queue-a-task-2 href=webappapis.html#queue-a-task>queue a
  task</a> to <a id=navigator.online:fire-a-simple-event-2 href=webappapis.html#fire-a-simple-event>fire a simple event</a> named <code id=navigator.online:event-online-2><a href=indices.html#event-online>online</a></code> at
  the <code id=navigator.online:window-4><a href=#window>Window</a></code> or <code id=navigator.online:workerglobalscope-4><a href=workers.html#workerglobalscope>WorkerGlobalScope</a></code> object.</p>

  <p>The <a id=navigator.online:task-source href=webappapis.html#task-source>task source</a> for these <a href=webappapis.html#concept-task id=navigator.online:concept-task>tasks</a> is the
  <a id=navigator.online:networking-task-source href=webappapis.html#networking-task-source>networking task source</a>.</p>

  

  <p class=note>この属性は、本質的に信頼できない。コンピューターは、インターネット接続がなくてもネットワークに接続できる。</p>

  <div class=example>

   <p>この例において、ブラウザーがオンラインおよびオフラインになるように、インジケーターが更新される。</p>

   <pre>&lt;!DOCTYPE HTML&gt;
&lt;html lang="en"&gt;
 &lt;head&gt;
  &lt;title&gt;Online status&lt;/title&gt;
  &lt;script&gt;
   function updateIndicator() {
     document.getElementById('indicator').textContent = navigator.onLine ? 'online' : 'offline';
   }
  &lt;/script&gt;
 &lt;/head&gt;
 &lt;body onload="updateIndicator()" ononline="updateIndicator()" onoffline="updateIndicator()"&gt;
  &lt;p&gt;The network is: &lt;span id="indicator"&gt;(state unknown)&lt;/span&gt;
 &lt;/body&gt;
&lt;/html&gt;</pre>

  </div>





  <nav><a href=interaction.html>← 6 ユーザーとの対話処理</a> — <a href=index.html>目次</a> — <a href=webappapis.html>8 ウェブアプリケーションAPI →</a></nav>
</body></html>