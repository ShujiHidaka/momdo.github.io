<!DOCTYPE html><html class=split lang=ja>
<script src=/link-fixup.js defer=""></script><meta charset=utf-8><meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name=viewport>
<title>HTML Standard 日本語訳</title><meta content=#3c790a name=theme-color><link rel=stylesheet href=https://resources.whatwg.org/standard.css>
<script defer="" src=https://resources.whatwg.org/dfn.js></script>
<script>
   function toggleStatus(div) {
     div.parentNode.classList.toggle('wrapped');
   }
  </script><link rel=icon href=https://resources.whatwg.org/logo.svg>
<style>
   [hidden] { display: none; }

   .bad, .bad *:not(.X\58X) { color: gray; border-color: gray; background: transparent; }

   .fingerprint { position: absolute; right: 0; z-index: 5; }
   @media (max-width: 767px) {
     .fingerprint { max-width: 35px; }
   }

   .status { min-height: 0.6em; font: 1em sans-serif; width: 9em; padding: 0.3em; position: absolute; z-index: 8; right: 0.3em; background: #EEE; color: black; box-shadow: 0 0 3px #999; overflow: hidden; margin: -2em 0 0 0; border-collapse: initial; border-spacing: initial; }
   .status:hover { z-index: 9; }
   .status:focus-within { z-index: 9; }
   .status.wrapped > :not(input) { display: none; }
   .status > input { position: absolute; left: 0; top: 0; width: 1em; height: 1em; border: none; background: transparent; padding: 0; margin: 0; }
   .status > p { font-size: 0.6em; margin: 0; padding: 0; }
   .status > p + p { padding-top: 0.5em; }
   .status > p > strong { margin-left: 1.5em; }
   .status > .support { display: block; }
   .status > .support > span { padding: 0.2em 0; display: block; display: table; }
   .status > .support > span.partial { color: #666666; filter: grayscale(50%); }
   .status > .support > span.no { color: #CCCCCC; filter: grayscale(100%); }
   .status > .support > span.no::before { opacity: 0.5; }
   .status > .support > span:first-of-type { padding-top: 0.5em; }
   .status > .support > span > span { padding: 0 0.5em; display: table-cell; vertical-align: top; }
   .status > .support > span > span:first-child { width: 100%; }
   .status > .support > span > span:last-child { width: 100%; white-space: pre; padding: 0; }
   .status > .support > span::before { content: ' '; display: table-cell; min-width: 1.5em; height: 1.5em; background: no-repeat center center; background-size: contain; text-align: right; font-size: 0.75em; font-weight: bold; }
   .status > .support > .and_chr::before { background-image: url(https://resources.whatwg.org/browser-logos/chrome.svg); }
   .status > .support > .and_ff::before { background-image: url(https://resources.whatwg.org/browser-logos/firefox.png); }
   .status > .support > .and_uc::before { background-image: url(https://resources.whatwg.org/browser-logos/uc.png); } /* UC Browser for Android */
   .status > .support > .android::before { background-image: url(https://resources.whatwg.org/browser-logos/android.svg); }
   .status > .support > .bb::before { background-image: url(https://resources.whatwg.org/browser-logos/bb.jpg); } /* Blackberry Browser */
   .status > .support > .chrome::before { background-image: url(https://resources.whatwg.org/browser-logos/chrome.svg); }
   .status > .support > .edge::before { background-image: url(https://resources.whatwg.org/browser-logos/edge.svg); }
   .status > .support > .firefox::before { background-image: url(https://resources.whatwg.org/browser-logos/firefox.png); }
   .status > .support > .ie::before { background-image: url(https://resources.whatwg.org/browser-logos/ie.png); }
   .status > .support > .ie_mob::before { background-image: url(https://resources.whatwg.org/browser-logos/ie-mobile.svg); }
   .status > .support > .ios_saf::before { background-image: url(https://resources.whatwg.org/browser-logos/safari-ios.svg); }
   .status > .support > .op_mini::before { background-image: url(https://resources.whatwg.org/browser-logos/opera-mini.png); }
   .status > .support > .op_mob::before { background-image: url(https://resources.whatwg.org/browser-logos/opera.png); }
   .status > .support > .opera::before { background-image: url(https://resources.whatwg.org/browser-logos/opera.png); }
   .status > .support > .safari::before { background-image: url(https://resources.whatwg.org/browser-logos/safari.png); }
   .status > .support > .samsung::before { background-image: url(https://resources.whatwg.org/browser-logos/samsung.png); }
   .status > .caniuse { text-align: right; font-style: italic; }
   .status > .caniuse + p { margin-top: 0.5em; border-top: 1px solid silver; }

   @media (max-width: 767px) {
     .status { right: -9em; }
   }

   .applies .yes, .yesno .yes { background: yellow; }
   .yesno .yes, .yesno .no { text-align: center; }

   .applies thead th > * { display: block; }
   .applies thead code { display: block; }
   .applies td { text-align: center; }

   .matrix, .matrix td { border: hidden; text-align: right; }
   .matrix { margin-left: 2em; }

   .vertical-summary-table tr > th[rowspan="2"]:first-child + th,
   .vertical-summary-table tr > td[rowspan="2"]:first-child + td { border-bottom: hidden; }

   .dice-example { border-collapse: collapse; border-style: hidden solid solid hidden; border-width: thin; margin-left: 3em; }
   .dice-example caption { width: 30em; font-size: smaller; font-style: italic; padding: 0.75em 0; text-align: left; }
   .dice-example td, .dice-example th { border: solid thin; width: 1.35em; height: 1.05em; text-align: center; padding: 0; }

   td.eg { border-width: thin; text-align: center; }

   #table-example-1 { border: solid thin; border-collapse: collapse; margin-left: 3em; }
   #table-example-1 caption { padding-bottom: 0.5em; }
   #table-example-1 thead, #table-example-1 tbody { border: none; }
   #table-example-1 th, #table-example-1 td { border: solid thin; }
   #table-example-1 th { font-weight: normal; }
   #table-example-1 td { border-style: none solid; vertical-align: top; }
   #table-example-1 th { padding: 0.5em; vertical-align: middle; text-align: center; }
   #table-example-1 tbody tr:first-child td { padding-top: 0.5em; }
   #table-example-1 tbody tr:last-child td { padding-bottom: 1.5em; }
   #table-example-1 tbody td:first-child { padding-left: 2.5em; padding-right: 0; width: 9em; }
   #table-example-1 tbody td:first-child::after { content: leader(". "); }
   #table-example-1 tbody td { padding-left: 2em; padding-right: 2em; }
   #table-example-1 tbody td:first-child + td { width: 10em; }
   #table-example-1 tbody td:first-child + td ~ td { width: 2.5em; }
   #table-example-1 tbody td:first-child + td + td + td ~ td { width: 1.25em; }

   .apple-table-examples { border: none; border-collapse: separate; border-spacing: 1.5em 0em; width: 40em; margin-left: 3em; }
   .apple-table-examples * { font-family: "Times", serif; }
   .apple-table-examples td, .apple-table-examples th { border: none; white-space: nowrap; padding-top: 0; padding-bottom: 0; }
   .apple-table-examples tbody th:first-child { border-left: none; width: 100%; }
   .apple-table-examples thead th:first-child ~ th { font-size: smaller; font-weight: bolder; border-bottom: solid 2px; text-align: center; }
   .apple-table-examples tbody th::after, .apple-table-examples tfoot th::after { content: leader(". ") }
   .apple-table-examples tbody th, .apple-table-examples tfoot th { font: inherit; text-align: left; }
   .apple-table-examples td { text-align: right; vertical-align: top; }
   .apple-table-examples.e1 tbody tr:last-child td { border-bottom: solid 1px; }
   .apple-table-examples.e1 tbody + tbody tr:last-child td { border-bottom: double 3px; }
   .apple-table-examples.e2 th[scope=row] { padding-left: 1em; }
   .apple-table-examples sup { line-height: 0; }

   .three-column-nowrap tr > td:first-child,
   .three-column-nowrap tr > td:first-child + td,
   .three-column-nowrap tr > td:first-child + td + td { white-space: nowrap; }

   .details-example img { vertical-align: top; }

   #base64-table {
     white-space: nowrap;
     font-size: 0.6em;
     column-width: 6em;
     column-count: 5;
     column-gap: 1em;
     -moz-column-width: 6em;
     -moz-column-count: 5;
     -moz-column-gap: 1em;
     -webkit-column-width: 6em;
     -webkit-column-count: 5;
     -webkit-column-gap: 1em;
   }
   #base64-table thead { display: none; }
   #base64-table * { border: none; }
   #base64-table tbody td:first-child:after { content: ':'; }
   #base64-table tbody td:last-child { text-align: right; }

   #named-character-references-table {
     white-space: nowrap;
     font-size: 0.6em;
     column-width: 30em;
     column-gap: 1em;
     -moz-column-width: 30em;
     -moz-column-gap: 1em;
     -webkit-column-width: 30em;
     -webkit-column-gap: 1em;
   }
   #named-character-references-table > table > tbody > tr > td:first-child + td,
   #named-character-references-table > table > tbody > tr > td:last-child { text-align: center; }
   #named-character-references-table > table > tbody > tr > td:last-child:hover > span { position: absolute; top: auto; left: auto; margin-left: 0.5em; line-height: 1.2; font-size: 5em; border: outset; padding: 0.25em 0.5em; background: white; width: 1.25em; height: auto; text-align: center; }
   #named-character-references-table > table > tbody > tr#entity-CounterClockwiseContourIntegral > td:first-child { font-size: 0.5em; }

   .glyph.control { color: red; }

   #table-example-1 * { font-family: "Essays1743", serif; line-height: 1.01em; }
   @font-face {
     font-family: 'Essays1743';
     src: url('/fonts/Essays1743.ttf');
   }
   @font-face {
     font-family: 'Essays1743';
     font-weight: bold;
     src: url('/fonts/Essays1743-Bold.ttf');
   }
   @font-face {
     font-family: 'Essays1743';
     font-style: italic;
     src: url('/fonts/Essays1743-Italic.ttf');
   }
   @font-face {
     font-family: 'Essays1743';
     font-style: italic;
     font-weight: bold;
     src: url('/fonts/Essays1743-BoldItalic.ttf');
   }

   @media (max-width: 767px) {
     #abstractimg { width: 100%; }
   }
   #abstractimg, #abstractimg text { font: inherit; }
   #abstractimg rect { fill: #424242; }
   #abstractimg text { fill: #ffffff; font-size: 18px }
   #abstractimg .top { word-spacing: 50px; text-anchor: middle; }
   #abstractimg .left, #abstractimg .bottom { word-spacing: 12px; }
   #abstractimg .right { font-size: 25px; }
  </style>
  <script data-file-issue-url=https://github.com/whatwg/html/issues/new src=https://resources.whatwg.org/file-issue.js async=""></script>
  <header id=head class="head with-buttons">
   <p><a href=https://whatwg.org/ class=logo><img alt=WHATWG src=https://resources.whatwg.org/logo.svg width=100 height=100></a></p>
   <hgroup><h1 class=allcaps>HTML</h1><h2 id=living-standard class="no-num no-toc">Living Standard — Last Updated <span class=pubdate>11 April 2017</span></h2></hgroup>
   
   
  </header>

  

  

  
  

  
  

  

  <nav><a href=forms.html>← 4.10 フォーム</a> — <a href=index.html>目次</a> — <a href=microdata.html>5 Microdata →</a></nav><ol class=toc><li id=toc-semantics><ol><li><a href=scripting.html#scripting-3>4.12 スクリプティング</a><ol><li><a href=scripting.html#the-script-element>4.12.1 <code>script</code>要素</a><ol><li><a href=scripting.html#script-processing-model>4.12.1.1 Processing model</a></li><li><a href=scripting.html#scriptingLanguages>4.12.1.2 スクリプト言語</a></li><li><a href=scripting.html#restrictions-for-contents-of-script-elements>4.12.1.3 <code>script</code>要素のコンテンツの制約</a></li><li><a href=scripting.html#inline-documentation-for-external-scripts>4.12.1.4 外部スクリプトに対するインライン文書</a></li><li><a href=scripting.html#scriptTagXSLT>4.12.1.5 Interaction of <code>script</code> elements and XSLT</a></li></ol></li><li><a href=scripting.html#the-noscript-element>4.12.2 <code>noscript</code>要素</a></li><li><a href=scripting.html#the-template-element>4.12.3 <code>template</code>要素</a><ol><li><a href=scripting.html#template-XSLT-XPath>4.12.3.1 Interaction of <code>template</code> elements with XSLT and XPath</a></li></ol></li><li><a href=scripting.html#the-slot-element>4.12.4 The <code>slot</code> element</a></li><li><a href=scripting.html#the-canvas-element>4.12.5 <code>canvas</code>要素</a><ol><li><a href=scripting.html#2dcontext>4.12.5.1 The 2D rendering context</a><ol><li><a href=scripting.html#implementation-notes>4.12.5.1.1 Implementation notes</a></li><li><a href=scripting.html#the-canvas-state>4.12.5.1.2 The canvas state</a></li><li><a href=scripting.html#line-styles>4.12.5.1.3 Line styles</a></li><li><a href=scripting.html#text-styles>4.12.5.1.4 Text styles</a></li><li><a href=scripting.html#building-paths>4.12.5.1.5 Building paths</a></li><li><a href=scripting.html#path2d-objects>4.12.5.1.6 <code>Path2D</code> objects</a></li><li><a href=scripting.html#transformations>4.12.5.1.7 Transformations</a></li><li><a href=scripting.html#image-sources-for-2d-rendering-contexts>4.12.5.1.8 Image sources for 2D rendering contexts</a></li><li><a href=scripting.html#fill-and-stroke-styles>4.12.5.1.9 Fill and stroke styles</a></li><li><a href=scripting.html#drawing-rectangles-to-the-bitmap>4.12.5.1.10 Drawing rectangles to the bitmap</a></li><li><a href=scripting.html#drawing-text-to-the-bitmap>4.12.5.1.11 Drawing text to the bitmap</a></li><li><a href=scripting.html#drawing-paths-to-the-canvas>4.12.5.1.12 Drawing paths to the canvas</a></li><li><a href=scripting.html#drawing-focus-rings-and-scrolling-paths-into-view>4.12.5.1.13 Drawing focus rings and scrolling paths into view</a></li><li><a href=scripting.html#drawing-images>4.12.5.1.14 Drawing images</a></li><li><a href=scripting.html#pixel-manipulation>4.12.5.1.15 Pixel manipulation</a></li><li><a href=scripting.html#compositing>4.12.5.1.16 Compositing</a></li><li><a href=scripting.html#image-smoothing>4.12.5.1.17 Image smoothing</a></li><li><a href=scripting.html#shadows>4.12.5.1.18 Shadows</a></li><li><a href=scripting.html#filters>4.12.5.1.19 Filters</a></li><li><a href=scripting.html#working-with-externally-defined-svg-filters>4.12.5.1.20 Working with externally-defined SVG filters</a></li><li><a href=scripting.html#drawing-model>4.12.5.1.21 Drawing model</a></li><li><a href=scripting.html#best-practices>4.12.5.1.22 Best practices</a></li><li><a href=scripting.html#examples>4.12.5.1.23 例</a></li></ol></li><li><a href=scripting.html#the-imagebitmap-rendering-context>4.12.5.2 The <code>ImageBitmap</code> rendering context</a><ol><li><a href=scripting.html#introduction-6>4.12.5.2.1 導入</a></li><li><a href=scripting.html#the-imagebitmaprenderingcontext-interface>4.12.5.2.2 The <code>ImageBitmapRenderingContext</code> interface</a></li></ol></li><li><a href=scripting.html#the-offscreencanvas-interface>4.12.5.3 The <code>OffscreenCanvas</code> interface</a><ol><li><a href=scripting.html#the-offscreen-2d-rendering-context>4.12.5.3.1 The offscreen 2D rendering context</a></li></ol></li><li><a href=scripting.html#colour-spaces-and-colour-correction>4.12.5.4 Color spaces and color correction</a></li><li><a href=scripting.html#serialising-bitmaps-to-a-file>4.12.5.5 Serializing bitmaps to a file</a></li><li><a href=scripting.html#security-with-canvas-elements>4.12.5.6 Security with <code>canvas</code> elements</a></li></ol></li></ol></li><li><a href=scripting.html#custom-elements>4.13 Custom elements</a><ol><li><a href=scripting.html#custom-elements-intro>4.13.1 導入</a><ol><li><a href=scripting.html#custom-elements-autonomous-example>4.13.1.1 Creating an autonomous custom element</a></li><li><a href=scripting.html#custom-elements-customized-builtin-example>4.13.1.2 Creating a customized built-in element</a></li><li><a href=scripting.html#custom-elements-autonomous-drawbacks>4.13.1.3 Drawbacks of autonomous custom elements</a></li><li><a href=scripting.html#custom-elements-upgrades-examples>4.13.1.4 Upgrading elements after their creation</a></li></ol></li><li><a href=scripting.html#custom-element-conformance>4.13.2 Requirements for custom element constructors</a></li><li><a href=scripting.html#custom-elements-core-concepts>4.13.3 Core concepts</a></li><li><a href=scripting.html#custom-elements-api>4.13.4 The <code>CustomElementRegistry</code> interface</a></li><li><a href=scripting.html#upgrades>4.13.5 Upgrades</a></li><li><a href=scripting.html#custom-element-reactions>4.13.6 Custom element reactions</a></li></ol></li><li><a href=scripting.html#common-idioms>4.14 専用要素なしの一般的語彙</a><ol><li><a href=scripting.html#the-main-part-of-the-content>4.14.1 コンテンツの主要部分</a></li><li><a href=scripting.html#rel-up>4.14.2 パンくずナビゲーション</a></li><li><a href=scripting.html#tag-clouds>4.14.3 タグクラウド</a></li><li><a href=scripting.html#conversations>4.14.4 会話</a></li><li><a href=scripting.html#footnotes>4.14.5 脚注</a></li></ol></li><li><a href=scripting.html#disabled-elements>4.15 無効要素</a></li><li><a href=scripting.html#selectors>4.16 Matching HTML elements using selectors and CSS</a><ol><li><a href="scripting.html#case-sensitivity-of-the-css-'attr()'-function">4.16.1 Case-sensitivity of the CSS 'attr()' function</a></li><li><a href=scripting.html#case-sensitivity-of-selectors>4.16.2 Case-sensitivity of selectors</a></li><li><a href=scripting.html#pseudo-classes>4.16.3 擬似クラス</a></li></ol></li></ol></li></ol><h3 id=scripting-3>4.12 スクリプティング<a href=#scripting-3 class=self-link></a></h3>

  <p>スクリプトは著者が文書に双方向性を追加することを許可する。</p>

  <p>著者は、宣言型のメカニズムがしばしばより保守しやすく、かつ多くのユーザーがスクリプトを無効としているため、可能であれば、スクリプトに宣言型の代替を使用するよう推奨される。</p>

  <div class=example>

   <p>たとえば、より詳細な情報を表示するセクションを表示または非表示にするスクリプトを使用する代わりに、<code id=scripting-3:the-details-element><a href=forms.html#the-details-element>details</a></code>要素を使用できる。</p>

  </div>

  <p>著者はまた、スクリプトのサポートがない状態でそれらのアプリケーションが行儀よくデグレードするよう推奨される。</p>

  <div class=example>

   <p>たとえば、著者がテーブルヘッダーにおいてリンクに動的なテーブルの再ソートを提供する場合、リンクはまたサーバーからソートされたテーブルを要求することによって、スクリプトなしで機能させることができるかもしれない。</p>

  </div>


  <h4 id=the-script-element data-dfn-type=element data-lt=script>4.12.1 <dfn id=script><code>script</code></dfn>要素<a href=#the-script-element class=self-link></a></h4>

  <dl class=element><dt><a href=dom.html#concept-element-categories id=the-script-element:concept-element-categories>カテゴリー</a>：<dd><a id=the-script-element:metadata-content-2 href=dom.html#metadata-content-2>メタデータコンテンツ</a>。<dd><a id=the-script-element:flow-content-2 href=dom.html#flow-content-2>フローコンテンツ</a>。<dd><a id=the-script-element:phrasing-content-2 href=dom.html#phrasing-content-2>フレージングコンテンツ</a>。<dd><a href=dom.html#script-supporting-elements-2 id=the-script-element:script-supporting-elements-2>スクリプトサポート要素</a>。<dt><a href=dom.html#concept-element-contexts id=the-script-element:concept-element-contexts>この要素を使用できるコンテキスト</a>：<dd><a id=the-script-element:metadata-content-2-2 href=dom.html#metadata-content-2>メタデータコンテンツ</a>が期待される場所。<dd><a id=the-script-element:phrasing-content-2-2 href=dom.html#phrasing-content-2>フレージングコンテンツ</a>が期待される場所。<dd><a id=the-script-element:script-supporting-elements-2-2 href=dom.html#script-supporting-elements-2>スクリプトサポート要素</a>が期待される場所。<dt><a href=dom.html#concept-element-content-model id=the-script-element:concept-element-content-model>コンテンツモデル</a>：<dd><code id=the-script-element:attr-script-src><a href=#attr-script-src>src</a></code>属性が存在しない場合、<code id=the-script-element:attr-script-type><a href=#attr-script-type>type</a></code>属性の値に依存するが、<a href=#restrictions-for-contents-of-script-elements id=the-script-element:restrictions-for-contents-of-script-elements>スクリプトの内容制限</a>に一致しなければならない。<dd><code id=the-script-element:attr-script-src-2><a href=#attr-script-src>src</a></code>属性が存在<em>する</em>場合、要素は空または<a href=#inline-documentation-for-external-scripts id=the-script-element:inline-documentation-for-external-scripts>スクリプト文書</a>を含むだけでなく<a href=#restrictions-for-contents-of-script-elements id=the-script-element:restrictions-for-contents-of-script-elements-2>スクリプトの内容制限</a>に一致するかのいずれかでなければならない。<dt><a href=dom.html#concept-element-tag-omission id=the-script-element:concept-element-tag-omission>text/htmlにおけるタグ省略</a>：<dd>どちらのタグも省略不可。<dt><a href=dom.html#concept-element-attributes id=the-script-element:concept-element-attributes>コンテンツ属性</a>：<dd><a id=the-script-element:global-attributes href=dom.html#global-attributes>グローバル属性</a><dd><code id=the-script-element:attr-script-src-3><a href=#attr-script-src>src</a></code> — リソースのアドレス<dd><code id=the-script-element:attr-script-type-2><a href=#attr-script-type>type</a></code> — 埋め込みリソースタイプ<dd><code id=the-script-element:attr-script-nomodule><a href=#attr-script-nomodule>nomodule</a></code> — Prevents execution in user agents that support <a href=webappapis.html#module-script id=the-script-element:module-script>module scripts</a><dd><code id=the-script-element:attr-script-charset><a href=#attr-script-charset>charset</a></code> — 外部スクリプトリソースの文字エンコーディング<dd><code id=the-script-element:attr-script-async><a href=#attr-script-async>async</a></code> — ブロックなしで、可能な場合にスクリプトを実行する<dd><code id=the-script-element:attr-script-defer><a href=#attr-script-defer>defer</a></code> — スクリプトの実行を延期する<dd><code id=the-script-element:attr-script-crossorigin><a href=#attr-script-crossorigin>crossorigin</a></code> — 要素がcrossorigin要求を処理する方法<dd><code id=the-script-element:attr-script-nonce><a href=#attr-script-nonce>nonce</a></code> — <cite>Content Security Policy</cite>チェックで使用される暗号nonce <a href=references.html#refsCSP>[CSP]</a><dd><code id=the-script-element:attr-script-integrity><a href=#attr-script-integrity>integrity</a></code> — Integrity metadata used in <cite>Subresource Integrity</cite> checks <a href=references.html#refsSRI>[SRI]</a><dt><a href=dom.html#concept-element-dom id=the-script-element:concept-element-dom>DOMインターフェイス</a>：<dd>
<pre class=idl>[<a id=the-script-element:htmlconstructor href=dom.html#htmlconstructor>HTMLConstructor</a>]
interface <dfn id=htmlscriptelement>HTMLScriptElement</dfn> : <a id=the-script-element:htmlelement href=dom.html#htmlelement>HTMLElement</a> {
  [<a href=#cereactions id=the-script-element:cereactions>CEReactions</a>] attribute USVString <a href=#dom-script-src id=the-script-element:dom-script-src>src</a>;
  [<a href=#cereactions id=the-script-element:cereactions-2>CEReactions</a>] attribute DOMString <a href=#dom-script-type id=the-script-element:dom-script-type>type</a>;
  [<a href=#cereactions id=the-script-element:cereactions-3>CEReactions</a>] attribute boolean <a href=#dom-script-nomodule id=the-script-element:dom-script-nomodule>noModule</a>;
  [<a href=#cereactions id=the-script-element:cereactions-4>CEReactions</a>] attribute DOMString <a href=#dom-script-charset id=the-script-element:dom-script-charset>charset</a>;
  [<a href=#cereactions id=the-script-element:cereactions-5>CEReactions</a>] attribute boolean <a href=#dom-script-async id=the-script-element:dom-script-async>async</a>;
  [<a href=#cereactions id=the-script-element:cereactions-6>CEReactions</a>] attribute boolean <a href=#dom-script-defer id=the-script-element:dom-script-defer>defer</a>;
  [<a href=#cereactions id=the-script-element:cereactions-7>CEReactions</a>] attribute DOMString? <a href=#dom-script-crossorigin id=the-script-element:dom-script-crossorigin>crossOrigin</a>;
  [<a href=#cereactions id=the-script-element:cereactions-8>CEReactions</a>] attribute DOMString <a href=#dom-script-text id=the-script-element:dom-script-text>text</a>;
  [<a href=#cereactions id=the-script-element:cereactions-9>CEReactions</a>] attribute DOMString <a href=#dom-script-nonce id=the-script-element:dom-script-nonce>nonce</a>;
  [<a href=#cereactions id=the-script-element:cereactions-10>CEReactions</a>] attribute DOMString <a href=#dom-script-integrity id=the-script-element:dom-script-integrity>integrity</a>;

};</pre>
   </dl>

  <p><code id=the-script-element:the-script-element><a href=#the-script-element>script</a></code>要素は、著者が文書に動的スクリプトおよびデータブロックを含むことを許可する。この要素は、ユーザーにコンテンツを<a href=dom.html#represents id=the-script-element:represents>表す</a>ものでない。</p>

  <p><dfn id=attr-script-type><code>type</code></dfn>属性は、表されるスクリプトの型をカスタマイズを可能にする：</p>

  <ul><li><p>属性を省略する、または<a href=#javascript-mime-type id=the-script-element:javascript-mime-type>JavaScript MIMEタイプ</a>に設定することは、スクリプトがJavaScript <i id=the-script-element:js-prod-script><a data-x-internal=js-prod-script href=https://tc39.github.io/ecma262/#prod-Script>Script</a></i>トップレベル制作物によって解釈されるようなクラシックスクリプトであることを意味する。クラシックスクリプトは、<code id=the-script-element:attr-script-charset-2><a href=#attr-script-charset>charset</a></code>、<code id=the-script-element:attr-script-async-2><a href=#attr-script-async>async</a></code>および<code id=the-script-element:attr-script-defer-2><a href=#attr-script-defer>defer</a></code>属性の影響を受ける。著者は、冗長な<a href=#javascript-mime-type id=the-script-element:javascript-mime-type-2>JavaScript MIMEタイプ</a>を与える代わりに、属性を省略すべきである。</li><li><p>文字列"<code>module</code>"に<a id=the-script-element:ascii-case-insensitive href=https://infra.spec.whatwg.org/#ascii-case-insensitive data-x-internal=ascii-case-insensitive>ASCII大文字・小文字不区別</a>で属性を設定することは、スクリプトがJavaScript <i id=the-script-element:js-prod-module><a data-x-internal=js-prod-module href=https://tc39.github.io/ecma262/#prod-Module>Module</a></i>トップレベル制作物によって解釈されるような<a id=the-script-element:module-script-2 href=webappapis.html#module-script>モジュールスクリプト</a>であることを意味する。モジュールスクリプトは<code id=the-script-element:attr-script-charset-3><a href=#attr-script-charset>charset</a></code>および<code id=the-script-element:attr-script-defer-3><a href=#attr-script-defer>defer</a></code>の影響を受けない。</li><li><p>他の値に属性を設定することは、スクリプトが処理されない<dfn id=data-block>データブロック</dfn>であることを意味する。（<code id=the-script-element:attr-script-type-3><a href=#attr-script-type>type</a></code>自身を除く）<code id=the-script-element:the-script-element-2><a href=#the-script-element>script</a></code>属性のいずれもデータブロック上で任意の効果を持たない。著者は、データブロックを示すために<a href=#javascript-mime-type id=the-script-element:javascript-mime-type-3>JavaScript MIMEタイプ</a>でない<a id=the-script-element:valid-mime-type href=https://mimesniff.spec.whatwg.org/#valid-mime-type data-x-internal=valid-mime-type>妥当なMIMEタイプ</a>を使用しなければならない。</li></ul>

  <p class=note><a href=#data-block id=the-script-element:data-block>データブロック</a>が<a id=the-script-element:valid-mime-type-2 href=https://mimesniff.spec.whatwg.org/#valid-mime-type data-x-internal=valid-mime-type>妥当なMIMEタイプ</a>を使用して表記されなければならない要件は、潜在的な将来の衝突を回避するための場所である。この仕様が<a href=#the-script-element id=the-script-element:the-script-element-3>スクリプト</a>の追加の型をいずれ追加する場合、その追加の型は"<code>module</code>"値が<a href=webappapis.html#module-script id=the-script-element:module-script-3>モジュールスクリプト</a>を表す方法のように、MIMEタイプでない何かに<code id=the-script-element:attr-script-type-4><a href=#attr-script-type>type</a></code>属性を設定することによってトリガーされる。現在に妥当なMIMEタイプを使用することで、将来のユーザーエージェントでさえも、データブロックが異なるスクリプトタイプとして再解釈されないことを保証する。</p>

  <p><a href=webappapis.html#classic-script id=the-script-element:classic-script-2>クラシックスクリプト</a>および<a href=webappapis.html#module-script id=the-script-element:module-script-4>モジュールスクリプト</a>は、インラインで埋め込まれるか、指定された場合に使用する外部スクリプトリソースの<a id=the-script-element:url href=https://triple-underscore.github.io/URL-ja.html#concept-url data-x-internal=url>URL</a>を与える、<dfn data-dfn-for=script id=attr-script-src data-dfn-type=element-attr data-export=""><code>src</code></dfn>属性を使用する外部ファイルからインポートされるかのいずれかであってもよい。<code id=the-script-element:attr-script-src-4><a href=#attr-script-src>src</a></code>が指定される場合、<a id=the-script-element:valid-non-empty-url-potentially-surrounded-by-spaces href=infrastructure.html#valid-non-empty-url-potentially-surrounded-by-spaces>潜在的にスペースで囲まれる妥当な空でないURL</a>でなければならない。インライン<code id=the-script-element:the-script-element-4><a href=#the-script-element>script</a></code>要素、または外部スクリプトリソースのコンテンツは、それぞれ<a href=webappapis.html#classic-script id=the-script-element:classic-script-3>クラシックスクリプト</a>および<a href=webappapis.html#module-script id=the-script-element:module-script-5>モジュールスクリプト</a>に対するJavaScript仕様の<i id=the-script-element:js-prod-script-2><a data-x-internal=js-prod-script href=https://tc39.github.io/ecma262/#prod-Script>Script</a></i>または<i id=the-script-element:js-prod-module-2><a data-x-internal=js-prod-module href=https://tc39.github.io/ecma262/#prod-Module>Module</a></i>制作物の要件に適合しなければならない。<a href=references.html#refsJAVASCRIPT>[JAVASCRIPT]</a></p>

  <p><a href=#data-block id=the-script-element:data-block-2>データブロック</a>を含めるために使用される場合、データは、インラインに埋め込まれなければならず、データの形式は、<code id=the-script-element:attr-script-type-5><a href=#attr-script-type>type</a></code>属性を使用して指定しなければならず、かつ<code id=the-script-element:the-script-element-5><a href=#the-script-element>script</a></code>要素のコンテンツは、使用される形式のために定義される要件に適合しなければならない。The <code id=the-script-element:attr-script-src-5><a href=#attr-script-src>src</a></code>, <code id=the-script-element:attr-script-charset-4><a href=#attr-script-charset>charset</a></code>, <code id=the-script-element:attr-script-async-3><a href=#attr-script-async>async</a></code>, <code id=the-script-element:attr-script-nomodule-2><a href=#attr-script-nomodule>nomodule</a></code>, <code id=the-script-element:attr-script-defer-4><a href=#attr-script-defer>defer</a></code>, <code id=the-script-element:attr-script-crossorigin-2><a href=#attr-script-crossorigin>crossorigin</a></code>, <code id=the-script-element:attr-script-nonce-2><a href=#attr-script-nonce>nonce</a></code> and <code id=the-script-element:attr-script-integrity-2><a href=#attr-script-integrity>integrity</a></code> attributes must not be specified.</p>

  <p>The <dfn id=attr-script-nomodule><code>nomodule</code></dfn> attribute is a <a id=the-script-element:boolean-attribute href=infrastructure.html#boolean-attribute>boolean
  attribute</a> that prevents a script from being executed in user agents that support
  <a href=webappapis.html#module-script id=the-script-element:module-script-6>module scripts</a>. This allows selective execution of <a href=webappapis.html#module-script id=the-script-element:module-script-7>module scripts</a> in modern user agents and <a href=webappapis.html#classic-script id=the-script-element:classic-script-4>classic scripts</a> in older user agents, <a href=#script-nomodule-example>as shown
  below</a>. The <code id=the-script-element:attr-script-nomodule-3><a href=#attr-script-nomodule>nomodule</a></code> attribute must not be
  specified on <a href=webappapis.html#module-script id=the-script-element:module-script-8>module scripts</a> (and will be ignored if it
  is).</p>

  <p><dfn id=attr-script-charset><code>charset</code></dfn>属性は、外部スクリプトリソースの文字エンコーディングを与える。<code id=the-script-element:attr-script-src-6><a href=#attr-script-src>src</a></code>属性が存在しない場合、またはスクリプトが<a id=the-script-element:classic-script-5 href=webappapis.html#classic-script>クラシックスクリプト</a>でない場合、属性は指定してはならない。（<a href=webappapis.html#module-script id=the-script-element:module-script-9>モジュールスクリプト</a>は常にUTF-8として解釈される。）属性が設定される場合、その値は<a id=the-script-element:encoding href=https://triple-underscore.github.io/Encoding-ja.html#encoding data-x-internal=encoding>エンコーディング</a>の<a href=https://encoding.spec.whatwg.org/#label id=the-script-element:encoding-label data-x-internal=encoding-label>ラベル</a>のいずれかと<a id=the-script-element:ascii-case-insensitive-2 href=https://infra.spec.whatwg.org/#ascii-case-insensitive data-x-internal=ascii-case-insensitive>ASCII大文字・小文字不区別</a>で一致しなければならず、かつもしあれば、外部ファイルの<a href=infrastructure.html#content-type id=the-script-element:content-type>Content-Typeメタデータ</a>の<code>charset</code>パラメーターと同じ<a id=the-script-element:encoding-2 href=https://triple-underscore.github.io/Encoding-ja.html#encoding data-x-internal=encoding>エンコーディング</a>を指定しなければならない。<a href=references.html#refsENCODING>[ENCODING]</a></p>

  <p><dfn id=attr-script-async><code>async</code></dfn>および<dfn id=attr-script-defer><code>defer</code></dfn>属性は、どのようにスクリプトが評価されるべきかを示す<a href=infrastructure.html#boolean-attribute id=the-script-element:boolean-attribute-2>真偽属性</a>である。<a href=webappapis.html#classic-script id=the-script-element:classic-script-6>クラシックスクリプト</a>は<code id=the-script-element:attr-script-defer-5><a href=#attr-script-defer>defer</a></code>または<code id=the-script-element:attr-script-async-4><a href=#attr-script-async>async</a></code>を指定してもよい。<a href=webappapis.html#module-script id=the-script-element:module-script-10>モジュールスクリプト</a>は、<code id=the-script-element:attr-script-async-5><a href=#attr-script-async>async</a></code>を指定してもよい。The <code id=the-script-element:attr-script-defer-6><a href=#attr-script-defer>defer</a></code> and <code id=the-script-element:attr-script-async-6><a href=#attr-script-async>async</a></code> attributes must not be specified if the <code id=the-script-element:attr-script-src-7><a href=#attr-script-src>src</a></code> attribute is not present.<div class=status><input onclick=toggleStatus(this) value=⋰ type=button><p class=support><strong>Support:</strong> script-defer<span class="and_chr yes"><span>Chrome for Android</span> <span>57+</span></span><span class="chrome yes"><span>Chrome</span> <span>8+</span></span><span class="and_uc yes"><span>UC Browser for Android</span> <span>11+</span></span><span class="ios_saf yes"><span>iOS Safari</span> <span>5.0+</span></span><span class="firefox yes"><span>Firefox</span> <span>3.5+</span></span><span class="ie yes"><span>IE</span> <span>10+</span></span><span class="samsung yes"><span>Samsung Internet</span> <span>4+</span></span><span class="op_mini no"><span>Opera Mini</span> <span>None</span></span><span class="android yes"><span>Android Browser</span> <span>3+</span></span><span class="safari yes"><span>Safari</span> <span>5+</span></span><span class="edge yes"><span>Edge</span> <span>12+</span></span><span class="opera yes"><span>Opera</span> <span>15+</span></span><p class=caniuse>Source: <a href="http://caniuse.com/#feat=script-defer">caniuse.com</a><p class=support><strong>Support:</strong> script-async<span class="and_chr yes"><span>Chrome for Android</span> <span>57+</span></span><span class="chrome yes"><span>Chrome</span> <span>8+</span></span><span class="and_uc yes"><span>UC Browser for Android</span> <span>11+</span></span><span class="ios_saf yes"><span>iOS Safari</span> <span>5.0+</span></span><span class="firefox yes"><span>Firefox</span> <span>3.6+</span></span><span class="ie yes"><span>IE</span> <span>10+</span></span><span class="samsung yes"><span>Samsung Internet</span> <span>4+</span></span><span class="op_mini no"><span>Opera Mini</span> <span>None</span></span><span class="android yes"><span>Android Browser</span> <span>3+</span></span><span class="safari yes"><span>Safari</span> <span>5.1+</span></span><span class="edge yes"><span>Edge</span> <span>12+</span></span><span class="opera yes"><span>Opera</span> <span>15+</span></span><p class=caniuse>Source: <a href="http://caniuse.com/#feat=script-async">caniuse.com</a></div>

  <p>これらの属性を使用して、スクリプトの種類によって選択できる複数の可能なモードが存在する。</p>

  <p><a href=webappapis.html#classic-script id=the-script-element:classic-script-7>古典的なスクリプト</a>について、<code id=the-script-element:attr-script-async-7><a href=#attr-script-async>async</a></code>属性が存在する場合、クラシックスクリプトは、構文解析と<a id=the-script-element:in-parallel href=infrastructure.html#in-parallel>並行して</a>フェッチされるとすぐに（潜在的に構文解析が完了する前に）利用可能になると評価される。<code id=the-script-element:attr-script-async-8><a href=#attr-script-async>async</a></code>が存在しないが<code id=the-script-element:attr-script-defer-7><a href=#attr-script-defer>defer</a></code>属性が存在する場合、クラシックスクリプトは、<a id=the-script-element:in-parallel href=infrastructure.html#in-parallel>並行して</a>フェッチされ、ページが解析終了した際に評価される。いずれの属性も存在しない場合、スクリプトは、両方が完了するまで解析を阻止して、すぐにフェッチされ評価される。</p>

  <p><a href=webappapis.html#module-script id=the-script-element:module-script-11>モジュールスクリプト</a>について、<code id=the-script-element:attr-script-async-9><a href=#attr-script-async>async</a></code>属性が存在する場合、モジュールスクリプトとそのすべての依存関係は、構文解析と<a id=the-script-element:in-parallel-3 href=infrastructure.html#in-parallel>並行して</a>フェッチされ、モジュールスクリプトは利用可能になるとすぐに（潜在的に構文解析が完了する前に）評価される。そうでなければ、モジュールスクリプトとその依存関係は、構文解析と<a id=the-script-element:in-parallel-4 href=infrastructure.html#in-parallel>並行して</a>フェッチされ、ページが解析終了した際に評価される。（<code id=the-script-element:attr-script-defer-8><a href=#attr-script-defer>defer</a></code>属性は、モジュールスクリプトに影響しない。）</p>

  <p>これは、次の模式図にすべて要約される：</p>

  <p><img src=https://html.spec.whatwg.org/multipage/images/asyncdefer.svg alt='&lt;script&gt;のために、解析はフェッチと実行によって中断される。With &lt;script defer&gt;, fetching is parallel to parsing and execution takes place after all parsing has finished. And with &lt;script async&gt;, fetching is parallel to parsing but once it finishes parsing is interrupted to execute the script. The story for &lt;script type="module"&gt; is similar to &lt;script defer&gt;, but the dependencies will be fetched as well, and the story for &lt;script type="module" async&gt; is similar to &lt;script async&gt; with the extra dependency fetching.' style="width: 80%; min-width: 820px;"></p>

  <p class=note>これら属性の正確な処理の詳細は、主に歴史的な理由から、いくぶん自明でない、多くのHTMLの側面を含む。したがって、実装要求は必然的に仕様のあらゆる場所に散在している。（この節の）下記のアルゴリズムは、この処理の中核を説明するが、これらのアルゴリズムが参照する、およびHTMLにおける<code id=the-script-element:the-script-element-6><a href=#the-script-element>script</a></code>の<a href=syntax.html#scriptTag>開始</a>タグと<a href=syntax.html#scriptEndTag>終了</a>タグに対する構文解析規則、<a href=syntax.html#scriptForeignEndTag>無関係なコンテンツで</a>、<a href=xhtml.html#scriptTagXML>XMLで</a>、<code id=the-script-element:dom-document-write><a href=webappapis.html#dom-document-write>document.write()</a></code>メソッドに対する規則、<a href=webappapis.html#scripting>スクリプト</a>の取り扱いなどによって参照される。</p>

  <p>The <code id=the-script-element:attr-script-defer-9><a href=#attr-script-defer>defer</a></code> attribute may be specified even if the <code id=the-script-element:attr-script-async-10><a href=#attr-script-async>async</a></code> attribute is specified, to cause legacy Web browsers that
  only support <code id=the-script-element:attr-script-defer-10><a href=#attr-script-defer>defer</a></code> (and not <code id=the-script-element:attr-script-async-11><a href=#attr-script-async>async</a></code>) to fall back to the <code id=the-script-element:attr-script-defer-11><a href=#attr-script-defer>defer</a></code> behavior instead of the blocking behavior that
  is the default.</p>

  <p><dfn id=attr-script-crossorigin><code>crossorigin</code></dfn>属性は<a id=the-script-element:cors-settings-attribute href=infrastructure.html#cors-settings-attribute>CORS設定属性</a>である。<a href=webappapis.html#classic-script id=the-script-element:classic-script-8>クラシックスクリプト</a>について、スクリプトが他の<a href=browsers.html#concept-origin id=the-script-element:concept-origin>生成元</a>から得られる場合、エラー情報が公開されるかどうかを制御する。<a href=webappapis.html#module-script id=the-script-element:module-script-12>モジュールスクリプト</a>について、クロスオリジンのリクエストに使用される<a href=https://triple-underscore.github.io/Fetch-ja.html#concept-request-credentials-mode id=the-script-element:concept-request-credentials-mode data-x-internal=concept-request-credentials-mode>資格情報モード</a>を制御する。</p>

  <p class=note><a href=webappapis.html#classic-script id=the-script-element:classic-script-9>クラシックスクリプト</a>とは異なり、<a href=webappapis.html#module-script id=the-script-element:module-script-13>モジュールスクリプト</a>は、クロスオリジンフェッチのために<a href=https://triple-underscore.github.io/Fetch-ja.html#http-cors-protocol id=the-script-element:cors-protocol data-x-internal=cors-protocol>CORSプロトコル</a>を使用する必要がある。</p>

  <p><dfn data-dfn-for=script id=attr-script-nonce data-dfn-type=element-attr data-export=""><code>nonce</code></dfn>属性は、要素で指定されるスクリプトが実行されるかどうかを判断するために<cite>コンテンツセキュリティポリシー</cite>で使用することができる暗号ノンス（"一度使用される数字"）を表す。値はテキストである。<a href=references.html#refsCSP>[CSP]</a></p>

  <p>The <dfn data-dfn-for=script id=attr-script-integrity data-dfn-type=element-attr data-export=""><code>integrity</code></dfn> attribute represents the <a href=https://fetch.spec.whatwg.org/#concept-request-integrity-metadata id=the-script-element:concept-request-integrity-metadata data-x-internal=concept-request-integrity-metadata>integrity metadata</a> for requests which this element is responsible for. 値はテキストである。The <code id=the-script-element:attr-script-integrity-3><a href=#attr-script-integrity>integrity</a></code> attribute must not be specified when embedding a <a id=the-script-element:module-script-14 href=webappapis.html#module-script>module script</a> or when the <code id=the-script-element:attr-script-src-8><a href=#attr-script-src>src</a></code> attribute is not specified. <a href=references.html#refsSRI>[SRI]</a></p>


  <p>Changing the <code id=the-script-element:attr-script-src-9><a href=#attr-script-src>src</a></code>, <code id=the-script-element:attr-script-type-6><a href=#attr-script-type>type</a></code>, <code id=the-script-element:attr-script-charset-5><a href=#attr-script-charset>charset</a></code>, <code id=the-script-element:attr-script-nomodule-4><a href=#attr-script-nomodule>nomodule</a></code>, <code id=the-script-element:attr-script-async-12><a href=#attr-script-async>async</a></code>, <code id=the-script-element:attr-script-defer-12><a href=#attr-script-defer>defer</a></code>, <code id=the-script-element:attr-script-crossorigin-3><a href=#attr-script-crossorigin>crossorigin</a></code>, <code id=the-script-element:attr-script-nonce-3><a href=#attr-script-nonce>nonce</a></code>
  and <code id=the-script-element:attr-script-integrity-4><a href=#attr-script-integrity>integrity</a></code> attributes dynamically has no direct
  effect; these attributes are only used at specific times described below.</p> 

  

  <p>The IDL attributes <dfn id=dom-script-src><code>src</code></dfn>, <dfn id=dom-script-type><code>type</code></dfn>, <dfn id=dom-script-charset><code>charset</code></dfn>, <dfn id=dom-script-defer><code>defer</code></dfn>, <dfn id=dom-script-integrity><code>integrity</code></dfn>, and <dfn id=dom-script-nonce><code>nonce</code></dfn>, must each <a id=the-script-element:reflect href=infrastructure.html#reflect>reflect</a> the respective
  content attributes of the same name.</p>

  <p><dfn id=dom-script-crossorigin><code>crossOrigin</code></dfn> IDL属性は、<code id=the-script-element:attr-script-crossorigin-4><a href=#attr-script-crossorigin>crossorigin</a></code>コンテンツ属性を<a id=the-script-element:reflect-2 href=infrastructure.html#reflect>反映</a>しなければならない。</p>

  <p>The <dfn id=dom-script-nomodule><code>noModule</code></dfn> IDL attribute must
  <a id=the-script-element:reflect-3 href=infrastructure.html#reflect>reflect</a> the <code id=the-script-element:attr-script-nomodule-5><a href=#attr-script-nomodule>nomodule</a></code> content
  attribute.</p>

  <p>The <dfn id=dom-script-async><code>async</code></dfn> IDL attribute controls whether the
  element will execute asynchronously or not. If the element's <a href=#non-blocking id=the-script-element:non-blocking>"non-blocking"</a> flag is
  set, then, on getting, the <code id=the-script-element:dom-script-async-2><a href=#dom-script-async>async</a></code> IDL attribute must return
  true, and on setting, the <a href=#non-blocking id=the-script-element:non-blocking-2>"non-blocking"</a> flag must first be unset, and then the
  content attribute must be removed if the IDL attribute's new value is false, and must be set to
  the empty string if the IDL attribute's new value is true. If the element's
  <a href=#non-blocking id=the-script-element:non-blocking-3>"non-blocking"</a> flag is <em>not</em> set, the IDL attribute must <a id=the-script-element:reflect-4 href=infrastructure.html#reflect>reflect</a>
  the <code id=the-script-element:attr-script-async-13><a href=#attr-script-async>async</a></code> content attribute.</p>

  


  <dl class=domintro><dt><var>script</var> . <code id=the-script-element:dom-script-text-2><a href=#dom-script-text>text</a></code> [ = <var>value</var> ]<dd>

    <p>要素の<a id=the-script-element:child-text-content href=infrastructure.html#child-text-content>子テキストコンテンツ</a>を返す。</p>

    <p>与えられた値を持つ要素の子を置換するために、設定できる。</p>

   </dl>

  

  <p>The IDL attribute <dfn id=dom-script-text><code>text</code></dfn> must return the <a id=the-script-element:child-text-content-2 href=infrastructure.html#child-text-content>child text content</a> of the <code id=the-script-element:the-script-element-7><a href=#the-script-element>script</a></code> element. 設定する際に、それは<code id=the-script-element:textcontent><a data-x-internal=textcontent href=https://triple-underscore.github.io/DOM4-ja.html#dom-node-textcontent>textContent</a></code> IDL属性と同じように振る舞わなければならない。</p>

  


  <p class=note><code id=the-script-element:dom-document-write-2><a href=webappapis.html#dom-document-write>document.write()</a></code>メソッドを用いて挿入される場合、<code id=the-script-element:the-script-element-8><a href=#the-script-element>script</a></code>要素は（一般にさらなるスクリプトの実行またはHTMLの解析をブロックして）実行するが、<code id=the-script-element:dom-innerhtml><a data-x-internal=dom-innerhtml href=https://w3c.github.io/DOM-Parsing/#widl-Element-innerHTML>innerHTML</a></code>および<code id=the-script-element:dom-outerhtml><a data-x-internal=dom-outerhtml href=https://w3c.github.io/DOM-Parsing/#widl-Element-outerHTML>outerHTML</a></code>属性を用いて挿入される場合、これらは一切実行しない。</p>

  <div class=example>

   <p>次の例において、2つの<code id=the-script-element:the-script-element-9><a href=#the-script-element>script</a></code>要素が使用される。1つは外部の<a id=the-script-element:classic-script-10 href=webappapis.html#classic-script>クラシックスクリプト</a>を埋め込み、もう1つは<a href=#data-block id=the-script-element:data-block-3>データブロック</a>のようないくつかのデータを含む。</p>

   <pre>&lt;script src="game-engine.js"&gt;&lt;/script&gt;
&lt;script type="text/x-game-map"&gt;
........U.........e
o............A....e
.....A.....AAA....e
.A..AAA...AAAAA...e
&lt;/script&gt;</pre>

   <p>この場合のデータは、ビデオゲームのマップを生成するスクリプトによって使用されるかもしれない。しかし、データはそのように使用する必要はない。おそらく実際にマップデータは、ページのマークアップの他の部分に埋め込まれており、ここでデータブロックは、ゲームマップで特定の機能を探しているユーザーを支援するサイトの検索エンジンによって単に使用される。</p>

  </div>

  <div class=example>

   <p>次のサンプルは、<code id=the-script-element:the-script-element-10><a href=#the-script-element>script</a></code>要素が外部<a id=the-script-element:classic-script-11 href=webappapis.html#classic-script>モジュールスクリプト</a>を含めるために使用される方法を示す。It also shows how a <code id=the-script-element:the-script-element-11><a href=#the-script-element>script</a></code> element can be used to invoke script while the document is being parsed, in this case to initialize the form's output.</p>

   <pre>&lt;script&gt;
 function calculate(form) {
   var price = 52000;
   if (form.elements.brakes.checked)
     price += 1000;
   if (form.elements.radio.checked)
     price += 2500;
   if (form.elements.turbo.checked)
     price += 5000;
   if (form.elements.sticker.checked)
     price += 250;
   form.elements.result.value = price;
 }
&lt;/script&gt;
&lt;form name="pricecalc" onsubmit="return false" onchange="calculate(this)"&gt;
 &lt;fieldset&gt;
  &lt;legend&gt;Work out the price of your car&lt;/legend&gt;
  &lt;p&gt;Base cost: £52000.&lt;/p&gt;
  &lt;p&gt;Select additional options:&lt;/p&gt;
  &lt;ul&gt;
   &lt;li&gt;&lt;label&gt;&lt;input type=checkbox name=brakes&gt; Ceramic brakes (£1000)&lt;/label&gt;&lt;/li&gt;
   &lt;li&gt;&lt;label&gt;&lt;input type=checkbox name=radio&gt; Satellite radio (£2500)&lt;/label&gt;&lt;/li&gt;
   &lt;li&gt;&lt;label&gt;&lt;input type=checkbox name=turbo&gt; Turbo charger (£5000)&lt;/label&gt;&lt;/li&gt;
   &lt;li&gt;&lt;label&gt;&lt;input type=checkbox name=sticker&gt; "XZ" sticker (£250)&lt;/label&gt;&lt;/li&gt;
  &lt;/ul&gt;
  &lt;p&gt;Total: £&lt;output name=result&gt;&lt;/output&gt;&lt;/p&gt;
 &lt;/fieldset&gt;
 &lt;script&gt;
  calculate(document.forms.pricecalc);
 &lt;/script&gt;
&lt;/form&gt;</pre>

  </div>

  <div id=script-type-module-example-1 class=example>

   <p>次のサンプルは、<code id=the-script-element:the-script-element-12><a href=#the-script-element>script</a></code>要素が外部<a id=the-script-element:module-script-15 href=webappapis.html#module-script>モジュールスクリプト</a>を含めるために使用される方法を示す。

   <pre>&lt;script type="module" src="app.js"&gt;&lt;/script&gt;</pre>

   <p>このモジュール、およびそのすべての依存関係（ソースファイル内のJavaScript <code>import</code>文を通して表現される）は、フェッチされる。一度、全体の結果としてモジュールツリーがインポートされ、かつ文書が解析を完了したら、<code>app.js</code>のコンテンツは評価される。</p>

   <p>さらに、同じ<code id=the-script-element:window><a href=browsers.html#window>Window</a></code>内の他の<code id=the-script-element:the-script-element-13><a href=#the-script-element>script</a></code>要素からのコードが<code>app.js</code>からモジュールをインポートする場合（たとえば<code>import "./app.js";</code>経由で）、より早い<code id=the-script-element:the-script-element-14><a href=#the-script-element>script</a></code>要素によって作成された同じ<a id=the-script-element:module-script-16 href=webappapis.html#module-script>モジュールスクリプト</a>がインポートされる。</p>

  </div>

  <div id=script-nomodule-example class=example>

  <p>This example shows how to include a <a id=the-script-element:module-script-17 href=webappapis.html#module-script>module script</a> for modern user agents, and a
  <a id=the-script-element:classic-script-12 href=webappapis.html#classic-script>classic script</a> for older user agents:</p>

  <pre>&lt;script type="module" src="app.js"&gt;&lt;/script&gt;
&lt;script nomodule src="classic-app-bundle.js"&gt;&lt;/script&gt;</pre>

  <p>In modern user agents that support <a href=webappapis.html#module-script id=the-script-element:module-script-18>module scripts</a>, the
  <code id=the-script-element:the-script-element-15><a href=#the-script-element>script</a></code> element with the <code id=the-script-element:attr-script-nomodule-6><a href=#attr-script-nomodule>nomodule</a></code> attribute
  will be ignored, and the <code id=the-script-element:the-script-element-16><a href=#the-script-element>script</a></code> element with a <code id=the-script-element:attr-script-type-7><a href=#attr-script-type>type</a></code> of "<code>module</code>" will be fetched and
  evaluated (as a <a id=the-script-element:module-script-19 href=webappapis.html#module-script>module script</a>). Conversely, older user agents will ignore the
  <code id=the-script-element:the-script-element-17><a href=#the-script-element>script</a></code> element with a <code id=the-script-element:attr-script-type-8><a href=#attr-script-type>type</a></code> of "<code>module</code>", as that is an unknown script type for them — but they will have no
  problem fetching and evaluating the other <code id=the-script-element:the-script-element-18><a href=#the-script-element>script</a></code> element (as a <a id=the-script-element:classic-script-13 href=webappapis.html#classic-script>classic
  script</a>), since they do not implement the <code id=the-script-element:attr-script-nomodule-7><a href=#attr-script-nomodule>nomodule</a></code> attribute.</p>

  </div>

  <div id=script-type-module-example-2 class=example>

   <p>次のサンプルは、​​<code id=the-script-element:the-script-element-19><a href=#the-script-element>script</a></code>要素が（たとえばニュースサイト上で）より面白い読書体験を生み出すために、文書のテキストで多数の置換を行うインライン<a id=the-script-element:module-script-20 href=webappapis.html#module-script>モジュールスクリプト</a>を書くために使用することができる方法を示す：<a href=references.html#refsXKCD1288>[XKCD1288]</a></p>

   <pre>&lt;script type="module"&gt;
 import { walkAllTextNodeDescendants } from "./dom-utils.js";

 const substitutions = new Map([
   ["witnesses", "these dudes I know"]
   ["allegedly", "kinda probably"]
   ["new study", "Tumblr post"]
   ["rebuild", "avenge"]
   ["space", "spaaace"]
   ["Google glass", "Virtual Boy"]
   ["smartphone", "Pokédex"]
   ["electric", "atomic"]
   ["Senator", "Elf-Lord"]
   ["car", "cat"]
   ["election", "eating contest"]
   ["Congressional leaders", "river spirits"]
   ["homeland security", "Homestar Runner"]
   ["could not be reached for comment", "is guilty and everyone knows it"]
 ]);

 function substitute(textNode) {
   for (const [before, after] of substitutions.entries()) {
     textNode.data = textNode.data.replace(new RegExp(`\\b${before}\\b`, "ig"), after);
   }
 }

 walkAllTextNodeDescendants(document.body, substitute);
&lt;/script&gt;</pre>

   <p>モジュールスクリプトを使用して得られたいくつかの注目すべき機能は、他のJavaScriptモジュール、デフォルトでstrictモード、およびトップレベル宣言が<a id=the-script-element:global-object href=webappapis.html#global-object>グローバルオブジェクト</a>に新しいプロパティを導入しない方法から関数をインポートする機能を含む。両方の文書の解析が完了し、およびその依存関係（<code>dom-utils.js</code>）がフェッチされかつ評価されるまで、この<code id=the-script-element:the-script-element-20><a href=#the-script-element>script</a></code>要素が文書に表示されるかを問わず、評価されないことにも注意する。</p>

  </div>

  

  <h5 id=script-processing-model>4.12.1.1 Processing model<a href=#script-processing-model class=self-link></a></h5>

  <p>A <code id=script-processing-model:the-script-element><a href=#the-script-element>script</a></code> element has several associated pieces of state.</p>

  <p>The first is a flag indicating whether or not the script block has been <dfn id=already-started>"already
  started"</dfn>. Initially, <code id=script-processing-model:the-script-element-2><a href=#the-script-element>script</a></code> elements must have this flag unset (script blocks,
  when created, are not "already started"). The <a href=https://triple-underscore.github.io/DOM4-ja.html#concept-node-clone-ext id=script-processing-model:concept-node-clone-ext data-x-internal=concept-node-clone-ext>cloning
  steps</a> for <code id=script-processing-model:the-script-element-3><a href=#the-script-element>script</a></code> elements must set the "already started" flag on the copy if
  it is set on the element being cloned.</p>

  <p>The second is a flag indicating whether the element was <dfn data-dfn-for=script id=parser-inserted data-dfn-type=dfn data-export="">"parser-inserted"</dfn>. Initially,
  <code id=script-processing-model:the-script-element-4><a href=#the-script-element>script</a></code> elements must have this flag unset. It is set by the <a id=script-processing-model:html-parser href=syntax.html#html-parser>HTML parser</a>
  and the <a id=script-processing-model:xml-parser href=xhtml.html#xml-parser>XML parser</a> on <code id=script-processing-model:the-script-element-5><a href=#the-script-element>script</a></code> elements they insert and affects the
  processing of those elements.</p>

  <p>The third is a flag indicating whether the element will be <dfn id=non-blocking>"non-blocking"</dfn>.
  Initially, <code id=script-processing-model:the-script-element-6><a href=#the-script-element>script</a></code> elements must have this flag set. It is unset by the <a id=script-processing-model:html-parser-2 href=syntax.html#html-parser>HTML
  parser</a> and the <a id=script-processing-model:xml-parser-2 href=xhtml.html#xml-parser>XML parser</a> on <code id=script-processing-model:the-script-element-7><a href=#the-script-element>script</a></code> elements they insert. In
  addition, whenever a <code id=script-processing-model:the-script-element-8><a href=#the-script-element>script</a></code> element whose <a href=#non-blocking id=script-processing-model:non-blocking>"non-blocking"</a> flag is set
  has an <code id=script-processing-model:attr-script-async><a href=#attr-script-async>async</a></code> content attribute added, the element's
  <a href=#non-blocking id=script-processing-model:non-blocking-2>"non-blocking"</a> flag must be unset.</p> 

  <p>The fourth is a flag indicating whether or not the script block is <dfn id=ready-to-be-parser-executed>"ready to be
  parser-executed"</dfn>. Initially, <code id=script-processing-model:the-script-element-9><a href=#the-script-element>script</a></code> elements must have this flag unset (script
  blocks, when created, are not "ready to be parser-executed"). This flag is used only for elements
  that are also <a href=#parser-inserted id=script-processing-model:parser-inserted>"parser-inserted"</a>, to let the parser know when to execute the
  script.</p>

  <p>The fifth is <dfn id=concept-script-type>the script's type</dfn>, which is either "<code>classic</code>" or "<code>module</code>". It is determined when the script is
  <a href=#prepare-a-script id=script-processing-model:prepare-a-script>prepared</a>, based on the <code id=script-processing-model:attr-script-type><a href=#attr-script-type>type</a></code> attribute of the element at that time.</p>

  <p>The sixth is a flag indicating whether or not the script is <dfn id=concept-script-external>from an external file</dfn>. It is determined when the script is
  <a href=#prepare-a-script id=script-processing-model:prepare-a-script-2>prepared</a>, based on the <code id=script-processing-model:attr-script-src><a href=#attr-script-src>src</a></code> attribute of the element at that time.</p>

  <p>Finally, a <code id=script-processing-model:the-script-element-10><a href=#the-script-element>script</a></code> element has <dfn id=concept-script-script data-export="">the script's script</dfn>, which is a <a href=webappapis.html#concept-script id=script-processing-model:concept-script>script</a>
  resulting from <a href=#prepare-a-script id=script-processing-model:prepare-a-script-3>preparing</a> the element. This is set
  asynchronously after the classic script or module tree is fetched. Once it is set, either to a
  <a href=webappapis.html#concept-script id=script-processing-model:concept-script-2>script</a> in the case of success or to null in the case of
  failure, the fetching algorithms will note that <dfn id=the-script-is-ready>the script is ready</dfn>, which can trigger
  other actions.  The user agent must <a id=script-processing-model:delay-the-load-event href=syntax.html#delay-the-load-event>delay the load
  event</a> of the element's <a id=script-processing-model:node-document href=https://triple-underscore.github.io/DOM4-ja.html#concept-node-document data-x-internal=node-document>node document</a> until <a href=#the-script-is-ready id=script-processing-model:the-script-is-ready>the script is
  ready</a>.</p>

  <hr>

  <p>When a <code id=script-processing-model:the-script-element-11><a href=#the-script-element>script</a></code> element that is not marked as being <a href=#parser-inserted id=script-processing-model:parser-inserted-2>"parser-inserted"</a>
  experiences one of the events listed in the following list, the user agent must
  <a id=script-processing-model:immediately href=infrastructure.html#immediately>immediately</a> <a href=#prepare-a-script id=script-processing-model:prepare-a-script-4>prepare</a> the <code id=script-processing-model:the-script-element-12><a href=#the-script-element>script</a></code>
  element:</p>

  <ul><li>The <code id=script-processing-model:the-script-element-13><a href=#the-script-element>script</a></code> element <a id=script-processing-model:becomes-connected href=infrastructure.html#becomes-connected>becomes connected</a>.</li><li>The <code id=script-processing-model:the-script-element-14><a href=#the-script-element>script</a></code> element is <a id=script-processing-model:connected href=https://triple-underscore.github.io/DOM4-ja.html#connected data-x-internal=connected>connected</a> and a node or document fragment is
   <a href=infrastructure.html#nodes-are-inserted id=script-processing-model:nodes-are-inserted>inserted</a> into the <code id=script-processing-model:the-script-element-15><a href=#the-script-element>script</a></code> element, after any
   <code id=script-processing-model:the-script-element-16><a href=#the-script-element>script</a></code> elements <a href=infrastructure.html#nodes-are-inserted id=script-processing-model:nodes-are-inserted-2>inserted</a> at that time.</li><li>The <code id=script-processing-model:the-script-element-17><a href=#the-script-element>script</a></code> element is <a id=script-processing-model:connected-2 href=https://triple-underscore.github.io/DOM4-ja.html#connected data-x-internal=connected>connected</a> and has a <code id=script-processing-model:attr-script-src-2><a href=#attr-script-src>src</a></code> attribute set where previously the element had no such
   attribute.</li></ul>

  <p>To <dfn id=prepare-a-script data-export="">prepare a script</dfn>, the user agent must
  act as follows:</p>

  <ol><li>

    <p>If the <code id=script-processing-model:the-script-element-18><a href=#the-script-element>script</a></code> element is marked as having <a href=#already-started id=script-processing-model:already-started>"already started"</a>, then
    abort these steps at this point. The script is not executed.</p>

   </li><li>

    <p>If the element has its <a href=#parser-inserted id=script-processing-model:parser-inserted-3>"parser-inserted"</a> flag set, then set <var>was-parser-inserted</var> to true and unset the element's
    <a href=#parser-inserted id=script-processing-model:parser-inserted-4>"parser-inserted"</a> flag. Otherwise, set <var>was-parser-inserted</var> to
    false.</p>

    <p class=note>This is done so that if parser-inserted <code id=script-processing-model:the-script-element-19><a href=#the-script-element>script</a></code> elements fail to run
    when the parser tries to run them, e.g. because they are empty or specify an unsupported
    scripting language, another script can later mutate them and cause them to run again.</p>

    

   </li><li>

    <p>If <var>was-parser-inserted</var> is true and the element does not have an <code id=script-processing-model:attr-script-async-2><a href=#attr-script-async>async</a></code> attribute, then set the element's
    <a href=#non-blocking id=script-processing-model:non-blocking-3>"non-blocking"</a> flag to true.</p>

    <p class=note>This is done so that if a parser-inserted <code id=script-processing-model:the-script-element-20><a href=#the-script-element>script</a></code> element fails to
    run when the parser tries to run it, but it is later executed after a script dynamically updates
    it, it will execute in a non-blocking fashion even if the <code id=script-processing-model:attr-script-async-3><a href=#attr-script-async>async</a></code>
    attribute isn't set.</p>

   </li><li id=script-processing-empty>

    <p>If the element has no <code id=script-processing-model:attr-script-src-3><a href=#attr-script-src>src</a></code> attribute, and its child
    nodes, if any, consist only of comment nodes and empty <code id=script-processing-model:text><a data-x-internal=text href=https://triple-underscore.github.io/DOM4-ja.html#interface-text>Text</a></code> nodes, then abort
    these steps at this point. The script is not executed.</p>

   </li><li><p>If the element is not <a id=script-processing-model:connected-3 href=https://triple-underscore.github.io/DOM4-ja.html#connected data-x-internal=connected>connected</a>, then abort these steps. The script is not
   executed.</li><li id=script-processing-prepare>

    <p>If either:</p>

    <ul class=brief><li>the <code id=script-processing-model:the-script-element-21><a href=#the-script-element>script</a></code> element has a <code id=script-processing-model:attr-script-type-2><a href=#attr-script-type>type</a></code> attribute
     and its value is the empty string, or</li><li>the <code id=script-processing-model:the-script-element-22><a href=#the-script-element>script</a></code> element has no <code id=script-processing-model:attr-script-type-3><a href=#attr-script-type>type</a></code> attribute
     but it has a <code id=script-processing-model:attr-script-language><a href=obsolete.html#attr-script-language>language</a></code> attribute and <em>that</em>
     attribute's value is the empty string, or</li><li>the <code id=script-processing-model:the-script-element-23><a href=#the-script-element>script</a></code> element has neither a <code id=script-processing-model:attr-script-type-4><a href=#attr-script-type>type</a></code>
     attribute nor a <code id=script-processing-model:attr-script-language-2><a href=obsolete.html#attr-script-language>language</a></code> attribute, then</li></ul>

    <p>...let <var>the script block's type string</var> for this <code id=script-processing-model:the-script-element-24><a href=#the-script-element>script</a></code> element be
    "<code>text/javascript</code>".</p>

    <p>Otherwise, if the <code id=script-processing-model:the-script-element-25><a href=#the-script-element>script</a></code> element has a <code id=script-processing-model:attr-script-type-5><a href=#attr-script-type>type</a></code> attribute, let <var>the script block's type string</var>
    for this <code id=script-processing-model:the-script-element-26><a href=#the-script-element>script</a></code> element be the value of that attribute with <a href=https://infra.spec.whatwg.org/#strip-leading-and-trailing-ascii-whitespace id=script-processing-model:strip-leading-and-trailing-ascii-whitespace data-x-internal=strip-leading-and-trailing-ascii-whitespace>leading and trailing ASCII whitespace
    stripped</a>.</p>

    <p>Otherwise, the element has a non-empty <code id=script-processing-model:attr-script-language-3><a href=obsolete.html#attr-script-language>language</a></code>
    attribute; let <var>the script block's type string</var> for this <code id=script-processing-model:the-script-element-27><a href=#the-script-element>script</a></code> element
    be the concatenation of the string "<code>text/</code>" followed by the value of the
    <code id=script-processing-model:attr-script-language-4><a href=obsolete.html#attr-script-language>language</a></code> attribute.</p>
    

    <p class=note>The <code id=script-processing-model:attr-script-language-5><a href=obsolete.html#attr-script-language>language</a></code> attribute is never
    conforming, and is always ignored if there is a <code id=script-processing-model:attr-script-type-6><a href=#attr-script-type>type</a></code>
    attribute present.</p>

    <p>Determine <a href=#concept-script-type id=script-processing-model:concept-script-type>the script's type</a> as follows:</p>

    <ul><li>If <var>the script block's type string</var> is an <a id=script-processing-model:ascii-case-insensitive href=https://infra.spec.whatwg.org/#ascii-case-insensitive data-x-internal=ascii-case-insensitive>ASCII case-insensitive</a>
     match for any <a href=#javascript-mime-type id=script-processing-model:javascript-mime-type>JavaScript MIME type</a>, <a href=#concept-script-type id=script-processing-model:concept-script-type-2>the
     script's type</a> is "<code>classic</code>".</li><li>If <var>the script block's type string</var> is an <a id=script-processing-model:ascii-case-insensitive-2 href=https://infra.spec.whatwg.org/#ascii-case-insensitive data-x-internal=ascii-case-insensitive>ASCII case-insensitive</a>
     match for the string "<code>module</code>", <a href=#concept-script-type id=script-processing-model:concept-script-type-3>the
     script's type</a> is "<code>module</code>".</li><li>If neither of the above conditions are true, then abort these steps at this point. No
     script is executed.</li></ul>

   </li><li>

    <p>If <var>was-parser-inserted</var> is true, then flag the element as
    <a href=#parser-inserted id=script-processing-model:parser-inserted-5>"parser-inserted"</a> again, and set the element's <a href=#non-blocking id=script-processing-model:non-blocking-4>"non-blocking"</a> flag to
    false.</p>

   </li><li id=script-processing-start>

    <p>Set the element's <a href=#already-started id=script-processing-model:already-started-2>"already started"</a> flag.</p>

   </li><li>

    <p>If the element is flagged as <a href=#parser-inserted id=script-processing-model:parser-inserted-6>"parser-inserted"</a>, but the element's
    <a id=script-processing-model:node-document-2 href=https://triple-underscore.github.io/DOM4-ja.html#concept-node-document data-x-internal=node-document>node document</a> is not the <code id=script-processing-model:document><a href=dom.html#document>Document</a></code> of the parser that created the
    element, then abort these steps.</p>

   </li><li id=script-processing-noscript>

    <p>If <a href=webappapis.html#concept-n-noscript id=script-processing-model:concept-n-noscript>scripting is disabled</a> for the <code id=script-processing-model:the-script-element-28><a href=#the-script-element>script</a></code>
    element, then abort these steps at this point. The script is not executed.</p>

    <p class=note>The definition of <a href=webappapis.html#concept-n-noscript id=script-processing-model:concept-n-noscript-2>scripting is disabled</a>
    means that, amongst others, the following scripts will not execute: scripts in
    <code id=script-processing-model:xmlhttprequest><a data-x-internal=xmlhttprequest href=https://triple-underscore.github.io/XHR-ja.html#xmlhttprequest>XMLHttpRequest</a></code>'s <code id=script-processing-model:dom-xmlhttprequest-responsexml><a data-x-internal=dom-xmlhttprequest-responsexml href=https://triple-underscore.github.io/XHR-ja.html#dom-xmlhttprequest-responsexml>responseXML</a></code>
    documents, scripts in <code id=script-processing-model:domparser><a data-x-internal=domparser href=https://w3c.github.io/DOM-Parsing/#the-domparser-interface>DOMParser</a></code>-created documents, scripts in documents created by
    <code id=script-processing-model:xsltprocessor><a href=infrastructure.html#xsltprocessor>XSLTProcessor</a></code>'s <code id=script-processing-model:dom-xsltprocessor-transformtodocument><a href=infrastructure.html#dom-xsltprocessor-transformtodocument>transformToDocument</a></code> feature, and scripts
    that are first inserted by a script into a <code id=script-processing-model:document-2><a href=dom.html#document>Document</a></code> that was created using the
    <code id=script-processing-model:dom-domimplementation-createdocument><a data-x-internal=dom-domimplementation-createdocument href=https://triple-underscore.github.io/DOM4-ja.htmlcreatedocument>createDocument()</a></code> API. <a href=references.html#refsXHR>[XHR]</a>
    <a href=references.html#refsDOMPARSING>[DOMPARSING]</a> <a href=references.html#refsXSLTP>[XSLTP]</a> <a href=references.html#refsDOM>[DOM]</a></p>


   </li><li>

   <p>If the <code id=script-processing-model:the-script-element-29><a href=#the-script-element>script</a></code> element has a <code id=script-processing-model:attr-script-nomodule><a href=#attr-script-nomodule>nomodule</a></code>
   content attribute and <a href=#concept-script-type id=script-processing-model:concept-script-type-4>the script's type</a> is "<code>classic</code>", then abort these steps. The script is not executed.</p>

   <p class=note>This means specifying <code id=script-processing-model:attr-script-nomodule-2><a href=#attr-script-nomodule>nomodule</a></code> on a
   <a id=script-processing-model:module-script href=webappapis.html#module-script>module script</a> has no effect; the algorithm continues onward.</p>

   </li><li id=script-processing-csp><p>If the <code id=script-processing-model:the-script-element-30><a href=#the-script-element>script</a></code> element does not have a <code id=script-processing-model:attr-script-src-4><a href=#attr-script-src>src</a></code> content attribute, and the <a id="script-processing-model:should-element's-inline-behavior-be-blocked-by-content-security-policy" href=https://triple-underscore.github.io/CSP3-ja.html#should-block-inline data-x-internal="should-element's-inline-behavior-be-blocked-by-content-security-policy">Should element's inline
   behavior be blocked by Content Security Policy?</a> algorithm returns "<code>Blocked</code>" when executed upon the <code id=script-processing-model:the-script-element-31><a href=#the-script-element>script</a></code> element, "<code>script</code>", and the <code id=script-processing-model:the-script-element-32><a href=#the-script-element>script</a></code> element's <a id=script-processing-model:child-text-content href=infrastructure.html#child-text-content>child text content</a>,
   then abort these steps. The script is not executed. <a href=references.html#refsCSP>[CSP]</a></li><li id=script-processing-for>

    <p>If the <code id=script-processing-model:the-script-element-33><a href=#the-script-element>script</a></code> element has an <code id=script-processing-model:attr-script-event><a href=obsolete.html#attr-script-event>event</a></code>
    attribute and a <code id=script-processing-model:attr-script-for><a href=obsolete.html#attr-script-for>for</a></code> attribute, and <a href=#concept-script-type id=script-processing-model:concept-script-type-5>the script's type</a> is "<code>classic</code>",
    then:</p>

    <ol><li><p>Let <var>for</var> be the value of the <code id=script-processing-model:attr-script-for-2><a href=obsolete.html#attr-script-for>for</a></code>
     attribute.</li><li><p>Let <var>event</var> be the value of the <code id=script-processing-model:attr-script-event-2><a href=obsolete.html#attr-script-event>event</a></code> attribute.</li><li><p><a id=script-processing-model:strip-leading-and-trailing-ascii-whitespace-2 href=https://infra.spec.whatwg.org/#strip-leading-and-trailing-ascii-whitespace data-x-internal=strip-leading-and-trailing-ascii-whitespace>Strip leading and trailing ASCII whitespace</a> from <var>event</var> and
     <var>for</var>.</li><li><p>If <var>for</var> is not an <a id=script-processing-model:ascii-case-insensitive-3 href=https://infra.spec.whatwg.org/#ascii-case-insensitive data-x-internal=ascii-case-insensitive>ASCII case-insensitive</a> match for the
     string "<code>window</code>", then abort these steps at this point. The script is
     not executed.</li><li><p>If <var>event</var> is not an <a id=script-processing-model:ascii-case-insensitive-4 href=https://infra.spec.whatwg.org/#ascii-case-insensitive data-x-internal=ascii-case-insensitive>ASCII case-insensitive</a> match for
     either the string "<code>onload</code>" or the string "<code>onload()</code>", then abort these steps at this point. The script is not
     executed.</li></ol>

   </li><li id=script-processing-encoding>

    <p>If the <code id=script-processing-model:the-script-element-34><a href=#the-script-element>script</a></code> element has a <code id=script-processing-model:attr-script-charset><a href=#attr-script-charset>charset</a></code>
    attribute, then let <var>encoding</var> be the result of <a id=script-processing-model:getting-an-encoding href=https://triple-underscore.github.io/Encoding-ja.html#concept-encoding-get data-x-internal=getting-an-encoding>getting an encoding</a> from
    the value of the <code id=script-processing-model:attr-script-charset-2><a href=#attr-script-charset>charset</a></code> attribute.</p>

    <p>If the <code id=script-processing-model:the-script-element-35><a href=#the-script-element>script</a></code> element does not have a <code id=script-processing-model:attr-script-charset-3><a href=#attr-script-charset>charset</a></code> attribute, or if <a id=script-processing-model:getting-an-encoding-2 href=https://triple-underscore.github.io/Encoding-ja.html#concept-encoding-get data-x-internal=getting-an-encoding>getting an encoding</a>
    failed, let <var>encoding</var> be the same as <a href=https://triple-underscore.github.io/DOM4-ja.html#concept-document-encoding id="script-processing-model:document's-character-encoding" data-x-internal="document's-character-encoding">the
    encoding</a> of the <code id=script-processing-model:the-script-element-36><a href=#the-script-element>script</a></code> element's <a id=script-processing-model:node-document-3 href=https://triple-underscore.github.io/DOM4-ja.html#concept-node-document data-x-internal=node-document>node document</a>.</p>

    <p class=note>If <a href=#concept-script-type id=script-processing-model:concept-script-type-6>the script's type</a> is "<code>module</code>", this encoding will be ignored.</p>

   </li><li><p>Let <var>CORS setting</var> be the current state of the element's <code id=script-processing-model:attr-script-crossorigin><a href=#attr-script-crossorigin>crossorigin</a></code> content attribute.</li><li>
    <p>Let <var>module script credentials mode</var> be determined by switching on <var>CORS
    setting</var>:</p>

    <dl class=switch><dt><a href=infrastructure.html#attr-crossorigin-none id=script-processing-model:attr-crossorigin-none>No CORS</a><dd>"<code>omit</code>"<dt><a href=infrastructure.html#attr-crossorigin-anonymous id=script-processing-model:attr-crossorigin-anonymous>Anonymous</a><dd>"<code>same-origin</code>"<dt><a href=infrastructure.html#attr-crossorigin-none id=script-processing-model:attr-crossorigin-none-2>Use Credentials</a><dd>"<code>include</code>"</dl>
   </li><li>

    <p>If the <code id=script-processing-model:the-script-element-37><a href=#the-script-element>script</a></code> element has a <code id=script-processing-model:attr-script-nonce><a href=#attr-script-nonce>nonce</a></code>
    attribute, then let <var>cryptographic nonce</var> be that attribute's value.</p>

    <p>Otherwise, let <var>cryptographic nonce</var> be the empty string.</p>

   </li><li>

    <p>If the <code id=script-processing-model:the-script-element-38><a href=#the-script-element>script</a></code> element has an <code id=script-processing-model:attr-script-integrity><a href=#attr-script-integrity>integrity</a></code> attribute, then let <var>integrity
    metadata</var> be that attribute's value.</p>

    <p>Otherwise, let <var>integrity metadata</var> be the empty string.</p>

   </li><li><p>Let <var>parser state</var> be "<code>parser-inserted</code>" if the
   <code id=script-processing-model:the-script-element-39><a href=#the-script-element>script</a></code> element has been flagged as <a href=#parser-inserted id=script-processing-model:parser-inserted-7>"parser-inserted"</a>, and
   "<code>not parser-inserted</code>" otherwise.</li><li><p>Let <var>settings</var> be the element's <a id=script-processing-model:node-document-4 href=https://triple-underscore.github.io/DOM4-ja.html#concept-node-document data-x-internal=node-document>node document</a>'s
   <code id=script-processing-model:window><a href=browsers.html#window>Window</a></code> object's <a id=script-processing-model:environment-settings-object href=webappapis.html#environment-settings-object>environment settings object</a>.</li><li id=script-processing-src-prepare>

    <p>If the element has a <code id=script-processing-model:attr-script-src-5><a href=#attr-script-src>src</a></code> content attribute, then:</p>

    <ol><li><p>Let <var>src</var> be the value of the element's <code id=script-processing-model:attr-script-src-6><a href=#attr-script-src>src</a></code> attribute.</li><li><p>If <var>src</var> is the empty string, <a id=script-processing-model:queue-a-task href=webappapis.html#queue-a-task>queue a task</a> to <a href=https://dom.spec.whatwg.org/#concept-event-fire id=script-processing-model:concept-event-fire data-x-internal=concept-event-fire>fire an event</a> named <code id=script-processing-model:event-error><a href=indices.html#event-error>error</a></code>
     at the element, and abort these steps.</li><li><p>Set the element's <a href=#concept-script-external id=script-processing-model:concept-script-external>from an external file</a>
     flag.</li><li><p><a href=infrastructure.html#parse-a-url id=script-processing-model:parse-a-url>Parse</a> <var>src</var> relative to the element's
     <a id=script-processing-model:node-document-5 href=https://triple-underscore.github.io/DOM4-ja.html#concept-node-document data-x-internal=node-document>node document</a>.</li><li><p>If the previous step failed, <a id=script-processing-model:queue-a-task-2 href=webappapis.html#queue-a-task>queue a task</a> to <a href=https://dom.spec.whatwg.org/#concept-event-fire id=script-processing-model:concept-event-fire-2 data-x-internal=concept-event-fire>fire an event</a> named <code id=script-processing-model:event-error-2><a href=indices.html#event-error>error</a></code>
     at the element, and abort these steps. Otherwise, let <var>url</var> be the <a id=script-processing-model:resulting-url-record href=infrastructure.html#resulting-url-record>resulting URL
     record</a>.</li><li>
      <p>Switch on <a href=#concept-script-type id=script-processing-model:concept-script-type-7>the script's type</a>:</p>

      <dl class=switch><dt>"<code>classic</code>"<dd>
        <p><a id=script-processing-model:fetch-a-classic-script href=webappapis.html#fetch-a-classic-script>Fetch a classic script</a> given <var>url</var>, <var>settings</var>,
        <var>cryptographic nonce</var>, <var>integrity metadata</var>, <var>parser state</var>,
        <var>CORS setting</var>, and <var>encoding</var>.</p>
       <dt>"<code>module</code>"<dd>
        <p><a id=script-processing-model:fetch-a-module-script-tree href=webappapis.html#fetch-a-module-script-tree>Fetch a module script graph</a> given <var>url</var>, <var>settings</var>,
        "<code>script</code>", <var>cryptographic nonce</var>, <var>parser state</var>,
        and <var>module script credentials mode</var>.</p>
       </dl>

      <p>When the chosen algorithm asynchronously completes, set <a href=#concept-script-script id=script-processing-model:concept-script-script>the script's script</a> to the result. At that time,
      <a href=#the-script-is-ready id=script-processing-model:the-script-is-ready-2>the script is ready</a>.</p>

      <p>For performance reasons, user agents may start fetching the classic script or module tree
      (as defined above) as soon as the <code id=script-processing-model:attr-script-src-7><a href=#attr-script-src>src</a></code> attribute is set,
      instead, in the hope that the element will be inserted into the document (and that the <code id=script-processing-model:attr-script-crossorigin-2><a href=#attr-script-crossorigin>crossorigin</a></code> attribute won't change value in the
      meantime). Either way, once the element is <a href=infrastructure.html#insert-an-element-into-a-document id=script-processing-model:insert-an-element-into-a-document>inserted into the document</a>, the load must have started as described in this
      step. If the UA performs such prefetching, but the element is never inserted in the document,
      or the <code id=script-processing-model:attr-script-src-8><a href=#attr-script-src>src</a></code> attribute is dynamically changed, or the <code id=script-processing-model:attr-script-crossorigin-3><a href=#attr-script-crossorigin>crossorigin</a></code> attribute is dynamically changed, then the
      user agent will not execute the script so obtained, and the fetching process will have been
      effectively wasted.</p>

     </li></ol>

   </li><li id=establish-script-block-source>

    <p>If the element does not have a <code id=script-processing-model:attr-script-src-9><a href=#attr-script-src>src</a></code> content attribute,
    run these substeps:</p>

    <ol><li><p>Let <var>source text</var> be the value of the <code id=script-processing-model:dom-script-text><a href=#dom-script-text>text</a></code> IDL attribute.</li><li>
      <p>Switch on <a href=#concept-script-type id=script-processing-model:concept-script-type-8>the script's type</a>:</p>

      <dl class=switch><dt>"<code>classic</code>"<dd>
        <ol><li><p>Let <var>script</var> be the result of <a id=script-processing-model:creating-a-classic-script href=webappapis.html#creating-a-classic-script>creating a classic script</a> using
         <var>source text</var> and <var>settings</var>.</li><li><p>Set <a href=#concept-script-script id=script-processing-model:concept-script-script-2>the script's script</a> to
         <var>script</var>.</li><li><p><a href=#the-script-is-ready id=script-processing-model:the-script-is-ready-3>The script is ready</a>.</li></ol>
       <dt>"<code>module</code>"<dd>
        <ol><li><p>Let <var>base URL</var> be the <code id=script-processing-model:the-script-element-40><a href=#the-script-element>script</a></code> element's <a id=script-processing-model:node-document-6 href=https://triple-underscore.github.io/DOM4-ja.html#concept-node-document data-x-internal=node-document>node
         document</a>'s <a id=script-processing-model:document-base-url href=infrastructure.html#document-base-url>document base URL</a>.</li><li><p>Let <var>script</var> be the result of <a id=script-processing-model:creating-a-module-script href=webappapis.html#creating-a-module-script>creating a module script</a> using
         <var>source text</var>, <var>settings</var>, <var>base URL</var>, <var>cryptographic
         nonce</var>, <var>parser state</var>, and <var>module script credentials
         mode</var>.</li><li><p>If this returns null, set <a href=#concept-script-script id=script-processing-model:concept-script-script-3>the script's
         script</a> to null and abort these substeps; <a href=#the-script-is-ready id=script-processing-model:the-script-is-ready-4>the script is ready</a>.</li><li><p><a href=webappapis.html#fetch-the-descendants-of-a-module-script id=script-processing-model:fetch-the-descendants-of-a-module-script>Fetch the
         descendants</a> of <var>script</var> (using an empty ancestor list). When this
         asynchronously completes, set <a href=#concept-script-script id=script-processing-model:concept-script-script-4>the script's
         script</a> to the result. At that time, <a href=#the-script-is-ready id=script-processing-model:the-script-is-ready-5>the script is ready</a>.</li></ol>
       </dl>
     </li></ol>
   </li><li>

    <p>Then, follow the first of the following options that describes the situation:</p>

    <dl class=switch><dt id=script-processing-defer>If <a href=#concept-script-type id=script-processing-model:concept-script-type-9>the script's
     type</a> is "<code>classic</code>", and the element has a <code id=script-processing-model:attr-script-src-10><a href=#attr-script-src>src</a></code> attribute, and the element has a <code id=script-processing-model:attr-script-defer><a href=#attr-script-defer>defer</a></code> attribute, and the element has been flagged as
     <a href=#parser-inserted id=script-processing-model:parser-inserted-8>"parser-inserted"</a>, and the element does not have an <code id=script-processing-model:attr-script-async-4><a href=#attr-script-async>async</a></code> attribute<dt id=script-processing-module-noasync-parser-inserted>If <a href=#concept-script-type id=script-processing-model:concept-script-type-10>the script's type</a> is "<code>module</code>", and
     the element has been flagged as <a href=#parser-inserted id=script-processing-model:parser-inserted-9>"parser-inserted"</a>, and the element does not have
     an <code id=script-processing-model:attr-script-async-5><a href=#attr-script-async>async</a></code> attribute<dd>

      <p>Add the element to the end of the <dfn id=list-of-scripts-that-will-execute-when-the-document-has-finished-parsing>list of scripts that will execute when the document
      has finished parsing</dfn> associated with the <code id=script-processing-model:document-3><a href=dom.html#document>Document</a></code> of the parser that
      created the element.</p>

      <p>When <a href=#the-script-is-ready id=script-processing-model:the-script-is-ready-6>the script is ready</a>, set the element's <a href=#ready-to-be-parser-executed id=script-processing-model:ready-to-be-parser-executed>"ready to be
      parser-executed"</a> flag. The parser will handle executing the script.</p>

     <dt id=script-processing-parser-inserted>If <a href=#concept-script-type id=script-processing-model:concept-script-type-11>the script's
     type</a> is "<code>classic</code>", and the element has a <code id=script-processing-model:attr-script-src-11><a href=#attr-script-src>src</a></code> attribute, and the element has been flagged as
     <a href=#parser-inserted id=script-processing-model:parser-inserted-10>"parser-inserted"</a>, and the element does not have an <code id=script-processing-model:attr-script-async-6><a href=#attr-script-async>async</a></code> attribute<dd>

      <p>The element is the <a href=#pending-parsing-blocking-script id=script-processing-model:pending-parsing-blocking-script>pending parsing-blocking script</a> of the
      <code id=script-processing-model:document-4><a href=dom.html#document>Document</a></code> of the parser that created the element. (There can only be one such
      script per <code id=script-processing-model:document-5><a href=dom.html#document>Document</a></code> at a time.)</p>

      <p>When <a href=#the-script-is-ready id=script-processing-model:the-script-is-ready-7>the script is ready</a>, set the element's <a href=#ready-to-be-parser-executed id=script-processing-model:ready-to-be-parser-executed-2>"ready to be
      parser-executed"</a> flag. The parser will handle executing the script.</p>

     <dt id=script-processing-src-sync>If <a href=#concept-script-type id=script-processing-model:concept-script-type-12>the script's
     type</a> is "<code>classic</code>", and the element has a <code id=script-processing-model:attr-script-src-12><a href=#attr-script-src>src</a></code> attribute, and the element does not have an <code id=script-processing-model:attr-script-async-7><a href=#attr-script-async>async</a></code> attribute, and the element does not have the
     <a href=#non-blocking id=script-processing-model:non-blocking-5>"non-blocking"</a> flag set<dt id=script-processing-module-noasync>If <a href=#concept-script-type id=script-processing-model:concept-script-type-13>the script's
     type</a> is "<code>module</code>", and the element does not have an <code id=script-processing-model:attr-script-async-8><a href=#attr-script-async>async</a></code> attribute, and the element does not have the
     <a href=#non-blocking id=script-processing-model:non-blocking-6>"non-blocking"</a> flag set<dd>

      <p>Add the element to the end of the <dfn id=list-of-scripts-that-will-execute-in-order-as-soon-as-possible>list of scripts that will execute in order as soon
      as possible</dfn> associated with the <a id=script-processing-model:node-document-7 href=https://triple-underscore.github.io/DOM4-ja.html#concept-node-document data-x-internal=node-document>node document</a> of the <code id=script-processing-model:the-script-element-41><a href=#the-script-element>script</a></code>
      element at the time the <a href=#prepare-a-script id=script-processing-model:prepare-a-script-5>prepare a script</a> algorithm started.</p>

      <p>When <a href=#the-script-is-ready id=script-processing-model:the-script-is-ready-8>the script is ready</a>, run the following steps:</p>

      <ol><li><p>If the element is not now the first element in the <a href=#list-of-scripts-that-will-execute-in-order-as-soon-as-possible id=script-processing-model:list-of-scripts-that-will-execute-in-order-as-soon-as-possible>list of scripts that will
       execute in order as soon as possible</a> to which it was added above, then mark the
       element as ready but abort these steps without executing the script yet.</li><li><p><i>Execution</i>: <a href=#execute-the-script-block id=script-processing-model:execute-the-script-block>Execute the script block</a> corresponding to the first
       script element in this <a href=#list-of-scripts-that-will-execute-in-order-as-soon-as-possible id=script-processing-model:list-of-scripts-that-will-execute-in-order-as-soon-as-possible-2>list of scripts that will execute in order as soon as
       possible</a>.</li><li><p>Remove the first element from this <a href=#list-of-scripts-that-will-execute-in-order-as-soon-as-possible id=script-processing-model:list-of-scripts-that-will-execute-in-order-as-soon-as-possible-3>list of scripts that will execute in order as
       soon as possible</a>.</li><li><p>If this <a href=#list-of-scripts-that-will-execute-in-order-as-soon-as-possible id=script-processing-model:list-of-scripts-that-will-execute-in-order-as-soon-as-possible-4>list of scripts that will execute in order as soon as possible</a> is
       still not empty and the first entry has already been marked as ready, then jump back to the
       step labeled <i>execution</i>.</li></ol>

     <dt id=script-processing-src>If <a href=#concept-script-type id=script-processing-model:concept-script-type-14>the script's type</a>
     is "<code>classic</code>", and the element has a <code id=script-processing-model:attr-script-src-13><a href=#attr-script-src>src</a></code> attribute<dt id=script-processing-module-async>If <a href=#concept-script-type id=script-processing-model:concept-script-type-15>the script's
     type</a> is "<code>module</code>"<dd>

      <p>The element must be added to the <dfn id=set-of-scripts-that-will-execute-as-soon-as-possible>set of scripts that will execute as soon as
      possible</dfn> of the <a id=script-processing-model:node-document-8 href=https://triple-underscore.github.io/DOM4-ja.html#concept-node-document data-x-internal=node-document>node document</a> of the <code id=script-processing-model:the-script-element-42><a href=#the-script-element>script</a></code> element at the
      time the <a href=#prepare-a-script id=script-processing-model:prepare-a-script-6>prepare a script</a> algorithm started.</p>

      <p>When <a href=#the-script-is-ready id=script-processing-model:the-script-is-ready-9>the script is ready</a>, <a href=#execute-the-script-block id=script-processing-model:execute-the-script-block-2>execute the script block</a> and then
      remove the element from the <a href=#set-of-scripts-that-will-execute-as-soon-as-possible id=script-processing-model:set-of-scripts-that-will-execute-as-soon-as-possible>set of scripts that will execute as soon as
      possible</a>.</p>

     <dt id=script-processing-style-delayed>If the element does not have a <code id=script-processing-model:attr-script-src-14><a href=#attr-script-src>src</a></code> attribute, and the element has been flagged as
     <a href=#parser-inserted id=script-processing-model:parser-inserted-11>"parser-inserted"</a>, and either the parser that created the <code id=script-processing-model:the-script-element-43><a href=#the-script-element>script</a></code> is
     an <a id=script-processing-model:xml-parser-3 href=xhtml.html#xml-parser>XML parser</a> or it's an <a id=script-processing-model:html-parser-3 href=syntax.html#html-parser>HTML parser</a> whose <a id=script-processing-model:script-nesting-level href=syntax.html#script-nesting-level>script nesting
     level</a> is not greater than one, and the <code id=script-processing-model:document-6><a href=dom.html#document>Document</a></code> of the <a id=script-processing-model:html-parser-4 href=syntax.html#html-parser>HTML
     parser</a> or <a id=script-processing-model:xml-parser-4 href=xhtml.html#xml-parser>XML parser</a> that created the <code id=script-processing-model:the-script-element-44><a href=#the-script-element>script</a></code> element <a id=script-processing-model:has-a-style-sheet-that-is-blocking-scripts href=semantics.html#has-a-style-sheet-that-is-blocking-scripts>has
     a style sheet that is blocking scripts</a><dd>

      <p>The element is the <a href=#pending-parsing-blocking-script id=script-processing-model:pending-parsing-blocking-script-2>pending parsing-blocking script</a> of the
      <code id=script-processing-model:document-7><a href=dom.html#document>Document</a></code> of the parser that created the element. (There can only be one such
      script per <code id=script-processing-model:document-8><a href=dom.html#document>Document</a></code> at a time.)</p>

      <p>Set the element's <a href=#ready-to-be-parser-executed id=script-processing-model:ready-to-be-parser-executed-3>"ready to be parser-executed"</a> flag. The parser will handle
      executing the script.</p>

     <dt id=script-processing-inline>そうでなければ<dd><a id=script-processing-model:immediately-2 href=infrastructure.html#immediately>Immediately</a> <a href=#execute-the-script-block id=script-processing-model:execute-the-script-block-3>execute the script block</a>, even if other scripts are
     already executing.</dl>

   </li></ol>

  <p>The <dfn id=pending-parsing-blocking-script>pending parsing-blocking script</dfn> of a <code id=script-processing-model:document-9><a href=dom.html#document>Document</a></code> is used by the
  <code id=script-processing-model:document-10><a href=dom.html#document>Document</a></code>'s parser(s).</p>

  <p class=note>If a <code id=script-processing-model:the-script-element-45><a href=#the-script-element>script</a></code> element that blocks a parser gets moved to another
  <code id=script-processing-model:document-11><a href=dom.html#document>Document</a></code> before it would normally have stopped blocking that parser, it nonetheless
  continues blocking that parser until the condition that causes it to be blocking the parser no
  longer applies (e.g. if the script is a <a href=#pending-parsing-blocking-script id=script-processing-model:pending-parsing-blocking-script-3>pending parsing-blocking script</a> because there
  was <a id=script-processing-model:a-style-sheet-that-is-blocking-scripts href=semantics.html#a-style-sheet-that-is-blocking-scripts>a style sheet that is blocking scripts</a> when it was parsed, but then the script is
  moved to another <code id=script-processing-model:document-12><a href=dom.html#document>Document</a></code> before the style sheet loads, the script still blocks the
  parser until the style sheets are all loaded, at which time the script executes and the parser is
  unblocked).</p>

  

  <p>When the user agent is required to <dfn id=execute-the-script-block>execute a script
  block</dfn>, it must run the following steps.</p>

  <ol><li>

    <p>If the element is flagged as <a href=#parser-inserted id=script-processing-model:parser-inserted-12>"parser-inserted"</a>, but the element's
    <a id=script-processing-model:node-document-9 href=https://triple-underscore.github.io/DOM4-ja.html#concept-node-document data-x-internal=node-document>node document</a> is not the <code id=script-processing-model:document-13><a href=dom.html#document>Document</a></code> of the parser that created the element,
    then abort these steps.</p>

   </li><li>

    <p>If <a href=#concept-script-script id=script-processing-model:concept-script-script-5>the script's script</a> is null, <a href=https://dom.spec.whatwg.org/#concept-event-fire id=script-processing-model:concept-event-fire-3 data-x-internal=concept-event-fire>fire an event</a> named <code id=script-processing-model:event-error-3><a href=indices.html#event-error>error</a></code>
    at the element, and abort these steps.</p>

   </li><li>

    <p>If the script is <a href=#concept-script-external id=script-processing-model:concept-script-external-2>from an external file</a>, or
    <a href=#concept-script-type id=script-processing-model:concept-script-type-16>the script's type</a> is "<code>module</code>",
    then increment the <a id=script-processing-model:ignore-destructive-writes-counter href=webappapis.html#ignore-destructive-writes-counter>ignore-destructive-writes counter</a> of the <code id=script-processing-model:the-script-element-46><a href=#the-script-element>script</a></code>
    element's <a id=script-processing-model:node-document-10 href=https://triple-underscore.github.io/DOM4-ja.html#concept-node-document data-x-internal=node-document>node document</a>. Let <var>neutralized doc</var> be that
    <code id=script-processing-model:document-14><a href=dom.html#document>Document</a></code>.</p>

   </li><li>

    <p>Let <var>old script element</var> be the value to which the <code id=script-processing-model:the-script-element-47><a href=#the-script-element>script</a></code>
    element's <a id=script-processing-model:node-document-11 href=https://triple-underscore.github.io/DOM4-ja.html#concept-node-document data-x-internal=node-document>node document</a>'s <code id=script-processing-model:dom-document-currentscript><a href=dom.html#dom-document-currentscript>currentScript</a></code> object was most recently
    set.</p>

   </li><li>

    <p>Switch on <a href=#concept-script-type id=script-processing-model:concept-script-type-17>the script's type</a>:</p>

    <dl class=switch><dt>"<code>classic</code>"<dd>
      <ol><li>
        <p>If the <code id=script-processing-model:the-script-element-48><a href=#the-script-element>script</a></code> element's <a id=script-processing-model:root href=https://triple-underscore.github.io/DOM4-ja.html#concept-tree-root data-x-internal=root>root</a> is <em>not</em> a <a id=script-processing-model:shadow-root href=https://triple-underscore.github.io/DOM4-ja.html#concept-shadow-root data-x-internal=shadow-root>shadow
        root</a>, then set the <code id=script-processing-model:the-script-element-49><a href=#the-script-element>script</a></code> element's <a id=script-processing-model:node-document-12 href=https://triple-underscore.github.io/DOM4-ja.html#concept-node-document data-x-internal=node-document>node document</a>'s <code id=script-processing-model:dom-document-currentscript-2><a href=dom.html#dom-document-currentscript>currentScript</a></code> attribute to the
        <code id=script-processing-model:the-script-element-50><a href=#the-script-element>script</a></code> element. Otherwise, set it to null.</p>

        <p class=note>This does not use the <a id=script-processing-model:in-a-document-tree href=https://triple-underscore.github.io/DOM4-ja.html#in-a-document data-x-internal=in-a-document-tree>in a document tree</a> check, as the
        <code id=script-processing-model:the-script-element-51><a href=#the-script-element>script</a></code> element could have been removed from the document prior to execution,
        and in that scenario <code id=script-processing-model:dom-document-currentscript-3><a href=dom.html#dom-document-currentscript>currentScript</a></code> still
        needs to point to it.</p>
       </li><li><p><a href=webappapis.html#run-a-classic-script id=script-processing-model:run-a-classic-script>Run the classic script</a> given by <a href=#concept-script-script id=script-processing-model:concept-script-script-6>the script's script</a>.</li></ol>
     <dt>"<code>module</code>"<dd>
      <ol><li><p>Set the <code id=script-processing-model:the-script-element-52><a href=#the-script-element>script</a></code> element's <a id=script-processing-model:node-document-13 href=https://triple-underscore.github.io/DOM4-ja.html#concept-node-document data-x-internal=node-document>node document</a>'s <code id=script-processing-model:dom-document-currentscript-4><a href=dom.html#dom-document-currentscript>currentScript</a></code> attribute to null.</li><li><p><a href=webappapis.html#run-a-module-script id=script-processing-model:run-a-module-script>Run the module script</a> given by <a href=#concept-script-script id=script-processing-model:concept-script-script-7>the script's script</a>.</li></ol>
     </dl>

   </li><li>

    <p>Set the <code id=script-processing-model:the-script-element-53><a href=#the-script-element>script</a></code> element's <a id=script-processing-model:node-document-14 href=https://triple-underscore.github.io/DOM4-ja.html#concept-node-document data-x-internal=node-document>node document</a>'s <code id=script-processing-model:dom-document-currentscript-5><a href=dom.html#dom-document-currentscript>currentScript</a></code> attribute to <var>old script
    element</var>.</p>

   </li><li>

    <p>Decrement the <a id=script-processing-model:ignore-destructive-writes-counter-2 href=webappapis.html#ignore-destructive-writes-counter>ignore-destructive-writes counter</a> of <var>neutralized doc</var>, if it was incremented in the earlier step.</p>

   </li><li>

    <p>If the script is <a href=#concept-script-external id=script-processing-model:concept-script-external-3>from an external file</a>, then
    <a href=https://dom.spec.whatwg.org/#concept-event-fire id=script-processing-model:concept-event-fire-4 data-x-internal=concept-event-fire>fire an event</a> named <code id=script-processing-model:event-load><a href=indices.html#event-load>load</a></code> at the <code id=script-processing-model:the-script-element-54><a href=#the-script-element>script</a></code> element.</p>

   </li></ol>

  


  <h5 id=scriptingLanguages>4.12.1.2 スクリプト言語<a href=#scriptingLanguages class=self-link></a></h5>

  <p><dfn id=javascript-mime-type data-export="">JavaScript MIMEタイプ</dfn>は、次のいずれかである<a id=scriptingLanguages:mime-type href=https://mimesniff.spec.whatwg.org/#mime-type data-x-internal=mime-type>MIMEタイプ</a>の文字列であり、JavaScriptを指す<a href=references.html#refsJAVASCRIPT>[JAVASCRIPT]</a>：</p>

  <ul class=brief><li><code id=scriptingLanguages:application/ecmascript><a href=indices.html#application/ecmascript>application/ecmascript</a></code>
   </li><li><code id=scriptingLanguages:application/javascript><a href=indices.html#application/javascript>application/javascript</a></code>
   </li><li><code id=scriptingLanguages:application/x-ecmascript><a href=indices.html#application/x-ecmascript>application/x-ecmascript</a></code>
   </li><li><code id=scriptingLanguages:application/x-javascript><a href=indices.html#application/x-javascript>application/x-javascript</a></code>
   </li><li><code id=scriptingLanguages:text/ecmascript><a href=indices.html#text/ecmascript>text/ecmascript</a></code>
   </li><li><code id=scriptingLanguages:text/javascript><a href=indices.html#text/javascript>text/javascript</a></code>
   </li><li><code id=scriptingLanguages:text/javascript1.0><a href=indices.html#text/javascript1.0>text/javascript1.0</a></code>
   </li><li><code id=scriptingLanguages:text/javascript1.1><a href=indices.html#text/javascript1.1>text/javascript1.1</a></code>
   </li><li><code id=scriptingLanguages:text/javascript1.2><a href=indices.html#text/javascript1.2>text/javascript1.2</a></code>
   </li><li><code id=scriptingLanguages:text/javascript1.3><a href=indices.html#text/javascript1.3>text/javascript1.3</a></code>
   </li><li><code id=scriptingLanguages:text/javascript1.4><a href=indices.html#text/javascript1.4>text/javascript1.4</a></code>
   </li><li><code id=scriptingLanguages:text/javascript1.5><a href=indices.html#text/javascript1.5>text/javascript1.5</a></code>
   </li><li><code id=scriptingLanguages:text/jscript><a href=indices.html#text/jscript>text/jscript</a></code>
   </li><li><code id=scriptingLanguages:text/livescript><a href=indices.html#text/livescript>text/livescript</a></code>
   </li><li><code id=scriptingLanguages:text/x-ecmascript><a href=indices.html#text/x-ecmascript>text/x-ecmascript</a></code>
   </li><li><code id=scriptingLanguages:text/x-javascript><a href=indices.html#text/x-javascript>text/x-javascript</a></code>
  </li></ul>

  <p>ユーザーエージェントは、すべての<a href=#javascript-mime-type id=scriptingLanguages:javascript-mime-type>JavaScript MIMEタイプ</a>を認識しなければならない。</p>

  

  <p>User agents may support other <a href=https://mimesniff.spec.whatwg.org/#mime-type id=scriptingLanguages:mime-type-2 data-x-internal=mime-type>MIME types</a> for other languages,
  but must not support other <a href=https://mimesniff.spec.whatwg.org/#mime-type id=scriptingLanguages:mime-type-3 data-x-internal=mime-type>MIME types</a> for the languages in the list
  above. User agents are not required to support JavaScript. The processing model for languages
  other than JavaScript is outside the scope of this specification.</p>

  <p>The following <a href=https://mimesniff.spec.whatwg.org/#mime-type id=scriptingLanguages:mime-type-4 data-x-internal=mime-type>MIME types</a> (with or without parameters) must not
  be interpreted as scripting languages:</p>

  <ul class=brief><li><code id=scriptingLanguages:text/plain><a data-x-internal=text/plain href=https://tools.ietf.org/html/rfc2046#section-4.1.3>text/plain</a></code>
   </li><li><code id=scriptingLanguages:text/xml><a href=indices.html#text/xml>text/xml</a></code>
   
   </li><li><code id=scriptingLanguages:application/octet-stream><a data-x-internal=application/octet-stream href=https://tools.ietf.org/html/rfc2046#section-4.5.1>application/octet-stream</a></code>
   </li><li><code id=scriptingLanguages:application/xml><a href=indices.html#application/xml>application/xml</a></code>
   
   

   

  </li></ul>

  <p class=note>These types are explicitly listed here because they are poorly-defined types that
  are nonetheless likely to be used as formats for data blocks, and it would be problematic if they
  were suddenly to be interpreted as script by a user agent.</p>

  

  <p>When examining types to determine if they represent supported languages, user agents must not
  ignore MIME parameters. Types are to be compared including all parameters.</p> 

  <p class=note>For example, types that include the <code>charset</code> parameter will
  not be recognized as referencing any of the scripting languages listed above.</p>

  


  <h5 id=restrictions-for-contents-of-script-elements>4.12.1.3 <dfn><code>script</code>要素のコンテンツの制約</dfn><a href=#restrictions-for-contents-of-script-elements class=self-link></a></h5>

  <p class=note>この節で説明される多少奇妙な制約を回避する最も簡単で安全な方法は、以下のシーケンスが（たとえば文字列、正規表現、またはコメントなど）スクリプト内でリテラルに表示され、かつ式の中でこのような構造体を使用してコードを記述を避けるようにする際に、"<code>&lt;!--</code>"を"<code>&lt;\!--</code>"として、"<code>&lt;script</code>"を"<code>&lt;\script</code>"として、および"<code>&lt;/script</code>"を"<code>&lt;\/script</code>"として常にエスケープすることである。この節の制限がトリガーになりやすい落とし穴を回避する：すなわち、歴史的な理由のために、HTMLにおける<code id=restrictions-for-contents-of-script-elements:the-script-element><a href=#the-script-element>script</a></code>ブロックの解析は、これらのシーケンスを考えた場合に直観的でない働きをする奇妙で風変わりな慣習である。</p>

  <p><code id=restrictions-for-contents-of-script-elements:the-script-element-2><a href=#the-script-element>script</a></code>要素の<code id=restrictions-for-contents-of-script-elements:textcontent><a data-x-internal=textcontent href=https://triple-underscore.github.io/DOM4-ja.html#dom-node-textcontent>textContent</a></code>は、Unicodeである文字セットである、以下のABNFで<code>script</code>生成物と対等でなければならない。<a href=references.html#refsABNF>[ABNF]</a></p>

  <pre>script        = outer *( comment-open inner comment-close outer )

outer         = &lt; any string that doesn't contain a substring that matches not-in-outer &gt;
not-in-outer  = comment-open
inner         = &lt; any string that doesn't contain a substring that matches not-in-inner &gt;
not-in-inner  = comment-close / script-open

comment-open  = "&lt;!--"
comment-close = "--&gt;"
script-open   = "&lt;" s c r i p t tag-end

s             =  %x0053 ; U+0053 LATIN CAPITAL LETTER S
s             =/ %x0073 ; U+0073 LATIN SMALL LETTER S
c             =  %x0043 ; U+0043 LATIN CAPITAL LETTER C
c             =/ %x0063 ; U+0063 LATIN SMALL LETTER C
r             =  %x0052 ; U+0052 LATIN CAPITAL LETTER R
r             =/ %x0072 ; U+0072 LATIN SMALL LETTER R
i             =  %x0049 ; U+0049 LATIN CAPITAL LETTER I
i             =/ %x0069 ; U+0069 LATIN SMALL LETTER I
p             =  %x0050 ; U+0050 LATIN CAPITAL LETTER P
p             =/ %x0070 ; U+0070 LATIN SMALL LETTER P
t             =  %x0054 ; U+0054 LATIN CAPITAL LETTER T
t             =/ %x0074 ; U+0074 LATIN SMALL LETTER T

tag-end       =  %x0009 ; U+0009 CHARACTER TABULATION (tab)
tag-end       =/ %x000A ; U+000A LINE FEED (LF)
tag-end       =/ %x000C ; U+000C FORM FEED (FF)
tag-end       =/ %x0020 ; U+0020 SPACE
tag-end       =/ %x002F ; U+002F SOLIDUS (/)
tag-end       =/ %x003E ; U+003E GREATER-THAN SIGN (&gt;)</pre>

  <p><code id=restrictions-for-contents-of-script-elements:the-script-element-3><a href=#the-script-element>script</a></code>要素が<a href=#inline-documentation-for-external-scripts id=restrictions-for-contents-of-script-elements:inline-documentation-for-external-scripts>スクリプト文書</a>を含む場合、以下の節で記述されるように、要素のコンテンツのさらなる制約がある。</p>

  <div class=example>

   <p>以下のスクリプトは、この問題を示している。このように、文字列が含まれているスクリプトがあるとする：</p>

   <pre>var example = 'Consider this string: &lt;!-- &lt;script&gt;';
console.log(example);</pre>

   <p>これが<code id=restrictions-for-contents-of-script-elements:the-script-element-4><a href=#the-script-element>script</a></code>ブロックで直接この文字列を入れていた場合、上記の制限に違反しない。</p>

   <pre>&lt;script&gt;
  var example = 'Consider this string: &lt;!-- &lt;script&gt;';
  console.log(example);
&lt;/script&gt;</pre>

   <p>しかし、より大きな問題かつ、スクリプトがそれらの制限に違反しない理由は、実際にスクリプトが奇妙に解析されるだろうということである。<em>上記のスクリプトブロックは終了していない</em>。それは、実際には依然として<code id=restrictions-for-contents-of-script-elements:the-script-element-5><a href=#the-script-element>script</a></code>ブロックの一部であるこのスニペットにおいて"<code>&lt;/script&gt;</code>"終了タグのように見えるものである。（スクリプトが終了していないため）スクリプトは実行しない。スクリプトが何らかの形で実行した場合、以下のようにマークアップが見えた場合、（ここで強調される）スクリプトが妥当なJavaScriptでないので、スクリプトは失敗するだろう：</p>

   <pre>&lt;script&gt;<mark>
  var example = 'Consider this string: &lt;!-- &lt;script&gt;';
  console.log(example);
&lt;/script&gt;
&lt;!-- despite appearances, this is actually part of the script still! --&gt;
&lt;script&gt;
 ... // this is the same script block still...
</mark>&lt;/script&gt;</pre>

   <p>ここで起こっていることはレガシーな理由のために、HTMLにおける<code id=restrictions-for-contents-of-script-elements:the-script-element-6><a href=#the-script-element>script</a></code>要素で"<code>&lt;!--</code>"および"<code>&lt;script</code>"文字列は、パーサがブロックを閉じる検討するためにバランスをとる必要がある。</p>

   <p>この節の最初に述べたように、問題の文字列をエスケープすることによって、問題は完全に回避されている：</p>

   <pre>&lt;script&gt;<mark>
  var example = 'Consider this string: &lt;\!-- &lt;\script&gt;';
  console.log(example);
</mark>&lt;/script&gt;
&lt;!-- this is just a comment between script blocks --&gt;
&lt;script&gt;<mark>
 ... // this is a new script block
</mark>&lt;/script&gt;</pre>

   <p>次の例のように、これらのシーケンスは自然にスクリプト式で出現可能である：</p>

   <pre>if (x&lt;!--y) { ... }
if ( player&lt;script ) { ... }</pre>

   <p>このような場合、文字はエスケープすることはできないが、シーケンスが発生しないように式は次のように書き換えることができる：</p>

   <pre>if (x &lt; !--y) { ... }
if (!--y &gt; x) { ... }
if (!(--y) &gt; x) { ... }
if (player &lt; script) { ... }
if (script &gt; player) { ... }</pre>

   <p>これを行うとはまた、同様に様々な落とし穴を回避する：関連する歴史的な理由のために、<a href=webappapis.html#classic-script id=restrictions-for-contents-of-script-elements:classic-script>classic scripts</a>で文字列"&lt;!--"は、"//"のように、実際には行コメントの開始として扱われる。</p>

  </div>


  <h5 id=inline-documentation-for-external-scripts>4.12.1.4 <dfn>外部スクリプトに対するインライン文書</dfn><a href=#inline-documentation-for-external-scripts class=self-link></a></h5>

  <p><code id=inline-documentation-for-external-scripts:the-script-element><a href=#the-script-element>script</a></code>要素の<code id=inline-documentation-for-external-scripts:attr-script-src><a href=#attr-script-src>src</a></code>属性が指定される場合、もしあれば、<code id=inline-documentation-for-external-scripts:the-script-element-2><a href=#the-script-element>script</a></code>要素のコンテンツは、要素のコンテンツから分割されるような<code id=inline-documentation-for-external-scripts:dom-script-text><a href=#dom-script-text>text</a></code> IDL属性値でなければならず、文字セットがUnicodeである下記のABNFで<code>documentation</code>生成物と一致しなければならない。<a href=references.html#refsABNF>[ABNF]</a></p>

  <pre>documentation = *( *( space / tab / comment ) [ line-comment ] newline )
comment       = slash star *( not-star / star not-slash ) 1*star slash
line-comment  = slash slash *not-newline

; characters
tab           = %x0009 ; U+0009 CHARACTER TABULATION (tab)
newline       = %x000A ; U+000A LINE FEED (LF)
space         = %x0020 ; U+0020 SPACE
star          = %x002A ; U+002A ASTERISK (*)
slash         = %x002F ; U+002F SOLIDUS (/)
not-newline   = %x0000-0009 / %x000B-10FFFF
                ; a <a id=inline-documentation-for-external-scripts:scalar-value href=https://infra.spec.whatwg.org/#scalar-value data-x-internal=scalar-value>scalar value</a> other than U+000A LINE FEED (LF)
not-star      = %x0000-0029 / %x002B-10FFFF
                ; a <a id=inline-documentation-for-external-scripts:scalar-value-2 href=https://infra.spec.whatwg.org/#scalar-value data-x-internal=scalar-value>scalar value</a> other than U+002A ASTERISK (*)
not-slash     = %x0000-002E / %x0030-10FFFF
                ; a <a id=inline-documentation-for-external-scripts:scalar-value-3 href=https://infra.spec.whatwg.org/#scalar-value data-x-internal=scalar-value>scalar value</a> other than U+002F SOLIDUS (/)</pre>

  <p class=note>これは、JavaScriptのコメントで要素のコンテンツを設置するものと一致する。</p>

  <p class=note>この要求は、<code id=inline-documentation-for-external-scripts:the-script-element-3><a href=#the-script-element>script</a></code>要素のコンテンツの構文上に先の制約に加えて存在する。</p>

  <div class=example>

   <p>以下は、依然として外部スクリプトファイルを参照する間に文書内で、著者がライセンス情報やAPI情報のような文書を含むことを許可する。<code id=inline-documentation-for-external-scripts:attr-script-src-2><a href=#attr-script-src>src</a></code>属性を提供する一方で、偶然にも著者が有効なスクリプトのように見えるものが含まないように、構文は制約される。</p>

   <pre>&lt;script src="cool-effects.js"&gt;
 // create new instances using:
 //    var e = new Effect();
 // start the effect using .play, stop using .stop:
 //    e.play();
 //    e.stop();
&lt;/script&gt;</pre>

  </div>


  

  <h5 id=scriptTagXSLT>4.12.1.5 Interaction of <code id=scriptTagXSLT:the-script-element><a href=#the-script-element>script</a></code> elements and XSLT<a href=#scriptTagXSLT class=self-link></a></h5>

  <p><i>この節は非規範的である。</i></p>

  <p>This specification does not define how XSLT interacts with the <code id=scriptTagXSLT:the-script-element-2><a href=#the-script-element>script</a></code> element.
  However, in the absence of another specification actually defining this, here are some guidelines
  for implementors, based on existing implementations:</p>

  <ul><li><p>When an XSLT transformation program is triggered by an <code><?xml-stylesheet?></code> processing instruction and the browser implements a
   direct-to-DOM transformation, <code id=scriptTagXSLT:the-script-element-3><a href=#the-script-element>script</a></code> elements created by the XSLT processor need to
   be marked <a href=#parser-inserted id=scriptTagXSLT:parser-inserted>"parser-inserted"</a> and run in document order (modulo scripts marked <code id=scriptTagXSLT:attr-script-defer><a href=#attr-script-defer>defer</a></code> or <code id=scriptTagXSLT:attr-script-async><a href=#attr-script-async>async</a></code>),
   <a id=scriptTagXSLT:immediately href=infrastructure.html#immediately>immediately</a>, as the transformation is occurring.</li><li><p>The <code id=scriptTagXSLT:dom-xsltprocessor-transformtodocument><a href=infrastructure.html#dom-xsltprocessor-transformtodocument>XSLTProcessor.transformToDocument()</a></code> method
   adds elements to a <code id=scriptTagXSLT:document><a href=dom.html#document>Document</a></code> that does not have a <a href=browsers.html#concept-document-bc id=scriptTagXSLT:concept-document-bc>browsing context</a>, and, accordingly, any <code id=scriptTagXSLT:the-script-element-4><a href=#the-script-element>script</a></code>
   elements they create need to have their <a href=#already-started id=scriptTagXSLT:already-started>"already started"</a> flag set in the
   <a href=#prepare-a-script id=scriptTagXSLT:prepare-a-script>prepare a script</a> algorithm and never get executed (<a href=webappapis.html#concept-bc-noscript id=scriptTagXSLT:concept-bc-noscript>scripting is disabled</a>). Such <code id=scriptTagXSLT:the-script-element-5><a href=#the-script-element>script</a></code> elements
   still need to be marked <a href=#parser-inserted id=scriptTagXSLT:parser-inserted-2>"parser-inserted"</a>, though, such that their <code id=scriptTagXSLT:dom-script-async><a href=#dom-script-async>async</a></code> IDL attribute will return false in the absence of an <code id=scriptTagXSLT:attr-script-async-2><a href=#attr-script-async>async</a></code> content attribute.</li><li><p>The <code id=scriptTagXSLT:dom-xsltprocessor-transformtofragment><a href=infrastructure.html#dom-xsltprocessor-transformtofragment>XSLTProcessor.transformToFragment()</a></code> method
   needs to create a fragment that is equivalent to one built manually by creating the elements
   using <code id=scriptTagXSLT:dom-document-createelementns><a data-x-internal=dom-document-createelementns href=https://triple-underscore.github.io/DOM4-ja.html#dom-document-createelementns>document.createElementNS()</a></code>. For instance,
   it needs to create <code id=scriptTagXSLT:the-script-element-6><a href=#the-script-element>script</a></code> elements that aren't <a href=#parser-inserted id=scriptTagXSLT:parser-inserted-3>"parser-inserted"</a> and
   that don't have their <a href=#already-started id=scriptTagXSLT:already-started-2>"already started"</a> flag set, so that they will execute when the
   fragment is inserted into a document.</li></ul>

  <p>The main distinction between the first two cases and the last case is that the first two
  operate on <code id=scriptTagXSLT:document-2><a href=dom.html#document>Document</a></code>s and the last operates on a fragment.</p>

  



  <h4 id=the-noscript-element>4.12.2 <dfn><code>noscript</code></dfn>要素<a href=#the-noscript-element class=self-link></a></h4>

  <dl class=element><dt><a href=dom.html#concept-element-categories id=the-noscript-element:concept-element-categories>カテゴリー</a>：<dd><a id=the-noscript-element:metadata-content-2 href=dom.html#metadata-content-2>メタデータコンテンツ</a>。<dd><a id=the-noscript-element:flow-content-2 href=dom.html#flow-content-2>フローコンテンツ</a>。<dd><a id=the-noscript-element:phrasing-content-2 href=dom.html#phrasing-content-2>フレージングコンテンツ</a>。<dt><a href=dom.html#concept-element-contexts id=the-noscript-element:concept-element-contexts>この要素を使用できるコンテキスト</a>：<dd>先祖<code id=the-noscript-element:the-noscript-element><a href=#the-noscript-element>noscript</a></code>要素が存在しない場合、<a href=https://triple-underscore.github.io/DOM4-ja.html#html-document id=the-noscript-element:html-documents data-x-internal=html-documents>HTML文書</a>の<code id=the-noscript-element:the-head-element><a href=semantics.html#the-head-element>head</a></code>要素内。<dd>先祖<code id=the-noscript-element:the-noscript-element-2><a href=#the-noscript-element>noscript</a></code>要素が存在しない場合、<a id=the-noscript-element:html-documents-2 href=https://triple-underscore.github.io/DOM4-ja.html#html-document data-x-internal=html-documents>HTML文書</a>で<a id=the-noscript-element:phrasing-content-2-2 href=dom.html#phrasing-content-2>フレージングコンテンツ</a>が期待される場所。<dt><a href=dom.html#concept-element-content-model id=the-noscript-element:concept-element-content-model>コンテンツモデル</a>：<dd><a href=webappapis.html#concept-n-noscript id=the-noscript-element:concept-n-noscript>スクリプトが無効</a>の場合、<code id=the-noscript-element:the-head-element-2><a href=semantics.html#the-head-element>head</a></code>要素内で：任意の順で、0個以上の<code id=the-noscript-element:the-link-element><a href=semantics.html#the-link-element>link</a></code>要素、ゼロ個以上の<code id=the-noscript-element:the-style-element><a href=semantics.html#the-style-element>style</a></code>要素、0個以上の<code id=the-noscript-element:the-meta-element><a href=semantics.html#the-meta-element>meta</a></code>要素。<dd><a href=webappapis.html#concept-n-noscript id=the-noscript-element:concept-n-noscript-2>スクリプトが無効</a>の場合、<code id=the-noscript-element:the-head-element-3><a href=semantics.html#the-head-element>head</a></code>要素外で：<a id=the-noscript-element:transparent href=dom.html#transparent>透過的</a>。ただし、<code id=the-noscript-element:the-noscript-element-3><a href=#the-noscript-element>noscript</a></code>要素の子孫を持ってはならない。<dd>そうでなければ：文で与えられる要件に適合するテキスト。<dt><a href=dom.html#concept-element-tag-omission id=the-noscript-element:concept-element-tag-omission>text/htmlにおけるタグ省略</a>：<dd>どちらのタグも省略不可。<dt><a href=dom.html#concept-element-attributes id=the-noscript-element:concept-element-attributes>コンテンツ属性</a>：<dd><a id=the-noscript-element:global-attributes href=dom.html#global-attributes>グローバル属性</a><dt><a href=dom.html#concept-element-dom id=the-noscript-element:concept-element-dom>DOMインターフェイス</a>：<dd><code id=the-noscript-element:htmlelement><a href=dom.html#htmlelement>HTMLElement</a></code>を使用する。</dl>

  <p><code id=the-noscript-element:the-noscript-element-4><a href=#the-noscript-element>noscript</a></code>要素は、<a href=webappapis.html#concept-n-script id=the-noscript-element:concept-n-script>スクリプトが有効である</a>場合は何も<a id=the-noscript-element:represents href=dom.html#represents>表さ</a>ず、<a href=webappapis.html#concept-n-noscript id=the-noscript-element:concept-n-noscript-3>スクリプトが無効である</a>場合は要素の子を<a id=the-noscript-element:represents-2 href=dom.html#represents>表す</a>。これは、文書が解析される方法に影響を与えることによって、スクリプトをサポートするユーザーエージェントとサポートしないユーザーエージェントに異なるマークアップを提示するために使用される。</p>

  <p><a id=the-noscript-element:html-documents-3 href=https://triple-underscore.github.io/DOM4-ja.html#html-document data-x-internal=html-documents>HTML文書</a>で使用する場合、許可されるコンテンツモデルは次のとおり：</p>

  <dl><dt><a href=webappapis.html#concept-n-noscript id=the-noscript-element:concept-n-noscript-4>スクリプトが無効である</a>場合、<code id=the-noscript-element:the-head-element-4><a href=semantics.html#the-head-element>head</a></code>要素内の<code id=the-noscript-element:the-noscript-element-5><a href=#the-noscript-element>noscript</a></code>要素に対して<dd><p><code id=the-noscript-element:the-noscript-element-6><a href=#the-noscript-element>noscript</a></code>要素は、<code id=the-noscript-element:the-link-element-2><a href=semantics.html#the-link-element>link</a></code>、<code id=the-noscript-element:the-style-element-2><a href=semantics.html#the-style-element>style</a></code>、および<code id=the-noscript-element:the-meta-element-2><a href=semantics.html#the-meta-element>meta</a></code>要素のみを含まなければならない。<dt><a href=webappapis.html#concept-n-script id=the-noscript-element:concept-n-script-2>スクリプトが有効である</a>場合、<code id=the-noscript-element:the-head-element-5><a href=semantics.html#the-head-element>head</a></code>要素内の<code id=the-noscript-element:the-noscript-element-7><a href=#the-noscript-element>noscript</a></code>要素に対して<dd><p><code id=the-noscript-element:the-noscript-element-8><a href=#the-noscript-element>noscript</a></code>要素は、テキストのみを含まなければならない。ただし、<var id=the-noscript-element:concept-frag-parse-context><a href=syntax.html#concept-frag-parse-context>context</a></var>要素として<code id=the-noscript-element:the-noscript-element-9><a href=#the-noscript-element>noscript</a></code>要素をもつ<a id=the-noscript-element:html-fragment-parsing-algorithm href=syntax.html#html-fragment-parsing-algorithm>HTML断片解析アルゴリズム</a>を呼び出すものかつ<var>input</var>のようなテキストコンテンツが<code id=the-noscript-element:the-noscript-element-10><a href=#the-noscript-element>noscript</a></code>要素の子であった場合、<code id=the-noscript-element:the-link-element-3><a href=semantics.html#the-link-element>link</a></code>、<code id=the-noscript-element:the-style-element-3><a href=semantics.html#the-style-element>style</a></code>、<code id=the-noscript-element:the-meta-element-3><a href=semantics.html#the-meta-element>meta</a></code>要素のみからなるノードのリストをもたらさなければならない場合を除く。そして<a href=syntax.html#parse-error id=the-noscript-element:parse-error>解析エラー</a>でない。<dt><a href=webappapis.html#concept-n-noscript id=the-noscript-element:concept-n-noscript-5>スクリプトが無効である</a>場合、<code id=the-noscript-element:the-head-element-6><a href=semantics.html#the-head-element>head</a></code>要素外の<code id=the-noscript-element:the-noscript-element-11><a href=#the-noscript-element>noscript</a></code>要素に対して<dd><p><code id=the-noscript-element:the-noscript-element-12><a href=#the-noscript-element>noscript</a></code>要素のコンテンツモデルは<a id=the-noscript-element:transparent-2 href=dom.html#transparent>透過的</a>であり、同時に<code id=the-noscript-element:the-noscript-element-13><a href=#the-noscript-element>noscript</a></code>要素が<code id=the-noscript-element:the-noscript-element-14><a href=#the-noscript-element>noscript</a></code>要素を持ってはならない（<code id=the-noscript-element:the-noscript-element-15><a href=#the-noscript-element>noscript</a></code>要素を入れ子にできない）追加制限がある。<dt><a href=webappapis.html#concept-n-script id=the-noscript-element:concept-n-script-3>スクリプトが有効である</a>場合、<code id=the-noscript-element:the-head-element-7><a href=semantics.html#the-head-element>head</a></code>要素外の<code id=the-noscript-element:the-noscript-element-16><a href=#the-noscript-element>noscript</a></code>要素に対して<dd>

    <p><code id=the-noscript-element:the-noscript-element-17><a href=#the-noscript-element>noscript</a></code>要素はテキストのみを含まなければならない。ただしテキストは、以下のアルゴリズムが<code id=the-noscript-element:the-noscript-element-18><a href=#the-noscript-element>noscript</a></code>要素および<code id=the-noscript-element:the-script-element><a href=#the-script-element>script</a></code>要素をもたない適合文書をもたらすものでなければならず、アルゴリズムでステップは例外を投げるまたは<a id=the-noscript-element:html-parser href=syntax.html#html-parser>HTMLパーサ</a>に<a id=the-noscript-element:parse-error-2 href=syntax.html#parse-error>解析エラー</a>を起こさないようにしなければならない：</p>
    

    <ol><li>文書からすべての<code id=the-noscript-element:the-script-element-2><a href=#the-script-element>script</a></code>要素を取り除く。</li><li>文書においてすべての<code id=the-noscript-element:the-noscript-element-19><a href=#the-noscript-element>noscript</a></code>要素のリストを作る。そのリストの各<code id=the-noscript-element:the-noscript-element-20><a href=#the-noscript-element>noscript</a></code>要素に対して、以下のステップを実行する：

      <ol><li><var>s</var>を<code id=the-noscript-element:the-noscript-element-21><a href=#the-noscript-element>noscript</a></code>要素要素の<a id=the-noscript-element:child-text-content href=infrastructure.html#child-text-content>子テキストコンテンツ</a>とする。</li><li><code id=the-noscript-element:the-noscript-element-22><a href=#the-noscript-element>noscript</a></code>要素の<code id=the-noscript-element:dom-outerhtml><a data-x-internal=dom-outerhtml href=https://w3c.github.io/DOM-Parsing/#widl-Element-outerHTML>outerHTML</a></code>属性を<var>s</var>の値に設定する。（これは、副作用として<code id=the-noscript-element:the-noscript-element-23><a href=#the-noscript-element>noscript</a></code>要素を文書から除去させる。）<a href=references.html#refsDOMPARSING>[DOMPARSING]</a></li></ol>

     </li></ol>

   </dl>

  <p class=note>歴史的な理由により、パーサが呼び出されたときに<a href=syntax.html#scripting-flag id=the-noscript-element:scripting-flag>スクリプトが有効にされたかどうか</a>に基づく<a id=the-noscript-element:html-parser-2 href=syntax.html#html-parser>HTMLパーサ</a>によって<code id=the-noscript-element:the-noscript-element-24><a href=#the-noscript-element>noscript</a></code>要素が異なる方法で処理されるので、これらのすべてのこじつけが必要とされる。</p>

  <p><code id=the-noscript-element:the-noscript-element-25><a href=#the-noscript-element>noscript</a></code>は<a id=the-noscript-element:xml-documents href=https://triple-underscore.github.io/DOM4-ja.html#xml-document data-x-internal=xml-documents>XML文書</a>で使用してはならない。</p>

  <p class=note>The <code id=the-noscript-element:the-noscript-element-26><a href=#the-noscript-element>noscript</a></code> element is only effective in <a id=the-noscript-element:syntax href=syntax.html#syntax>the HTML syntax</a>, it has no effect in <a id=the-noscript-element:the-xhtml-syntax href=xhtml.html#the-xhtml-syntax>the XML syntax</a>. スクリプトが有効である場合、この要素が動作する方法は、基本的にパーサを"オフ"にすることであり、要素の内容は、実際の要素としてではなく純粋にテキストとして扱われているのである。XMLは、これを実行するためのメカニズムを定義しない。</p>

  

  <p>The <code id=the-noscript-element:the-noscript-element-27><a href=#the-noscript-element>noscript</a></code> element has no other requirements. In particular, children of the
  <code id=the-noscript-element:the-noscript-element-28><a href=#the-noscript-element>noscript</a></code> element are not exempt from <a id=the-noscript-element:form-submission-2 href=forms.html#form-submission-2>form submission</a>, scripting, and so
  forth, even when <a href=webappapis.html#concept-n-script id=the-noscript-element:concept-n-script-4>scripting is enabled</a> for the element.</p>

  

  <div class=example>

   <p>次の例において、<code id=the-noscript-element:the-noscript-element-29><a href=#the-noscript-element>noscript</a></code>要素は、スクリプトのフォールバックを提供するために使用される。</p>

   <pre>&lt;form action="calcSquare.php"&gt;
 &lt;p&gt;
  &lt;label for=x&gt;Number&lt;/label&gt;:
  &lt;input id="x" name="x" type="number"&gt;
 &lt;/p&gt;
 &lt;script&gt;
  var x = document.getElementById('x');
  var output = document.createElement('p');
  output.textContent = 'Type a number; it will be squared right then!';
  x.form.appendChild(output);
  x.form.onsubmit = function () { return false; }
  x.oninput = function () {
    var v = x.valueAsNumber;
    output.textContent = v + ' squared is ' + v * v;
  };
 &lt;/script&gt;
 &lt;noscript&gt;
  &lt;input type=submit value="Calculate Square"&gt;
 &lt;/noscript&gt;
&lt;/form&gt;</pre>

   <p>スクリプトが無効である場合、ボタンは、サーバー側で計算を行うために表示される。スクリプトが有効である場合、代わりに値がその場で計算される。</p>

   <p><code id=the-noscript-element:the-noscript-element-30><a href=#the-noscript-element>noscript</a></code>要素は鈍器である。時には、スクリプトを有効にするかもしれないが、何らかの理由でページのスクリプトが失敗するかもしれない。このような理由から、次の例のように、<code id=the-noscript-element:the-noscript-element-31><a href=#the-noscript-element>noscript</a></code>要素の使用を避ける代わりに、その場でスクリプトのないページからスクリプト化されたページにページを変更するスクリプトを設計することが一般により良い：</p>

   <pre>&lt;form action="calcSquare.php"&gt;
 &lt;p&gt;
  &lt;label for=x&gt;Number&lt;/label&gt;:
  &lt;input id="x" name="x" type="number"&gt;
 &lt;/p&gt;
 <strong>&lt;input id="submit" type=submit value="Calculate Square"&gt;</strong>
 &lt;script&gt;
  var x = document.getElementById('x');
  var output = document.createElement('p');
  output.textContent = 'Type a number; it will be squared right then!';
  x.form.appendChild(output);
  x.form.onsubmit = function () { return false; }
  x.oninput = function () {
    var v = x.valueAsNumber;
    output.textContent = v + ' squared is ' + v * v;
  };
<strong>  var submit = document.getElementById('submit');
  submit.parentNode.removeChild(submit);</strong>
 &lt;/script&gt;
&lt;/form&gt;</pre>

   <p>The above technique is also useful in <a id=the-noscript-element:xml-documents-2 href=https://triple-underscore.github.io/DOM4-ja.html#xml-document data-x-internal=xml-documents>XML documents</a>, since <code id=the-noscript-element:the-noscript-element-32><a href=#the-noscript-element>noscript</a></code>
   is not allowed there.</p>

  </div>


  <h4 id=the-template-element>4.12.3 <dfn><code>template</code></dfn>要素<a href=#the-template-element class=self-link></a></h4><div class=status><input onclick=toggleStatus(this) value=⋰ type=button><p class=support><strong>Support:</strong> template<span class="and_chr yes"><span>Chrome for Android</span> <span>57+</span></span><span class="chrome yes"><span>Chrome</span> <span>26+</span></span><span class="and_uc no"><span>UC Browser for Android</span> <span>None</span></span><span class="ios_saf yes"><span>iOS Safari</span> <span>8+</span></span><span class="firefox yes"><span>Firefox</span> <span>22+</span></span><span class="ie no"><span>IE</span> <span>None</span></span><span class="samsung yes"><span>Samsung Internet</span> <span>4+</span></span><span class="op_mini no"><span>Opera Mini</span> <span>None</span></span><span class="android yes"><span>Android Browser</span> <span>4.4+</span></span><span class="safari yes"><span>Safari</span> <span>7.1+</span></span><span class="edge yes"><span>Edge</span> <span>13+</span></span><span class="opera yes"><span>Opera</span> <span>15+</span></span><p class=caniuse>Source: <a href="http://caniuse.com/#feat=template">caniuse.com</a></div>

  <dl class=element><dt><a href=dom.html#concept-element-categories id=the-template-element:concept-element-categories>カテゴリー</a>：<dd><a id=the-template-element:metadata-content-2 href=dom.html#metadata-content-2>メタデータコンテンツ</a>。<dd><a id=the-template-element:flow-content-2 href=dom.html#flow-content-2>フローコンテンツ</a>。<dd><a id=the-template-element:phrasing-content-2 href=dom.html#phrasing-content-2>フレージングコンテンツ</a>。<dd><a href=dom.html#script-supporting-elements-2 id=the-template-element:script-supporting-elements-2>スクリプトサポート要素</a>。<dt><a href=dom.html#concept-element-contexts id=the-template-element:concept-element-contexts>この要素を使用できるコンテキスト</a>：<dd><a id=the-template-element:metadata-content-2-2 href=dom.html#metadata-content-2>メタデータコンテンツ</a>が期待される場所。<dd><a id=the-template-element:phrasing-content-2-2 href=dom.html#phrasing-content-2>フレージングコンテンツ</a>が期待される場所。<dd><a id=the-template-element:script-supporting-elements-2-2 href=dom.html#script-supporting-elements-2>スクリプトサポート要素</a>が期待される場所。<dd><code id=the-template-element:attr-colgroup-span><a href=tables.html#attr-colgroup-span>span</a></code>属性を持たない<code id=the-template-element:the-colgroup-element><a href=tables.html#the-colgroup-element>colgroup</a></code>要素の子として。<dt><a href=dom.html#concept-element-content-model id=the-template-element:concept-element-content-model>コンテンツモデル</a>：<dd><a href=dom.html#concept-content-nothing id=the-template-element:concept-content-nothing>Nothing</a>。<dt><a href=dom.html#concept-element-tag-omission id=the-template-element:concept-element-tag-omission>text/htmlにおけるタグ省略</a>：<dd>どちらのタグも省略不可。<dt><a href=dom.html#concept-element-attributes id=the-template-element:concept-element-attributes>コンテンツ属性</a>：<dd><a id=the-template-element:global-attributes href=dom.html#global-attributes>グローバル属性</a><dt><a href=dom.html#concept-element-dom id=the-template-element:concept-element-dom>DOMインターフェイス</a>：<dd>
<pre class=idl>[<a id=the-template-element:htmlconstructor href=dom.html#htmlconstructor>HTMLConstructor</a>]
interface <dfn id=htmltemplateelement>HTMLTemplateElement</dfn> : <a id=the-template-element:htmlelement href=dom.html#htmlelement>HTMLElement</a> {
  readonly attribute <a id=the-template-element:documentfragment href=https://triple-underscore.github.io/DOM4-ja.html#interface-documentfragment data-x-internal=documentfragment>DocumentFragment</a> <a href=#dom-template-content id=the-template-element:dom-template-content>content</a>;
};</pre>
</dl>

  <p><code id=the-template-element:the-template-element><a href=#the-template-element>template</a></code>要素は、複製され、スクリプトによって文書に挿入できるHTMLの断片を宣言するために使用される。</p>

  <p>レンダリングにおいて、<code id=the-template-element:the-template-element-2><a href=#the-template-element>template</a></code>要素は何も<a id=the-template-element:represents href=dom.html#represents>表さ</a>ない。</p>

  <p>The <a href=#template-contents id=the-template-element:template-contents>template contents</a> of a <code id=the-template-element:the-template-element-3><a href=#the-template-element>template</a></code> element are not children of the
  element itself. Instead, they are stored in a <code id=the-template-element:documentfragment-2><a data-x-internal=documentfragment href=https://triple-underscore.github.io/DOM4-ja.html#interface-documentfragment>DocumentFragment</a></code> associated with a
  different <code id=the-template-element:document><a href=dom.html#document>Document</a></code> without a <a id=the-template-element:browsing-context href=browsers.html#browsing-context>browsing context</a> so as to avoid the
  <code id=the-template-element:the-template-element-4><a href=#the-template-element>template</a></code> contents interfering with the main <code id=the-template-element:document-2><a href=dom.html#document>Document</a></code>. (For example, this
  avoids form controls from being submitted, scripts from executing, and so forth.) The
  <a href=#template-contents id=the-template-element:template-contents-2>template contents</a> have <a href=dom.html#no-browsing-context>no conformance
  requirements</a>.</p>

  <div class=example>

   <p>For example, consider the following document:</p>

   

   <pre>&lt;!doctype html&gt;
&lt;html lang="en"&gt;
 &lt;head&gt;
  &lt;title&gt;Homework&lt;/title&gt;
 &lt;body&gt;
  &lt;template id="template"&gt;&lt;p&gt;Smile!&lt;/p&gt;&lt;/template&gt;
  &lt;script&gt;
   let num = 3;
   const fragment = document.getElementById('template').content.cloneNode(true);
   while (num-- &gt; 1) {
     fragment.firstChild.before(fragment.firstChild.cloneNode(true));
     fragment.firstChild.textContent += fragment.lastChild.textContent;
   }
   document.body.appendChild(fragment);
  &lt;/script&gt;
&lt;/html&gt;</pre>

   <p>The <code id=the-template-element:the-p-element><a href=semantics.html#the-p-element>p</a></code> element in the <code id=the-template-element:the-template-element-5><a href=#the-template-element>template</a></code> is <em>not</em> a child of the
   <code id=the-template-element:the-template-element-6><a href=#the-template-element>template</a></code> in the DOM; it is a child of the <code id=the-template-element:documentfragment-3><a data-x-internal=documentfragment href=https://triple-underscore.github.io/DOM4-ja.html#interface-documentfragment>DocumentFragment</a></code> returned by
   the <code id=the-template-element:the-template-element-7><a href=#the-template-element>template</a></code> element's <code id=the-template-element:dom-template-content-2><a href=#dom-template-content>content</a></code> IDL
   attribute.</p>

   <p>If the script were to call <code id=the-template-element:dom-node-appendchild><a data-x-internal=dom-node-appendchild href=https://triple-underscore.github.io/DOM4-ja.html#dom-node-appendchild>appendChild()</a></code> on the
   <code id=the-template-element:the-template-element-8><a href=#the-template-element>template</a></code> element, that would add a child to the <code id=the-template-element:the-template-element-9><a href=#the-template-element>template</a></code> element (as
   for any other element); however, doing so is a violation of the <code id=the-template-element:the-template-element-10><a href=#the-template-element>template</a></code> element's
   content model.</p>

  </div>

  <dl class=domintro><dt><var>template</var> . <code id=the-template-element:dom-template-content-3><a href=#dom-template-content>content</a></code><dd>

    <p>Returns the <a href=#template-contents id=the-template-element:template-contents-3>template contents</a> (a <code id=the-template-element:documentfragment-4><a data-x-internal=documentfragment href=https://triple-underscore.github.io/DOM4-ja.html#interface-documentfragment>DocumentFragment</a></code>).</p>

   </dl>

  

  <p>Each <code id=the-template-element:the-template-element-11><a href=#the-template-element>template</a></code> element has an associated <code id=the-template-element:documentfragment-5><a data-x-internal=documentfragment href=https://triple-underscore.github.io/DOM4-ja.html#interface-documentfragment>DocumentFragment</a></code> object that
  is its <dfn id=template-contents>template contents</dfn>. When a <code id=the-template-element:the-template-element-12><a href=#the-template-element>template</a></code> element is created, the user
  agent must run the following steps to establish the <a href=#template-contents id=the-template-element:template-contents-4>template contents</a>:</p>

  <ol><li><p>Let <var>doc</var> be the <code id=the-template-element:the-template-element-13><a href=#the-template-element>template</a></code> element's <a id=the-template-element:node-document href=https://triple-underscore.github.io/DOM4-ja.html#concept-node-document data-x-internal=node-document>node document</a>'s <a href=#appropriate-template-contents-owner-document id=the-template-element:appropriate-template-contents-owner-document>appropriate template contents owner
   document</a>.</li><li><p>Create a <code id=the-template-element:documentfragment-6><a data-x-internal=documentfragment href=https://triple-underscore.github.io/DOM4-ja.html#interface-documentfragment>DocumentFragment</a></code> object whose <a id=the-template-element:node-document-2 href=https://triple-underscore.github.io/DOM4-ja.html#concept-node-document data-x-internal=node-document>node document</a> is
   <var>doc</var> and <a href=https://triple-underscore.github.io/DOM4-ja.html#concept-documentfragment-host id=the-template-element:concept-documentfragment-host data-x-internal=concept-documentfragment-host>host</a> is the
   <code id=the-template-element:the-template-element-14><a href=#the-template-element>template</a></code> element.</li><li><p>Set the <code id=the-template-element:the-template-element-15><a href=#the-template-element>template</a></code> element's <a href=#template-contents id=the-template-element:template-contents-5>template contents</a> to the newly
   created <code id=the-template-element:documentfragment-7><a data-x-internal=documentfragment href=https://triple-underscore.github.io/DOM4-ja.html#interface-documentfragment>DocumentFragment</a></code> object.</li></ol>

  <p>A <code id=the-template-element:document-3><a href=dom.html#document>Document</a></code> <var>doc</var>'s <dfn id=appropriate-template-contents-owner-document>appropriate template contents owner
  document</dfn> is the <code id=the-template-element:document-4><a href=dom.html#document>Document</a></code> returned by the following algorithm:</p>

  <ol><li>

    <p>If <var>doc</var> is not a <code id=the-template-element:document-5><a href=dom.html#document>Document</a></code> created by this algorithm, then:</p>

    <ol><li>

      <p>If <var>doc</var> does not yet have an <dfn id=associated-inert-template-document>associated inert template document</dfn>,
      then:</p>

      <ol><li><p>Let <var>new doc</var> be a new <code id=the-template-element:document-6><a href=dom.html#document>Document</a></code> (that does not have a
       <a href=browsers.html#concept-document-bc id=the-template-element:concept-document-bc>browsing context</a>). This is "a
       <code id=the-template-element:document-7><a href=dom.html#document>Document</a></code> created by this algorithm" for the purposes of the step
       above.</li><li><p>If <var>doc</var> is an <a href=https://triple-underscore.github.io/DOM4-ja.html#html-document id=the-template-element:html-documents data-x-internal=html-documents>HTML document</a>, mark
       <var>new doc</var> as an <a href=https://triple-underscore.github.io/DOM4-ja.html#html-document id=the-template-element:html-documents-2 data-x-internal=html-documents>HTML document</a>
       also.</li><li><p>Let <var>doc</var>'s <a href=#associated-inert-template-document id=the-template-element:associated-inert-template-document>associated inert template document</a> be <var>new doc</var>.</li></ol>

     </li><li><p>Set <var>doc</var> to <var>doc</var>'s <a href=#associated-inert-template-document id=the-template-element:associated-inert-template-document-2>associated inert
     template document</a>.</li></ol>

    <p class=note>Each <code id=the-template-element:document-8><a href=dom.html#document>Document</a></code> not created by this algorithm thus gets a single
    <code id=the-template-element:document-9><a href=dom.html#document>Document</a></code> to act as its proxy for owning the <a href=#template-contents id=the-template-element:template-contents-6>template contents</a> of all
    its <code id=the-template-element:the-template-element-16><a href=#the-template-element>template</a></code> elements, so that they aren't in a <a id=the-template-element:browsing-context-2 href=browsers.html#browsing-context>browsing context</a> and
    thus remain inert (e.g. scripts do not run). Meanwhile, <code id=the-template-element:the-template-element-17><a href=#the-template-element>template</a></code> elements inside
    <code id=the-template-element:document-10><a href=dom.html#document>Document</a></code> objects that <em>are</em> created by this algorithm just reuse the same
    <code id=the-template-element:document-11><a href=dom.html#document>Document</a></code> owner for their contents.</p>

   </li><li><p>Return <var>doc</var>.</li></ol>

  <p id=template-adopting-steps>The <a href=https://triple-underscore.github.io/DOM4-ja.html#concept-node-adopt-ext id=the-template-element:concept-node-adopt-ext data-x-internal=concept-node-adopt-ext>adopting steps</a>
  (with <var>node</var> and <var>oldDocument</var> as parameters) for <code id=the-template-element:the-template-element-18><a href=#the-template-element>template</a></code> elements
  are the following:</p>

  <ol><li>

    <p>Let <var>doc</var> be <var>node</var>'s <a id=the-template-element:node-document-3 href=https://triple-underscore.github.io/DOM4-ja.html#concept-node-document data-x-internal=node-document>node document</a>'s
    <a href=#appropriate-template-contents-owner-document id=the-template-element:appropriate-template-contents-owner-document-2>appropriate template contents owner document</a>.</p>

    <p class=note><var>node</var>'s <a id=the-template-element:node-document-4 href=https://triple-underscore.github.io/DOM4-ja.html#concept-node-document data-x-internal=node-document>node document</a> is the <code id=the-template-element:document-12><a href=dom.html#document>Document</a></code> object
    that <var>node</var> was just adopted <em>into</em>.</p>

   </li><li><p><a href=https://triple-underscore.github.io/DOM4-ja.html#concept-node-adopt id=the-template-element:concept-node-adopt data-x-internal=concept-node-adopt>Adopt</a> <var>node</var>'s
   <a href=#template-contents id=the-template-element:template-contents-7>template contents</a> (a <code id=the-template-element:documentfragment-8><a data-x-internal=documentfragment href=https://triple-underscore.github.io/DOM4-ja.html#interface-documentfragment>DocumentFragment</a></code> object) into <var>doc</var>.</li></ol>

  <p>The <dfn id=dom-template-content><code>content</code></dfn> IDL attribute must return the
  <code id=the-template-element:the-template-element-19><a href=#the-template-element>template</a></code> element's <a href=#template-contents id=the-template-element:template-contents-8>template contents</a>.</p>

  <hr>

  <p>The <a href=https://triple-underscore.github.io/DOM4-ja.html#concept-node-clone-ext id=the-template-element:concept-node-clone-ext data-x-internal=concept-node-clone-ext>cloning steps</a> for a <code id=the-template-element:the-template-element-20><a href=#the-template-element>template</a></code>
  element <var>node</var> being cloned to a copy <var>copy</var> must run the
  following steps:</p>

  <ol><li><p>If the <var>clone children flag</var> is not set in the calling <a href=https://triple-underscore.github.io/DOM4-ja.html#concept-node-clone id=the-template-element:concept-node-clone data-x-internal=concept-node-clone>clone</a> algorithm, abort these steps.</li><li><p>Let <var>copied contents</var> be the result of <a href=https://triple-underscore.github.io/DOM4-ja.html#concept-node-clone id=the-template-element:concept-node-clone-2 data-x-internal=concept-node-clone>cloning</a> all the children of <var>node</var>'s
   <a href=#template-contents id=the-template-element:template-contents-9>template contents</a>, with <var>document</var> set to <var>copy</var>'s <a href=#template-contents id=the-template-element:template-contents-10>template contents</a>'s <a id=the-template-element:node-document-5 href=https://triple-underscore.github.io/DOM4-ja.html#concept-node-document data-x-internal=node-document>node
   document</a>, and with the <var>clone children
   flag</var> set.</li><li><p>Append <var>copied contents</var> to <var>copy</var>'s <a href=#template-contents id=the-template-element:template-contents-11>template
   contents</a>.</li></ol>

  

  <div class=example>

   <p>この例において、スクリプトは、手動でマークアップから構造を生成する代わりに要素構造を提供するために<code id=the-template-element:the-template-element-21><a href=#the-template-element>template</a></code>を使用して、データ構造からデータをもつテーブル4列に投入する。</p>

   <pre>&lt;!DOCTYPE html&gt;
&lt;html lang='en'&gt;
&lt;title&gt;Cat data&lt;/title&gt;
&lt;script&gt;
 // Data is hard-coded here, but could come from the server
 var data = [
   { name: 'Pillar', color: 'Ticked Tabby', sex: 'Female (neutered)', legs: 3 },
   { name: 'Hedral', color: 'Tuxedo', sex: 'Male (neutered)', legs: 4 },
 ];
&lt;/script&gt;
&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th&gt;Name &lt;th&gt;Color &lt;th&gt;Sex &lt;th&gt;Legs
 &lt;tbody&gt;
  &lt;template id="row"&gt;
   &lt;tr&gt;&lt;td&gt;&lt;td&gt;&lt;td&gt;&lt;td&gt;
  &lt;/template&gt;
&lt;/table&gt;
&lt;script&gt;
 var template = document.querySelector('#row');
 for (var i = 0; i &lt; data.length; i += 1) {
   var cat = data[i];
   var clone = template.content.cloneNode(true);
   var cells = clone.querySelectorAll('td');
   cells[0].textContent = cat.name;
   cells[1].textContent = cat.color;
   cells[2].textContent = cat.sex;
   cells[3].textContent = cat.legs;
   template.parentNode.appendChild(clone);
 }
&lt;/script&gt;</pre>

   <p>この例は、<code id=the-template-element:the-template-element-22><a href=#the-template-element>template</a></code>のコンテンツに<code id=the-template-element:dom-node-clonenode><a data-x-internal=dom-node-clonenode href=https://triple-underscore.github.io/DOM4-ja.html#dom-node-clonenode>cloneNode()</a></code>を使用する。それは、同じことをする<code id=the-template-element:dom-document-importnode><a data-x-internal=dom-document-importnode href=https://triple-underscore.github.io/DOM4-ja.html#dom-document-importnode>document.importNode()</a></code>を等価的に使用することもできる。<a id=the-template-element:node-document-6 href=https://triple-underscore.github.io/DOM4-ja.html#concept-node-document data-x-internal=node-document>ノード文書</a>が更新される際に、この2つのAPIの唯一の違いがある。ノードが<code id=the-template-element:dom-node-appendchild-2><a data-x-internal=dom-node-appendchild href=https://triple-underscore.github.io/DOM4-ja.html#dom-node-appendchild>appendChild()</a></code>で付加される場合に<code id=the-template-element:dom-node-clonenode-2><a data-x-internal=dom-node-clonenode href=https://triple-underscore.github.io/DOM4-ja.html#dom-node-clonenode>cloneNode()</a></code>とともに更新され、ノードがクローン化される際に、<code id=the-template-element:dom-document-importnode-2><a data-x-internal=dom-document-importnode href=https://triple-underscore.github.io/DOM4-ja.html#dom-document-importnode>document.importNode()</a></code>とともに更新される。</p>

  </div>



  

  <h5 id=template-XSLT-XPath>4.12.3.1 Interaction of <code id=template-XSLT-XPath:the-template-element><a href=#the-template-element>template</a></code> elements with XSLT and XPath<a href=#template-XSLT-XPath class=self-link></a></h5>

  <p><i>この節は非規範的である。</i></p>

  <p>This specification does not define how XSLT and XPath interact with the <code id=template-XSLT-XPath:the-template-element-2><a href=#the-template-element>template</a></code>
  element. However, in the absence of another specification actually defining this, here are some
  guidelines for implementors, which are intended to be consistent with other processing described
  in this specification:</p>

  <ul><li><p>An XSLT processor based on an XML parser that acts <a href=xhtml.html#xml-parser id=template-XSLT-XPath:xml-parser>as described
   in this specification</a> needs to act as if <code id=template-XSLT-XPath:the-template-element-3><a href=#the-template-element>template</a></code> elements contain as
   descendants their <a href=#template-contents id=template-XSLT-XPath:template-contents>template contents</a> for the purposes of the transform.</li><li><p>An XSLT processor that outputs a DOM needs to ensure that nodes that would go into a
   <code id=template-XSLT-XPath:the-template-element-4><a href=#the-template-element>template</a></code> element are instead placed into the element's <a href=#template-contents id=template-XSLT-XPath:template-contents-2>template
   contents</a>.</li><li><p>XPath evaluation using the XPath DOM API when applied to a <code id=template-XSLT-XPath:document><a href=dom.html#document>Document</a></code> parsed
   using the <a id=template-XSLT-XPath:html-parser href=syntax.html#html-parser>HTML parser</a> or the <a id=template-XSLT-XPath:xml-parser-2 href=xhtml.html#xml-parser>XML parser</a> described in this specification
   needs to ignore <a href=#template-contents id=template-XSLT-XPath:template-contents-3>template contents</a>.</p>

  </li></ul>

  



  <h4 id=the-slot-element>4.12.4 <dfn><code>slot</code></dfn>要素<a href=#the-slot-element class=self-link></a></h4>

  <dl class=element><dt><a href=dom.html#concept-element-categories id=the-slot-element:concept-element-categories>カテゴリー</a>：<dd><a id=the-slot-element:flow-content-2 href=dom.html#flow-content-2>フローコンテンツ</a>。<dd><a id=the-slot-element:phrasing-content-2 href=dom.html#phrasing-content-2>フレージングコンテンツ</a>。<dt><a href=dom.html#concept-element-contexts id=the-slot-element:concept-element-contexts>この要素を使用できるコンテキスト</a>：<dd><a id=the-slot-element:phrasing-content-2-2 href=dom.html#phrasing-content-2>フレージングコンテンツ</a>が期待される場所。<dt><a href=dom.html#concept-element-content-model id=the-slot-element:concept-element-content-model>コンテンツモデル</a>：<dd><a id=the-slot-element:transparent href=dom.html#transparent>透過的</a><dt><a href=dom.html#concept-element-tag-omission id=the-slot-element:concept-element-tag-omission>text/htmlにおけるタグ省略</a>：<dd>どちらのタグも省略不可。<dt><a href=dom.html#concept-element-attributes id=the-slot-element:concept-element-attributes>コンテンツ属性</a>：<dd><a id=the-slot-element:global-attributes href=dom.html#global-attributes>グローバル属性</a><dd><code id=the-slot-element:attr-slot-name><a href=#attr-slot-name>name</a></code> — シャドウツリースロットの名前<dt><a href=dom.html#concept-element-dom id=the-slot-element:concept-element-dom>DOMインターフェイス</a>：<dd>
<pre class=idl>[<a id=the-slot-element:htmlconstructor href=dom.html#htmlconstructor>HTMLConstructor</a>]
interface <dfn id=htmlslotelement>HTMLSlotElement</dfn> : <a id=the-slot-element:htmlelement href=dom.html#htmlelement>HTMLElement</a> {
  [<a href=#cereactions id=the-slot-element:cereactions>CEReactions</a>] attribute DOMString <a href=#dom-slot-name id=the-slot-element:dom-slot-name>name</a>;
  sequence&lt;Node&gt; <a href=#dom-slot-assignednodes id=the-slot-element:dom-slot-assignednodes>assignedNodes</a>(optional <a href=#assignednodesoptions id=the-slot-element:assignednodesoptions>AssignedNodesOptions</a> options);
};

dictionary <dfn id=assignednodesoptions>AssignedNodesOptions</dfn> {
  boolean flatten = false;
};</pre>
   </dl>

  <p><code id=the-slot-element:the-slot-element><a href=#the-slot-element>slot</a></code>要素は、<a href=https://triple-underscore.github.io/DOM4-ja.html#concept-slot id=the-slot-element:concept-slot data-x-internal=concept-slot>スロット</a>を定義する。典型的に<a id=the-slot-element:shadow-tree href=https://triple-underscore.github.io/DOM4-ja.html#concept-shadow-tree data-x-internal=shadow-tree>シャドウツリー</a>に使用される。もしあれば、<code id=the-slot-element:the-slot-element-2><a href=#the-slot-element>slot</a></code>要素はその<a id=the-slot-element:assigned-nodes href=https://triple-underscore.github.io/DOM4-ja.html#slot-assigned-nodes data-x-internal=assigned-nodes>割り当てられるノード</a>を<a id=the-slot-element:represents href=dom.html#represents>表し</a>、そうでなければそのコンテンツを表す。</p>

  <p><dfn id=attr-slot-name><code>name</code></dfn>コンテンツ属性は、任意の文字列値を含んでもよい。これは<a href=https://triple-underscore.github.io/DOM4-ja.html#concept-slot id=the-slot-element:concept-slot-2 data-x-internal=concept-slot>スロット</a>の<a href=https://triple-underscore.github.io/DOM4-ja.html#slot-name id=the-slot-element:slot-name data-x-internal=slot-name>名前</a>を表す。</p>

  <p class=note>The <code id=the-slot-element:attr-slot-name-2><a href=#attr-slot-name>name</a></code> attribute is used to <a href=https://dom.spec.whatwg.org/#assign-a-slot id=the-slot-element:assign-a-slot data-x-internal=assign-a-slot>assign slots</a> to other elements: a <code id=the-slot-element:the-slot-element-3><a href=#the-slot-element>slot</a></code> element with a
  <code id=the-slot-element:attr-slot-name-3><a href=#attr-slot-name>name</a></code> attribute creates a named <a href=https://triple-underscore.github.io/DOM4-ja.html#concept-slot id=the-slot-element:concept-slot-3 data-x-internal=concept-slot>slot</a> to which any element is <a href=https://dom.spec.whatwg.org/#assign-a-slot id=the-slot-element:assign-a-slot-2 data-x-internal=assign-a-slot>assigned</a> if that element has a <code id=the-slot-element:attr-slot><a href=dom.html#attr-slot>slot</a></code> attribute whose
  value matches that <code id=the-slot-element:attr-slot-name-4><a href=#attr-slot-name>name</a></code> attribute's value, and the
  <code id=the-slot-element:the-slot-element-4><a href=#the-slot-element>slot</a></code> element is a child of the <a id=the-slot-element:shadow-tree-2 href=https://triple-underscore.github.io/DOM4-ja.html#concept-shadow-tree data-x-internal=shadow-tree>shadow tree</a> whose <a id=the-slot-element:root href=https://triple-underscore.github.io/DOM4-ja.html#concept-tree-root data-x-internal=root>root</a>'s
  <a href=https://triple-underscore.github.io/DOM4-ja.html#concept-documentfragment-host id=the-slot-element:concept-documentfragment-host data-x-internal=concept-documentfragment-host>host</a> has that corresponding <code id=the-slot-element:attr-slot-2><a href=dom.html#attr-slot>slot</a></code> attribute value.</p>

  <dl class=domintro><dt><var>slot</var> . <code id=the-slot-element:dom-slot-name-2><a href=#dom-slot-name>name</a></code><dd><var>slot</var>の<a href=https://triple-underscore.github.io/DOM4-ja.html#slot-name id=the-slot-element:slot-name-2 data-x-internal=slot-name>名前</a>を取得し設定することが可能である。<dt><var>slot</var> . <code id=the-slot-element:dom-slot-assignednodes-2><a href=#dom-slot-assignednodes>assignedNodes</a></code>()<dd><var>slot</var>の<a id=the-slot-element:assigned-nodes-2 href=https://triple-underscore.github.io/DOM4-ja.html#slot-assigned-nodes data-x-internal=assigned-nodes>割り当てられるノード</a>を返す。<dt><var>slot</var> . <code id=the-slot-element:dom-slot-assignednodes-3><a href=#dom-slot-assignednodes>assignedNodes</a></code>({ flatten: true })<dd>もしあれば、<var>slot</var>の<a id=the-slot-element:assigned-nodes-3 href=https://triple-underscore.github.io/DOM4-ja.html#slot-assigned-nodes data-x-internal=assigned-nodes>割り当てられるノード</a>を返し、そうでなければ<var>slot</var>の子を返し、かつ<code id=the-slot-element:the-slot-element-6><a href=#the-slot-element>slot</a></code>要素が存在しなくなるまで、再帰的に、<code id=the-slot-element:the-slot-element-5><a href=#the-slot-element>slot</a></code>要素に遭遇するのと同じものを返す。</dl>

  <p><dfn id=dom-slot-name><code>name</code></dfn> IDL属性は、同じ名前のコンテンツ属性を<a id=the-slot-element:reflect href=infrastructure.html#reflect>反映</a>しなければならない。</p>

  <p>呼び出される場合、<dfn id=dom-slot-assignednodes><code>assignedNodes(<var>options</var>)</code></dfn>メソッドは次の手順を実行しなければならない：</p>

  <ol><li><p><var>options</var>の<code>flatten</code>メンバーの値がfalseである場合、この要素の<a id=the-slot-element:assigned-nodes-4 href=https://triple-underscore.github.io/DOM4-ja.html#slot-assigned-nodes data-x-internal=assigned-nodes>割り当てられたノード</a>を返す。</li><li><p>この要素をもつ<a id=the-slot-element:finding-flattened-slotables href=https://triple-underscore.github.io/DOM4-ja.html#find-flattened-slotables data-x-internal=finding-flattened-slotables>finding flattened slotables</a>の結果を返す。</li></ol>



  <h4 id=the-canvas-element>4.12.5 <dfn id=canvas><code>canvas</code></dfn>要素<a href=#the-canvas-element class=self-link></a></h4><div class=status><input onclick=toggleStatus(this) value=⋰ type=button><p class=support><strong>Support:</strong> canvas<span class="and_chr yes"><span>Chrome for Android</span> <span>57+</span></span><span class="chrome yes"><span>Chrome</span> <span>4+</span></span><span class="and_uc yes"><span>UC Browser for Android</span> <span>11+</span></span><span class="ios_saf yes"><span>iOS Safari</span> <span>3.2+</span></span><span class="firefox yes"><span>Firefox</span> <span>3.6+</span></span><span class="ie yes"><span>IE</span> <span>9+</span></span><span class="samsung yes"><span>Samsung Internet</span> <span>4+</span></span><span class="op_mini partial"><span>Opera Mini (limited)</span> <span>all+</span></span><span class="android yes"><span>Android Browser</span> <span>3+</span></span><span class="safari yes"><span>Safari</span> <span>4+</span></span><span class="edge yes"><span>Edge</span> <span>12+</span></span><span class="opera yes"><span>Opera</span> <span>9+</span></span><p class=caniuse>Source: <a href="http://caniuse.com/#feat=canvas">caniuse.com</a></div>

  <dl class=element><dt><a href=dom.html#concept-element-categories id=the-canvas-element:concept-element-categories>カテゴリー</a>：<dd><a id=the-canvas-element:flow-content-2 href=dom.html#flow-content-2>フローコンテンツ</a>。<dd><a id=the-canvas-element:phrasing-content-2 href=dom.html#phrasing-content-2>フレージングコンテンツ</a>。<dd><a id=the-canvas-element:embedded-content-category href=dom.html#embedded-content-category>エンベディッドコンテンツ</a>。<dd><a id=the-canvas-element:palpable-content-2 href=dom.html#palpable-content-2>パルパブルコンテンツ</a>。<dt><a href=dom.html#concept-element-contexts id=the-canvas-element:concept-element-contexts>この要素を使用できるコンテキスト</a>：<dd><a id=the-canvas-element:embedded-content-category-2 href=dom.html#embedded-content-category>エンベディッドコンテンツ</a>が期待される場所。<dt><a href=dom.html#concept-element-content-model id=the-canvas-element:concept-element-content-model>コンテンツモデル</a>：<dd><a id=the-canvas-element:transparent href=dom.html#transparent>Transparent</a>, but with no <a id=the-canvas-element:interactive-content-2 href=dom.html#interactive-content-2>interactive content</a> descendants except
   for <code id=the-canvas-element:the-a-element><a href=semantics.html#the-a-element>a</a></code> elements, <code id=the-canvas-element:the-img-element><a href=embedded-content.html#the-img-element>img</a></code> elements with
   <code id=the-canvas-element:attr-hyperlink-usemap><a href=embedded-content.html#attr-hyperlink-usemap>usemap</a></code> attributes, <code id=the-canvas-element:the-button-element><a href=forms.html#the-button-element>button</a></code> elements,
   <code id=the-canvas-element:the-input-element><a href=forms.html#the-input-element>input</a></code> elements whose <code id=the-canvas-element:attr-input-type><a href=forms.html#attr-input-type>type</a></code> attribute are in
   the <a href="forms.html#checkbox-state-(type=checkbox)" id="the-canvas-element:checkbox-state-(type=checkbox)">Checkbox</a> or <a href="forms.html#radio-button-state-(type=radio)" id="the-canvas-element:radio-button-state-(type=radio)">Radio Button</a> states, <code id=the-canvas-element:the-input-element-2><a href=forms.html#the-input-element>input</a></code> elements that are
   <a href=forms.html#concept-button id=the-canvas-element:concept-button>buttons</a>, <code id=the-canvas-element:the-select-element><a href=forms.html#the-select-element>select</a></code> elements with a <code id=the-canvas-element:attr-select-multiple><a href=forms.html#attr-select-multiple>multiple</a></code> attribute or a <a href=forms.html#concept-select-size id=the-canvas-element:concept-select-size>display size</a> greater than 1, and elements that would not be
   <a id=the-canvas-element:interactive-content-2-2 href=dom.html#interactive-content-2>interactive content</a> except for having the <code id=the-canvas-element:attr-tabindex><a href=interaction.html#attr-tabindex>tabindex</a></code> attribute specified.<dt><a href=dom.html#concept-element-tag-omission id=the-canvas-element:concept-element-tag-omission>text/htmlにおけるタグ省略</a>：<dd>どちらのタグも省略不可。<dt><a href=dom.html#concept-element-attributes id=the-canvas-element:concept-element-attributes>コンテンツ属性</a>：<dd><a id=the-canvas-element:global-attributes href=dom.html#global-attributes>グローバル属性</a><dd><code id=the-canvas-element:attr-canvas-width><a href=#attr-canvas-width>width</a></code> — 横の次元<dd><code id=the-canvas-element:attr-canvas-height><a href=#attr-canvas-height>height</a></code> — 縦の次元<dt><a href=dom.html#concept-element-dom id=the-canvas-element:concept-element-dom>DOMインターフェイス</a>：<dd>
    <pre class=idl>typedef (<a href=#canvasrenderingcontext2d id=the-canvas-element:canvasrenderingcontext2d>CanvasRenderingContext2D</a> or <a id=the-canvas-element:webglrenderingcontext href=https://www.khronos.org/registry/webgl/specs/latest/1.0/#WebGLRenderingContext data-x-internal=webglrenderingcontext>WebGLRenderingContext</a>) <dfn id=renderingcontext>RenderingContext</dfn>;

[<a id=the-canvas-element:htmlconstructor href=dom.html#htmlconstructor>HTMLConstructor</a>]
interface <dfn id=htmlcanvaselement>HTMLCanvasElement</dfn> : <a id=the-canvas-element:htmlelement href=dom.html#htmlelement>HTMLElement</a> {
  [<a href=#cereactions id=the-canvas-element:cereactions>CEReactions</a>] attribute unsigned long <a href=#dom-canvas-width id=the-canvas-element:dom-canvas-width>width</a>;
  [<a href=#cereactions id=the-canvas-element:cereactions-2>CEReactions</a>] attribute unsigned long <a href=#dom-canvas-height id=the-canvas-element:dom-canvas-height>height</a>;

  <a href=#renderingcontext id=the-canvas-element:renderingcontext>RenderingContext</a>? <a href=#dom-canvas-getcontext id=the-canvas-element:dom-canvas-getcontext>getContext</a>(DOMString contextId, any... arguments);

  USVString <a href=#dom-canvas-todataurl id=the-canvas-element:dom-canvas-todataurl>toDataURL</a>(optional DOMString type, optional any quality);
  void <a href=#dom-canvas-toblob id=the-canvas-element:dom-canvas-toblob>toBlob</a>(<a href=#blobcallback id=the-canvas-element:blobcallback>BlobCallback</a> _callback, optional DOMString type, optional any quality);
  <a href=#offscreencanvas id=the-canvas-element:offscreencanvas>OffscreenCanvas</a> <a href=#dom-canvas-transfercontroltooffscreen id=the-canvas-element:dom-canvas-transfercontroltooffscreen>transferControlToOffscreen</a>();
};

callback <dfn id=blobcallback>BlobCallback</dfn> = void (<a id=the-canvas-element:blob href=https://triple-underscore.github.io/File_API-ja.html#blob data-x-internal=blob>Blob</a>? blob);</pre>
   </dl>

  <p><code id=the-canvas-element:the-canvas-element><a href=#the-canvas-element>canvas</a></code>要素は、グラフ、ゲームグラフィック、芸術、またはその他の視覚的な画像をその場でレンダリングするために使用できる、解像度に依存するビットマップキャンバスを伴うスクリプトを提供する。</p>

  <p>より適切な要素が利用可能である場合、著者は文書で<code id=the-canvas-element:the-canvas-element-2><a href=#the-canvas-element>canvas</a></code>要素を使うべきでない。たとえば、見出し、ページを描画する<code id=the-canvas-element:the-canvas-element-3><a href=#the-canvas-element>canvas</a></code>要素を使用することは不適当である：見出しの望ましいプレゼンテーショングラフィカルが強烈である場合、それは適切な要素（典型的には<code id=the-canvas-element:the-h1,-h2,-h3,-h4,-h5,-and-h6-elements><a href=semantics.html#the-h1,-h2,-h3,-h4,-h5,-and-h6-elements> h1</a></code>）を使用してマークアップし、CSSを使用していて、ウェブコンポーネントのような技術をサポートするスタイリングする必要がある。</p>

  <p>When authors use the <code id=the-canvas-element:the-canvas-element-4><a href=#the-canvas-element>canvas</a></code> element, they must also provide content that, when presented to the user, conveys essentially the same function or purpose as the <code id=the-canvas-element:the-canvas-element-5><a href=#the-canvas-element>canvas</a></code>'s bitmap. このコンテンツは<code id=the-canvas-element:the-canvas-element-6><a href=#the-canvas-element>canvas</a></code>要素のコンテンツとして置かれてもよい。<code id=the-canvas-element:the-canvas-element-7><a href=#the-canvas-element>canvas</a></code>要素のコンテンツは、もしあれば、その要素の<a id=the-canvas-element:fallback-content href=dom.html#fallback-content>フォールバックコンテンツ</a>である。</p>

  <hr>

  <p>In interactive visual media, if <a href=webappapis.html#concept-n-script id=the-canvas-element:concept-n-script>scripting is enabled</a> for
  the <code id=the-canvas-element:the-canvas-element-8><a href=#the-canvas-element>canvas</a></code> element, and if support for <code id=the-canvas-element:the-canvas-element-9><a href=#the-canvas-element>canvas</a></code> elements has been enabled,
  then the <code id=the-canvas-element:the-canvas-element-10><a href=#the-canvas-element>canvas</a></code> element <a id=the-canvas-element:represents href=dom.html#represents>represents</a> <a id=the-canvas-element:embedded-content-category-3 href=dom.html#embedded-content-category>embedded content</a>
  consisting of a dynamically created image, the element's bitmap.</p>

  <p>静的で、非対話的な視覚メディアにおいて、<code id=the-canvas-element:the-canvas-element-11><a href=#the-canvas-element>canvas</a></code>要素が以前に描かれている場合（たとえば、ページがインタラクティブな視覚媒体で表示され、現在描かれている場合、またはページレイアウトプロセス中に実行された一部のスクリプトが要素で描かれた場合）、<code id=the-canvas-element:the-canvas-element-12><a href=#the-canvas-element>canvas</a></code>要素は、現在のビットマップとサイズをもつ<a id=the-canvas-element:embedded-content-category-4 href=dom.html#embedded-content-category>エンベディッドコンテンツ</a>を<a id=the-canvas-element:represents-2 href=dom.html#represents>表す</a>。そうでなければ、要素は代わりにその<a id=the-canvas-element:fallback-content-2 href=dom.html#fallback-content>フォールバックコンテンツ</a>を表す。</p>

  <p>非視覚系メディアにおいて、かつ視覚メディアで<code id=the-canvas-element:the-canvas-element-13><a href=#the-canvas-element>canvas</a></code>要素に対して<a href=webappapis.html#concept-n-noscript id=the-canvas-element:concept-n-noscript>スクリプトが無効である</a>場合、または<code id=the-canvas-element:the-canvas-element-14><a href=#the-canvas-element>canvas</a></code>要素のサポートが無効である場合、<code id=the-canvas-element:the-canvas-element-15><a href=#the-canvas-element>canvas</a></code>要素は代わりに<a id=the-canvas-element:fallback-content-3 href=dom.html#fallback-content>フォールバックコンテンツ</a>を<a id=the-canvas-element:represents-3 href=dom.html#represents>表す</a>。</p>

  
  <p><code id=the-canvas-element:the-canvas-element-16><a href=#the-canvas-element>canvas</a></code>要素が<a id=the-canvas-element:embedded-content-category-5 href=dom.html#embedded-content-category>エンベディッドコンテンツ</a>を<a id=the-canvas-element:represents-4 href=dom.html#represents>表す</a>場合、ユーザーは<code id=the-canvas-element:the-canvas-element-17><a href=#the-canvas-element>canvas</a></code>要素の子孫（<a id=the-canvas-element:fallback-content-4 href=dom.html#fallback-content>フォールバックコンテンツ</a>内）にフォーカスできる。要素が<a id=the-canvas-element:focused href=interaction.html#focused>フォーカスされている</a>場合、（要素自体が表示されていなくても）キーボード操作イベントの対象となる。これは、著者がインタラクティブキャンバスをキーボードアクセシブルにできる：著者は、<a id=the-canvas-element:fallback-content-5 href=dom.html#fallback-content>フォールバックコンテンツ</a>内の<i id=the-canvas-element:focusable-area><a href=interaction.html#focusable-area>フォーカス可能な領域</a></i>にインタラクティブな領域の1対1対応を持つべきである。（フォーカスは、マウス操作イベントに影響しない。）<a href=references.html#refsUIEVENTS>[DOMEVENTS]</a></p> 

  <p>An element whose nearest <code id=the-canvas-element:the-canvas-element-18><a href=#the-canvas-element>canvas</a></code> element ancestor is <a id=the-canvas-element:being-rendered href=rendering.html#being-rendered>being rendered</a>
  and <a id=the-canvas-element:represents-5 href=dom.html#represents>represents</a> <a id=the-canvas-element:embedded-content-category-6 href=dom.html#embedded-content-category>embedded content</a> is an element that is <dfn id=being-used-as-relevant-canvas-fallback-content>being used as
  relevant canvas fallback content</dfn>.</p>

  <hr>

  <p><code id=the-canvas-element:the-canvas-element-19><a href=#the-canvas-element>canvas</a></code>要素は、要素ビットマップの大きさを制御する<dfn id=attr-canvas-width><code>width</code></dfn>と<dfn id=attr-canvas-height><code>height</code></dfn>の2つの属性を持つ。指定される場合、これらの属性は<a href=infrastructure.html#valid-non-negative-integer id=the-canvas-element:valid-non-negative-integer>妥当な非負の整数</a>である値を持たなければならない。The <a id=the-canvas-element:rules-for-parsing-non-negative-integers href=infrastructure.html#rules-for-parsing-non-negative-integers>rules for parsing non-negative integers</a> must be used to obtain their numeric values. If an attribute is missing, or if parsing its value returns an error, then the default value must be used instead. <code id=the-canvas-element:attr-canvas-width-2><a href=#attr-canvas-width>width</a></code>属性はデフォルトで300に、<code id=the-canvas-element:attr-canvas-height-2><a href=#attr-canvas-height>height</a></code>属性はデフォルトで150に設定される。</p>

  <p>要素が<a id=the-canvas-element:embedded-content-category-7 href=dom.html#embedded-content-category>エンベディッドコンテンツ</a>を<a id=the-canvas-element:represents-6 href=dom.html#represents>表す</a>場合、<code id=the-canvas-element:the-canvas-element-20><a href=#the-canvas-element>canvas</a></code>要素の<a id=the-canvas-element:intrinsic-dimensions href=https://momdo.github.io/css2/conform.html#intrinsic data-x-internal=intrinsic-dimensions>内在次元</a>は、その要素のビットマップの次元に等しい。</p>

  <p>ユーザーエージェントは、<code id=the-canvas-element:the-canvas-element-21><a href=#the-canvas-element>canvas</a></code>とレンダリングコンテキストのビットマップに対する座標空間単位あたりの画像データの1画素からなる平方画素密度を使用しなければならない。</p>

  <p class=note>A <code id=the-canvas-element:the-canvas-element-22><a href=#the-canvas-element>canvas</a></code> element can be sized arbitrarily by a style sheet, its
  bitmap is then subject to the <a id="the-canvas-element:'object-fit'" href=https://triple-underscore.github.io/css-images-ja.html#the-object-fit data-x-internal="'object-fit'">'object-fit'</a> CSS property.</p>

  

  <hr>

  <p>The bitmaps of <code id=the-canvas-element:the-canvas-element-23><a href=#the-canvas-element>canvas</a></code> elements, the bitmaps of <code id=the-canvas-element:imagebitmap><a href=webappapis.html#imagebitmap>ImageBitmap</a></code> objects,
  as well as some of the bitmaps of rendering contexts, such as those described in the sections on
  the <code id=the-canvas-element:canvasrenderingcontext2d-2><a href=#canvasrenderingcontext2d>CanvasRenderingContext2D</a></code> and <code id=the-canvas-element:imagebitmaprenderingcontext><a href=#imagebitmaprenderingcontext>ImageBitmapRenderingContext</a></code> objects
  below, have an <dfn id=concept-canvas-origin-clean>origin-clean</dfn> flag, which can be
  set to true or false. Initially, when the <code id=the-canvas-element:the-canvas-element-24><a href=#the-canvas-element>canvas</a></code> element or <code id=the-canvas-element:imagebitmap-2><a href=webappapis.html#imagebitmap>ImageBitmap</a></code>
  object is created, its bitmap's <a href=#concept-canvas-origin-clean id=the-canvas-element:concept-canvas-origin-clean>origin-clean</a>
  flag must be set to true.</p>

  <p>A <code id=the-canvas-element:the-canvas-element-25><a href=#the-canvas-element>canvas</a></code> element can have a rendering context bound to it. Initially, it does not
  have a bound rendering context. To keep track of whether it has a rendering context or not, and
  what kind of rendering context it is, a <code id=the-canvas-element:the-canvas-element-26><a href=#the-canvas-element>canvas</a></code> also has a <dfn id=concept-canvas-context-mode>canvas context mode</dfn>, which is initially <dfn id=concept-canvas-none>none</dfn> but can be changed to either <dfn id=concept-canvas-placeholder>placeholder</dfn>, <dfn id=concept-canvas-2d>2d</dfn>, <dfn id=concept-canvas-bitmaprenderer>bitmaprenderer</dfn>, or <dfn id=concept-canvas-webgl>webgl</dfn> by algorithms defined in this specification.</p>

  <p>When its <a href=#concept-canvas-context-mode id=the-canvas-element:concept-canvas-context-mode>canvas context mode</a> is <a href=#concept-canvas-none id=the-canvas-element:concept-canvas-none>none</a>, a <code id=the-canvas-element:the-canvas-element-27><a href=#the-canvas-element>canvas</a></code> element has no rendering context,
  and its bitmap must be fully transparent black with an <a id=the-canvas-element:intrinsic-width href=infrastructure.html#intrinsic-width>intrinsic width</a> equal to the
  numeric value of the element's <code id=the-canvas-element:attr-canvas-width-3><a href=#attr-canvas-width>width</a></code> attribute and an
  <a id=the-canvas-element:intrinsic-height href=infrastructure.html#intrinsic-height>intrinsic height</a> equal to the numeric value of the element's <code id=the-canvas-element:attr-canvas-height-3><a href=#attr-canvas-height>height</a></code> attribute, those values being interpreted in <a href=https://momdo.github.io/css3-values/#px id="the-canvas-element:'px'" data-x-internal="'px'">CSS pixels</a>, and being updated as the attributes are set, changed, or
  removed.</p>

  <p>When its <a href=#concept-canvas-context-mode id=the-canvas-element:concept-canvas-context-mode-2>canvas context mode</a> is <a href=#concept-canvas-placeholder id=the-canvas-element:concept-canvas-placeholder>placeholder</a>, a <code id=the-canvas-element:the-canvas-element-28><a href=#the-canvas-element>canvas</a></code> element has no
  rendering context. It serves as a placeholder for an <code id=the-canvas-element:offscreencanvas-2><a href=#offscreencanvas>OffscreenCanvas</a></code> object, and
  the content of the <code id=the-canvas-element:the-canvas-element-29><a href=#the-canvas-element>canvas</a></code> element is updated by calling the <code id=the-canvas-element:offscreencontext-commit><a href=#offscreencontext-commit>commit()</a></code> method of the <code id=the-canvas-element:offscreencanvas-3><a href=#offscreencanvas>OffscreenCanvas</a></code>
  object's rendering context.</p>

  <p>When a <code id=the-canvas-element:the-canvas-element-30><a href=#the-canvas-element>canvas</a></code> element represents <a id=the-canvas-element:embedded-content-category-8 href=dom.html#embedded-content-category>embedded content</a>, it provides a
  <a id=the-canvas-element:paint-source href=https://drafts.csswg.org/css-images-4/#paint-source data-x-internal=paint-source>paint source</a> whose width is the element's <a id=the-canvas-element:intrinsic-width-2 href=infrastructure.html#intrinsic-width>intrinsic width</a>, whose height
  is the element's <a id=the-canvas-element:intrinsic-height-2 href=infrastructure.html#intrinsic-height>intrinsic height</a>, and whose appearance is the element's bitmap.</p>

  <p>Whenever the <code id=the-canvas-element:attr-canvas-width-4><a href=#attr-canvas-width>width</a></code> and <code id=the-canvas-element:attr-canvas-height-4><a href=#attr-canvas-height>height</a></code> content attributes are set, removed, changed, or
  redundantly set to the value they already have, then the user agent must perform the action
  from the row of the following table that corresponds to the <code id=the-canvas-element:the-canvas-element-31><a href=#the-canvas-element>canvas</a></code> element's <a href=#concept-canvas-context-mode id=the-canvas-element:concept-canvas-context-mode-3>context mode</a>.</p>

  <table><thead><tr><th>
      <p><a href=#concept-canvas-context-mode id=the-canvas-element:concept-canvas-context-mode-4>Context Mode</a></p>
     </th><th>
      <p>アクション</p>

   <tbody></th></tr><tr><th>
      <p><a href=#concept-canvas-2d id=the-canvas-element:concept-canvas-2d>2d</a></p>
     <td>
      <p>Follow the steps to <a href=#concept-canvas-set-bitmap-dimensions id=the-canvas-element:concept-canvas-set-bitmap-dimensions>set bitmap
      dimensions</a> to the numeric values of the <code id=the-canvas-element:attr-canvas-width-5><a href=#attr-canvas-width>width</a></code>
      and <code id=the-canvas-element:attr-canvas-height-5><a href=#attr-canvas-height>height</a></code> content attributes.</p>

    </td></th></tr><tr><th>
      <p><a href=#concept-canvas-webgl id=the-canvas-element:concept-canvas-webgl>webgl</a></p>
     <td>
      <p>Follow the behavior defined in the WebGL specification. <a href=references.html#refsWEBGL>[WEBGL]</a></p>

    </td></th></tr><tr><th>
      <p><a href=#concept-canvas-bitmaprenderer id=the-canvas-element:concept-canvas-bitmaprenderer>bitmaprenderer</a></p>
     <td>
      <p>If the context's <a href=#concept-imagebitmaprenderingcontext-bitmap-mode id=the-canvas-element:concept-imagebitmaprenderingcontext-bitmap-mode>bitmap
      mode</a> is set to <a href=#concept-imagebitmaprenderingcontext-blank id=the-canvas-element:concept-imagebitmaprenderingcontext-blank>blank</a>,
      run the steps to <a href="#set-an-imagebitmaprenderingcontext's-output-bitmap" id="the-canvas-element:set-an-imagebitmaprenderingcontext's-output-bitmap">set an <code>ImageBitmapRenderingContext</code>'s output bitmap</a>,
      passing the <code id=the-canvas-element:the-canvas-element-32><a href=#the-canvas-element>canvas</a></code> element's rendering context.</p>

    </td></th></tr><tr><th>
      <p><a href=#concept-canvas-placeholder id=the-canvas-element:concept-canvas-placeholder-2>placeholder</a></p>
     <td>
      <p>Do nothing.</p>

    </td></th></tr><tr><th>
      <p><a href=#concept-canvas-none id=the-canvas-element:concept-canvas-none-2>none</a></p>
     <td>
      <p>Do nothing.</p>
  </td></th></tr></table>

  <p>The <dfn id=dom-canvas-width><code>width</code></dfn> and <dfn id=dom-canvas-height><code>height</code></dfn> IDL attributes must <a id=the-canvas-element:reflect href=infrastructure.html#reflect>reflect</a> the
  respective content attributes of the same name, with the same defaults.</p>

  

  <hr>

  
  <dl class=domintro><dt><var>context</var> = <var>canvas</var> . <code id=the-canvas-element:dom-canvas-getcontext-2><a href=#dom-canvas-getcontext>getContext</a></code>(<var>contextId</var> [, ... ] )<dd>

    <p>キャンバス上に描画するためのAPIを公開するオブジェクトを返す。The first argument specifies the desired API, either "<code id=the-canvas-element:canvas-context-2d><a href=#canvas-context-2d>2d</a></code>", "<code id=the-canvas-element:canvas-context-bitmaprenderer><a href=#canvas-context-bitmaprenderer>bitmaprenderer</a></code>" or "<code id=the-canvas-element:canvas-context-webgl><a href=#canvas-context-webgl>webgl</a></code>". 後続の引数は、そのAPIによって処理される。</p>

    <p>This specification defines the "<code id=the-canvas-element:canvas-context-2d-2><a href=#canvas-context-2d>2d</a></code>" and "<code id=the-canvas-element:canvas-context-bitmaprenderer-2><a href=#canvas-context-bitmaprenderer>bitmaprenderer</a></code>" contexts below. There is also a
    specification that defines a "<code id=the-canvas-element:canvas-context-webgl-2><a href=#canvas-context-webgl>webgl</a></code>" context.
    <a href=references.html#refsWEBGL>[WEBGL]</a></p>

    <p>Returns null if the given context ID is not supported, or if the canvas has already been
    initialized with another context type (e.g. trying to get a "<code id=the-canvas-element:canvas-context-2d-3><a href=#canvas-context-2d>2d</a></code>" context after getting a "<code id=the-canvas-element:canvas-context-webgl-3><a href=#canvas-context-webgl>webgl</a></code>" context).</p>

   </dl>

  

  <p>The <dfn id=dom-canvas-getcontext><code>getContext(<var>contextId</var>,
  <var>arguments...</var>)</code></dfn> method of the <code id=the-canvas-element:the-canvas-element-33><a href=#the-canvas-element>canvas</a></code> element, when invoked,
  must run the steps in the cell of the following table whose column header describes the
  <code id=the-canvas-element:the-canvas-element-34><a href=#the-canvas-element>canvas</a></code> element's <a href=#concept-canvas-context-mode id=the-canvas-element:concept-canvas-context-mode-5>canvas context
  mode</a> and whose row header describes the method's first argument.</p>

  <table><thead><tr><td>
     <th><a href=#concept-canvas-none id=the-canvas-element:concept-canvas-none-3>none</a>
     </th><th><a href=#concept-canvas-2d id=the-canvas-element:concept-canvas-2d-2>2d</a>
     </th><th><a href=#concept-canvas-bitmaprenderer id=the-canvas-element:concept-canvas-bitmaprenderer-2>bitmaprenderer</a>
     </th><th><a href=#concept-canvas-webgl id=the-canvas-element:concept-canvas-webgl-2>webgl</a>
     </th><th><a href=#concept-canvas-placeholder id=the-canvas-element:concept-canvas-placeholder-3>placeholder</a>
   <tbody></th></td></tr><tr><th>"<dfn id=canvas-context-2d><code>2d</code></dfn>"
     
     <td>

      

      Follow the <a href=#2d-context-creation-algorithm id=the-canvas-element:2d-context-creation-algorithm>2D context creation algorithm</a> defined in the section below, passing
      it the <code id=the-canvas-element:the-canvas-element-35><a href=#the-canvas-element>canvas</a></code> element and the method's <var>arguments...</var>, to obtain a
      <code id=the-canvas-element:canvasrenderingcontext2d-3><a href=#canvasrenderingcontext2d>CanvasRenderingContext2D</a></code> object; if this does not throw an exception, then
      set the <code id=the-canvas-element:the-canvas-element-36><a href=#the-canvas-element>canvas</a></code> element's <a href=#concept-canvas-context-mode id=the-canvas-element:concept-canvas-context-mode-6>context
      mode</a> to <a href=#concept-canvas-2d id=the-canvas-element:concept-canvas-2d-3>2d</a>, and return the
      <code id=the-canvas-element:canvasrenderingcontext2d-4><a href=#canvasrenderingcontext2d>CanvasRenderingContext2D</a></code> object.

     

     </td><td>
      
      Return the same object as was returned the last time the method was invoked with this same
      first argument.
     
     </td><td>
      
      Return null.
     
     </td><td>
      
      Return null.
     
     </td><td>
      
      Throw an <a id=the-canvas-element:invalidstateerror href=https://triple-underscore.github.io/WebIDL-ja.html#invalidstateerror data-x-internal=invalidstateerror>"<code>InvalidStateError</code>"</a> <code id=the-canvas-element:domexception><a data-x-internal=domexception href=https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException>DOMException</a></code>.

    

    </td></th></tr><tr><th>"<dfn id=canvas-context-bitmaprenderer><code>bitmaprenderer</code></dfn>"
     
     <td>

      

      Follow the <a href=#imagebitmaprenderingcontext-creation-algorithm id=the-canvas-element:imagebitmaprenderingcontext-creation-algorithm><code>ImageBitmapRenderingContext</code> creation algorithm</a> defined
      in the section below, passing it the <code id=the-canvas-element:the-canvas-element-37><a href=#the-canvas-element>canvas</a></code> element and the method's
      <var>arguments...</var>, to obtain an <code id=the-canvas-element:imagebitmaprenderingcontext-2><a href=#imagebitmaprenderingcontext>ImageBitmapRenderingContext</a></code> object; then
      set the <code id=the-canvas-element:the-canvas-element-38><a href=#the-canvas-element>canvas</a></code> element's <a href=#concept-canvas-context-mode id=the-canvas-element:concept-canvas-context-mode-7>context
      mode</a> to <a href=#concept-canvas-bitmaprenderer id=the-canvas-element:concept-canvas-bitmaprenderer-3>bitmaprenderer</a>, and return the
      <code id=the-canvas-element:imagebitmaprenderingcontext-3><a href=#imagebitmaprenderingcontext>ImageBitmapRenderingContext</a></code> object.

     

     </td><td>
      
      Return null.
     
     </td><td>
      
      Return the same object as was returned the last time the method was invoked with this same
      first argument.
     
     </td><td>
      
      Return null.
     
     </td><td>
      
      Throw an <a id=the-canvas-element:invalidstateerror-2 href=https://triple-underscore.github.io/WebIDL-ja.html#invalidstateerror data-x-internal=invalidstateerror>"<code>InvalidStateError</code>"</a> <code id=the-canvas-element:domexception-2><a data-x-internal=domexception href=https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException>DOMException</a></code>.

    

    </td></th></tr><tr><th>"<dfn id=canvas-context-webgl><code>webgl</code></dfn>", if the user agent supports the WebGL feature in its current configuration
     
     <td>

      

      Follow the instructions given in the WebGL specification's <i>Context Creation</i> section to
      obtain either a <code id=the-canvas-element:webglrenderingcontext-2><a data-x-internal=webglrenderingcontext href=https://www.khronos.org/registry/webgl/specs/latest/1.0/#WebGLRenderingContext>WebGLRenderingContext</a></code> or null; if the returned value is null,
      then return null and abort these steps, otherwise, set the <code id=the-canvas-element:the-canvas-element-39><a href=#the-canvas-element>canvas</a></code> element's
      <a href=#concept-canvas-context-mode id=the-canvas-element:concept-canvas-context-mode-8>context mode</a> to <a href=#concept-canvas-webgl id=the-canvas-element:concept-canvas-webgl-3>webgl</a>, and return the <code id=the-canvas-element:webglrenderingcontext-3><a data-x-internal=webglrenderingcontext href=https://www.khronos.org/registry/webgl/specs/latest/1.0/#WebGLRenderingContext>WebGLRenderingContext</a></code>
      object <a href=references.html#refsWEBGL>[WEBGL]</a>

     </td><td>
      
      Return null.
     
     </td><td>
      
      Return null.
     
     </td><td>
      
      Return the same object as was returned the last time the method was invoked with this same
      first argument.
     
     </td><td>
      
      Throw an <a id=the-canvas-element:invalidstateerror-3 href=https://triple-underscore.github.io/WebIDL-ja.html#invalidstateerror data-x-internal=invalidstateerror>"<code>InvalidStateError</code>"</a> <code id=the-canvas-element:domexception-3><a data-x-internal=domexception href=https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException>DOMException</a></code>.

    

    </td></th></tr><tr><th>An unsupported value*
     
     <td>
      
      Return null.
     
     </td><td>
      
      Return null.
     
     </td><td>
      
      Return null.
     
     </td><td>
      
      Return null.
     
     </td><td>
      
      Throw an <a id=the-canvas-element:invalidstateerror-4 href=https://triple-underscore.github.io/WebIDL-ja.html#invalidstateerror data-x-internal=invalidstateerror>"<code>InvalidStateError</code>"</a> <code id=the-canvas-element:domexception-4><a data-x-internal=domexception href=https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException>DOMException</a></code>.

  

  </td></th></tr></table>

  <p class=tablenote><small>* For example, the "<code id=the-canvas-element:canvas-context-webgl-4><a href=#canvas-context-webgl>webgl</a></code>"
  value in the case of a user agent having exhausted the graphics hardware's abilities and having no
  software fallback implementation.</small></p>

  <hr>

  

  <dl class=domintro><dt><var>url</var> = <var>canvas</var> . <code id=the-canvas-element:dom-canvas-todataurl-2><a href=#dom-canvas-todataurl>toDataURL</a></code>( [ <var>type</var> [, <var>quality</var> ] ] )<dd>

    <p>キャンバスで画像に対する<a href=http://www.akanko.net/marimo/data/rfc/rfc2397-jp.txt#section-2 id=the-canvas-element:data-protocol data-x-internal=data-protocol><code>data:</code> URL</a>を返す。</p>

    <p>最初の引数が与えられた場合、返される画像の型（たとえば、PNGまたはJPEG）を制御する。The default is "<code id=the-canvas-element:image/png><a href=indices.html#image/png>image/png</a></code>"; that type is also used if the given type isn't supported. The second argument applies if the type is an image format that supports variable quality (such as "<code id=the-canvas-element:image/jpeg><a href=indices.html#image/jpeg>image/jpeg</a></code>"), and is a number in the range 0.0 to 1.0 inclusive indicating the desired quality level for the resulting image.</p>

    <p>"<code id=the-canvas-element:image/png-2><a href=indices.html#image/png>image/png</a></code>"以外の型を使用しようとする際、著者は、実際に返された文字列が正確に"<code>data:image/png,</code>"または"<code>data:image/png;</code>"のいずれかの文字列で始まるかどうかをチェックすることで、画像が要求された形式で返されたかどうかを確認できる。その場合、画像はPNGであり、したがって要求された型はサポートされない。（キャンバスが高さや幅のいずれかを持たない場合、このような例外の一つであり、結果は単に"<code>data:,</code>"であるかもしれない）。</p>

   <dt><var>canvas</var> . <code id=the-canvas-element:dom-canvas-toblob-2><a href=#dom-canvas-toblob>toBlob</a></code>(<var>callback</var> [, <var>type</var> [, quality ] ] )<dd>

    <p>キャンバス内の画像を含むファイルを表す<code id=the-canvas-element:blob-2><a data-x-internal=blob href=https://triple-underscore.github.io/File_API-ja.html#blob>Blob</a></code>オブジェクトを作成し、そのオブジェクトへのハンドルとともにコールバックを呼び出す。</p>

    <p>2つ目の引数が与えられた場合、返される画像の型（たとえば、PNGまたはJPEG）を制御する。The default is "<code id=the-canvas-element:image/png-3><a href=indices.html#image/png>image/png</a></code>"; that type is also used if the given type isn't supported. The third argument applies if the type is an image format that supports variable quality (such as "<code id=the-canvas-element:image/jpeg-2><a href=indices.html#image/jpeg>image/jpeg</a></code>"), and is a number in the range 0.0 to 1.0 inclusive indicating the desired quality level for the resulting image.</p>

   <dt><var>canvas</var> . <code id=the-canvas-element:dom-canvas-transfercontroltooffscreen-2><a href=#dom-canvas-transfercontroltooffscreen>transferControlToOffscreen</a></code>()<dd>
    <p>Returns a newly created <code id=the-canvas-element:offscreencanvas-4><a href=#offscreencanvas>OffscreenCanvas</a></code> object that uses the
    <code id=the-canvas-element:the-canvas-element-40><a href=#the-canvas-element>canvas</a></code> element as a placeholder. Once the <code id=the-canvas-element:the-canvas-element-41><a href=#the-canvas-element>canvas</a></code> element has become a
    placeholder for an <code id=the-canvas-element:offscreencanvas-5><a href=#offscreencanvas>OffscreenCanvas</a></code> object, its intrinsic size can no longer be
    changed, and it cannot have a rendering context. The content of the placeholder canvas is
    updated by calling the <code id=the-canvas-element:offscreencontext-commit-2><a href=#offscreencontext-commit>commit()</a></code> method of the
    <code id=the-canvas-element:offscreencanvas-6><a href=#offscreencanvas>OffscreenCanvas</a></code> object's rendering context.
    
    </p>
   </dl>

  

  <p>The <dfn id=dom-canvas-todataurl><code>toDataURL(<var>type</var>,
  <var>quality</var>)</code></dfn> method, when invoked, must run these steps:</p>

  <ol><li><p>If this <code id=the-canvas-element:the-canvas-element-42><a href=#the-canvas-element>canvas</a></code> element's bitmap's <a href=#concept-canvas-origin-clean id=the-canvas-element:concept-canvas-origin-clean-2>origin-clean</a> flag is set to false, then throw a
   <a id=the-canvas-element:securityerror href=https://triple-underscore.github.io/WebIDL-ja.html#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a> <code id=the-canvas-element:domexception-5><a data-x-internal=domexception href=https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException>DOMException</a></code> and abort these steps.</p>


   </li><li><p>If this <code id=the-canvas-element:the-canvas-element-43><a href=#the-canvas-element>canvas</a></code> element's bitmap has no pixels (i.e. either its horizontal
   dimension or its vertical dimension is zero) then return the string "<code>data:,</code>" and abort these steps. (This is the shortest <a href=http://www.akanko.net/marimo/data/rfc/rfc2397-jp.txt#section-2 id=the-canvas-element:data-protocol-2 data-x-internal=data-protocol><code>data:</code> URL</a>; it represents the empty string in a <code>text/plain</code> resource.)</li><li><p>Let <var>file</var> be <a href=#a-serialisation-of-the-bitmap-as-a-file id=the-canvas-element:a-serialisation-of-the-bitmap-as-a-file>a
   serialization of this <code>canvas</code> element's bitmap as a file</a>, passing
   <var>type</var> and <var>quality</var> if they were given.</li><li><p>If <var>file</var> is null then return "<code>data:,</code>".</li><li><p>Return a <a href=http://www.akanko.net/marimo/data/rfc/rfc2397-jp.txt#section-2 id=the-canvas-element:data-protocol-3 data-x-internal=data-protocol><code>data:</code> URL</a> representing
   <var>file</var>. <a href=references.html#refsRFC2397>[RFC2397]</a></p>

   

  </li></ol>

  <p>The <dfn id=dom-canvas-toblob><code>toBlob(<var>callback</var>, <var>type</var>,
  <var>quality</var>)</code></dfn> method, when invoked, must run these steps:</p>

  <ol><li><p>If this <code id=the-canvas-element:the-canvas-element-44><a href=#the-canvas-element>canvas</a></code> element's bitmap's <a href=#concept-canvas-origin-clean id=the-canvas-element:concept-canvas-origin-clean-3>origin-clean</a> flag is set to false, then throw a
   <a id=the-canvas-element:securityerror-2 href=https://triple-underscore.github.io/WebIDL-ja.html#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a> <code id=the-canvas-element:domexception-6><a data-x-internal=domexception href=https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException>DOMException</a></code> and abort these steps.</p>


   </li><li>
    <p>If this <code id=the-canvas-element:the-canvas-element-45><a href=#the-canvas-element>canvas</a></code> element's bitmap has no pixels (i.e. either its horizontal
    dimension or its vertical dimension is zero) then let <var>result</var> be null.</p>

    <p>Otherwise, let <var>result</var> be a <code id=the-canvas-element:blob-3><a data-x-internal=blob href=https://triple-underscore.github.io/File_API-ja.html#blob>Blob</a></code> object representing <a href=#a-serialisation-of-the-bitmap-as-a-file id=the-canvas-element:a-serialisation-of-the-bitmap-as-a-file-2>a serialization of this <code>canvas</code> element's
    bitmap as a file</a>, passing <var>type</var> and <var>quality</var> if they were given. <a href=references.html#refsFILEAPI>[FILEAPI]</a></p>
   </li><li><p>Return, but continue running these steps <a id=the-canvas-element:in-parallel href=infrastructure.html#in-parallel>in parallel</a>.</li><li><p><a id=the-canvas-element:queue-a-task href=webappapis.html#queue-a-task>Queue a task</a> to <a href=https://heycam.github.io/webidl/#invoke-a-callback-function id=the-canvas-element:es-invoking-callback-functions data-x-internal=es-invoking-callback-functions>invoke</a>
   the <code id=the-canvas-element:blobcallback-2><a href=#blobcallback>BlobCallback</a></code> <var>callback</var> with <var>result</var> as its argument. The
   <a id=the-canvas-element:task-source href=webappapis.html#task-source>task source</a> for this task is the
   <dfn id=canvas-blob-serialisation-task-source>canvas blob serialization task
   source</dfn>.</li></ol>

  <p>The <dfn id=dom-canvas-transfercontroltooffscreen><code>transferControlToOffscreen()</code></dfn> method,
  when invoked, must run these steps:</p>

  <ol><li><p>If this <code id=the-canvas-element:the-canvas-element-46><a href=#the-canvas-element>canvas</a></code> element's <a href=#concept-canvas-context-mode id=the-canvas-element:concept-canvas-context-mode-9>context
   mode</a> is not set to <a href=#concept-canvas-none id=the-canvas-element:concept-canvas-none-4>none</a>, throw an
   <a id=the-canvas-element:invalidstateerror-5 href=https://triple-underscore.github.io/WebIDL-ja.html#invalidstateerror data-x-internal=invalidstateerror>"<code>InvalidStateError</code>"</a> <code id=the-canvas-element:domexception-7><a data-x-internal=domexception href=https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException>DOMException</a></code> and abort these
   steps.</li><li><p>Let <var>offscreenCanvas</var> be a new <code id=the-canvas-element:offscreencanvas-7><a href=#offscreencanvas>OffscreenCanvas</a></code> object with its
   width and height equal to the values of the <code id=the-canvas-element:attr-canvas-width-6><a href=#attr-canvas-width>width</a></code>
   and <code id=the-canvas-element:attr-canvas-height-6><a href=#attr-canvas-height>height</a></code> content attributes of this
   <code id=the-canvas-element:the-canvas-element-47><a href=#the-canvas-element>canvas</a></code> element.</li><li><p>Set the <a href=#offscreencanvas-placeholder id=the-canvas-element:offscreencanvas-placeholder>placeholder <code>canvas</code>
   element</a> of <var>offscreenCanvas</var> to be a weak reference to this <code id=the-canvas-element:the-canvas-element-48><a href=#the-canvas-element>canvas</a></code>
   element.</li><li><p>Set this <code id=the-canvas-element:the-canvas-element-49><a href=#the-canvas-element>canvas</a></code> element's <a href=#concept-canvas-context-mode id=the-canvas-element:concept-canvas-context-mode-10>context
   mode</a> to <a href=#concept-canvas-placeholder id=the-canvas-element:concept-canvas-placeholder-4>placeholder</a>.</li><li><p>Return <var>offscreenCanvas</var>.</li></ol>

  

  

  <h5 id=2dcontext>4.12.5.1 The 2D rendering context<a href=#2dcontext class=self-link></a></h5><div class=status><input onclick=toggleStatus(this) value=⋰ type=button><p class=bugs><strong>Spec bugs:</strong> <a href="https://www.w3.org/Bugs/Public/show_bug.cgi?id=18220" title="drawImage should accept SVGImageElement">18220</a></div>

  

  <pre class=idl>typedef (<a id=2dcontext:htmlimageelement href=embedded-content.html#htmlimageelement>HTMLImageElement</a> or
         <a id=2dcontext:svgimageelement href=https://triple-underscore.github.io/SVG11/struct.html#InterfaceSVGImageElement data-x-internal=svgimageelement>SVGImageElement</a>) <dfn id=htmlorsvgimageelement>HTMLOrSVGImageElement</dfn>;

typedef (<a href=#htmlorsvgimageelement id=2dcontext:htmlorsvgimageelement>HTMLOrSVGImageElement</a> or
         <a id=2dcontext:htmlvideoelement href=embedded-content.html#htmlvideoelement>HTMLVideoElement</a> or
         <a href=#htmlcanvaselement id=2dcontext:htmlcanvaselement>HTMLCanvasElement</a> or
         <a id=2dcontext:imagebitmap href=webappapis.html#imagebitmap>ImageBitmap</a> or
         <a href=#offscreencanvas id=2dcontext:offscreencanvas>OffscreenCanvas</a>) <dfn id=canvasimagesource>CanvasImageSource</dfn>;

enum <dfn id=canvasfillrule>CanvasFillRule</dfn> { "<a href=#dom-context-2d-fillrule-nonzero id=2dcontext:dom-context-2d-fillrule-nonzero>nonzero</a>", "<a href=#dom-context-2d-fillrule-evenodd id=2dcontext:dom-context-2d-fillrule-evenodd>evenodd</a>" };

dictionary <dfn id=canvasrenderingcontext2dsettings>CanvasRenderingContext2DSettings</dfn> {
  boolean <a href=#dom-canvasrenderingcontext2dsettings-alpha id=2dcontext:dom-canvasrenderingcontext2dsettings-alpha>alpha</a> = true;
};

enum <dfn id=imagesmoothingquality>ImageSmoothingQuality</dfn> { "<a href=#dom-context-2d-imagesmoothingquality-low id=2dcontext:dom-context-2d-imagesmoothingquality-low>low</a>", "<a href=#dom-context-2d-imagesmoothingquality-medium id=2dcontext:dom-context-2d-imagesmoothingquality-medium>medium</a>", "<a href=#dom-context-2d-imagesmoothingquality-high id=2dcontext:dom-context-2d-imagesmoothingquality-high>high</a>" };

interface <dfn id=canvasrenderingcontext2d>CanvasRenderingContext2D</dfn> {
  // back-reference to the canvas
  readonly attribute <a href=#htmlcanvaselement id=2dcontext:htmlcanvaselement-2>HTMLCanvasElement</a> <a href=#dom-context-2d-canvas id=2dcontext:dom-context-2d-canvas>canvas</a>;
};
<a href=#canvasrenderingcontext2d id=2dcontext:canvasrenderingcontext2d>CanvasRenderingContext2D</a> implements <a href=#canvasstate id=2dcontext:canvasstate>CanvasState</a>;
<a href=#canvasrenderingcontext2d id=2dcontext:canvasrenderingcontext2d-2>CanvasRenderingContext2D</a> implements <a href=#canvastransform id=2dcontext:canvastransform>CanvasTransform</a>;
<a href=#canvasrenderingcontext2d id=2dcontext:canvasrenderingcontext2d-3>CanvasRenderingContext2D</a> implements <a href=#canvascompositing id=2dcontext:canvascompositing>CanvasCompositing</a>;
<a href=#canvasrenderingcontext2d id=2dcontext:canvasrenderingcontext2d-4>CanvasRenderingContext2D</a> implements <a href=#canvasimagesmoothing id=2dcontext:canvasimagesmoothing>CanvasImageSmoothing</a>;
<a href=#canvasrenderingcontext2d id=2dcontext:canvasrenderingcontext2d-5>CanvasRenderingContext2D</a> implements <a href=#canvasfillstrokestyles id=2dcontext:canvasfillstrokestyles>CanvasFillStrokeStyles</a>;
<a href=#canvasrenderingcontext2d id=2dcontext:canvasrenderingcontext2d-6>CanvasRenderingContext2D</a> implements <a href=#canvasshadowstyles id=2dcontext:canvasshadowstyles>CanvasShadowStyles</a>;
<a href=#canvasrenderingcontext2d id=2dcontext:canvasrenderingcontext2d-7>CanvasRenderingContext2D</a> implements <a href=#canvasfilters id=2dcontext:canvasfilters>CanvasFilters</a>;
<a href=#canvasrenderingcontext2d id=2dcontext:canvasrenderingcontext2d-8>CanvasRenderingContext2D</a> implements <a href=#canvasrect id=2dcontext:canvasrect>CanvasRect</a>;
<a href=#canvasrenderingcontext2d id=2dcontext:canvasrenderingcontext2d-9>CanvasRenderingContext2D</a> implements <a href=#canvasdrawpath id=2dcontext:canvasdrawpath>CanvasDrawPath</a>;
<a href=#canvasrenderingcontext2d id=2dcontext:canvasrenderingcontext2d-10>CanvasRenderingContext2D</a> implements <a href=#canvasuserinterface id=2dcontext:canvasuserinterface>CanvasUserInterface</a>;
<a href=#canvasrenderingcontext2d id=2dcontext:canvasrenderingcontext2d-11>CanvasRenderingContext2D</a> implements <a href=#canvastext id=2dcontext:canvastext>CanvasText</a>;
<a href=#canvasrenderingcontext2d id=2dcontext:canvasrenderingcontext2d-12>CanvasRenderingContext2D</a> implements <a href=#canvasdrawimage id=2dcontext:canvasdrawimage>CanvasDrawImage</a>;
<a href=#canvasrenderingcontext2d id=2dcontext:canvasrenderingcontext2d-13>CanvasRenderingContext2D</a> implements <a href=#canvasimagedata id=2dcontext:canvasimagedata>CanvasImageData</a>;
<a href=#canvasrenderingcontext2d id=2dcontext:canvasrenderingcontext2d-14>CanvasRenderingContext2D</a> implements <a href=#canvaspathdrawingstyles id=2dcontext:canvaspathdrawingstyles>CanvasPathDrawingStyles</a>;
<a href=#canvasrenderingcontext2d id=2dcontext:canvasrenderingcontext2d-15>CanvasRenderingContext2D</a> implements <a href=#canvastextdrawingstyles id=2dcontext:canvastextdrawingstyles>CanvasTextDrawingStyles</a>;
<a href=#canvasrenderingcontext2d id=2dcontext:canvasrenderingcontext2d-16>CanvasRenderingContext2D</a> implements <a href=#canvaspath id=2dcontext:canvaspath>CanvasPath</a>;

[NoInterfaceObject, Exposed=(Window,Worker)]
interface <dfn id=canvasstate>CanvasState</dfn> {
  // state
  void <a href=#dom-context-2d-save id=2dcontext:dom-context-2d-save>save</a>(); // push state on state stack
  void <a href=#dom-context-2d-restore id=2dcontext:dom-context-2d-restore>restore</a>(); // pop state stack and restore state
};

[NoInterfaceObject, Exposed=(Window,Worker)]
interface <dfn id=canvastransform>CanvasTransform</dfn> {
  // transformations (default transform is the identity matrix)
  void <a href=#dom-context-2d-scale id=2dcontext:dom-context-2d-scale>scale</a>(unrestricted double x, unrestricted double y);
  void <a href=#dom-context-2d-rotate id=2dcontext:dom-context-2d-rotate>rotate</a>(unrestricted double angle);
  void <a href=#dom-context-2d-translate id=2dcontext:dom-context-2d-translate>translate</a>(unrestricted double x, unrestricted double y);
  void <a href=#dom-context-2d-transform id=2dcontext:dom-context-2d-transform>transform</a>(unrestricted double a, unrestricted double b, unrestricted double c, unrestricted double d, unrestricted double e, unrestricted double f);

  [NewObject] <a id=2dcontext:dommatrix href=https://drafts.fxtf.org/geometry/#dommatrix data-x-internal=dommatrix>DOMMatrix</a> <a href=#dom-context-2d-gettransform id=2dcontext:dom-context-2d-gettransform>getTransform</a>();
  void <a href=#dom-context-2d-settransform id=2dcontext:dom-context-2d-settransform>setTransform</a>(unrestricted double a, unrestricted double b, unrestricted double c, unrestricted double d, unrestricted double e, unrestricted double f);
  void <a href=#dom-context-2d-settransform id=2dcontext:dom-context-2d-settransform-2>setTransform</a>(optional <a id=2dcontext:dommatrixinit href=https://drafts.fxtf.org/geometry/#dictdef-dommatrixinit data-x-internal=dommatrixinit>DOMMatrixInit</a> transform);
  void <a href=#dom-context-2d-resettransform id=2dcontext:dom-context-2d-resettransform>resetTransform</a>();

};

[NoInterfaceObject, Exposed=(Window,Worker)]
interface <dfn id=canvascompositing>CanvasCompositing</dfn> {
  // compositing
  attribute unrestricted double <a href=#dom-context-2d-globalalpha id=2dcontext:dom-context-2d-globalalpha>globalAlpha</a>; // (default 1.0)
  attribute DOMString <a href=#dom-context-2d-globalcompositeoperation id=2dcontext:dom-context-2d-globalcompositeoperation>globalCompositeOperation</a>; // (default source-over)
};

[NoInterfaceObject, Exposed=(Window,Worker)]
interface <dfn id=canvasimagesmoothing>CanvasImageSmoothing</dfn> {
  // image smoothing
  attribute boolean <a href=#dom-context-2d-imagesmoothingenabled id=2dcontext:dom-context-2d-imagesmoothingenabled>imageSmoothingEnabled</a>; // (default true)
  attribute <a href=#imagesmoothingquality id=2dcontext:imagesmoothingquality>ImageSmoothingQuality</a> <a href=#dom-context-2d-imagesmoothingquality id=2dcontext:dom-context-2d-imagesmoothingquality>imageSmoothingQuality</a>; // (default low)

};

[NoInterfaceObject, Exposed=(Window,Worker)]
interface <dfn id=canvasfillstrokestyles>CanvasFillStrokeStyles</dfn> {
  // colors and styles (see also the <a href=#canvaspathdrawingstyles id=2dcontext:canvaspathdrawingstyles-2>CanvasPathDrawingStyles</a> and <a href=#canvastextdrawingstyles id=2dcontext:canvastextdrawingstyles-2>CanvasTextDrawingStyles</a> interfaces)
  attribute (DOMString or CanvasGradient or CanvasPattern) <a href=#dom-context-2d-strokestyle id=2dcontext:dom-context-2d-strokestyle>strokeStyle</a>; // (default black)
  attribute (DOMString or CanvasGradient or CanvasPattern) <a href=#dom-context-2d-fillstyle id=2dcontext:dom-context-2d-fillstyle>fillStyle</a>; // (default black)
  <a href=#canvasgradient id=2dcontext:canvasgradient>CanvasGradient</a> <a href=#dom-context-2d-createlineargradient id=2dcontext:dom-context-2d-createlineargradient>createLinearGradient</a>(double x0, double y0, double x1, double y1);
  <a href=#canvasgradient id=2dcontext:canvasgradient-2>CanvasGradient</a> <a href=#dom-context-2d-createradialgradient id=2dcontext:dom-context-2d-createradialgradient>createRadialGradient</a>(double x0, double y0, double r0, double x1, double y1, double r1);
  <a href=#canvaspattern id=2dcontext:canvaspattern>CanvasPattern</a>? <a href=#dom-context-2d-createpattern id=2dcontext:dom-context-2d-createpattern>createPattern</a>(<a href=#canvasimagesource id=2dcontext:canvasimagesource>CanvasImageSource</a> image, [TreatNullAs=EmptyString] DOMString repetition);

};

[NoInterfaceObject, Exposed=(Window,Worker)]
interface <dfn id=canvasshadowstyles>CanvasShadowStyles</dfn> {
  // shadows
  attribute unrestricted double <a href=#dom-context-2d-shadowoffsetx id=2dcontext:dom-context-2d-shadowoffsetx>shadowOffsetX</a>; // (default 0)
  attribute unrestricted double <a href=#dom-context-2d-shadowoffsety id=2dcontext:dom-context-2d-shadowoffsety>shadowOffsetY</a>; // (default 0)
  attribute unrestricted double <a href=#dom-context-2d-shadowblur id=2dcontext:dom-context-2d-shadowblur>shadowBlur</a>; // (default 0)
  attribute DOMString <a href=#dom-context-2d-shadowcolor id=2dcontext:dom-context-2d-shadowcolor>shadowColor</a>; // (default transparent black)
};

[NoInterfaceObject, Exposed=(Window,Worker)]
interface <dfn id=canvasfilters>CanvasFilters</dfn> {
  // filters
  attribute DOMString <a href=#dom-context-2d-filter id=2dcontext:dom-context-2d-filter>filter</a>; // (default "none")
};

[NoInterfaceObject, Exposed=(Window,Worker)]
interface <dfn id=canvasrect>CanvasRect</dfn> {
  // rects
  void <a href=#dom-context-2d-clearrect id=2dcontext:dom-context-2d-clearrect>clearRect</a>(unrestricted double x, unrestricted double y, unrestricted double w, unrestricted double h);
  void <a href=#dom-context-2d-fillrect id=2dcontext:dom-context-2d-fillrect>fillRect</a>(unrestricted double x, unrestricted double y, unrestricted double w, unrestricted double h);
  void <a href=#dom-context-2d-strokerect id=2dcontext:dom-context-2d-strokerect>strokeRect</a>(unrestricted double x, unrestricted double y, unrestricted double w, unrestricted double h);
};

[NoInterfaceObject, Exposed=(Window,Worker)]
interface <dfn id=canvasdrawpath>CanvasDrawPath</dfn> {
  // path API (see also <a href=#canvaspath id=2dcontext:canvaspath-2>CanvasPath</a>)
  void <a href=#dom-context-2d-beginpath id=2dcontext:dom-context-2d-beginpath>beginPath</a>();
  void <a href=#dom-context-2d-fill id=2dcontext:dom-context-2d-fill>fill</a>(optional <a href=#canvasfillrule id=2dcontext:canvasfillrule>CanvasFillRule</a> fillRule = "<a href=#dom-context-2d-fillrule-nonzero id=2dcontext:dom-context-2d-fillrule-nonzero-2>nonzero</a>");
  void <a href=#dom-context-2d-fill id=2dcontext:dom-context-2d-fill-2>fill</a>(<a href=#path2d id=2dcontext:path2d>Path2D</a> path, optional <a href=#canvasfillrule id=2dcontext:canvasfillrule-2>CanvasFillRule</a> fillRule = "<a href=#dom-context-2d-fillrule-nonzero id=2dcontext:dom-context-2d-fillrule-nonzero-3>nonzero</a>");
  void <a href=#dom-context-2d-stroke id=2dcontext:dom-context-2d-stroke>stroke</a>();
  void <a href=#dom-context-2d-stroke id=2dcontext:dom-context-2d-stroke-2>stroke</a>(<a href=#path2d id=2dcontext:path2d-2>Path2D</a> path);
  void <a href=#dom-context-2d-clip id=2dcontext:dom-context-2d-clip>clip</a>(optional <a href=#canvasfillrule id=2dcontext:canvasfillrule-3>CanvasFillRule</a> fillRule = "<a href=#dom-context-2d-fillrule-nonzero id=2dcontext:dom-context-2d-fillrule-nonzero-4>nonzero</a>");
  void <a href=#dom-context-2d-clip id=2dcontext:dom-context-2d-clip-2>clip</a>(<a href=#path2d id=2dcontext:path2d-3>Path2D</a> path, optional <a href=#canvasfillrule id=2dcontext:canvasfillrule-4>CanvasFillRule</a> fillRule = "<a href=#dom-context-2d-fillrule-nonzero id=2dcontext:dom-context-2d-fillrule-nonzero-5>nonzero</a>");
  void <a href=#dom-context-2d-resetclip id=2dcontext:dom-context-2d-resetclip>resetClip</a>();
  boolean <a href=#dom-context-2d-ispointinpath id=2dcontext:dom-context-2d-ispointinpath>isPointInPath</a>(unrestricted double x, unrestricted double y, optional <a href=#canvasfillrule id=2dcontext:canvasfillrule-5>CanvasFillRule</a> fillRule = "<a href=#dom-context-2d-fillrule-nonzero id=2dcontext:dom-context-2d-fillrule-nonzero-6>nonzero</a>");
  boolean <a href=#dom-context-2d-ispointinpath id=2dcontext:dom-context-2d-ispointinpath-2>isPointInPath</a>(<a href=#path2d id=2dcontext:path2d-4>Path2D</a> path, unrestricted double x, unrestricted double y, optional <a href=#canvasfillrule id=2dcontext:canvasfillrule-6>CanvasFillRule</a> fillRule = "<a href=#dom-context-2d-fillrule-nonzero id=2dcontext:dom-context-2d-fillrule-nonzero-7>nonzero</a>");
  boolean <a href=#dom-context-2d-ispointinstroke id=2dcontext:dom-context-2d-ispointinstroke>isPointInStroke</a>(unrestricted double x, unrestricted double y);
  boolean <a href=#dom-context-2d-ispointinstroke id=2dcontext:dom-context-2d-ispointinstroke-2>isPointInStroke</a>(<a href=#path2d id=2dcontext:path2d-5>Path2D</a> path, unrestricted double x, unrestricted double y);
};

[NoInterfaceObject]
interface <dfn id=canvasuserinterface>CanvasUserInterface</dfn> {
  void <a href=#dom-context-2d-drawfocusifneeded id=2dcontext:dom-context-2d-drawfocusifneeded>drawFocusIfNeeded</a>(<a id=2dcontext:element href=https://triple-underscore.github.io/DOM4-ja.html#interface-element data-x-internal=element>Element</a> element);
  void <a href=#dom-context-2d-drawfocusifneeded id=2dcontext:dom-context-2d-drawfocusifneeded-2>drawFocusIfNeeded</a>(<a href=#path2d id=2dcontext:path2d-6>Path2D</a> path, <a id=2dcontext:element-2 href=https://triple-underscore.github.io/DOM4-ja.html#interface-element data-x-internal=element>Element</a> element);
  void <a href=#dom-context-2d-scrollpathintoview id=2dcontext:dom-context-2d-scrollpathintoview>scrollPathIntoView</a>();
  void <a href=#dom-context-2d-scrollpathintoview id=2dcontext:dom-context-2d-scrollpathintoview-2>scrollPathIntoView</a>(<a href=#path2d id=2dcontext:path2d-7>Path2D</a> path);
};

[NoInterfaceObject]
interface <dfn id=canvastext>CanvasText</dfn> {
  // text (see also the <a href=#canvaspathdrawingstyles id=2dcontext:canvaspathdrawingstyles-3>CanvasPathDrawingStyles</a> and <a href=#canvastextdrawingstyles id=2dcontext:canvastextdrawingstyles-3>CanvasTextDrawingStyles</a> interfaces)
  void <a href=#dom-context-2d-filltext id=2dcontext:dom-context-2d-filltext>fillText</a>(DOMString text, unrestricted double x, unrestricted double y, optional unrestricted double maxWidth);
  void <a href=#dom-context-2d-stroketext id=2dcontext:dom-context-2d-stroketext>strokeText</a>(DOMString text, unrestricted double x, unrestricted double y, optional unrestricted double maxWidth);
  <a href=#textmetrics id=2dcontext:textmetrics>TextMetrics</a> <a href=#dom-context-2d-measuretext id=2dcontext:dom-context-2d-measuretext>measureText</a>(DOMString text);
};

[NoInterfaceObject, Exposed=(Window,Worker)]
interface <dfn id=canvasdrawimage>CanvasDrawImage</dfn> {
  // drawing images
  void <a href=#dom-context-2d-drawimage id=2dcontext:dom-context-2d-drawimage>drawImage</a>(<a href=#canvasimagesource id=2dcontext:canvasimagesource-2>CanvasImageSource</a> image, unrestricted double dx, unrestricted double dy);
  void <a href=#dom-context-2d-drawimage id=2dcontext:dom-context-2d-drawimage-2>drawImage</a>(<a href=#canvasimagesource id=2dcontext:canvasimagesource-3>CanvasImageSource</a> image, unrestricted double dx, unrestricted double dy, unrestricted double dw, unrestricted double dh);
  void <a href=#dom-context-2d-drawimage id=2dcontext:dom-context-2d-drawimage-3>drawImage</a>(<a href=#canvasimagesource id=2dcontext:canvasimagesource-4>CanvasImageSource</a> image, unrestricted double sx, unrestricted double sy, unrestricted double sw, unrestricted double sh, unrestricted double dx, unrestricted double dy, unrestricted double dw, unrestricted double dh);
};

[NoInterfaceObject, Exposed=(Window,Worker)]
interface <dfn id=canvasimagedata>CanvasImageData</dfn> {
  // <a href=#pixel-manipulation id=2dcontext:pixel-manipulation>pixel manipulation</a>
  <a href=#imagedata id=2dcontext:imagedata>ImageData</a> <a href=#dom-context-2d-createimagedata id=2dcontext:dom-context-2d-createimagedata>createImageData</a>(long sw, long sh);
  <a href=#imagedata id=2dcontext:imagedata-2>ImageData</a> <a href=#dom-context-2d-createimagedata id=2dcontext:dom-context-2d-createimagedata-2>createImageData</a>(<a href=#imagedata id=2dcontext:imagedata-3>ImageData</a> imagedata);
  <a href=#imagedata id=2dcontext:imagedata-4>ImageData</a> <a href=#dom-context-2d-getimagedata id=2dcontext:dom-context-2d-getimagedata>getImageData</a>(long sx, long sy, long sw, long sh);
  void <a href=#dom-context-2d-putimagedata id=2dcontext:dom-context-2d-putimagedata>putImageData</a>(<a href=#imagedata id=2dcontext:imagedata-5>ImageData</a> imagedata, long dx, long dy);
  void <a href=#dom-context-2d-putimagedata id=2dcontext:dom-context-2d-putimagedata-2>putImageData</a>(<a href=#imagedata id=2dcontext:imagedata-6>ImageData</a> imagedata, long dx, long dy, long dirtyX, long dirtyY, long dirtyWidth, long dirtyHeight);
};

enum <dfn id=canvaslinecap>CanvasLineCap</dfn> { "butt", "round", "square" };
enum <dfn id=canvaslinejoin>CanvasLineJoin</dfn> { "round", "bevel", "miter" };
enum <dfn id=canvastextalign>CanvasTextAlign</dfn> { "<a href=#dom-context-2d-textalign-start id=2dcontext:dom-context-2d-textalign-start>start</a>", "<a href=#dom-context-2d-textalign-end id=2dcontext:dom-context-2d-textalign-end>end</a>", "<a href=#dom-context-2d-textalign-left id=2dcontext:dom-context-2d-textalign-left>left</a>", "<a href=#dom-context-2d-textalign-right id=2dcontext:dom-context-2d-textalign-right>right</a>", "<a href=#dom-context-2d-textalign-center id=2dcontext:dom-context-2d-textalign-center>center</a>" };
enum <dfn id=canvastextbaseline>CanvasTextBaseline</dfn> { "<a href=#dom-context-2d-textbaseline-top id=2dcontext:dom-context-2d-textbaseline-top>top</a>", "<a href=#dom-context-2d-textbaseline-hanging id=2dcontext:dom-context-2d-textbaseline-hanging>hanging</a>", "<a href=#dom-context-2d-textbaseline-middle id=2dcontext:dom-context-2d-textbaseline-middle>middle</a>", "<a href=#dom-context-2d-textbaseline-alphabetic id=2dcontext:dom-context-2d-textbaseline-alphabetic>alphabetic</a>", "<a href=#dom-context-2d-textbaseline-ideographic id=2dcontext:dom-context-2d-textbaseline-ideographic>ideographic</a>", "<a href=#dom-context-2d-textbaseline-bottom id=2dcontext:dom-context-2d-textbaseline-bottom>bottom</a>" };
enum <dfn id=canvasdirection>CanvasDirection</dfn> { "<a href=#dom-context-2d-direction-ltr id=2dcontext:dom-context-2d-direction-ltr>ltr</a>", "<a href=#dom-context-2d-direction-rtl id=2dcontext:dom-context-2d-direction-rtl>rtl</a>", "<a href=#dom-context-2d-direction-inherit id=2dcontext:dom-context-2d-direction-inherit>inherit</a>" };

[NoInterfaceObject, Exposed=(Window,Worker)]
interface <dfn id=canvaspathdrawingstyles>CanvasPathDrawingStyles</dfn> {
  // line caps/joins
  attribute unrestricted double <a href=#dom-context-2d-linewidth id=2dcontext:dom-context-2d-linewidth>lineWidth</a>; // (default 1)
  attribute <a href=#canvaslinecap id=2dcontext:canvaslinecap>CanvasLineCap</a> <a href=#dom-context-2d-linecap id=2dcontext:dom-context-2d-linecap>lineCap</a>; // (default "butt")
  attribute <a href=#canvaslinejoin id=2dcontext:canvaslinejoin>CanvasLineJoin</a> <a href=#dom-context-2d-linejoin id=2dcontext:dom-context-2d-linejoin>lineJoin</a>; // (default "miter")
  attribute unrestricted double <a href=#dom-context-2d-miterlimit id=2dcontext:dom-context-2d-miterlimit>miterLimit</a>; // (default 10)

  // dashed lines
  void <a href=#dom-context-2d-setlinedash id=2dcontext:dom-context-2d-setlinedash>setLineDash</a>(sequence&lt;unrestricted double&gt; segments); // default empty
  sequence&lt;unrestricted double&gt; <a href=#dom-context-2d-getlinedash id=2dcontext:dom-context-2d-getlinedash>getLineDash</a>();
  attribute unrestricted double <a href=#dom-context-2d-linedashoffset id=2dcontext:dom-context-2d-linedashoffset>lineDashOffset</a>;
};

[NoInterfaceObject]
interface <dfn id=canvastextdrawingstyles>CanvasTextDrawingStyles</dfn> {
  // text
  attribute DOMString <a href=#dom-context-2d-font id=2dcontext:dom-context-2d-font>font</a>; // (default 10px sans-serif)
  attribute <a href=#canvastextalign id=2dcontext:canvastextalign>CanvasTextAlign</a> <a href=#dom-context-2d-textalign id=2dcontext:dom-context-2d-textalign>textAlign</a>; // (default: "start")
  attribute <a href=#canvastextbaseline id=2dcontext:canvastextbaseline>CanvasTextBaseline</a> <a href=#dom-context-2d-textbaseline id=2dcontext:dom-context-2d-textbaseline>textBaseline</a>; // (default: "alphabetic")
  attribute <a href=#canvasdirection id=2dcontext:canvasdirection>CanvasDirection</a> <a href=#dom-context-2d-direction id=2dcontext:dom-context-2d-direction>direction</a>; // (default: "inherit")
};

[NoInterfaceObject, Exposed=(Window,Worker)]
interface <dfn id=canvaspath>CanvasPath</dfn> {
  // shared path API methods
  void <a href=#dom-context-2d-closepath id=2dcontext:dom-context-2d-closepath>closePath</a>();
  void <a href=#dom-context-2d-moveto id=2dcontext:dom-context-2d-moveto>moveTo</a>(unrestricted double x, unrestricted double y);
  void <a href=#dom-context-2d-lineto id=2dcontext:dom-context-2d-lineto>lineTo</a>(unrestricted double x, unrestricted double y);
  void <a href=#dom-context-2d-quadraticcurveto id=2dcontext:dom-context-2d-quadraticcurveto>quadraticCurveTo</a>(unrestricted double cpx, unrestricted double cpy, unrestricted double x, unrestricted double y);
  void <a href=#dom-context-2d-beziercurveto id=2dcontext:dom-context-2d-beziercurveto>bezierCurveTo</a>(unrestricted double cp1x, unrestricted double cp1y, unrestricted double cp2x, unrestricted double cp2y, unrestricted double x, unrestricted double y);
  void <a href=#dom-context-2d-arcto id=2dcontext:dom-context-2d-arcto>arcTo</a>(unrestricted double x1, unrestricted double y1, unrestricted double x2, unrestricted double y2, unrestricted double radius); 
  void <a href=#dom-context-2d-arcto id=2dcontext:dom-context-2d-arcto-2>arcTo</a>(unrestricted double x1, unrestricted double y1, unrestricted double x2, unrestricted double y2, unrestricted double radiusX, unrestricted double radiusY, unrestricted double rotation); 
  void <a href=#dom-context-2d-rect id=2dcontext:dom-context-2d-rect>rect</a>(unrestricted double x, unrestricted double y, unrestricted double w, unrestricted double h);
  void <a href=#dom-context-2d-arc id=2dcontext:dom-context-2d-arc>arc</a>(unrestricted double x, unrestricted double y, unrestricted double radius, unrestricted double startAngle, unrestricted double endAngle, optional boolean anticlockwise = false); 
  void <a href=#dom-context-2d-ellipse id=2dcontext:dom-context-2d-ellipse>ellipse</a>(unrestricted double x, unrestricted double y, unrestricted double radiusX, unrestricted double radiusY, unrestricted double rotation, unrestricted double startAngle, unrestricted double endAngle, optional boolean anticlockwise = false); 
};

[Exposed=(Window,Worker)]
interface <dfn id=canvasgradient>CanvasGradient</dfn> {
  // opaque object
  void <a href=#dom-canvasgradient-addcolorstop id=2dcontext:dom-canvasgradient-addcolorstop>addColorStop</a>(double offset, DOMString color);
};

[Exposed=(Window,Worker)]
interface <dfn id=canvaspattern>CanvasPattern</dfn> {
  // opaque object
  void <a href=#dom-canvaspattern-settransform id=2dcontext:dom-canvaspattern-settransform>setTransform</a>(optional <a id=2dcontext:dommatrixinit-2 href=https://drafts.fxtf.org/geometry/#dictdef-dommatrixinit data-x-internal=dommatrixinit>DOMMatrixInit</a> transform);
};

interface <dfn id=textmetrics>TextMetrics</dfn> {
  // x-direction
  readonly attribute double <a href=#dom-textmetrics-width id=2dcontext:dom-textmetrics-width>width</a>; // advance width
  readonly attribute double <a href=#dom-textmetrics-actualboundingboxleft id=2dcontext:dom-textmetrics-actualboundingboxleft>actualBoundingBoxLeft</a>;
  readonly attribute double <a href=#dom-textmetrics-actualboundingboxright id=2dcontext:dom-textmetrics-actualboundingboxright>actualBoundingBoxRight</a>;

  // y-direction
  readonly attribute double <a href=#dom-textmetrics-fontboundingboxascent id=2dcontext:dom-textmetrics-fontboundingboxascent>fontBoundingBoxAscent</a>;
  readonly attribute double <a href=#dom-textmetrics-fontboundingboxdescent id=2dcontext:dom-textmetrics-fontboundingboxdescent>fontBoundingBoxDescent</a>;
  readonly attribute double <a href=#dom-textmetrics-actualboundingboxascent id=2dcontext:dom-textmetrics-actualboundingboxascent>actualBoundingBoxAscent</a>;
  readonly attribute double <a href=#dom-textmetrics-actualboundingboxdescent id=2dcontext:dom-textmetrics-actualboundingboxdescent>actualBoundingBoxDescent</a>;
  readonly attribute double <a href=#dom-textmetrics-emheightascent id=2dcontext:dom-textmetrics-emheightascent>emHeightAscent</a>;
  readonly attribute double <a href=#dom-textmetrics-emheightdescent id=2dcontext:dom-textmetrics-emheightdescent>emHeightDescent</a>;
  readonly attribute double <a href=#dom-textmetrics-hangingbaseline id=2dcontext:dom-textmetrics-hangingbaseline>hangingBaseline</a>;
  readonly attribute double <a href=#dom-textmetrics-alphabeticbaseline id=2dcontext:dom-textmetrics-alphabeticbaseline>alphabeticBaseline</a>;
  readonly attribute double <a href=#dom-textmetrics-ideographicbaseline id=2dcontext:dom-textmetrics-ideographicbaseline>ideographicBaseline</a>;
};

[<a href=#dom-imagedata id=2dcontext:dom-imagedata>Constructor</a>(unsigned long sw, unsigned long sh),
 <a href=#dom-imagedata id=2dcontext:dom-imagedata-2>Constructor</a>(<a href=https://triple-underscore.github.io/WebIDL-ja.html#idl-Uint8ClampedArray id=2dcontext:idl-uint8clampedarray data-x-internal=idl-uint8clampedarray>Uint8ClampedArray</a> data, unsigned long sw, optional unsigned long sh),
 Exposed=(Window,Worker),
 <a id=2dcontext:serializable href=infrastructure.html#serializable>Serializable</a>]
interface <dfn id=imagedata>ImageData</dfn> {
  readonly attribute unsigned long <a href=#dom-imagedata-width id=2dcontext:dom-imagedata-width>width</a>;
  readonly attribute unsigned long <a href=#dom-imagedata-height id=2dcontext:dom-imagedata-height>height</a>;
  readonly attribute <a href=https://triple-underscore.github.io/WebIDL-ja.html#idl-Uint8ClampedArray id=2dcontext:idl-uint8clampedarray-2 data-x-internal=idl-uint8clampedarray>Uint8ClampedArray</a> <a href=#dom-imagedata-data id=2dcontext:dom-imagedata-data>data</a>;
};

[<a href=#dom-path2d id=2dcontext:dom-path2d>Constructor</a>,
 <a href=#dom-path2d-copy id=2dcontext:dom-path2d-copy>Constructor</a>(<a href=#path2d id=2dcontext:path2d-8>Path2D</a> path),
 <a href=#dom-path2d-merge id=2dcontext:dom-path2d-merge>Constructor</a>(sequence&lt;<a href=#path2d id=2dcontext:path2d-9>Path2D</a>&gt; paths, optional <a href=#canvasfillrule id=2dcontext:canvasfillrule-7>CanvasFillRule</a> fillRule = "<a href=#dom-context-2d-fillrule-nonzero id=2dcontext:dom-context-2d-fillrule-nonzero-8>nonzero</a>"),
 <a href=#dom-path2d-withdata id=2dcontext:dom-path2d-withdata>Constructor</a>(DOMString d), Exposed=(Window,Worker)]
interface <dfn id=path2d>Path2D</dfn> {
  void <a href=#dom-path2d-addpath id=2dcontext:dom-path2d-addpath>addPath</a>(<a href=#path2d id=2dcontext:path2d-10>Path2D</a> path, optional <a id=2dcontext:dommatrixinit-3 href=https://drafts.fxtf.org/geometry/#dictdef-dommatrixinit data-x-internal=dommatrixinit>DOMMatrixInit</a> transform);
};
<a href=#path2d id=2dcontext:path2d-11>Path2D</a> implements <a href=#canvaspath id=2dcontext:canvaspath-3>CanvasPath</a>;</pre>

 

  <p class=note>To maintain compatibility with existing Web content, user agents need to enumerate
  methods defined in <code id=2dcontext:canvasuserinterface-2><a href=#canvasuserinterface>CanvasUserInterface</a></code> immediately after the <code id=2dcontext:dom-context-2d-stroke-3><a href=#dom-context-2d-stroke>stroke(Path2D)</a></code> method on <code id=2dcontext:canvasrenderingcontext2d-17><a href=#canvasrenderingcontext2d>CanvasRenderingContext2D
  </a></code> objects.</p>

  <dl class=domintro><dt><var>context</var> = <var>canvas</var> . <code id=2dcontext:dom-canvas-getcontext><a href=#dom-canvas-getcontext>getContext</a></code>('2d' [, { [ <code id=2dcontext:dom-canvasrenderingcontext2dsettings-alpha-2><a href=#dom-canvasrenderingcontext2dsettings-alpha>alpha</a></code>: false ] } ] )<dd>

    <p>Returns a <code id=2dcontext:canvasrenderingcontext2d-18><a href=#canvasrenderingcontext2d>CanvasRenderingContext2D</a></code> object that is permanently bound to a
    particular <code id=2dcontext:the-canvas-element><a href=#the-canvas-element>canvas</a></code> element.</p>

    <p>If the <code id=2dcontext:dom-canvasrenderingcontext2dsettings-alpha-3><a href=#dom-canvasrenderingcontext2dsettings-alpha>alpha</a></code> setting is
    provided and set to false, then the canvas is forced to always be opaque.</p>

   <dt><var>context</var> . <code id=2dcontext:dom-context-2d-canvas-2><a href=#dom-context-2d-canvas>canvas</a></code><dd>

    <p>Returns the <code id=2dcontext:the-canvas-element-2><a href=#the-canvas-element>canvas</a></code> element.</p>

   </dl>

  

  <p>A <code id=2dcontext:canvasrenderingcontext2d-19><a href=#canvasrenderingcontext2d>CanvasRenderingContext2D</a></code> object has an <dfn id=output-bitmap>output bitmap</dfn> that
  is initialized when the object is created.</p>


  <p>The <a href=#output-bitmap id=2dcontext:output-bitmap>output bitmap</a> has an <a href=#concept-canvas-origin-clean id=2dcontext:concept-canvas-origin-clean>origin-clean</a> flag, which can be set to true or false.
  Initially, when one of these bitmaps is created, its <a href=#concept-canvas-origin-clean id=2dcontext:concept-canvas-origin-clean-2>origin-clean</a> flag must be set to true.</p>


  <p>The <code id=2dcontext:canvasrenderingcontext2d-20><a href=#canvasrenderingcontext2d>CanvasRenderingContext2D</a></code> object also has an <dfn id=concept-canvas-alpha>alpha</dfn> flag, which can be set to true or false. Initially,
  when the context is created, its <a href=#concept-canvas-alpha id=2dcontext:concept-canvas-alpha>alpha</a> flag must be
  set to true. When a <code id=2dcontext:canvasrenderingcontext2d-21><a href=#canvasrenderingcontext2d>CanvasRenderingContext2D</a></code> object has its <a href=#concept-canvas-alpha id=2dcontext:concept-canvas-alpha-2>alpha</a> flag set to false, then its alpha channel must be
  fixed to 1.0 (fully opaque) for all pixels, and attempts to change the alpha component of any
  pixel must be silently ignored.</p>

  <p class=note>Thus, the bitmap of such a context starts off as fully-opaque black instead of
  fully-transparent black; <code id=2dcontext:dom-context-2d-clearrect-2><a href=#dom-context-2d-clearrect>clearRect()</a></code> always
  results in fully-opaque black pixels, every fourth byte from <code id=2dcontext:dom-context-2d-getimagedata-2><a href=#dom-context-2d-getimagedata>getImageData()</a></code> is always 255, the <code id=2dcontext:dom-context-2d-putimagedata-3><a href=#dom-context-2d-putimagedata>putImageData()</a></code> method effectively ignores every
  fourth byte in its input, and so on. However, the alpha component of styles and images drawn
  onto the canvas are still honoured up to the point where they would impact the <a href=#output-bitmap id=2dcontext:output-bitmap-2>output
  bitmap</a>'s alpha channel; for instance, drawing a 50% transparent white square on a freshly
  created <a href=#output-bitmap id=2dcontext:output-bitmap-3>output bitmap</a> with its <a href=#concept-canvas-alpha id=2dcontext:concept-canvas-alpha-3>alpha</a>
  flag set to false will result in a fully-opaque gray square.</p>

  <hr>

  <p>The <code id=2dcontext:canvasrenderingcontext2d-22><a href=#canvasrenderingcontext2d>CanvasRenderingContext2D</a></code> 2D rendering context represents a flat linear
  Cartesian surface whose origin (0,0) is at the top left corner, with the coordinate space having
  <var>x</var> values increasing when going right, and <var>y</var> values increasing when going
  down. The <var>x</var>-coordinate of the right-most edge is equal to the width of the rendering
  context's <a href=#output-bitmap id=2dcontext:output-bitmap-4>output bitmap</a> in <a href=https://momdo.github.io/css3-values/#px id="2dcontext:'px'" data-x-internal="'px'">CSS pixels</a>; similarly, the
  <var>y</var>-coordinate of the bottom-most edge is equal to the height of the rendering context's
  <a href=#output-bitmap id=2dcontext:output-bitmap-5>output bitmap</a> in <a href=https://momdo.github.io/css3-values/#px id="2dcontext:'px'-2" data-x-internal="'px'">CSS pixels</a>.</p>

  <p>The size of the coordinate space does not necessarily represent the size of the actual bitmaps
  that the user agent will use internally or during rendering. On high-definition displays, for
  instance, the user agent may internally use bitmaps with two device pixels per unit in the
  coordinate space, so that the rendering remains at high quality throughout. Anti-aliasing can
  similarly be implemented using over-sampling with bitmaps of a higher resolution than the final
  image on the display.</p>

  <hr>

  <p>The <dfn id=2d-context-creation-algorithm>2D context creation algorithm</dfn>, which is passed a <var>target</var> (a
  <code id=2dcontext:the-canvas-element-3><a href=#the-canvas-element>canvas</a></code> element) and optionally some arguments, consists of running the following
  steps:</p>

  <ol><li><p>If the algorithm was passed some arguments, then let <var>arg</var> be the first such
   argument. Otherwise, let <var>arg</var> be undefined.</li><li><p>Let <var>settings</var> be the result of <a href=#coerce-context-arguments-for-2d id=2dcontext:coerce-context-arguments-for-2d>coercing the <var>arg</var> context arguments for 2D</a>.</li><li><p>Create a new <code id=2dcontext:canvasrenderingcontext2d-23><a href=#canvasrenderingcontext2d>CanvasRenderingContext2D</a></code> object.</li><li><p>Initialize its <code id=2dcontext:dom-context-2d-canvas-3><a href=#dom-context-2d-canvas>canvas</a></code> attribute to point to
   <var>target</var>.</li><li><p>Let the new <code id=2dcontext:canvasrenderingcontext2d-24><a href=#canvasrenderingcontext2d>CanvasRenderingContext2D</a></code> object's <a href=#output-bitmap id=2dcontext:output-bitmap-6>output bitmap</a> be
   the same bitmap as <var>target</var>'s bitmap (so that they are shared).</li><li><p><a href=#concept-canvas-set-bitmap-dimensions id=2dcontext:concept-canvas-set-bitmap-dimensions>Set bitmap dimensions</a> to the
   numeric values of <var>target</var>'s <code id=2dcontext:attr-canvas-width><a href=#attr-canvas-width>width</a></code> and
   <code id=2dcontext:attr-canvas-height><a href=#attr-canvas-height>height</a></code> content attributes.</li><li>

    <p>Process each of the members of <var>settings</var> as follows:</p>

    <dl><dt><dfn id=dom-canvasrenderingcontext2dsettings-alpha><code>alpha</code></dfn><dd>If false, then set the new <code id=2dcontext:canvasrenderingcontext2d-25><a href=#canvasrenderingcontext2d>CanvasRenderingContext2D</a></code> object's <a href=#concept-canvas-alpha id=2dcontext:concept-canvas-alpha-4>alpha</a> flag to false.</dl>

   </li><li><p>Return the new <code id=2dcontext:canvasrenderingcontext2d-26><a href=#canvasrenderingcontext2d>CanvasRenderingContext2D</a></code> object.</li></ol>

  <hr>

  <hr>

  <p>When a user agent is required to <dfn id=coerce-context-arguments-for-2d>coerce context arguments for 2D</dfn>, it must run these
  steps:</p>

  <ol><li><p>Let <var>input</var> be the argument to coerce.</li><li><p>Let <var>jsval</var> be the result of <a href=https://triple-underscore.github.io/WebIDL-ja.html#es-type-mapping id=2dcontext:concept-idl-convert data-x-internal=concept-idl-convert>converting</a>
   <var>input</var> to a JavaScript value. If this throws an exception, then propagate the
   exception and abort these steps.</li><li><p>Let <var>dict</var> be the result of <a href=https://triple-underscore.github.io/WebIDL-ja.html#es-type-mapping id=2dcontext:concept-idl-convert-2 data-x-internal=concept-idl-convert>converting</a>
   <var>jsval</var> to the dictionary type <code id=2dcontext:canvasrenderingcontext2dsettings><a href=#canvasrenderingcontext2dsettings>CanvasRenderingContext2DSettings</a></code>. If this
   throws an exception, then propagate the exception and abort these steps.</li><li><p>Return <var>dict</var>.</li></ol>

  <hr>

  <p>When the user agent is to <dfn id=concept-canvas-set-bitmap-dimensions>set bitmap
  dimensions</dfn> to <var>width</var> and <var>height</var>, it must run these steps:</p>

  <ol><li><p><a href=#reset-the-rendering-context-to-its-default-state id=2dcontext:reset-the-rendering-context-to-its-default-state>Reset the rendering context to its default state</a>.</li><li><p>Resize the <a href=#output-bitmap id=2dcontext:output-bitmap-7>output bitmap</a> to the new <var>width</var> and <var>height</var>
   and clear it to fully transparent black.</li><li><p>Let <var>canvas</var> be the <code id=2dcontext:the-canvas-element-4><a href=#the-canvas-element>canvas</a></code> element to which the rendering
   context's <code id=2dcontext:dom-context-2d-canvas-4><a href=#dom-context-2d-canvas>canvas</a></code> attribute was initialized.</li><li><p>If the numeric value of <var>canvas</var>'s <code id=2dcontext:attr-canvas-width-2><a href=#attr-canvas-width>width</a></code>
   content attribute differs from <var>width</var>, then set <var>canvas</var>'s <code id=2dcontext:attr-canvas-width-3><a href=#attr-canvas-width>width</a></code> content attribute to the shortest possible string
   representing <var>width</var> as a <a id=2dcontext:valid-non-negative-integer href=infrastructure.html#valid-non-negative-integer>valid non-negative integer</a>.</li><li><p>If the numeric value of <var>canvas</var>'s <code id=2dcontext:attr-canvas-height-2><a href=#attr-canvas-height>height</a></code>
   content attribute differs from <var>height</var>, then set <var>canvas</var>'s <code id=2dcontext:attr-canvas-height-3><a href=#attr-canvas-height>height</a></code> content attribute to the shortest possible string
   representing <var>height</var> as a <a id=2dcontext:valid-non-negative-integer-2 href=infrastructure.html#valid-non-negative-integer>valid non-negative integer</a>.</li></ol>

  <div class=example>
   <p>Only one square appears to be drawn in the following example:</p>
   <pre>// canvas is a reference to a &lt;canvas&gt; element
var context = canvas.getContext('2d');
context.fillRect(0,0,50,50);
canvas.setAttribute('width', '300'); // clears the canvas
context.fillRect(0,100,50,50);
canvas.width = canvas.width; // clears the canvas
context.fillRect(100,0,50,50); // only this square remains</pre>
  </div>

  <hr>

  <p>When the user agent is to run the <dfn id=concept-canvas-unbinding-steps>unbinding
  steps</dfn> for a rendering context, it must run these steps:</p>

  <ol><li><p><a href=#reset-the-rendering-context-to-its-default-state id=2dcontext:reset-the-rendering-context-to-its-default-state-2>Reset the rendering context to its default state</a>.</li><li><p>Clear the <code id=2dcontext:canvasrenderingcontext2d-27><a href=#canvasrenderingcontext2d>CanvasRenderingContext2D</a></code> object's <a href=#output-bitmap id=2dcontext:output-bitmap-8>output bitmap</a> to a
   transparent black.</li><li><p>Set the <code id=2dcontext:canvasrenderingcontext2d-28><a href=#canvasrenderingcontext2d>CanvasRenderingContext2D</a></code> object's <a href=#concept-canvas-origin-clean id=2dcontext:concept-canvas-origin-clean-3>origin-clean</a> flag to true.</li><li><p>Let the <code id=2dcontext:canvasrenderingcontext2d-29><a href=#canvasrenderingcontext2d>CanvasRenderingContext2D</a></code> object have no <a href=#output-bitmap id=2dcontext:output-bitmap-9>output
   bitmap</a>.</li></ol>

  <p>When the user agent is to run the <dfn id=concept-canvas-binding-steps>binding
  steps</dfn> to bind the rendering context to the <code id=2dcontext:the-canvas-element-5><a href=#the-canvas-element>canvas</a></code> element <var>target</var>, it
  must run these steps:</p>

  <ol><li><p><a href=#reset-the-rendering-context-to-its-default-state id=2dcontext:reset-the-rendering-context-to-its-default-state-3>Reset the rendering context to its default state</a>.</li><li><p>Resize the <code id=2dcontext:canvasrenderingcontext2d-30><a href=#canvasrenderingcontext2d>CanvasRenderingContext2D</a></code> object's <a href=#output-bitmap id=2dcontext:output-bitmap-10>output bitmap</a> to
   the dimensions of <var>target</var>'s bitmap and clear it to fully transparent black.</li><li><p>Set the <code id=2dcontext:canvasrenderingcontext2d-31><a href=#canvasrenderingcontext2d>CanvasRenderingContext2D</a></code> object's <a href=#concept-canvas-origin-clean id=2dcontext:concept-canvas-origin-clean-4>origin-clean</a> flag to true.</li><li><p>Let the <code id=2dcontext:canvasrenderingcontext2d-32><a href=#canvasrenderingcontext2d>CanvasRenderingContext2D</a></code> object's <a href=#output-bitmap id=2dcontext:output-bitmap-11>output bitmap</a> be <var>target</var>'s bitmap.</li></ol>

  <hr>

  <p>The <dfn id=dom-context-2d-canvas><code>canvas</code></dfn> attribute must return the
  value it was initialized to when the object was created.</p>

  <hr>

  <p id=canvasrenderingcontext2d-currentcolor>Whenever the CSS value <code>currentColor</code> is used as a color in the <code id=2dcontext:canvasrenderingcontext2d-33><a href=#canvasrenderingcontext2d>CanvasRenderingContext2D</a></code>
  API, the <a id=2dcontext:computed-value href=https://drafts.csswg.org/css-cascade/#computed-value data-x-internal=computed-value>computed value</a> of the <code>currentColor</code> keyword is
  the <a id=2dcontext:computed-value-2 href=https://drafts.csswg.org/css-cascade/#computed-value data-x-internal=computed-value>computed value</a> of the <a id="2dcontext:'color'" href=https://triple-underscore.github.io/css-color-ja.html#the-color-property data-x-internal="'color'">'color'</a> property on the <code id=2dcontext:the-canvas-element-6><a href=#the-canvas-element>canvas</a></code>
  element at the time that the color is specified (e.g. when the appropriate attribute is set, or
  when the method is called; not when the color is rendered or otherwise used). If the computed
  value of the <a id="2dcontext:'color'-2" href=https://triple-underscore.github.io/css-color-ja.html#the-color-property data-x-internal="'color'">'color'</a> property is undefined for a particular case (e.g. because the element is
  not in a document), then the <a id=2dcontext:computed-value-3 href=https://drafts.csswg.org/css-cascade/#computed-value data-x-internal=computed-value>computed value</a> of the <a id="2dcontext:'color'-3" href=https://triple-underscore.github.io/css-color-ja.html#the-color-property data-x-internal="'color'">'color'</a> property
  for the purposes of determining the computed value of the <code>currentColor</code>
  keyword is fully opaque black. <a href=references.html#refsCSSCOLOR>[CSSCOLOR]</a></p>

  <p>In the case of <code id=2dcontext:dom-canvasgradient-addcolorstop-2><a href=#dom-canvasgradient-addcolorstop>addColorStop()</a></code> on
  <code id=2dcontext:canvasgradient-3><a href=#canvasgradient>CanvasGradient</a></code>, the "<a id=2dcontext:computed-value-4 href=https://drafts.csswg.org/css-cascade/#computed-value data-x-internal=computed-value>computed value</a> of the <a id="2dcontext:'color'-4" href=https://triple-underscore.github.io/css-color-ja.html#the-color-property data-x-internal="'color'">'color'</a>
  property" for the purposes of determining the <a id=2dcontext:computed-value-5 href=https://drafts.csswg.org/css-cascade/#computed-value data-x-internal=computed-value>computed value</a> of the <code>currentColor</code> keyword is always fully opaque black (there is no associated
  element). <a href=references.html#refsCSSCOLOR>[CSSCOLOR]</a></p>

  <p class=note>This is because <code id=2dcontext:canvasgradient-4><a href=#canvasgradient>CanvasGradient</a></code> objects are
  <code id=2dcontext:the-canvas-element-7><a href=#the-canvas-element>canvas</a></code>-neutral — a <code id=2dcontext:canvasgradient-5><a href=#canvasgradient>CanvasGradient</a></code> object created by one
  <code id=2dcontext:the-canvas-element-8><a href=#the-canvas-element>canvas</a></code> can be used by another, and there is therefore no way to know which is the
  "element in question" at the time that the color is specified.</p>

  <p class=note>Similar concerns exist with font-related properties; the rules for those are
  described in detail in the relevant section below.</p>

  

  <hr>

  <p>The <code id=2dcontext:canvasfillrule-8><a href=#canvasfillrule>CanvasFillRule</a></code> enumeration is used to select the <dfn id=fill-rule>fill rule</dfn>
  algorithm by which to determine if a point is inside or outside a path.</p>

  <p>The value "<dfn id=dom-context-2d-fillrule-nonzero><code>nonzero</code></dfn>" value
  indicates the non-zero winding rule, wherein

     a point is considered to be outside a shape if the number of times a half-infinite straight
     line drawn from that point crosses the shape's path going in one direction is equal to the
     number of times it crosses the path going in the other direction.

  

  </p>


  <p>The "<dfn id=dom-context-2d-fillrule-evenodd><code>evenodd</code></dfn>" value indicates
  the even-odd rule, wherein

     a point is considered to be outside a shape if the number of times a half-infinite straight
     line drawn from that point crosses the shape's path is even.

  

  </p>

  <p>If a point is not outside a shape, it is inside the shape.</p>


  <hr>

  <p>The <code id=2dcontext:imagesmoothingquality-2><a href=#imagesmoothingquality>ImageSmoothingQuality</a></code> enumeration is used to express a preference for the
  interpolation quality to use when smoothing images.</p>

  <p>The "<dfn id=dom-context-2d-imagesmoothingquality-low><code>low</code></dfn>" value
  indicates a preference for a low level of image interpolation quality. Low-quality image
  interpolation may be more computationally efficient than higher settings.</p>

  <p>The "<dfn id=dom-context-2d-imagesmoothingquality-medium><code>medium</code></dfn>" value
  indicates a preference for a medium level of image interpolation quality.</p>

  <p>The "<dfn id=dom-context-2d-imagesmoothingquality-high><code>high</code></dfn>" value
  indicates a preference for a high level of image interpolation quality. High-quality image
  interpolation may be more computationally expensive than lower settings.</p>

  <p class=note>Bilinear scaling is an example of a relatively fast, lower-quality image-smoothing
  algorithm. Bicubic or Lanczos scaling are examples of image-smoothing algorithms that produce
  higher-quality output. This specification does not mandate that specific interpolation algorithms
  be used.</p>


  <h6 id=implementation-notes>4.12.5.1.1 Implementation notes<a href=#implementation-notes class=self-link></a></h6>

  <p><i>この節は非規範的である。</i></p>

  <p>The <a href=#output-bitmap id=implementation-notes:output-bitmap>output bitmap</a>, when it is not directly displayed by the user agent,
  implementations can, instead of updating this bitmap, merely remember the sequence of drawing
  operations that have been applied to it until such time as the bitmap's actual data is needed
  (for example because of a call to <code id=implementation-notes:dom-context-2d-drawimage><a href=#dom-context-2d-drawimage>drawImage()</a></code>, or
  the <code id=implementation-notes:dom-createimagebitmap><a href=webappapis.html#dom-createimagebitmap>createImageBitmap()</a></code> factory method). In many
  cases, this will be more memory efficient.</p>

  <p>The bitmap of a <code id=implementation-notes:the-canvas-element><a href=#the-canvas-element>canvas</a></code> element is the one bitmap that's pretty much always going
  to be needed in practice. The <a href=#output-bitmap id=implementation-notes:output-bitmap-2>output bitmap</a> of a rendering context, when it has one,
  is always just an alias to a <code id=implementation-notes:the-canvas-element-2><a href=#the-canvas-element>canvas</a></code> element's bitmap.</p>

  <p>Additional bitmaps are sometimes needed, e.g. to enable fast drawing when the canvas is being
  painted at a different size than its <a href=https://momdo.github.io/css2/conform.html#intrinsic id=implementation-notes:intrinsic-dimensions data-x-internal=intrinsic-dimensions>intrinsic size</a>,
  or to enable double buffering so that graphics updates, like page scrolling for example, can be
  processed concurrently while canvas draw commands are being executed.</p>

  <h6 id=the-canvas-state>4.12.5.1.2 The canvas state<a href=#the-canvas-state class=self-link></a></h6>

  <p>Objects that implement the <code id=the-canvas-state:canvasstate><a href=#canvasstate>CanvasState</a></code> interface maintain a stack of drawing
  states. <dfn id=drawing-state>Drawing states</dfn> consist of:</p>

  <ul class=brief><li>The current <a href=#transformations id=the-canvas-state:transformations>transformation matrix</a>.</li><li>The current <a href=#clipping-region id=the-canvas-state:clipping-region>clipping region</a>.</li><li>The current values of the following attributes: <code id=the-canvas-state:dom-context-2d-strokestyle><a href=#dom-context-2d-strokestyle>strokeStyle</a></code>, <code id=the-canvas-state:dom-context-2d-fillstyle><a href=#dom-context-2d-fillstyle>fillStyle</a></code>, <code id=the-canvas-state:dom-context-2d-globalalpha><a href=#dom-context-2d-globalalpha>globalAlpha</a></code>, <code id=the-canvas-state:dom-context-2d-linewidth><a href=#dom-context-2d-linewidth>lineWidth</a></code>, <code id=the-canvas-state:dom-context-2d-linecap><a href=#dom-context-2d-linecap>lineCap</a></code>, <code id=the-canvas-state:dom-context-2d-linejoin><a href=#dom-context-2d-linejoin>lineJoin</a></code>, <code id=the-canvas-state:dom-context-2d-miterlimit><a href=#dom-context-2d-miterlimit>miterLimit</a></code>, <code id=the-canvas-state:dom-context-2d-linedashoffset><a href=#dom-context-2d-linedashoffset>lineDashOffset</a></code>, <code id=the-canvas-state:dom-context-2d-shadowoffsetx><a href=#dom-context-2d-shadowoffsetx>shadowOffsetX</a></code>, <code id=the-canvas-state:dom-context-2d-shadowoffsety><a href=#dom-context-2d-shadowoffsety>shadowOffsetY</a></code>, <code id=the-canvas-state:dom-context-2d-shadowblur><a href=#dom-context-2d-shadowblur>shadowBlur</a></code>, <code id=the-canvas-state:dom-context-2d-shadowcolor><a href=#dom-context-2d-shadowcolor>shadowColor</a></code>, <code id=the-canvas-state:dom-context-2d-filter><a href=#dom-context-2d-filter>filter</a></code>, <code id=the-canvas-state:dom-context-2d-globalcompositeoperation><a href=#dom-context-2d-globalcompositeoperation>globalCompositeOperation</a></code>, <code id=the-canvas-state:dom-context-2d-font><a href=#dom-context-2d-font>font</a></code>, <code id=the-canvas-state:dom-context-2d-textalign><a href=#dom-context-2d-textalign>textAlign</a></code>, <code id=the-canvas-state:dom-context-2d-textbaseline><a href=#dom-context-2d-textbaseline>textBaseline</a></code>, <code id=the-canvas-state:dom-context-2d-direction><a href=#dom-context-2d-direction>direction</a></code>, <code id=the-canvas-state:dom-context-2d-imagesmoothingenabled><a href=#dom-context-2d-imagesmoothingenabled>imageSmoothingEnabled</a></code>, <code id=the-canvas-state:dom-context-2d-imagesmoothingquality><a href=#dom-context-2d-imagesmoothingquality>imageSmoothingQuality</a></code>.</li><li>The current <a href=#dash-list id=the-canvas-state:dash-list>dash list</a>.</li></ul>

  <p class=note>The <a href=#current-default-path id=the-canvas-state:current-default-path>current default path</a> and the rendering context's bitmaps are not
  part of the drawing state. The <a href=#current-default-path id=the-canvas-state:current-default-path-2>current default path</a> is persistent, and can only be
  reset using the <code id=the-canvas-state:dom-context-2d-beginpath><a href=#dom-context-2d-beginpath>beginPath()</a></code> method. The bitmaps
  depend on whether and how the rendering context is bound to a <code id=the-canvas-state:the-canvas-element><a href=#the-canvas-element>canvas</a></code> element.</p>

  <dl class=domintro><dt><var>context</var> . <code id=the-canvas-state:dom-context-2d-save><a href=#dom-context-2d-save>save</a></code>()<dd>

    <p>Pushes the current state onto the stack.</p>

   <dt><var>context</var> . <code id=the-canvas-state:dom-context-2d-restore><a href=#dom-context-2d-restore>restore</a></code>()<dd>

    <p>Pops the top state on the stack, restoring the context to that state.</p>

   </dl>

  

  <p>The <dfn id=dom-context-2d-save><code>save()</code></dfn> method, when invoked, must push
  a copy of the current drawing state onto the drawing state stack.</p>

  <p>The <dfn id=dom-context-2d-restore><code>restore()</code></dfn> method, when invoked,
  must pop the top entry in the drawing state stack, and reset the drawing state it describes. If
  there is no saved state, then the method must do nothing.</p>

  <p>When the user agent is to <dfn id=reset-the-rendering-context-to-its-default-state>reset the rendering context to its default state</dfn>, it must
  clear the drawing state stack and everything that <a href=#drawing-state id=the-canvas-state:drawing-state>drawing state</a> consists of to
  initial values.</p>

  

  


  <h6 id=line-styles>4.12.5.1.3 Line styles<a href=#line-styles class=self-link></a></h6>

  <dl class=domintro><dt><var>context</var> . <code id=line-styles:dom-context-2d-linewidth><a href=#dom-context-2d-linewidth>lineWidth</a></code> [ = <var>value</var> ]<dt><var>styles</var> . <code id=line-styles:dom-context-2d-linewidth-2><a href=#dom-context-2d-linewidth>lineWidth</a></code> [ = <var>value</var> ]<dd>

    <p>Returns the current line width.</p>

    <p>Can be set, to change the line width. Values that are not finite values greater than zero are
    ignored.</p>

   <dt><var>context</var> . <code id=line-styles:dom-context-2d-linecap><a href=#dom-context-2d-linecap>lineCap</a></code> [ = <var>value</var> ]<dt><var>styles</var> . <code id=line-styles:dom-context-2d-linecap-2><a href=#dom-context-2d-linecap>lineCap</a></code> [ = <var>value</var> ]<dd>

    <p>Returns the current line cap style.</p>

    <p>Can be set, to change the line cap style.</p>

    <p>The possible line cap styles are "<code>butt</code>", "<code>round</code>", and "<code>square</code>". Other values are ignored.</p>

   <dt><var>context</var> . <code id=line-styles:dom-context-2d-linejoin><a href=#dom-context-2d-linejoin>lineJoin</a></code> [ = <var>value</var> ]<dt><var>styles</var> . <code id=line-styles:dom-context-2d-linejoin-2><a href=#dom-context-2d-linejoin>lineJoin</a></code> [ = <var>value</var> ]<dd>

    <p>Returns the current line join style.</p>

    <p>Can be set, to change the line join style.</p>

    <p>The possible line join styles are "<code>bevel</code>", "<code>round</code>", and "<code>miter</code>". Other values are ignored.</p>

   <dt><var>context</var> . <code id=line-styles:dom-context-2d-miterlimit><a href=#dom-context-2d-miterlimit>miterLimit</a></code> [ = <var>value</var> ]<dt><var>styles</var> . <code id=line-styles:dom-context-2d-miterlimit-2><a href=#dom-context-2d-miterlimit>miterLimit</a></code> [ = <var>value</var> ]<dd>

    <p>Returns the current miter limit ratio.</p>

    <p>Can be set, to change the miter limit ratio. Values that are not finite values greater than
    zero are ignored.</p>

   <dt><var>context</var> . <code id=line-styles:dom-context-2d-setlinedash><a href=#dom-context-2d-setlinedash>setLineDash</a></code>(<var>segments</var>)<dt><var>styles</var> . <code id=line-styles:dom-context-2d-setlinedash-2><a href=#dom-context-2d-setlinedash>setLineDash</a></code>(<var>segments</var>)<dd>

    <p>Sets the current line dash pattern (as used when stroking). The argument is a list of
    distances for which to alternately have the line on and the line off.</p>

   <dt><var>segments</var> = <var>context</var> . <code id=line-styles:dom-context-2d-getlinedash><a href=#dom-context-2d-getlinedash>getLineDash</a></code>()<dt><var>segments</var> = <var>styles</var> . <code id=line-styles:dom-context-2d-getlinedash-2><a href=#dom-context-2d-getlinedash>getLineDash</a></code>()<dd>

    <p>Returns a copy of the current line dash pattern. The array returned will always have an even
    number of entries (i.e. the pattern is normalized).</p>

   <dt><var>context</var> . <code id=line-styles:dom-context-2d-linedashoffset><a href=#dom-context-2d-linedashoffset>lineDashOffset</a></code><dt><var>styles</var> . <code id=line-styles:dom-context-2d-linedashoffset-2><a href=#dom-context-2d-linedashoffset>lineDashOffset</a></code><dd>

    <p>Returns the phase offset (in the same units as the line dash pattern).</p>

    <p>Can be set, to change the phase offset. Values that are not finite values are ignored.</p>

   </dl>

  

  <p>Objects that implement the <code id=line-styles:canvaspathdrawingstyles><a href=#canvaspathdrawingstyles>CanvasPathDrawingStyles</a></code> interface have attributes and
  methods (defined in this section) that control how lines are treated by the object.</p>

  <p>The <dfn id=dom-context-2d-linewidth><code>lineWidth</code></dfn> attribute gives the
  width of lines, in coordinate space units. On getting, it must return the current value. On
  setting, zero, negative, infinite, and NaN values must be ignored, leaving the value unchanged;
  other values must change the current value to the new value.</p>

  <p>When the object implementing the <code id=line-styles:canvaspathdrawingstyles-2><a href=#canvaspathdrawingstyles>CanvasPathDrawingStyles</a></code> interface is created, the
  <code id=line-styles:dom-context-2d-linewidth-3><a href=#dom-context-2d-linewidth>lineWidth</a></code> attribute must initially have the value
  1.0.</p>

  <hr>

  <p>The <dfn id=dom-context-2d-linecap><code>lineCap</code></dfn> attribute defines the type
  of endings that UAs will place on the end of lines. The three valid values are "<code>butt</code>", "<code>round</code>", and "<code>square</code>".</p>

  <p>On getting, it must return the current value. On setting, the current value must be changed
  to the new value.</p>

  <p>When the object implementing the <code id=line-styles:canvaspathdrawingstyles-3><a href=#canvaspathdrawingstyles>CanvasPathDrawingStyles</a></code> interface is created, the
  <code id=line-styles:dom-context-2d-linecap-3><a href=#dom-context-2d-linecap>lineCap</a></code> attribute must initially have the value
  "<code>butt</code>".</p>

  <hr>

  <p>The <dfn id=dom-context-2d-linejoin><code>lineJoin</code></dfn> attribute defines the type
  of corners that UAs will place where two lines meet. The three valid values are
  "<code>bevel</code>", "<code>round</code>", and "<code>miter</code>".</p>

  <p>On getting, it must return the current value. On setting, the current value must be changed
  to the new value.</p>

  <p>When the object implementing the <code id=line-styles:canvaspathdrawingstyles-4><a href=#canvaspathdrawingstyles>CanvasPathDrawingStyles</a></code> interface is created, the
  <code id=line-styles:dom-context-2d-linejoin-3><a href=#dom-context-2d-linejoin>lineJoin</a></code> attribute must initially have the value
  "<code>miter</code>".</p>

  <hr>

  <p>When the <code id=line-styles:dom-context-2d-linejoin-4><a href=#dom-context-2d-linejoin>lineJoin</a></code> attribute has the value "<code>miter</code>", strokes use the miter limit ratio to decide how to render joins. The
  miter limit ratio can be explicitly set using the <dfn id=dom-context-2d-miterlimit><code>miterLimit</code></dfn> attribute. On getting, it must return
  the current value. On setting, zero, negative, infinite, and NaN values must be ignored, leaving
  the value unchanged; other values must change the current value to the new value.</p>
  

  <p>When the object implementing the <code id=line-styles:canvaspathdrawingstyles-5><a href=#canvaspathdrawingstyles>CanvasPathDrawingStyles</a></code> interface is created, the
  <code id=line-styles:dom-context-2d-miterlimit-3><a href=#dom-context-2d-miterlimit>miterLimit</a></code> attribute must initially have the value
  10.0.</p>

  <hr>

  <p>Each <code id=line-styles:canvaspathdrawingstyles-6><a href=#canvaspathdrawingstyles>CanvasPathDrawingStyles</a></code> object has a <dfn id=dash-list>dash list</dfn>, which is either
  empty or consists of an even number of non-negative numbers. Initially, the <a href=#dash-list id=line-styles:dash-list>dash list</a>
  must be empty.</p>

  <p>The <dfn id=dom-context-2d-setlinedash><code>setLineDash()</code></dfn> method, when
  invoked, must run these steps:</p>

  <ol><li><p>Let <var>a</var> be the argument.</li><li><p>If any value in <var>a</var> is not finite (e.g. an Infinity or a NaN value), or
   if any value is negative (less than zero), then abort these steps (without throwing an exception;
   user agents could show a message on a developer console, though, as that would be helpful for
   debugging).</li><li><p>If the number of elements in <var>a</var> is odd, then let <var>a</var>
   be the concatenation of two copies of <var>a</var>.</li><li><p>Let the object's <a href=#dash-list id=line-styles:dash-list-2>dash list</a> be <var>a</var>.</li></ol>

  <p>When the <dfn id=dom-context-2d-getlinedash><code>getLineDash()</code></dfn> method is
  invoked, it must return a sequence whose values are the values of the object's <a href=#dash-list id=line-styles:dash-list-3>dash
  list</a>, in the same order.</p>

  <p>It is sometimes useful to change the "phase" of the dash pattern, e.g. to achieve a "marching
  ants" effect. The phase can be set using the <dfn id=dom-context-2d-linedashoffset><code>lineDashOffset</code></dfn> attribute. On getting, it must
  return the current value. On setting, infinite and NaN values must be ignored, leaving the value
  unchanged; other values must change the current value to the new value.</p>

  <p>When the object implementing the <code id=line-styles:canvaspathdrawingstyles-7><a href=#canvaspathdrawingstyles>CanvasPathDrawingStyles</a></code> interface is created, the
  <code id=line-styles:dom-context-2d-linedashoffset-3><a href=#dom-context-2d-linedashoffset>lineDashOffset</a></code> attribute must initially have
  the value 0.0.</p>

  <hr>

  <p>When a user agent is to <dfn id=trace-a-path>trace a path</dfn>, given an object <var>style</var>
  that implements the <code id=line-styles:canvaspathdrawingstyles-8><a href=#canvaspathdrawingstyles>CanvasPathDrawingStyles</a></code> interface, it must run the following
  algorithm. This algorithm returns a new <a href=#concept-path id=line-styles:concept-path>path</a>.</p>

  <ol><li><p>Let <var>path</var> be a copy of the path being traced.</li><li><p>Prune all zero-length <a href=#line-segments id=line-styles:line-segments>line segments</a> from <var>path</var>.</li><li><p>Remove from <var>path</var> any subpaths containing no lines (i.e. subpaths with
   just one point).</li><li><p>Replace each point in each subpath of <var>path</var> other than the first point
   and the last point of each subpath by a <i>join</i> that joins the line leading to that point to
   the line leading out of that point, such that the subpaths all consist of two points (a starting
   point with a line leading out of it, and an ending point with a line leading into it), one or
   more lines (connecting the points and the joins), and zero or more joins (each connecting one
   line to another), connected together such that each subpath is a series of one or more lines with
   a join between each one and a point on each end.</li><li><p>Add a straight closing line to each closed subpath in <var>path</var> connecting
   the last point and the first point of that subpath; change the last point to a join (from the
   previously last line to the newly added closing line), and change the first point to a join (from
   the newly added closing line to the first line).</p>

   </li><li><p>If the <var>styles</var> <a href=#dash-list id=line-styles:dash-list-4>dash list</a> is empty, then jump to the step
   labeled <i>convert</i>.</li><li><p>Let <var>pattern width</var> be the concatenation of all the entries of the <var>styles</var> <a href=#dash-list id=line-styles:dash-list-5>dash list</a>, in coordinate space units.</p>

   </li><li><p>For each subpath <var>subpath</var> in <var>path</var>, run the
   following substeps. These substeps mutate the subpaths in <var>path</var> <i>in
   vivo</i>.</p>

    <ol><li><p>Let <var>subpath width</var> be the length of all the lines of <var>subpath</var>, in coordinate space units.</p>

     </li><li><p>Let <var>offset</var> be the value of the <var>styles</var> <code id=line-styles:dom-context-2d-linedashoffset-4><a href=#dom-context-2d-linedashoffset>lineDashOffset</a></code>, in coordinate space
     units.</li><li>

      <p>While <var>offset</var> is greater than <var>pattern width</var>,
      decrement it by <var>pattern width</var>.</p>

      <p>While <var>offset</var> is less than zero, increment it by <var>pattern
      width</var>.</p>

     </li><li><p>Define <var>L</var> to be a linear coordinate line defined along all lines in
     <var>subpath</var>, such that the start of the first line in the subpath is defined
     as coordinate 0, and the end of the last line in the subpath is defined as coordinate <var>subpath width</var>.</li><li><p>Let <var>position</var> be zero minus <var>offset</var>.</li><li><p><var>index</var>を0にする。</li><li><p>Let <var>current state</var> be <i>off</i> (the other states being <i>on</i>
     and <i>zero-on</i>).</li><li><p><i>Dash on</i>: Let <var>segment length</var> be
     the value of the <var>styles</var> <a href=#dash-list id=line-styles:dash-list-6>dash
     list</a>'s <var>index</var>th entry.</li><li><p>Increment <var>position</var> by <var>segment length</var>.</li><li><p>If <var>position</var> is greater than <var>subpath width</var>,
     then end these substeps for this subpath and start them again for the next subpath; if there
     are no more subpaths, then jump to the step labeled <i>convert</i> instead.</li><li><p>If <var>segment length</var> is non-zero, then let <var>current state</var> be
     <i>on</i>.</li><li><p><var>index</var>を1でインクリメントする。</li><li><p><i>Dash off</i>: Let <var>segment
     length</var> be the value of the <var>styles</var> <a href=#dash-list id=line-styles:dash-list-7>dash list</a>'s <var>index</var>th entry.</li><li><p>Let <var>start</var> be the offset <var>position</var> on <var>L</var>.</li><li><p>Increment <var>position</var> by <var>segment length</var>.</li><li><p>If <var>position</var> is less than zero, then jump to the step labeled
     <i>post-cut</i>.</li><li><p>If <var>start</var> is less than zero, then let <var>start</var> be
     zero.</li><li><p>If <var>position</var> is greater than <var>subpath width</var>,
     then let <var>end</var> be the offset <var>subpath width</var> on <var>L</var>. Otherwise, let <var>end</var> be the offset <var>position</var> on <var>L</var>.</li><li>

      <p>Jump to the first appropriate step:</p>

      <dl class=switch><dt>If <var>segment length</var> is zero and <var>current state</var> is
       <i>off</i><dd>

        <p>Do nothing, just continue to the next step.</p>

       <dt>If <var>current state</var> is <i>off</i><dd>

        <p>Cut the line on which <var>end</var> finds itself short at <var>end</var> and place a point there, cutting the subpath that it was in in two;
        remove all line segments, joins, points, and subpaths that are between <var>start</var> and <var>end</var>; and finally place a single point at <var>start</var> with no lines connecting to it.</p>

        <p>The point has a <i>directionality</i> for the purposes of drawing line caps (see below).
        The directionality is the direction that the original line had at that point (i.e. when <var>L</var> was defined above).</p>

       <dt>そうでなければ<dd>

        <p>Cut the line on which <var>start</var> finds itself into two at <var>start</var> and place a point there, cutting the subpath that it was in in two, and
        similarly cut the line on which <var>end</var> finds itself short at <var>end</var> and place a point there, cutting the subpath that <em>it</em> was in in
        two, and then remove all line segments, joins, points, and subpaths that are between <var>start</var> and <var>end</var>.</p>

        <p>If <var>start</var> and <var>end</var> are the same point, then this
        results in just the line being cut in two and two points being inserted there, with nothing
        being removed, unless a join also happens to be at that point, in which case the join must
        be removed.</p>

       </dl>

     </li><li><p><i>Post-cut</i>: If <var>position</var> is greater than <var>subpath width</var>, then jump to the step labeled <i>convert</i>.</li><li><p>If <var>segment length</var> is greater than zero, then let
     <var>positioned-at-on-dash</var> be false.</li><li><p><var>index</var>を1でインクリメントする。If it is equal to the number of entries in the <var>styles</var> <a href=#dash-list id=line-styles:dash-list-8>dash list</a>, then let <var>index</var> be 0.</li><li><p>Return to the step labeled <i>dash on</i>.</li></ol>

   </li><li>

    <p><i>Convert</i>: This is the step that converts the path to a new path that represents its
    stroke.</p>

    <p>Create a new <a href=#concept-path id=line-styles:concept-path-2>path</a> that describes the edge of the areas
    that would be covered if a straight line of length equal to the <var>styles</var>
    <code id=line-styles:dom-context-2d-linewidth-4><a href=#dom-context-2d-linewidth>lineWidth</a></code> was swept along each subpath in <var>path</var> while being kept at an angle such that the line is orthogonal to the path
    being swept, replacing each point with the end cap necessary to satisfy the <var>styles</var> <code id=line-styles:dom-context-2d-linecap-4><a href=#dom-context-2d-linecap>lineCap</a></code> attribute as
    described previously and elaborated below, and replacing each join with the join necessary to
    satisfy the <var>styles</var> <code id=line-styles:dom-context-2d-linejoin-5><a href=#dom-context-2d-linejoin>lineJoin</a></code>
    type, as defined below.</p>

    <p><strong>Caps</strong>: Each point has a flat edge perpendicular to the direction of the line
    coming out of it. This is them augmented according to the value of the <var>styles</var> <code id=line-styles:dom-context-2d-linecap-5><a href=#dom-context-2d-linecap>lineCap</a></code>. The "<code>butt</code>" value means that no additional line cap is added. The "<code>round</code>" value means that a semi-circle with the diameter equal to the <var>styles</var> <code id=line-styles:dom-context-2d-linewidth-5><a href=#dom-context-2d-linewidth>lineWidth</a></code> width must
    additionally be placed on to the line coming out of each point. The "<code>square</code>" value means that a rectangle with the length of the <var>styles</var> <code id=line-styles:dom-context-2d-linewidth-6><a href=#dom-context-2d-linewidth>lineWidth</a></code> width and the
    width of half the <var>styles</var> <code id=line-styles:dom-context-2d-linewidth-7><a href=#dom-context-2d-linewidth>lineWidth</a></code> width, placed flat against the edge
    perpendicular to the direction of the line coming out of the point, must be added at each
    point.</p>

    <p>Points with no lines coming out of them must have two caps placed back-to-back as if it was
    really two points connected to each other by an infinitesimally short straight line in the
    direction of the point's <i>directionality</i> (as defined above).</p>

    <p><strong>Joins</strong>: In addition to the point where a join occurs, two additional points
    are relevant to each join, one for each line: the two corners found half the line width away
    from the join point, one perpendicular to each line, each on the side furthest from the other
    line.</p>

    <p>A triangle connecting these two opposite corners with a straight line, with the third point
    of the triangle being the join point, must be added at all joins. The <code id=line-styles:dom-context-2d-linejoin-6><a href=#dom-context-2d-linejoin>lineJoin</a></code> attribute controls whether anything else is
    rendered. The three aforementioned values have the following meanings:</p>

    <p>The "<code>bevel</code>" value means that this is all that is rendered at
    joins.</p>

    <p>The "<code>round</code>" value means that an arc connecting the two aforementioned
    corners of the join, abutting (and not overlapping) the aforementioned triangle, with the
    diameter equal to the line width and the origin at the point of the join, must be added at
    joins.</p>

    <p>The "<code>miter</code>" value means that a second triangle must (if it can given
    the miter length) be added at the join, with one line being the line between the two
    aforementioned corners, abutting the first triangle, and the other two being continuations of
    the outside edges of the two joining lines, as long as required to intersect without going over
    the miter length.</p>

    <p>The miter length is the distance from the point where the join occurs to the intersection of
    the line edges on the outside of the join. The miter limit ratio is the maximum allowed ratio of
    the miter length to half the line width. If the miter length would cause the miter limit ratio
    (as set by the <var>style</var> <code id=line-styles:dom-context-2d-miterlimit-4><a href=#dom-context-2d-miterlimit>miterLimit</a></code> attribute) to be exceeded, then this second
    triangle must not be added.</p> 



    <p>The subpaths in the newly created path must be oriented such that for any point, the number
    of times a half-infinite straight line drawn from that point crosses a subpath is even if and
    only if the number of times a half-infinite straight line drawn from that same point crosses a
    subpath going in one direction is equal to the number of times it crosses a subpath going in the
    other direction.</p>

   </li><li><p>Return the newly created path.</li></ol>



  


  <h6 id=text-styles>4.12.5.1.4 Text styles<a href=#text-styles class=self-link></a></h6>

  <dl class=domintro><dt><var>context</var> . <code id=text-styles:dom-context-2d-font><a href=#dom-context-2d-font>font</a></code> [ = <var>value</var> ]<dt><var>styles</var> . <code id=text-styles:dom-context-2d-font-2><a href=#dom-context-2d-font>font</a></code> [ = <var>value</var> ]<dd>

    <p>Returns the current font settings.</p>

    <p>Can be set, to change the font. The syntax is the same as for the CSS <a id="text-styles:'font'" href=https://triple-underscore.github.io/css-fonts-ja.html#font-prop data-x-internal="'font'">'font'</a>
    property; values that cannot be parsed as CSS font values are ignored.</p>

    <p>Relative keywords and lengths are computed relative to the font of the <code id=text-styles:the-canvas-element><a href=#the-canvas-element>canvas</a></code>
    element.</p>

   <dt><var>context</var> . <code id=text-styles:dom-context-2d-textalign><a href=#dom-context-2d-textalign>textAlign</a></code> [ = <var>value</var> ]<dt><var>styles</var> . <code id=text-styles:dom-context-2d-textalign-2><a href=#dom-context-2d-textalign>textAlign</a></code> [ = <var>value</var> ]<dd>

    <p>Returns the current text alignment settings.</p>

    <p>Can be set, to change the alignment. The possible values are and their meanings are given
    below. Other values are ignored. The default is "<code>start</code>".</p>

   <dt><var>context</var> . <code id=text-styles:dom-context-2d-textbaseline><a href=#dom-context-2d-textbaseline>textBaseline</a></code> [ = <var>value</var> ]<dt><var>styles</var> . <code id=text-styles:dom-context-2d-textbaseline-2><a href=#dom-context-2d-textbaseline>textBaseline</a></code> [ = <var>value</var> ]<dd>

    <p>Returns the current baseline alignment settings.</p>

    <p>Can be set, to change the baseline alignment. The possible values and their meanings are
    given below. Other values are ignored. The default is "<code id=text-styles:dom-context-2d-textbaseline-alphabetic><a href=#dom-context-2d-textbaseline-alphabetic>alphabetic</a></code>".</p>

   <dt><var>context</var> . <code id=text-styles:dom-context-2d-direction><a href=#dom-context-2d-direction>direction</a></code> [ = <var>value</var> ]<dt><var>styles</var> . <code id=text-styles:dom-context-2d-direction-2><a href=#dom-context-2d-direction>direction</a></code> [ = <var>value</var> ]<dd>

    <p>Returns the current directionality.</p>

    <p>Can be set, to change the directionality. The possible values and their meanings are given
    below. Other values are ignored. The default is "<code id=text-styles:dom-context-2d-direction-inherit><a href=#dom-context-2d-direction-inherit>inherit</a></code>".</p>

   </dl>

  

  <p>Objects that implement the <code id=text-styles:canvastextdrawingstyles><a href=#canvastextdrawingstyles>CanvasTextDrawingStyles</a></code> interface have attributes
  (defined in this section) that control how text is laid out (rasterized or outlined) by the
  object. Such objects can also have a <dfn id=font-style-source-object>font style source object</dfn>. For
  <code id=text-styles:canvasrenderingcontext2d><a href=#canvasrenderingcontext2d>CanvasRenderingContext2D</a></code> objects, this is the <code id=text-styles:the-canvas-element-2><a href=#the-canvas-element>canvas</a></code> element
  referenced by the context's canvas property.</p>

  

  <p>The <dfn id=dom-context-2d-font><code>font</code></dfn> IDL attribute, on setting, must
  be <a href=https://drafts.csswg.org/css-syntax/#parse-grammar id=text-styles:parse-something-according-to-a-css-grammar data-x-internal=parse-something-according-to-a-css-grammar>parsed as a CSS &lt;'font'&gt;
  value</a> (but without supporting property-independent style sheet syntax like 'inherit'), and
  the resulting font must be assigned to the context, with the <a id="text-styles:'line-height'" href=https://momdo.github.io/css2/visudet.html#propdef-line-height data-x-internal="'line-height'">'line-height'</a> component
  forced to 'normal', with the <a id="text-styles:'font-size'" href=https://triple-underscore.github.io/css-fonts-ja.html#font-size-prop data-x-internal="'font-size'">'font-size'</a> component converted to <a href=https://momdo.github.io/css3-values/#px id="text-styles:'px'" data-x-internal="'px'">CSS pixels</a>, and with system fonts being computed to explicit values. If the
  new value is syntactically incorrect (including using property-independent style sheet syntax like
  'inherit' or 'initial'), then it must be ignored, without assigning a new font value. <a href=references.html#refsCSS>[CSS]</a></p>

  <p>Font family names must be interpreted in the context of the <a href=#font-style-source-object id=text-styles:font-style-source-object>font style source
  object</a> when the font is to be used; any fonts embedded using <code>@font-face</code> or loaded using <code id=text-styles:fontface><a href=infrastructure.html#fontface>FontFace</a></code> objects that are visible to the
  <a href=#font-style-source-object id=text-styles:font-style-source-object-2>font style source object</a> must therefore be available once they are loaded. (Each <a href=#font-style-source-object id=text-styles:font-style-source-object-3>font style source
  object</a> has a <a id=text-styles:font-source href=https://triple-underscore.github.io/css-font-loading-ja.html#font-source data-x-internal=font-source>font source</a>, which determines what fonts are available.) If a font
  is used before it is fully loaded, or if the <a href=#font-style-source-object id=text-styles:font-style-source-object-4>font style source object</a> does not have
  that font in scope at the time the font is to be used, then it must be treated as if it was an
  unknown font, falling back to another as described by the relevant CSS specifications. <a href=references.html#refsCSSFONTS>[CSSFONTS]</a> <a href=references.html#refsCSSFONTLOAD>[CSSFONTLOAD]</a></p>

  <p>On getting, the <code id=text-styles:dom-context-2d-font-3><a href=#dom-context-2d-font>font</a></code> attribute must return the <a href=https://triple-underscore.github.io/cssom-ja.html#serialize-a-css-value id=text-styles:serializing-a-css-value data-x-internal=serializing-a-css-value>serialized form</a> of the current font of the context (with
  no <a id="text-styles:'line-height'-2" href=https://momdo.github.io/css2/visudet.html#propdef-line-height data-x-internal="'line-height'">'line-height'</a> component). <a href=references.html#refsCSSOM>[CSSOM]</a></p>

  <div class=example>

   <p>For example, after the following statement:</p>

   <pre>context.font = 'italic 400 12px/2 Unknown Font, sans-serif';</pre>

   <p>...the expression <code>context.font</code> would evaluate to the string "<code>italic&nbsp;12px&nbsp;"Unknown&nbsp;Font",&nbsp;sans-serif</code>". The "400"
   font-weight doesn't appear because that is the default value. The line-height doesn't appear
   because it is forced to "normal", the default value.</p>

  </div>

  <p>When the object implementing the <code id=text-styles:canvastextdrawingstyles-2><a href=#canvastextdrawingstyles>CanvasTextDrawingStyles</a></code> interface is created, the
  font of the context must be set to 10px sans-serif. When the <a id="text-styles:'font-size'-2" href=https://triple-underscore.github.io/css-fonts-ja.html#font-size-prop data-x-internal="'font-size'">'font-size'</a> component is
  set to lengths using percentages, <a id="text-styles:'em'" href=https://momdo.github.io/css3-values/#em data-x-internal="'em'">'em'</a> or <a id="text-styles:'ex'" href=https://momdo.github.io/css3-values/#ex data-x-internal="'ex'">'ex'</a> units, or the 'larger' or
  'smaller' keywords, these must be interpreted relative to the <a id=text-styles:computed-value href=https://drafts.csswg.org/css-cascade/#computed-value data-x-internal=computed-value>computed value</a> of the
  <a id="text-styles:'font-size'-3" href=https://triple-underscore.github.io/css-fonts-ja.html#font-size-prop data-x-internal="'font-size'">'font-size'</a> property of the <a href=#font-style-source-object id=text-styles:font-style-source-object-5>font style source object</a> at the time that
  the attribute is set, if it is an element. When the <a id="text-styles:'font-weight'" href=https://triple-underscore.github.io/css-fonts-ja.html#font-weight-prop data-x-internal="'font-weight'">'font-weight'</a> component is set to
  the relative values 'bolder' and 'lighter', these must be interpreted relative to the
  <a id=text-styles:computed-value-2 href=https://drafts.csswg.org/css-cascade/#computed-value data-x-internal=computed-value>computed value</a> of the <a id="text-styles:'font-weight'-2" href=https://triple-underscore.github.io/css-fonts-ja.html#font-weight-prop data-x-internal="'font-weight'">'font-weight'</a> property of the <a href=#font-style-source-object id=text-styles:font-style-source-object-6>font style
  source object</a> at the time that the attribute is set, if it is an element. If the <a href=https://drafts.csswg.org/css-cascade/#computed-value id=text-styles:computed-value-3 data-x-internal=computed-value>computed values</a> are undefined for a particular case (e.g. because
  the <a href=#font-style-source-object id=text-styles:font-style-source-object-7>font style source object</a> is not an element or is not <a id=text-styles:being-rendered href=rendering.html#being-rendered>being
  rendered</a>), then the relative keywords must be interpreted relative to the normal-weight
  10px sans-serif default.</p>

  <p>The <dfn id=dom-context-2d-textalign><code>textAlign</code></dfn> IDL attribute, on
  getting, must return the current value. On setting, the current value must be changed to the new
  value. When the object implementing the <code id=text-styles:canvastextdrawingstyles-3><a href=#canvastextdrawingstyles>CanvasTextDrawingStyles</a></code> interface is
  created, the <code id=text-styles:dom-context-2d-textalign-3><a href=#dom-context-2d-textalign>textAlign</a></code> attribute must initially
  have the value <code id=text-styles:dom-context-2d-textalign-start><a href=#dom-context-2d-textalign-start>start</a></code>.</p>

  <p>The <dfn id=dom-context-2d-textbaseline><code>textBaseline</code></dfn> IDL attribute, on
  getting, must return the current value. On setting, the current value must be changed to the new
  value. When the object implementing the <code id=text-styles:canvastextdrawingstyles-4><a href=#canvastextdrawingstyles>CanvasTextDrawingStyles</a></code> interface is
  created, the <code id=text-styles:dom-context-2d-textbaseline-3><a href=#dom-context-2d-textbaseline>textBaseline</a></code> attribute must
  initially have the value <code id=text-styles:dom-context-2d-textbaseline-alphabetic-2><a href=#dom-context-2d-textbaseline-alphabetic>alphabetic</a></code>.</p>

  <p>The <dfn id=dom-context-2d-direction><code>direction</code></dfn> IDL attribute, on
  getting, must return the current value. On setting, the current value must be changed to the new
  value. When the object implementing the <code id=text-styles:canvastextdrawingstyles-5><a href=#canvastextdrawingstyles>CanvasTextDrawingStyles</a></code> interface is
  created, the <code id=text-styles:dom-context-2d-direction-3><a href=#dom-context-2d-direction>direction</a></code> attribute must initially
  have the value "<code id=text-styles:dom-context-2d-direction-inherit-2><a href=#dom-context-2d-direction-inherit>inherit</a></code>".</p>

  

  <p>The <code id=text-styles:dom-context-2d-textalign-4><a href=#dom-context-2d-textalign>textAlign</a></code> attribute's allowed keywords are
  as follows:</p>

  <dl><dt><dfn id=dom-context-2d-textalign-start><code>start</code></dfn>
   <dd><p>Align to the start edge of the text (left side in left-to-right text, right side in
   right-to-left text).<dt><dfn id=dom-context-2d-textalign-end><code>end</code></dfn>
   <dd><p>Align to the end edge of the text (right side in left-to-right text, left side in
   right-to-left text).<dt><dfn id=dom-context-2d-textalign-left><code>left</code></dfn>
   <dd><p>Align to the left.<dt><dfn id=dom-context-2d-textalign-right><code>right</code></dfn>
   <dd><p>Align to the right.<dt><dfn id=dom-context-2d-textalign-center><code>center</code></dfn>
   <dd><p>Align to the center.</dl>

  <p>The <code id=text-styles:dom-context-2d-textbaseline-4><a href=#dom-context-2d-textbaseline>textBaseline</a></code>
  attribute's allowed keywords correspond to alignment points in the
  font:</p>

  <p><img src=https://html.spec.whatwg.org/multipage/images/baselines.png width=738 alt="The top of the em square is roughly at the top of the glyphs in a font, the hanging baseline is where some glyphs like आ are anchored, the middle is half-way between the top of the em square and the bottom of the em square, the alphabetic baseline is where characters like Á, ÿ, f, and Ω are anchored, the ideographic baseline is where glyphs like 私 and 達 are anchored, and the bottom of the em square is roughly at the bottom of the glyphs in a font. The top and bottom of the bounding box can be far from these baselines, due to glyphs extending far outside the em square." height=300></p>

  <p>The keywords map to these alignment points as follows:</p>

  <dl><dt><dfn id=dom-context-2d-textbaseline-top><code>top</code></dfn>
   <dd>The top of the em square<dt><dfn id=dom-context-2d-textbaseline-hanging><code>hanging</code></dfn>
   <dd>The hanging baseline<dt><dfn id=dom-context-2d-textbaseline-middle><code>middle</code></dfn>
   <dd>The middle of the em square<dt><dfn id=dom-context-2d-textbaseline-alphabetic><code>alphabetic</code></dfn>
   <dd>The alphabetic baseline<dt><dfn id=dom-context-2d-textbaseline-ideographic><code>ideographic</code></dfn>
   <dd>The ideographic baseline<dt><dfn id=dom-context-2d-textbaseline-bottom><code>bottom</code></dfn>
   <dd>The bottom of the em square</dl>

  <p>The <code id=text-styles:dom-context-2d-direction-4><a href=#dom-context-2d-direction>direction</a></code> attribute's allowed keywords are
  as follows:</p>

  <dl><dt><dfn id=dom-context-2d-direction-ltr><code>ltr</code></dfn>

   <dd><p>Treat input to the <a href=#text-preparation-algorithm id=text-styles:text-preparation-algorithm>text preparation algorithm</a> as left-to-right text.<dt><dfn id=dom-context-2d-direction-rtl><code>rtl</code></dfn>

   <dd><p>Treat input to the <a href=#text-preparation-algorithm id=text-styles:text-preparation-algorithm-2>text preparation algorithm</a> as right-to-left text.<dt><dfn id=dom-context-2d-direction-inherit><code>inherit</code></dfn>

   <dd><p>Default to the directionality of the <code id=text-styles:the-canvas-element-3><a href=#the-canvas-element>canvas</a></code> element or <code id=text-styles:document><a href=dom.html#document>Document</a></code>
   as appropriate.</dl>

  <p>The <dfn id=text-preparation-algorithm>text preparation algorithm</dfn> is as follows. It takes as input a string <var>text
  </var>, a <code id=text-styles:canvastextdrawingstyles-6><a href=#canvastextdrawingstyles>CanvasTextDrawingStyles</a></code> object <var>target</var>, and an optional length
  <var>maxWidth</var>. It returns an array of glyph shapes, each positioned on a common coordinate
  space, a <var>physical alignment</var> whose value is one of <i>left</i>, <i>right</i>, and
  <i>center</i>, and an <a id=text-styles:inline-box href=https://momdo.github.io/css2/visuren.html#inline-box data-x-internal=inline-box>inline box</a>. (Most callers of this algorithm ignore the
  <var>physical alignment</var> and the <a id=text-styles:inline-box-2 href=https://momdo.github.io/css2/visuren.html#inline-box data-x-internal=inline-box>inline box</a>.)</p>

  <ol><li><p>If <var>maxWidth</var> was provided but is less than or equal to zero or equal to NaN,
   then return an empty array.</li><li><p>Replace all <a id=text-styles:space-characters href=https://infra.spec.whatwg.org/#ascii-whitespace data-x-internal=space-characters>ASCII whitespace</a> in <var>text</var> with U+0020 SPACE
   characters.</li><li><p>Let <var>font</var> be the current font of <var>target</var>, as given
   by that object's <code id=text-styles:dom-context-2d-font-4><a href=#dom-context-2d-font>font</a></code> attribute.</li><li>

    <p>Apply the appropriate step from the following list to determine the value of <var>direction</var>:</p>

    <dl class=switch><dt>If the <var>target</var> object's <code id=text-styles:dom-context-2d-direction-5><a href=#dom-context-2d-direction>direction</a></code> attribute has the value "<code id=text-styles:dom-context-2d-direction-ltr><a href=#dom-context-2d-direction-ltr>ltr</a></code>"<dd>Let <var>direction</var> be '<a href=dom.html#concept-ltr id=text-styles:concept-ltr>ltr</a>'.<dt>If the <var>target</var> object's <code id=text-styles:dom-context-2d-direction-6><a href=#dom-context-2d-direction>direction</a></code> attribute has the value "<code id=text-styles:dom-context-2d-direction-rtl><a href=#dom-context-2d-direction-rtl>rtl</a></code>"<dd>Let <var>direction</var> be '<a href=dom.html#concept-rtl id=text-styles:concept-rtl>rtl</a>'.<dt>If the <var>target</var> object's <a href=#font-style-source-object id=text-styles:font-style-source-object-8>font style source object</a> is an
     element<dd>Let <var>direction</var> be <a id=text-styles:the-directionality href=dom.html#the-directionality>the directionality</a> of the <var>target</var> object's <a href=#font-style-source-object id=text-styles:font-style-source-object-9>font style source object</a>.<dt>If the <var>target</var> object's <a href=#font-style-source-object id=text-styles:font-style-source-object-10>font style source object</a> is a
     <code id=text-styles:document-2><a href=dom.html#document>Document</a></code> with a non-null <a id=text-styles:document-element href=https://triple-underscore.github.io/DOM4-ja.html#document-element data-x-internal=document-element>document element</a><dd>Let <var>direction</var> be <a id=text-styles:the-directionality-2 href=dom.html#the-directionality>the directionality</a> of the <var>target</var>
     object's <a href=#font-style-source-object id=text-styles:font-style-source-object-11>font style source object</a>'s <a id=text-styles:document-element-2 href=https://triple-underscore.github.io/DOM4-ja.html#document-element data-x-internal=document-element>document element</a>.<dt>そうでなければ<dd>Let <var>direction</var> be '<a href=dom.html#concept-ltr id=text-styles:concept-ltr-2>ltr</a>'.</dl>

   </li><li><p>Form a hypothetical infinitely-wide CSS <a id=text-styles:line-box href=https://momdo.github.io/css2/visuren.html#line-box data-x-internal=line-box>line box</a> containing a single
   <a id=text-styles:inline-box-3 href=https://momdo.github.io/css2/visuren.html#inline-box data-x-internal=inline-box>inline box</a> containing the text <var>text</var>, with all the properties at their
   initial values except the <a id="text-styles:'font'-2" href=https://triple-underscore.github.io/css-fonts-ja.html#font-prop data-x-internal="'font'">'font'</a> property of the <a id=text-styles:inline-box-4 href=https://momdo.github.io/css2/visuren.html#inline-box data-x-internal=inline-box>inline box</a> set to
   <var>font</var>, the <a id="text-styles:'direction'" href=https://triple-underscore.github.io/css-writing-modes-ja.html#direction data-x-internal="'direction'">'direction'</a> property of the <a id=text-styles:inline-box-5 href=https://momdo.github.io/css2/visuren.html#inline-box data-x-internal=inline-box>inline box</a> set to
   <var>direction</var>, and the <a id="text-styles:'white-space'" href=https://triple-underscore.github.io/css-text-ja.html#white-space-property data-x-internal="'white-space'">'white-space'</a> property set to 'pre'. <a href=references.html#refsCSS>[CSS]</a></li><li><p>If <var>maxWidth</var> was provided and the hypothetical width of the
   <a id=text-styles:inline-box-6 href=https://momdo.github.io/css2/visuren.html#inline-box data-x-internal=inline-box>inline box</a> in the hypothetical <a id=text-styles:line-box-2 href=https://momdo.github.io/css2/visuren.html#line-box data-x-internal=line-box>line box</a> is greater than
   <var>maxWidth</var> <a href=https://momdo.github.io/css3-values/#px id="text-styles:'px'-2" data-x-internal="'px'">CSS pixels</a>, then change <var>font</var> to have a
   more condensed font (if one is available or if a reasonably readable one can be synthesized by
   applying a horizontal scale factor to the font) or a smaller font, and return to the previous
   step.</li><li>

    <p>The <var>anchor point</var> is a point on the <a id=text-styles:inline-box-7 href=https://momdo.github.io/css2/visuren.html#inline-box data-x-internal=inline-box>inline box</a>, and the <var>physical
    alignment</var> is one of the values <i>left</i>, <i>right</i>, and <i>center</i>. These
    variables are determined by the <code id=text-styles:dom-context-2d-textalign-5><a href=#dom-context-2d-textalign>textAlign</a></code> and
    <code id=text-styles:dom-context-2d-textbaseline-5><a href=#dom-context-2d-textbaseline>textBaseline</a></code> values as follows:</p>

    <p>Horizontal position:</p>

    <dl><dt>If <code id=text-styles:dom-context-2d-textalign-6><a href=#dom-context-2d-textalign>textAlign</a></code> is <code id=text-styles:dom-context-2d-textalign-left><a href=#dom-context-2d-textalign-left>left</a></code><dt>If <code id=text-styles:dom-context-2d-textalign-7><a href=#dom-context-2d-textalign>textAlign</a></code> is <code id=text-styles:dom-context-2d-textalign-start-2><a href=#dom-context-2d-textalign-start>start</a></code> and <var>direction</var> is
     'ltr'<dt>If <code id=text-styles:dom-context-2d-textalign-8><a href=#dom-context-2d-textalign>textAlign</a></code> is <code id=text-styles:dom-context-2d-textalign-end><a href=#dom-context-2d-textalign-end>end</a></code> and <var>direction</var> is 'rtl'<dd>Let the <var>anchor point</var>'s horizontal position be the left edge of the
     <a id=text-styles:inline-box-8 href=https://momdo.github.io/css2/visuren.html#inline-box data-x-internal=inline-box>inline box</a>, and let <var>physical alignment</var> be <i>left</i>.<dt>If <code id=text-styles:dom-context-2d-textalign-9><a href=#dom-context-2d-textalign>textAlign</a></code> is <code id=text-styles:dom-context-2d-textalign-right><a href=#dom-context-2d-textalign-right>right</a></code><dt>If <code id=text-styles:dom-context-2d-textalign-10><a href=#dom-context-2d-textalign>textAlign</a></code> is <code id=text-styles:dom-context-2d-textalign-end-2><a href=#dom-context-2d-textalign-end>end</a></code> and <var>direction</var> is 'ltr'<dt>If <code id=text-styles:dom-context-2d-textalign-11><a href=#dom-context-2d-textalign>textAlign</a></code> is <code id=text-styles:dom-context-2d-textalign-start-3><a href=#dom-context-2d-textalign-start>start</a></code> and <var>direction</var> is
     'rtl'<dd>Let the <var>anchor point</var>'s horizontal position be the right edge of the
     <a id=text-styles:inline-box-9 href=https://momdo.github.io/css2/visuren.html#inline-box data-x-internal=inline-box>inline box</a>, and let <var>physical alignment</var> be <i>right</i>.<dt>If <code id=text-styles:dom-context-2d-textalign-12><a href=#dom-context-2d-textalign>textAlign</a></code> is <code id=text-styles:dom-context-2d-textalign-center><a href=#dom-context-2d-textalign-center>center</a></code><dd>Let the <var>anchor point</var>'s horizontal position be half way between the left
     and right edges of the <a id=text-styles:inline-box-10 href=https://momdo.github.io/css2/visuren.html#inline-box data-x-internal=inline-box>inline box</a>, and let <var>physical alignment</var> be
     <i>center</i>.</dl>

    <p>Vertical position:</p>

    <dl><dt>If <code id=text-styles:dom-context-2d-textbaseline-6><a href=#dom-context-2d-textbaseline>textBaseline</a></code> is <code id=text-styles:dom-context-2d-textbaseline-top><a href=#dom-context-2d-textbaseline-top>top</a></code><dd>Let the <var>anchor point</var>'s vertical position be the top of the em box of
     the first available font of the <a id=text-styles:inline-box-11 href=https://momdo.github.io/css2/visuren.html#inline-box data-x-internal=inline-box>inline box</a>.<dt>If <code id=text-styles:dom-context-2d-textbaseline-7><a href=#dom-context-2d-textbaseline>textBaseline</a></code> is <code id=text-styles:dom-context-2d-textbaseline-hanging><a href=#dom-context-2d-textbaseline-hanging>hanging</a></code><dd>Let the <var>anchor point</var>'s vertical position be the hanging baseline of the
     first available font of the <a id=text-styles:inline-box-12 href=https://momdo.github.io/css2/visuren.html#inline-box data-x-internal=inline-box>inline box</a>.<dt>If <code id=text-styles:dom-context-2d-textbaseline-8><a href=#dom-context-2d-textbaseline>textBaseline</a></code> is <code id=text-styles:dom-context-2d-textbaseline-middle><a href=#dom-context-2d-textbaseline-middle>middle</a></code><dd>Let the <var>anchor point</var>'s vertical position be half way between the bottom
     and the top of the em box of the first available font of the <a id=text-styles:inline-box-13 href=https://momdo.github.io/css2/visuren.html#inline-box data-x-internal=inline-box>inline box</a>.<dt>If <code id=text-styles:dom-context-2d-textbaseline-9><a href=#dom-context-2d-textbaseline>textBaseline</a></code> is <code id=text-styles:dom-context-2d-textbaseline-alphabetic-3><a href=#dom-context-2d-textbaseline-alphabetic>alphabetic</a></code><dd>Let the <var>anchor point</var>'s vertical position be the alphabetic baseline of
     the first available font of the <a id=text-styles:inline-box-14 href=https://momdo.github.io/css2/visuren.html#inline-box data-x-internal=inline-box>inline box</a>.<dt>If <code id=text-styles:dom-context-2d-textbaseline-10><a href=#dom-context-2d-textbaseline>textBaseline</a></code> is <code id=text-styles:dom-context-2d-textbaseline-ideographic><a href=#dom-context-2d-textbaseline-ideographic>ideographic</a></code><dd>Let the <var>anchor point</var>'s vertical position be the ideographic baseline of
     the first available font of the <a id=text-styles:inline-box-15 href=https://momdo.github.io/css2/visuren.html#inline-box data-x-internal=inline-box>inline box</a>.<dt>If <code id=text-styles:dom-context-2d-textbaseline-11><a href=#dom-context-2d-textbaseline>textBaseline</a></code> is <code id=text-styles:dom-context-2d-textbaseline-bottom><a href=#dom-context-2d-textbaseline-bottom>bottom</a></code><dd>Let the <var>anchor point</var>'s vertical position be the bottom of the em box of
     the first available font of the <a id=text-styles:inline-box-16 href=https://momdo.github.io/css2/visuren.html#inline-box data-x-internal=inline-box>inline box</a>.</dl>

   </li><li>

    <p>Let <var>result</var> be an array constructed by iterating over each glyph in the
    <a id=text-styles:inline-box-17 href=https://momdo.github.io/css2/visuren.html#inline-box data-x-internal=inline-box>inline box</a> from left to right (if any), adding to the array, for each glyph, the
    shape of the glyph as it is in the <a id=text-styles:inline-box-18 href=https://momdo.github.io/css2/visuren.html#inline-box data-x-internal=inline-box>inline box</a>, positioned on a coordinate space
    using <a href=https://momdo.github.io/css3-values/#px id="text-styles:'px'-3" data-x-internal="'px'">CSS pixels</a> with its origin is at the <var>anchor
    point</var>.</p>

   </li><li><p>Return <var>result</var>, <var>physical alignment</var>, and the inline
   box.</li></ol>


  <h6 id=building-paths>4.12.5.1.5 Building paths<a href=#building-paths class=self-link></a></h6>

  <p>Objects that implement the <code id=building-paths:canvaspath><a href=#canvaspath>CanvasPath</a></code> interface have a <a href=#concept-path id=building-paths:concept-path>path</a>. A <dfn id=concept-path>path</dfn> has a list of zero or
  more subpaths. Each subpath consists of a list of one or more points, connected by straight or
  curved <dfn id=line-segments>line segments</dfn>, and a flag indicating whether the subpath is closed or not. A
  closed subpath is one where the last point of the subpath is connected to the first point of the
  subpath by a straight line. Subpaths with only one point are ignored when painting the path.</p>

  <p><a href=#concept-path id=building-paths:concept-path-2>Paths</a> have a <dfn id=need-new-subpath>need new subpath</dfn> flag. When this
  flag is set, certain APIs create a new subpath rather than extending the previous one. When a
  <a href=#concept-path id=building-paths:concept-path-3>path</a> is created, its <a href=#need-new-subpath id=building-paths:need-new-subpath>need new subpath</a> flag must be
  set.</p>

  <p>When an object implementing the <code id=building-paths:canvaspath-2><a href=#canvaspath>CanvasPath</a></code> interface is created, its <a href=#concept-path id=building-paths:concept-path-4>path</a> must be initialized to zero subpaths.</p>

  <dl class=domintro><dt><var>context</var> . <code id=building-paths:dom-context-2d-moveto><a href=#dom-context-2d-moveto>moveTo</a></code>(<var>x</var>, <var>y</var>)<dt><var>path</var> . <code id=building-paths:dom-context-2d-moveto-2><a href=#dom-context-2d-moveto>moveTo</a></code>(<var>x</var>, <var>y</var>)<dd>

    <p>Creates a new subpath with the given point.</p>

   <dt><var>context</var> . <code id=building-paths:dom-context-2d-closepath><a href=#dom-context-2d-closepath>closePath</a></code>()<dt><var>path</var> . <code id=building-paths:dom-context-2d-closepath-2><a href=#dom-context-2d-closepath>closePath</a></code>()<dd>

    <p>Marks the current subpath as closed, and starts a new subpath with a point the same as the
    start and end of the newly closed subpath.</p>

   <dt><var>context</var> . <code id=building-paths:dom-context-2d-lineto><a href=#dom-context-2d-lineto>lineTo</a></code>(<var>x</var>, <var>y</var>)<dt><var>path</var> . <code id=building-paths:dom-context-2d-lineto-2><a href=#dom-context-2d-lineto>lineTo</a></code>(<var>x</var>, <var>y</var>)<dd>

    <p>Adds the given point to the current subpath, connected to the previous one by a straight
    line.</p>

   <dt><var>context</var> . <code id=building-paths:dom-context-2d-quadraticcurveto><a href=#dom-context-2d-quadraticcurveto>quadraticCurveTo</a></code>(<var>cpx</var>, <var>cpy</var>, <var>x</var>, <var>y</var>)<dt><var>path</var> . <code id=building-paths:dom-context-2d-quadraticcurveto-2><a href=#dom-context-2d-quadraticcurveto>quadraticCurveTo</a></code>(<var>cpx</var>, <var>cpy</var>, <var>x</var>, <var>y</var>)<dd>

    <p>Adds the given point to the current subpath, connected to the previous one by a quadratic
    Bézier curve with the given control point.</p>

   <dt><var>context</var> . <code id=building-paths:dom-context-2d-beziercurveto><a href=#dom-context-2d-beziercurveto>bezierCurveTo</a></code>(<var>cp1x</var>, <var>cp1y</var>, <var>cp2x</var>, <var>cp2y</var>, <var>x</var>, <var>y</var>)<dt><var>path</var> . <code id=building-paths:dom-context-2d-beziercurveto-2><a href=#dom-context-2d-beziercurveto>bezierCurveTo</a></code>(<var>cp1x</var>, <var>cp1y</var>, <var>cp2x</var>, <var>cp2y</var>, <var>x</var>, <var>y</var>)<dd>

    <p>Adds the given point to the current subpath, connected to the previous one by a cubic
    Bézier curve with the given control points.</p>

   <dt><var>context</var> . <code id=building-paths:dom-context-2d-arcto><a href=#dom-context-2d-arcto>arcTo</a></code>(<var>x1</var>, <var>y1</var>, <var>x2</var>, <var>y2</var>, <var>radiusX</var> [, <var>radiusY</var>, <var>rotation</var> ] )<dt><var>path</var> . <code id=building-paths:dom-context-2d-arcto-2><a href=#dom-context-2d-arcto>arcTo</a></code>(<var>x1</var>, <var>y1</var>, <var>x2</var>, <var>y2</var>, <var>radiusX</var> [, <var>radiusY</var>, <var>rotation</var> ] )<dd>

    <p>Adds an arc with the given control points and radius to the current subpath, connected to the
    previous point by a straight line.</p>

    <p>If two radii are provided, then the first controls the width of the arc's ellipse, and the
    second controls the height. If only one is provided, or if they are the same, then the arc is
    from a circle. In the case of an ellipse, the rotation argument controls the clockwise
    inclination of the ellipse relative to the x-axis.</p>

    <p>Throws an <a id=building-paths:indexsizeerror href=https://triple-underscore.github.io/WebIDL-ja.html#indexsizeerror data-x-internal=indexsizeerror>"<code>IndexSizeError</code>"</a> <code id=building-paths:domexception><a data-x-internal=domexception href=https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException>DOMException</a></code> if the given
    radius is negative.</p>

    <figure class=diagrams>
     
     <img width=357 src=https://html.spec.whatwg.org/multipage/images/arcTo1.png height=254 alt="">
     <img width=468 src=https://html.spec.whatwg.org/multipage/images/arcTo2.png height=310 alt="">
     <img width=513 src=https://html.spec.whatwg.org/multipage/images/arcTo3.png height=233 alt="">
    </figure>



   <dt><var>context</var> . <code id=building-paths:dom-context-2d-arc><a href=#dom-context-2d-arc>arc</a></code>(<var>x</var>, <var>y</var>, <var>radius</var>, <var>startAngle</var>, <var>endAngle</var> [, <var>anticlockwise</var> ] )<dt><var>path</var> . <code id=building-paths:dom-context-2d-arc-2><a href=#dom-context-2d-arc>arc</a></code>(<var>x</var>, <var>y</var>, <var>radius</var>, <var>startAngle</var>, <var>endAngle</var> [, <var>anticlockwise</var> ] )<dd>

    <p>Adds points to the subpath such that the arc described by the circumference of the circle
    described by the arguments, starting at the given start angle and ending at the given end angle,
    going in the given direction (defaulting to clockwise), is added to the path, connected to the
    previous point by a straight line.</p>

    <p>Throws an <a id=building-paths:indexsizeerror-2 href=https://triple-underscore.github.io/WebIDL-ja.html#indexsizeerror data-x-internal=indexsizeerror>"<code>IndexSizeError</code>"</a> <code id=building-paths:domexception-2><a data-x-internal=domexception href=https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException>DOMException</a></code> if the given
    radius is negative.</p>

    <figure class=diagrams>
     
     <img width=590 src=https://html.spec.whatwg.org/multipage/images/arc1.png height=255 alt="">
    </figure>



   <dt><var>context</var> . <code id=building-paths:dom-context-2d-ellipse><a href=#dom-context-2d-ellipse>ellipse</a></code>(<var>x</var>, <var>y</var>, <var>radiusX</var>, <var>radiusY</var>, <var>rotation</var>, <var>startAngle</var>, <var>endAngle</var> [, <var>anticlockwise</var>] )<dt><var>path</var> . <code id=building-paths:dom-context-2d-ellipse-2><a href=#dom-context-2d-ellipse>ellipse</a></code>(<var>x</var>, <var>y</var>, <var>radiusX</var>, <var>radiusY</var>, <var>rotation</var>, <var>startAngle</var>, <var>endAngle</var> [, <var>anticlockwise</var>] )<dd>

    <p>Adds points to the subpath such that the arc described by the circumference of the ellipse
    described by the arguments, starting at the given start angle and ending at the given end angle,
    going in the given direction (defaulting to clockwise), is added to the path, connected to the
    previous point by a straight line.</p>

    <p>Throws an <a id=building-paths:indexsizeerror-3 href=https://triple-underscore.github.io/WebIDL-ja.html#indexsizeerror data-x-internal=indexsizeerror>"<code>IndexSizeError</code>"</a> <code id=building-paths:domexception-3><a data-x-internal=domexception href=https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException>DOMException</a></code> if the given
    radius is negative.</p>

   <dt><var>context</var> . <code id=building-paths:dom-context-2d-rect><a href=#dom-context-2d-rect>rect</a></code>(<var>x</var>, <var>y</var>, <var>w</var>, <var>h</var>)<dt><var>path</var> . <code id=building-paths:dom-context-2d-rect-2><a href=#dom-context-2d-rect>rect</a></code>(<var>x</var>, <var>y</var>, <var>w</var>, <var>h</var>)<dd>

    <p>Adds a new closed subpath to the path, representing the given rectangle.</p>

   </dl>

  

  <p>The following methods allow authors to manipulate the <a href=#concept-path id=building-paths:concept-path-5>paths</a>
  of objects implementing the <code id=building-paths:canvaspath-3><a href=#canvaspath>CanvasPath</a></code> interface.</p>

  <p>For objects implementing the <code id=building-paths:canvasdrawpath><a href=#canvasdrawpath>CanvasDrawPath</a></code> and <code id=building-paths:canvastransform><a href=#canvastransform>CanvasTransform</a></code>
  interfaces, the points passed to the methods, and the resulting lines added to <a href=#current-default-path id=building-paths:current-default-path>current
  default path</a> by these methods, must be transformed according to the <a href=#transformations id=building-paths:transformations>current transformation matrix</a> before being added to
  the path.</p>

  <p>The <dfn id=dom-context-2d-moveto><code>moveTo(<var>x</var>, <var>y</var>)</code></dfn>
  method, when invoked, must run these steps:</p>

  <ol><li><p>If either of the arguments are infinite or NaN, then abort these steps.</li><li><p>Create a new subpath with the specified point as its first (and only) point.</li></ol>

  <p>When the user agent is to <dfn id=ensure-there-is-a-subpath>ensure there is a subpath</dfn> for a coordinate (<var>x</var>,
  <var>y</var>) on a <a href=#concept-path id=building-paths:concept-path-6>path</a>, the user agent must check to see if
  the <a href=#concept-path id=building-paths:concept-path-7>path</a> has its <a href=#need-new-subpath id=building-paths:need-new-subpath-2>need new subpath</a> flag set. If it
  does, then the user agent must create a new subpath with the point (<var>x</var>, <var>y</var>) as
  its first (and only) point, as if the <code id=building-paths:dom-context-2d-moveto-3><a href=#dom-context-2d-moveto>moveTo()</a></code> method
  had been called, and must then unset the <a href=#concept-path id=building-paths:concept-path-8>path</a>'s <a href=#need-new-subpath id=building-paths:need-new-subpath-3>need new
  subpath</a> flag.</p>


  <p>The <dfn id=dom-context-2d-closepath><code>closePath()</code></dfn> method, when invoked,
  must do nothing if the object's path has no subpaths. Otherwise, it must mark the last subpath as
  closed, create a new subpath whose first point is the same as the previous subpath's first point,
  and finally add this new subpath to the path.</p>

  <p class=note>If the last subpath had more than one point in its list of points, then this is
  equivalent to adding a straight line connecting the last point back to the first point, thus
  "closing" the shape, and then repeating the last (possibly implied) <code id=building-paths:dom-context-2d-moveto-4><a href=#dom-context-2d-moveto>moveTo()</a></code> call.</p>


  <p>New points and the lines connecting them are added to subpaths using the methods described
  below. In all cases, the methods only modify the last subpath in the object's path.</p>


  <p>The <dfn id=dom-context-2d-lineto><code>lineTo(<var>x</var>, <var>y</var>)</code></dfn>
  method, when invoked, must run these steps:</p>

  <ol><li><p>If either of the arguments are infinite or NaN, then abort these steps.</li><li><p>If the object's path has no subpaths, then <a href=#ensure-there-is-a-subpath id=building-paths:ensure-there-is-a-subpath>ensure there is a subpath</a> for
   <span>(<var>x</var>, <var>y</var>)</span>.</li><li><p>Otherwise, connect the last point in the subpath to the given point (<var>x</var>,
   <var>y</var>) using a straight line, and then add the given point (<var>x</var>, <var>y</var>) to
   the subpath.</li></ol>

  <p>The <dfn id=dom-context-2d-quadraticcurveto><code>quadraticCurveTo(<var>cpx</var>,
  <var>cpy</var>, <var>x</var>, <var>y</var>)</code></dfn> method, when invoked, must run these
  steps:</p>

  <ol><li><p>If any of the arguments are infinite or NaN, then abort these steps.</li><li><p><a href=#ensure-there-is-a-subpath id=building-paths:ensure-there-is-a-subpath-2>Ensure there is a subpath</a> for <span>(<var>cpx</var>,
   <var>cpy</var>)</span></li><li><p>Connect the last point in the subpath to the given point (<var>x</var>, <var>y</var>)
   using a quadratic Bézier curve with control point (<var>cpx</var>, <var>cpy</var>). <a href=references.html#refsBEZIER>[BEZIER]</a></li><li><p>Add the given point (<var>x</var>, <var>y</var>) to the subpath.</li></ol>

  <p>The <dfn id=dom-context-2d-beziercurveto><code>bezierCurveTo(<var>cp1x</var>,
  <var>cp1y</var>, <var>cp2x</var>, <var>cp2y</var>, <var>x</var>, <var>y</var>)</code></dfn>
  method, when invoked, must run these steps:</p>

  <ol><li><p>If any of the arguments are infinite or NaN, then abort these steps.</li><li><p><a href=#ensure-there-is-a-subpath id=building-paths:ensure-there-is-a-subpath-3>Ensure there is a subpath</a> for <span>(<var>cp1x</var>,
   <var>cp1y</var>)</span>.</li><li><p>Connect the last point in the subpath to the given point (<var>x</var>, <var>y</var>)
   using a cubic Bézier curve with control points (<var>cp1x</var>, <var>cp1y</var>) and
   (<var>cp2x</var>, <var>cp2y</var>). <a href=references.html#refsBEZIER>[BEZIER]</a></li><li><p>Add the point (<var>x</var>, <var>y</var>) to the subpath.</li></ol>

  <hr>

  <p>The <dfn id=dom-context-2d-arcto><code>arcTo(<var>x1</var>, <var>y1</var>, <var>x2</var>,
  <var>y2</var>, <var>radiusX</var>, <var>radiusY</var>, <var>rotation</var>)</code></dfn> method,
  when invoked, must run these steps:</p>

  <ol><li><p>If any of the arguments are infinite or NaN, then abort these steps.</li><li><p><a href=#ensure-there-is-a-subpath id=building-paths:ensure-there-is-a-subpath-4>Ensure there is a subpath</a> for <span>(<var>x1</var>,
   <var>y1</var>)</span>.</li><li><p>If either <var>radiusX</var> or <var>radiusY</var> are negative, then throw an
   <a id=building-paths:indexsizeerror-4 href=https://triple-underscore.github.io/WebIDL-ja.html#indexsizeerror data-x-internal=indexsizeerror>"<code>IndexSizeError</code>"</a> <code id=building-paths:domexception-4><a data-x-internal=domexception href=https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException>DOMException</a></code>.</li><li><p>If <var>radiusY</var> is omitted, then set <var>radiusY</var> to
   <var>radiusX</var>.</li><li><p>Let the point (<var>x0</var>, <var>y0</var>) be the last point in the subpath, transformed
   by the inverse of the <a href=#transformations id=building-paths:transformations-2>current transformation
   matrix</a> (so that it is in the same coordinate system as the points passed to the
   method).</li><li><p>If the point (<var>x0</var>, <var>y0</var>) is equal to the point (<var>x1</var>,
   <var>y1</var>), or if the point (<var>x1</var>, <var>y1</var>) is equal to the point
   (<var>x2</var>, <var>y2</var>), or if both <var>radiusX</var> and <var>radiusY</var> are zero,
   then add the point (<var>x1</var>, <var>y1</var>) to the subpath, and connect that point to the
   previous point (<var>x0</var>, <var>y0</var>) by a straight line.</li><li><p>Otherwise, if the points (<var>x0</var>, <var>y0</var>), (<var>x1</var>, <var>y1</var>),
   and (<var>x2</var>, <var>y2</var>) all lie on a single straight line, then add the point
   (<var>x1</var>, <var>y1</var>) to the subpath, and connect that point to the previous point
   (<var>x0</var>, <var>y0</var>) by a straight line.</li><li><p>Otherwise, let <var>The Arc</var> be the shortest arc given by circumference of the
   ellipse that has radius <var>radiusX</var> on the major axis and radius <var>radiusY</var> on the
   minor axis, and whose semi-major axis is rotated <var>rotation</var> radians clockwise from the
   positive x-axis, and that has one point tangent to the half-infinite line that crosses the point
   (<var>x0</var>, <var>y0</var>) and ends at the point (<var>x1</var>, <var>y1</var>), and that has
   a different point tangent to the half-infinite line that ends at the point (<var>x1</var>,
   <var>y1</var>) and crosses the point (<var>x2</var>, <var>y2</var>). The points at which this
   ellipse touches these two lines are called the start and end tangent points respectively. Connect
   the point (<var>x0</var>, <var>y0</var>) to the start tangent point by a straight line, adding
   the start tangent point to the subpath, and then connect the start tangent point to the end
   tangent point by <var>The Arc</var>, adding the end tangent point to the subpath.</li></ol>

  <hr>

  <p>The <dfn id=dom-context-2d-arc><code>arc(<var>x</var>, <var>y</var>,
  <var>radius</var>, <var>startAngle</var>, <var>endAngle</var>, <var>anticlockwise</var>)</code></dfn> and <dfn id=dom-context-2d-ellipse><code>ellipse(<var>x</var>, <var>y</var>, <var>radiusX</var>, <var>radiusY</var>, <var>rotation</var>, <var>startAngle</var>, <var>endAngle</var>, <var>anticlockwise</var>)</code></dfn> methods draw arcs.</p>

  <p>The <code id=building-paths:dom-context-2d-arc-3><a href=#dom-context-2d-arc>arc()</a></code> method is equivalent to the <code id=building-paths:dom-context-2d-ellipse-3><a href=#dom-context-2d-ellipse>ellipse()</a></code> method in the case where the two radii are equal.
  When the <code id=building-paths:dom-context-2d-arc-4><a href=#dom-context-2d-arc>arc()</a></code> method is invoked, it must act as if the
  <code id=building-paths:dom-context-2d-ellipse-4><a href=#dom-context-2d-ellipse>ellipse()</a></code> method had been invoked with the <var>radiusX</var> and <var>radiusY</var> arguments set to the value of the <var>radius</var> argument, the <var>rotation</var> argument set to zero, and the
  other arguments set to the same values as their identically named arguments on the <code id=building-paths:dom-context-2d-arc-5><a href=#dom-context-2d-arc>arc()</a></code> method.</p>

  <p>The <code id=building-paths:dom-context-2d-ellipse-5><a href=#dom-context-2d-ellipse>ellipse()</a></code> method, when invoked, must run these
  steps:</p>

  <ol><li><p>If any of the arguments are infinite or NaN, then abort these steps.</li><li><p>If either <var>radiusX</var> or <var>radiusY</var> are negative, then throw an
   <a id=building-paths:indexsizeerror-5 href=https://triple-underscore.github.io/WebIDL-ja.html#indexsizeerror data-x-internal=indexsizeerror>"<code>IndexSizeError</code>"</a> <code id=building-paths:domexception-5><a data-x-internal=domexception href=https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException>DOMException</a></code>.</li><li><p>If the object's path has any subpaths, then add a straight line from the last point in the
   subpath to the start point of the arc.</li><li>
    <p>Add the start and end points of the arc to the subpath, and connect them with an arc. The arc
    and its start and end points are defined as follows:</p>

    <p>Consider an ellipse that has its origin at (<var>x</var>, <var>y</var>), that has a
    major-axis radius <var>radiusX</var> and a minor-axis radius <var>radiusY</var>, and that is
    rotated about its origin such that its semi-major axis is inclined <var>rotation</var> radians
    clockwise from the x-axis.</p>

    <p>If <var>anticlockwise</var> is false and <span><var>endAngle</var>-<var>startAngle</var></span> is equal to or greater than <span>2π</span>, or, if <var>anticlockwise</var> is <em>true</em> and <span><var>startAngle</var>-<var>endAngle</var></span> is equal to or greater than <span>2π</span>, then the arc is the whole circumference of this ellipse, and the point
    at <var>startAngle</var> along this circle's circumference, measured in radians clockwise from
    the ellipse's semi-major axis, acts as both the start point and the end point.</p>

    <p>Otherwise, the points at <var>startAngle</var> and <var>endAngle</var> along this circle's
    circumference, measured in radians clockwise from the ellipse's semi-major axis, are the start
    and end points respectively, and the arc is the path along the circumference of this ellipse
    from the start point to the end point, going anti-clockwise if <var>anticlockwise</var> is true,
    and clockwise otherwise. Since the points are on the ellipse, as opposed to being simply angles
    from zero, the arc can never cover an angle greater than <span>2π</span>
    radians.</p>

    <p class=note>Even if the arc covers the entire circumference of the ellipse and there are no
    other points in the subpath, the path is not closed unless the <code id=building-paths:dom-context-2d-closepath-3><a href=#dom-context-2d-closepath>closePath()</a></code> method is appropriately invoked.</p>
   </li></ol>

  <hr>

  <p>The <dfn id=dom-context-2d-rect><code>rect(<var>x</var>, <var>y</var>, <var>w</var>,
  <var>h</var>)</code></dfn> method, when invoked, must run these steps:</p>

  <ol><li><p>If any of the arguments are infinite or NaN, then abort these steps.</li><li><p>Create a new subpath containing just the four points (<var>x</var>, <var>y</var>),
   (<var>x</var>+<var>w</var>, <var>y</var>), (<var>x</var>+<var>w</var>,
   <var>y</var>+<var>h</var>), (<var>x</var>, <var>y</var>+<var>h</var>), in that order, with those
   four points connected by straight lines.</li><li><p>Mark the subpath as closed.</li><li><p>Create a new subpath with the point (<var>x</var>, <var>y</var>) as the only point in the
   subpath.</li></ol>

  

  



  <h6 id=path2d-objects>4.12.5.1.6 <code id=path2d-objects:path2d><a href=#path2d>Path2D</a></code> objects<a href=#path2d-objects class=self-link></a></h6><div class=status><input onclick=toggleStatus(this) value=⋰ type=button><p class=bugs><strong>Spec bugs:</strong> <a href="https://www.w3.org/Bugs/Public/show_bug.cgi?id=21939" title="&lt;canvas&gt;: Path introspection">21939</a></div>

  <p><code id=path2d-objects:path2d-2><a href=#path2d>Path2D</a></code> objects can be used to declare paths that are then later used on
  objects implementing the <code id=path2d-objects:canvasdrawpath><a href=#canvasdrawpath>CanvasDrawPath</a></code> interface. In addition to many of the APIs
  described in earlier sections, <code id=path2d-objects:path2d-3><a href=#path2d>Path2D</a></code> objects have methods to combine paths, and to
  add text to paths.</p>

  <dl class=domintro><dt><var>path</var> = new <code id=path2d-objects:dom-path2d><a href=#dom-path2d>Path2D</a></code>()<dd>

    <p>Creates a new empty <code id=path2d-objects:path2d-4><a href=#path2d>Path2D</a></code> object.</p>

   <dt><var>path</var> = new <code id=path2d-objects:dom-path2d-copy><a href=#dom-path2d-copy>Path2D</a></code>(<var>path</var>)<dd>

    <p>Creates a new <code id=path2d-objects:path2d-5><a href=#path2d>Path2D</a></code> object that is a copy of the argument.</p>

   <dt><var>path</var> = new <code id=path2d-objects:dom-path2d-merge><a href=#dom-path2d-merge>Path2D</a></code>(<var>paths</var> [, <var>fillRule</var> ] )<dd>

    <p>Creates a new <code id=path2d-objects:path2d-6><a href=#path2d>Path2D</a></code> object that describes a path that outlines the given <var>paths</var>, using the given fill rule.</p>

   <dt><var>path</var> = new <code id=path2d-objects:dom-path2d-withdata><a href=#dom-path2d-withdata>Path2D</a></code>(<var>d</var>)<dd>

    <p>Creates a new path with the path described by the argument, interpreted as SVG path data. <a href=references.html#refsSVG>[SVG]</a></p>

   <dt><var>path</var> . <code id=path2d-objects:dom-path2d-addpath><a href=#dom-path2d-addpath>addPath</a></code>(<var>path</var> [, <var>transform</var> ] )<dd>

    <p>Adds to the path the path given by the argument.</p>

   </dl>

  

  <p>The <dfn id=dom-path2d><code>Path2D()</code></dfn> constructor, when invoked, must return a
  newly created <code id=path2d-objects:path2d-7><a href=#path2d>Path2D</a></code> object.</p>

  <hr>

  <p>The <dfn id=dom-path2d-copy><code>Path2D(<var>path</var>)</code></dfn>
  constructor, when invoked, must return a newly created <code id=path2d-objects:path2d-8><a href=#path2d>Path2D</a></code> object, to which the
  subpaths of the argument are added. (In other words, it returns a copy of the argument.)</p>

  <hr>

  <p>The <dfn id=dom-path2d-merge><code>Path2D(<var>paths</var>,
  <var>fillRule</var>)</code></dfn> constructor, when invoked, must run these steps:</p>

  <ol><li>

    <p>Run the appropriate step from the following list, based on the constructor's second
    argument:</p>

    <dl class=switch><dt>If it is "nonzero"<dd>

      <p>Let <var>merged path</var> be a <a href=#concept-path id=path2d-objects:concept-path>path</a> that
      consists of a set of non-overlapping subpaths that exactly outline the points from which, in
      any of the <a href=#concept-path id=path2d-objects:concept-path-2>paths</a> provided in the constructor's first
      argument, the number of times a half-infinite straight line drawn from that point crosses a
      subpath going in one direction is not equal to the number of times it crosses a subpath going
      in the other direction.</p>

     <dt>If it is "evenodd"<dd>

      <p>Let <var>merged path</var> be a <a href=#concept-path id=path2d-objects:concept-path-3>path</a> that
      consists of a set of non-overlapping subpaths that exactly outline the points from which, in
      any of the <a href=#concept-path id=path2d-objects:concept-path-4>paths</a> provided in the constructor's first
      argument, the number of times a half-infinite straight line drawn from that point crosses that
      path is odd.</p>

     </dl>

    <p>The subpaths in <var>merged path</var> must be oriented such that for any point,
    the number of times a half-infinite straight line drawn from that point crosses a subpath is
    even if and only if the number of times a half-infinite straight line drawn from that same point
    crosses a subpath going in one direction is equal to the number of times it crosses a subpath
    going in the other direction.</p>

   </li><li><p>Add all the subpaths in <var>merged path</var> to the <code id=path2d-objects:path2d-9><a href=#path2d>Path2D</a></code>
   object.</li><li><p>Set the <code id=path2d-objects:path2d-10><a href=#path2d>Path2D</a></code> object's <a href=#need-new-subpath id=path2d-objects:need-new-subpath>need new subpath</a> flag.</li></ol>

  <hr>

  <p>The <dfn id=dom-path2d-withdata><code>Path2D(<var>d</var>)</code></dfn>
  constructor, when invoked, must run these steps:</p>

  <ol><li>

    <p>Parse and interpret the <var>d</var> argument according to the SVG specification's
    rules for path data, thus obtaining an SVG path. <a href=references.html#refsSVG>[SVG]</a></p>

    <p class=note>The resulting path could be empty. SVG defines error handling rules for parsing
    and applying path data.</p>

   </li><li><p>Let (<var>x</var>, <var>y</var>) be the last point in the SVG
   path.</li><li><p>Create a new <code id=path2d-objects:path2d-11><a href=#path2d>Path2D</a></code> object and add all the subpaths in the SVG path, if any,
   to that <code id=path2d-objects:path2d-12><a href=#path2d>Path2D</a></code> object.  </p>

   </li><li><p>Create a new subpath in the <code id=path2d-objects:path2d-13><a href=#path2d>Path2D</a></code> object with (<var>x</var>, <var>y</var>) as the only point in the subpath.</li><li><p>Return the <code id=path2d-objects:path2d-14><a href=#path2d>Path2D</a></code> object as the constructed object.</li></ol>

  <hr>

  <p>The <dfn id=dom-path2d-addpath><code>addPath(<var>b</var>,
  <var>transform</var>)</code></dfn> method, when invoked on a <code id=path2d-objects:path2d-15><a href=#path2d>Path2D</a></code> object
  <var>a</var>, must run these steps:</p>

  <ol><li><p>If the <code id=path2d-objects:path2d-16><a href=#path2d>Path2D</a></code> object <var>b</var> has no subpaths, then abort these
   steps.</li><li><p>Create a copy of all the subpaths in <var>b</var>. Let this copy be known as <var>c</var>.</li><li><p>Let <var>matrix</var> be the result of <a href=https://drafts.fxtf.org/geometry/#create-a-dommatrix-from-the-dictionary id=path2d-objects:create-a-dommatrix-from-a-dictionary data-x-internal=create-a-dommatrix-from-a-dictionary>creating a <code>DOMMatrix</code> from a dictionary</a>
   <var>transform</var>.</li><li><p>Transform all the coordinates and lines in <var>c</var> by the transform matrix
   <var>matrix</var>.</li><li><p>Let (<var>x</var>, <var>y</var>) be the last point in the last subpath
   of <var>c</var>.</li><li><p>Add all the subpaths in <var>c</var> to <var>a</var>.</li><li><p>Create a new subpath in <var>a</var> with (<var>x</var>, <var>y</var>) as the only point in the subpath.</li></ol>

  


  <h6 id=transformations>4.12.5.1.7 <dfn>Transformations</dfn><a href=#transformations class=self-link></a></h6><div class=status><input onclick=toggleStatus(this) value=⋰ type=button><p class=bugs><strong>Spec bugs:</strong> <a href="https://www.w3.org/Bugs/Public/show_bug.cgi?id=28333" title="Show on example how a,b,c,d,e,f affect the point position">28333</a></div>

  <p>Objects that implement the <code id=transformations:canvastransform><a href=#canvastransform>CanvasTransform</a></code> interface have a <dfn id=current-transformation-matrix>current
  transformation matrix</dfn>, as well as methods (described in this section) to manipulate it. When
  an object implementing the <code id=transformations:canvastransform-2><a href=#canvastransform>CanvasTransform</a></code> interface is created, its transformation
  matrix must be initialized to the identity transform.</p>

  <p>The <a href=#current-transformation-matrix id=transformations:current-transformation-matrix>current transformation matrix</a> is applied to coordinates when creating the
  <a href=#current-default-path id=transformations:current-default-path>current default path</a>, and when painting text, shapes, and <code id=transformations:path2d><a href=#path2d>Path2D</a></code>
  objects, on objects implementing the <code id=transformations:canvastransform-3><a href=#canvastransform>CanvasTransform</a></code> interface.</p>
  

  <p class=note>Most of the API uses <code id=transformations:dommatrix><a data-x-internal=dommatrix href=https://drafts.fxtf.org/geometry/#dommatrix>DOMMatrix</a></code> objects rather than this API. This API
  remains mostly for historical reasons.</p>

  

  <p>The transformations must be performed in reverse order.</p>

  <p class=note>For instance, if a scale transformation that doubles the width is applied to the
  canvas, followed by a rotation transformation that rotates drawing operations by a quarter turn,
  and a rectangle twice as wide as it is tall is then drawn on the canvas, the actual result will be
  a square.</p> 

  

  <dl class=domintro><dt><var>context</var> . <code id=transformations:dom-context-2d-scale><a href=#dom-context-2d-scale>scale</a></code>(<var>x</var>, <var>y</var>)<dd>

    <p>Changes the <a href=#current-transformation-matrix id=transformations:current-transformation-matrix-2>current transformation matrix</a> to apply a scaling transformation
    with the given characteristics.</p>

   <dt><var>context</var> . <code id=transformations:dom-context-2d-rotate><a href=#dom-context-2d-rotate>rotate</a></code>(<var>angle</var>)<dd>

    <p>Changes the <a href=#current-transformation-matrix id=transformations:current-transformation-matrix-3>current transformation matrix</a> to apply a rotation transformation
    with the given characteristics. The angle is in radians.</p>

   <dt><var>context</var> . <code id=transformations:dom-context-2d-translate><a href=#dom-context-2d-translate>translate</a></code>(<var>x</var>, <var>y</var>)<dd>

    <p>Changes the <a href=#current-transformation-matrix id=transformations:current-transformation-matrix-4>current transformation matrix</a> to apply a translation transformation
    with the given characteristics.</p>

   <dt><var>context</var> . <code id=transformations:dom-context-2d-transform><a href=#dom-context-2d-transform>transform</a></code>(<var>a</var>, <var>b</var>, <var>c</var>, <var>d</var>, <var>e</var>, <var>f</var>)<dd>

    <p>Changes the <a href=#current-transformation-matrix id=transformations:current-transformation-matrix-5>current transformation matrix</a> to apply the matrix given by the
    arguments as described below.</p>

   <dt><var>matrix</var> = <var>context</var> . <code id=transformations:dom-context-2d-gettransform><a href=#dom-context-2d-gettransform>getTransform</a></code>()<dd>

    <p>Returns a copy of the <a href=#current-transformation-matrix id=transformations:current-transformation-matrix-6>current transformation matrix</a>, as a newly created
    <code id=transformations:dommatrix-2><a data-x-internal=dommatrix href=https://drafts.fxtf.org/geometry/#dommatrix>DOMMatrix</a></code> object.</p>

   <dt><var>context</var> . <code id=transformations:dom-context-2d-settransform><a href=#dom-context-2d-settransform>setTransform</a></code>(<var>a</var>, <var>b</var>, <var>c</var>, <var>d</var>, <var>e</var>, <var>f</var>)<dd>

    <p>Changes the <a href=#current-transformation-matrix id=transformations:current-transformation-matrix-7>current transformation matrix</a> <em>to</em> the matrix given by the
    arguments as described below.</p>

   <dt><var>context</var> . <code id=transformations:dom-context-2d-settransform-2><a href=#dom-context-2d-settransform>setTransform</a></code>(<var>transform</var>)<dd>

    <p>Changes the <a href=#current-transformation-matrix id=transformations:current-transformation-matrix-8>current transformation matrix</a> <em>to</em> the matrix represented by
    the passed <code id=transformations:dommatrixinit><a data-x-internal=dommatrixinit href=https://drafts.fxtf.org/geometry/#dictdef-dommatrixinit>DOMMatrixInit</a></code> dictionary.</p>

   <dt><var>context</var> . <code id=transformations:dom-context-2d-resettransform><a href=#dom-context-2d-resettransform>resetTransform</a></code>()<dd>

    <p>Changes the <a href=#current-transformation-matrix id=transformations:current-transformation-matrix-9>current transformation matrix</a> to the identity transform.</p>

   </dl>

  

  <p>The <dfn id=dom-context-2d-scale><code>scale(<var>x</var>, <var>y</var>)</code></dfn>
  method, when invoked, must run these steps:</p>

  <ol><li><p>If either of the arguments are infinite or NaN, then abort these steps.</li><li><p>Add the scaling transformation described by the arguments to the <a href=#current-transformation-matrix id=transformations:current-transformation-matrix-10>current
   transformation matrix</a>. The <var>x</var> argument represents the scale factor in the
   horizontal direction and the <var>y</var> argument represents the scale factor in the vertical
   direction. The factors are multiples.</li></ol>

  <p>The <dfn id=dom-context-2d-rotate><code>rotate(<var>angle</var>)</code></dfn> method,
  when invoked, must run these steps:</p>

  <ol><li><p>If <var>angle</var> is infinite or NaN, then abort these steps.</li><li><p>Add the rotation transformation described by the argument to the <a href=#current-transformation-matrix id=transformations:current-transformation-matrix-11>current
   transformation matrix</a>. The <var>angle</var> argument represents a clockwise rotation angle
   expressed in radians.</li></ol>

  <p>The <dfn id=dom-context-2d-translate><code>translate(<var>x</var>,
  <var>y</var>)</code></dfn> method, when invoked, must run these steps:</p>

  <ol><li><p>If either of the arguments are infinite or NaN, then abort these steps.</li><li><p>Add the translation transformation described by the arguments to the <a href=#current-transformation-matrix id=transformations:current-transformation-matrix-12>current
   transformation matrix</a>. The <var>x</var> argument represents the translation distance in
   the horizontal direction and the <var>y</var> argument represents the translation distance in the
   vertical direction. The arguments are in coordinate space units.</li></ol>

  <p>The <dfn id=dom-context-2d-transform><code>transform(<var>a</var>, <var>b</var>,
  <var>c</var>, <var>d</var>, <var>e</var>, <var>f</var>)</code></dfn> method, when invoked, must
  run these steps:</p>

  <ol><li><p>If any of the arguments are infinite or NaN, then abort these steps.</li><li><p>Replace the <a href=#current-transformation-matrix id=transformations:current-transformation-matrix-13>current transformation matrix</a> with the result of multiplying the
   current transformation matrix with the matrix described by:</li></ol>

  

  <table class=matrix><tr><td><var>a</var></td><td><var>c</var></td><td><var>e</var></td></tr><tr><td><var>b</var></td><td><var>d</var></td><td><var>f</var></td></tr><tr><td>0</td><td>0</td><td>1</td></tr></table>

  <p class=note>The arguments <var>a</var>, <var>b</var>, <var>c</var>, <var>d</var>,
  <var>e</var>, and <var>f</var> are sometimes called <var>m11</var>, <var>m12</var>,
  <var>m21</var>, <var>m22</var>, <var>dx</var>, and <var>dy</var> or <var>m11</var>,
  <var>m21</var>, <var>m12</var>, <var>m22</var>, <var>dx</var>, and <var>dy</var>. Care ought to be
  taken in particular with the order of the second and third arguments (<var>b</var> and
  <var>c</var>) as their order varies from API to API and APIs sometimes use the notation
  <var>m12</var>/<var>m21</var> and sometimes <var>m21</var>/<var>m12</var> for those positions.</p>

  

  <p>The <dfn id=dom-context-2d-gettransform><code>getTransform()</code></dfn> method, when
  invoked, must return a newly created <code id=transformations:dommatrix-3><a data-x-internal=dommatrix href=https://drafts.fxtf.org/geometry/#dommatrix>DOMMatrix</a></code> representing a copy of the
  <a href=#current-transformation-matrix id=transformations:current-transformation-matrix-14>current transformation matrix</a> matrix of the context.</p>

  <p class=note>This returned object is not live, so updating it will not affect the
  <a href=#current-transformation-matrix id=transformations:current-transformation-matrix-15>current transformation matrix</a>, and updating the <a href=#current-transformation-matrix id=transformations:current-transformation-matrix-16>current transformation
  matrix</a> will not affect an already returned <code id=transformations:dommatrix-4><a data-x-internal=dommatrix href=https://drafts.fxtf.org/geometry/#dommatrix>DOMMatrix</a></code>.</p>

  <p>The <dfn id=dom-context-2d-settransform><code>setTransform(<var>a</var>, <var>b</var>,
  <var>c</var>, <var>d</var>, <var>e</var>, <var>f</var>)</code></dfn> method, when invoked, must
  run these steps:</p>

  <ol><li><p>If any of the arguments are infinite or NaN, then abort these steps.</li><li><p>Reset the <a href=#current-transformation-matrix id=transformations:current-transformation-matrix-17>current transformation matrix</a> to the identity matrix.</li><li><p>Invoke the <code><a href=#dom-context-2d-transform id=transformations:dom-context-2d-transform-2>transform</a>(<var>a</var>, <var>b</var>, <var>c</var>,
   <var>d</var>, <var>e</var>, <var>f</var>)</code> method with the same arguments.</li></ol>

  <p>The <dfn><code>setTransform(<var>transform</var>)</code></dfn> method, when invoked,
  must reset the <a href=#current-transformation-matrix id=transformations:current-transformation-matrix-18>current transformation matrix</a> to the value represented by the result
  of <a href=https://drafts.fxtf.org/geometry/#create-a-dommatrix-from-the-dictionary id=transformations:create-a-dommatrix-from-a-dictionary data-x-internal=create-a-dommatrix-from-a-dictionary>creating a <code>DOMMatrix</code> from a
  dictionary</a> <var>transform</var>.</p>

  <p>The <dfn id=dom-context-2d-resettransform><code>resetTransform()</code></dfn> method,
  when invoked, must reset the <a href=#current-transformation-matrix id=transformations:current-transformation-matrix-19>current transformation matrix</a> to the identity
  matrix.</p>

  



  <h6 id=image-sources-for-2d-rendering-contexts>4.12.5.1.8 Image sources for 2D rendering contexts<a href=#image-sources-for-2d-rendering-contexts class=self-link></a></h6>

  <p>Some methods on the <code id=image-sources-for-2d-rendering-contexts:canvasdrawimage><a href=#canvasdrawimage>CanvasDrawImage</a></code> and <code id=image-sources-for-2d-rendering-contexts:canvasfillstrokestyles><a href=#canvasfillstrokestyles>CanvasFillStrokeStyles</a></code>
  interfaces take the union type <code id=image-sources-for-2d-rendering-contexts:canvasimagesource><a href=#canvasimagesource>CanvasImageSource</a></code> as an argument.</p>

  <p>This union type allows objects implementing any of the following interfaces to be used as image
  sources:</p>

  <ul><li><code id=image-sources-for-2d-rendering-contexts:htmlorsvgimageelement><a href=#htmlorsvgimageelement>HTMLOrSVGImageElement</a></code> (<code id=image-sources-for-2d-rendering-contexts:the-img-element><a href=embedded-content.html#the-img-element>img</a></code> or <a id=image-sources-for-2d-rendering-contexts:svg-image href=https://triple-underscore.github.io/SVG11/struct.html#ImageElement data-x-internal=svg-image>SVG <code>image</code></a>
   elements)</li><li><code id=image-sources-for-2d-rendering-contexts:htmlvideoelement><a href=embedded-content.html#htmlvideoelement>HTMLVideoElement</a></code> (<code id=image-sources-for-2d-rendering-contexts:the-video-element><a href=embedded-content.html#the-video-element>video</a></code> elements)</li><li><code id=image-sources-for-2d-rendering-contexts:htmlcanvaselement><a href=#htmlcanvaselement>HTMLCanvasElement</a></code> (<code id=image-sources-for-2d-rendering-contexts:the-canvas-element><a href=#the-canvas-element>canvas</a></code> elements)</li><li><code id=image-sources-for-2d-rendering-contexts:imagebitmap><a href=webappapis.html#imagebitmap>ImageBitmap</a></code></li></ul>

  <p class=note>Although not formally specified as such, <a id=image-sources-for-2d-rendering-contexts:svg-image-2 href=https://triple-underscore.github.io/SVG11/struct.html#ImageElement data-x-internal=svg-image>SVG <code>image</code></a>
  elements are expected to be implemented nearly identical to <code id=image-sources-for-2d-rendering-contexts:the-img-element-2><a href=embedded-content.html#the-img-element>img</a></code> elements. That is,
  <a id=image-sources-for-2d-rendering-contexts:svg-image-3 href=https://triple-underscore.github.io/SVG11/struct.html#ImageElement data-x-internal=svg-image>SVG <code>image</code></a> elements share the fundamental concepts and features of
  <code id=image-sources-for-2d-rendering-contexts:the-img-element-3><a href=embedded-content.html#the-img-element>img</a></code> elements.</p>

  <p class=note>The <code id=image-sources-for-2d-rendering-contexts:imagebitmap-2><a href=webappapis.html#imagebitmap>ImageBitmap</a></code> interface can be created from a number of other
  image-representing types, including <code id=image-sources-for-2d-rendering-contexts:imagedata><a href=#imagedata>ImageData</a></code>.</p>

  <p>When a user agent is required to <dfn id=check-the-usability-of-the-image-argument>check the usability of the <var>image</var>
  argument</dfn>, where <var>image</var> is a <code id=image-sources-for-2d-rendering-contexts:canvasimagesource-2><a href=#canvasimagesource>CanvasImageSource</a></code> object, the
  user agent must run these steps, which return either <i>good</i>, <i>bad</i>, or
  <i>aborted</i>:</p>

  <ol><li><p>If <var>image</var> is an <code id=image-sources-for-2d-rendering-contexts:htmlorsvgimageelement-2><a href=#htmlorsvgimageelement>HTMLOrSVGImageElement</a></code> object that is in the <a href=embedded-content.html#img-error id=image-sources-for-2d-rendering-contexts:img-error>broken</a> state, then throw an
   <a id=image-sources-for-2d-rendering-contexts:invalidstateerror href=https://triple-underscore.github.io/WebIDL-ja.html#invalidstateerror data-x-internal=invalidstateerror>"<code>InvalidStateError</code>"</a> <code id=image-sources-for-2d-rendering-contexts:domexception><a data-x-internal=domexception href=https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException>DOMException</a></code>, return <i>aborted</i>,
   and abort these steps.</li><li><p>If <var>image</var> is an <code id=image-sources-for-2d-rendering-contexts:htmlorsvgimageelement-3><a href=#htmlorsvgimageelement>HTMLOrSVGImageElement</a></code> object that is not <a href=embedded-content.html#img-good id=image-sources-for-2d-rendering-contexts:img-good>fully decodable</a>, or if <var>image</var> is an
   <code id=image-sources-for-2d-rendering-contexts:htmlvideoelement-2><a href=embedded-content.html#htmlvideoelement>HTMLVideoElement</a></code> object whose <code id=image-sources-for-2d-rendering-contexts:dom-media-readystate><a href=embedded-content.html#dom-media-readystate>readyState</a></code>
   attribute is either <code id=image-sources-for-2d-rendering-contexts:dom-media-have_nothing><a href=embedded-content.html#dom-media-have_nothing>HAVE_NOTHING</a></code> or <code id=image-sources-for-2d-rendering-contexts:dom-media-have_metadata><a href=embedded-content.html#dom-media-have_metadata>HAVE_METADATA</a></code>, then return <i>bad</i> and abort these
   steps.</li><li><p>If <var>image</var> is an <code id=image-sources-for-2d-rendering-contexts:htmlorsvgimageelement-4><a href=#htmlorsvgimageelement>HTMLOrSVGImageElement</a></code> object with an
   <a id=image-sources-for-2d-rendering-contexts:intrinsic-width href=infrastructure.html#intrinsic-width>intrinsic width</a> or <a id=image-sources-for-2d-rendering-contexts:intrinsic-height href=infrastructure.html#intrinsic-height>intrinsic height</a> (or both) equal to zero, then
   return <i>bad</i> and abort these steps.</li><li><p>If <var>image</var> is an <code id=image-sources-for-2d-rendering-contexts:htmlcanvaselement-2><a href=#htmlcanvaselement>HTMLCanvasElement</a></code> object with either a horizontal
   dimension or a vertical dimension equal to zero, then return <i>bad</i> and abort these
   steps.</li><li><p>If <var>image</var> is an <code id=image-sources-for-2d-rendering-contexts:imagebitmap-3><a href=webappapis.html#imagebitmap>ImageBitmap</a></code> object with its
   <a id=image-sources-for-2d-rendering-contexts:detached href=infrastructure.html#detached>[[Detached]]</a> internal slot value set to true, then throw an
   <a id=image-sources-for-2d-rendering-contexts:invalidstateerror-2 href=https://triple-underscore.github.io/WebIDL-ja.html#invalidstateerror data-x-internal=invalidstateerror>"<code>InvalidStateError</code>"</a> <code id=image-sources-for-2d-rendering-contexts:domexception-2><a data-x-internal=domexception href=https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException>DOMException</a></code>, return <i>aborted</i>,
   and abort these steps.</li><li><p>Return <i>good</i>.</li></ol>

  <p>When a <code id=image-sources-for-2d-rendering-contexts:canvasimagesource-3><a href=#canvasimagesource>CanvasImageSource</a></code> object represents an <code id=image-sources-for-2d-rendering-contexts:htmlorsvgimageelement-5><a href=#htmlorsvgimageelement>HTMLOrSVGImageElement</a></code>,
  the element's image must be used as the source image.</p>

  <p>Specifically, when a <code id=image-sources-for-2d-rendering-contexts:canvasimagesource-4><a href=#canvasimagesource>CanvasImageSource</a></code> object represents an animated image in an
  <code id=image-sources-for-2d-rendering-contexts:htmlorsvgimageelement-6><a href=#htmlorsvgimageelement>HTMLOrSVGImageElement</a></code>, the user agent must use the default image of the animation
  (the one that the format defines is to be used when animation is not supported or is disabled),
  or, if there is no such image, the first frame of the animation, when rendering the image for
  <code id=image-sources-for-2d-rendering-contexts:canvasrenderingcontext2d><a href=#canvasrenderingcontext2d>CanvasRenderingContext2D</a></code> APIs.</p>

  <p>When a <code id=image-sources-for-2d-rendering-contexts:canvasimagesource-5><a href=#canvasimagesource>CanvasImageSource</a></code> object represents an <code id=image-sources-for-2d-rendering-contexts:htmlvideoelement-3><a href=embedded-content.html#htmlvideoelement>HTMLVideoElement</a></code>, then
  the frame at the <a id=image-sources-for-2d-rendering-contexts:current-playback-position href=embedded-content.html#current-playback-position>current playback position</a> when the method with the argument is
  invoked must be used as the source image when rendering the image for
  <code id=image-sources-for-2d-rendering-contexts:canvasrenderingcontext2d-2><a href=#canvasrenderingcontext2d>CanvasRenderingContext2D</a></code> APIs, and the source image's dimensions must be the <a href=embedded-content.html#concept-video-intrinsic-width id=image-sources-for-2d-rendering-contexts:concept-video-intrinsic-width>intrinsic width</a> and <a href=embedded-content.html#concept-video-intrinsic-height id=image-sources-for-2d-rendering-contexts:concept-video-intrinsic-height>intrinsic height</a> of the <a id=image-sources-for-2d-rendering-contexts:media-resource href=embedded-content.html#media-resource>media resource</a>
  (i.e. after any aspect-ratio correction has been applied).</p>

  <p>When a <code id=image-sources-for-2d-rendering-contexts:canvasimagesource-6><a href=#canvasimagesource>CanvasImageSource</a></code> object represents an <code id=image-sources-for-2d-rendering-contexts:htmlcanvaselement-3><a href=#htmlcanvaselement>HTMLCanvasElement</a></code>, the
  element's bitmap must be used as the source image.</p>

  <p>When a <code id=image-sources-for-2d-rendering-contexts:canvasimagesource-7><a href=#canvasimagesource>CanvasImageSource</a></code> object represents an element that is <a id=image-sources-for-2d-rendering-contexts:being-rendered href=rendering.html#being-rendered>being
  rendered</a> and that element has been resized, the original image data of the source image
  must be used, not the image as it is rendered (e.g. <code id=image-sources-for-2d-rendering-contexts:attr-dim-width><a href=embedded-content.html#attr-dim-width>width</a></code> and
  <code id=image-sources-for-2d-rendering-contexts:attr-dim-height><a href=embedded-content.html#attr-dim-height>height</a></code> attributes on the source element have no effect on how
  the object is interpreted when rendering the image for <code id=image-sources-for-2d-rendering-contexts:canvasrenderingcontext2d-3><a href=#canvasrenderingcontext2d>CanvasRenderingContext2D</a></code>
  APIs).</p>

  <p>When a <code id=image-sources-for-2d-rendering-contexts:canvasimagesource-8><a href=#canvasimagesource>CanvasImageSource</a></code> object represents an <code id=image-sources-for-2d-rendering-contexts:imagebitmap-4><a href=webappapis.html#imagebitmap>ImageBitmap</a></code>, the
  object's bitmap image data must be used as the source image.</p>

  <p><dfn id=the-image-argument-is-not-origin-clean>The <var>image argument</var> is not origin-clean</dfn> if it is an
  <code id=image-sources-for-2d-rendering-contexts:htmlorsvgimageelement-7><a href=#htmlorsvgimageelement>HTMLOrSVGImageElement</a></code> or <code id=image-sources-for-2d-rendering-contexts:htmlvideoelement-4><a href=embedded-content.html#htmlvideoelement>HTMLVideoElement</a></code> whose <a id=image-sources-for-2d-rendering-contexts:concept-origin href=browsers.html#concept-origin>origin</a> is
  not the <a href=browsers.html#same-origin id=image-sources-for-2d-rendering-contexts:same-origin>same</a> as the <a href=webappapis.html#concept-settings-object-origin id=image-sources-for-2d-rendering-contexts:concept-settings-object-origin>origin</a> specified by the <a id=image-sources-for-2d-rendering-contexts:entry-settings-object href=webappapis.html#entry-settings-object>entry settings
  object</a>, or if it is an <code id=image-sources-for-2d-rendering-contexts:htmlcanvaselement-4><a href=#htmlcanvaselement>HTMLCanvasElement</a></code> whose bitmap's <a href=#concept-canvas-origin-clean id=image-sources-for-2d-rendering-contexts:concept-canvas-origin-clean>origin-clean</a> flag is false.</p>



  <h6 id=fill-and-stroke-styles>4.12.5.1.9 Fill and stroke styles<a href=#fill-and-stroke-styles class=self-link></a></h6>

  <dl class=domintro><dt><var>context</var> . <code id=fill-and-stroke-styles:dom-context-2d-fillstyle><a href=#dom-context-2d-fillstyle>fillStyle</a></code> [ = <var>value</var> ]<dd>

    <p>Returns the current style used for filling shapes.</p>

    <p>Can be set, to change the fill style.</p>

    <p>The style can be either a string containing a CSS color, or a <code id=fill-and-stroke-styles:canvasgradient><a href=#canvasgradient>CanvasGradient</a></code> or
    <code id=fill-and-stroke-styles:canvaspattern><a href=#canvaspattern>CanvasPattern</a></code> object. Invalid values are ignored.</p>

   <dt><var>context</var> . <code id=fill-and-stroke-styles:dom-context-2d-strokestyle><a href=#dom-context-2d-strokestyle>strokeStyle</a></code> [ = <var>value</var> ]<dd>

    <p>Returns the current style used for stroking shapes.</p>

    <p>Can be set, to change the stroke style.</p>

    <p>The style can be either a string containing a CSS color, or a <code id=fill-and-stroke-styles:canvasgradient-2><a href=#canvasgradient>CanvasGradient</a></code> or
    <code id=fill-and-stroke-styles:canvaspattern-2><a href=#canvaspattern>CanvasPattern</a></code> object. Invalid values are ignored.</p>

   </dl>

  

  

  <p>Objects that implement the <code id=fill-and-stroke-styles:canvasfillstrokestyles><a href=#canvasfillstrokestyles>CanvasFillStrokeStyles</a></code> interface have attributes and
  methods (defined in this section) that control how shapes are treated by the object.</p>

  <p>The <dfn id=dom-context-2d-fillstyle><code>fillStyle</code></dfn> attribute represents the
  color or style to use inside shapes, and the <dfn id=dom-context-2d-strokestyle><code>strokeStyle</code></dfn> attribute represents the color
  or style to use for the lines around the shapes.</p>

  <p>Both attributes can be either strings, <code id=fill-and-stroke-styles:canvasgradient-3><a href=#canvasgradient>CanvasGradient</a></code>s, or
  <code id=fill-and-stroke-styles:canvaspattern-3><a href=#canvaspattern>CanvasPattern</a></code>s. On setting, strings must be <a href=infrastructure.html#parsed-as-a-css-color-value id=fill-and-stroke-styles:parsed-as-a-css-color-value>parsed as CSS &lt;color&gt; values</a> and the color assigned, and
  <code id=fill-and-stroke-styles:canvasgradient-4><a href=#canvasgradient>CanvasGradient</a></code> and <code id=fill-and-stroke-styles:canvaspattern-4><a href=#canvaspattern>CanvasPattern</a></code> objects must be assigned themselves. <a href=references.html#refsCSSCOLOR>[CSSCOLOR]</a> If the value is a string but cannot be <a id=fill-and-stroke-styles:parsed-as-a-css-color-value-2 href=infrastructure.html#parsed-as-a-css-color-value>parsed as a CSS
  &lt;color&gt; value</a>, then it must be ignored, and the attribute must retain its previous
  value.

  If the new value is a <code id=fill-and-stroke-styles:canvaspattern-5><a href=#canvaspattern>CanvasPattern</a></code> object that is marked as <a href=#concept-canvas-pattern-not-origin-clean id=fill-and-stroke-styles:concept-canvas-pattern-not-origin-clean>not origin-clean</a>, then the
  <code id=fill-and-stroke-styles:canvasrenderingcontext2d><a href=#canvasrenderingcontext2d>CanvasRenderingContext2D</a></code>'s <a href=#concept-canvas-origin-clean id=fill-and-stroke-styles:concept-canvas-origin-clean>origin-clean</a> flag must be set to false.

  

  </p>

  <p>When set to a <code id=fill-and-stroke-styles:canvaspattern-6><a href=#canvaspattern>CanvasPattern</a></code> or <code id=fill-and-stroke-styles:canvasgradient-5><a href=#canvasgradient>CanvasGradient</a></code> object, the assignment
  is <a id=fill-and-stroke-styles:live href=infrastructure.html#live>live</a>, meaning that changes made to the object after the assignment do affect
  subsequent stroking or filling of shapes.</p>

  <p>On getting, if the value is a color, then the <a href=#serialisation-of-a-color id=fill-and-stroke-styles:serialisation-of-a-color>serialization of the color</a> must be returned. Otherwise, if it is not a color but a
  <code id=fill-and-stroke-styles:canvasgradient-6><a href=#canvasgradient>CanvasGradient</a></code> or <code id=fill-and-stroke-styles:canvaspattern-7><a href=#canvaspattern>CanvasPattern</a></code>, then the respective object must be
  returned. (Such objects are opaque and therefore only useful for assigning to other attributes or
  for comparison to other gradients or patterns.)</p>

  <p>The <dfn id=serialisation-of-a-color>serialization of a color</dfn> for a color
  value is a string, computed as follows: if it has alpha equal to 1.0, then the string is a
  lowercase six-digit hex value, prefixed with a "#" character (U+0023 NUMBER SIGN), with the first
  two digits representing the red component, the next two digits representing the green component,
  and the last two digits representing the blue component, the digits being <a href=https://infra.spec.whatwg.org/#ascii-lower-hex-digit id=fill-and-stroke-styles:lowercase-ascii-hex-digits data-x-internal=lowercase-ascii-hex-digits>ASCII lower hex digits</a>. Otherwise, the color value has alpha less than
  1.0, and the string is the color value in the CSS <code>rgba()</code>
  functional-notation format: the literal string "<code>rgba</code>" (U+0072 U+0067 U+0062
  U+0061) followed by a U+0028 LEFT PARENTHESIS, a base-ten integer in the range 0-255 representing
  the red component (using <a id=fill-and-stroke-styles:ascii-digits href=https://infra.spec.whatwg.org/#ascii-digit data-x-internal=ascii-digits>ASCII digits</a> in the shortest form possible), a literal
  U+002C COMMA and U+0020 SPACE, an integer for the green component, a comma and a space, an integer
  for the blue component, another comma and space, a U+0030 DIGIT ZERO, if the alpha value is
  greater than zero then a U+002E FULL STOP (representing the decimal point), if the alpha value is
  greater than zero then one or more <a id=fill-and-stroke-styles:ascii-digits-2 href=https://infra.spec.whatwg.org/#ascii-digit data-x-internal=ascii-digits>ASCII digits</a> representing the fractional part of
  the alpha, and finally a U+0029
  RIGHT PARENTHESIS. User agents must express the fractional part of the alpha value, if any, with
  the level of precision necessary for the alpha value, when reparsed, to be interpreted as the same
  alpha value.</p>
  

  <p>When the context is created, the <code id=fill-and-stroke-styles:dom-context-2d-fillstyle-2><a href=#dom-context-2d-fillstyle>fillStyle</a></code> and <code id=fill-and-stroke-styles:dom-context-2d-strokestyle-2><a href=#dom-context-2d-strokestyle>strokeStyle</a></code> attributes
  must initially have the string value <code>#000000</code>.</p>

  <p>When the value is a color, it must not be affected by the transformation matrix when used to
  draw on bitmaps.</p> 

  

  <hr>

  <p>There are two types of gradients, linear gradients and radial gradients, both represented by
  objects implementing the opaque <code id=fill-and-stroke-styles:canvasgradient-7><a href=#canvasgradient>CanvasGradient</a></code> interface.</p>

  <p id=interpolation>Once a gradient has been created (see below), stops are placed along it to
  define how the colors are distributed along the gradient. The color of the
  gradient at each stop is the color specified for that stop. Between each such stop, the colors and
  the alpha component must be linearly interpolated over the RGBA space without premultiplying the
  alpha value to find the color to use at that offset. Before the first stop, the color must be the
  color of the first stop. After the last stop, the color must be the color of the last stop. When
  there are no stops, the gradient is transparent black.</p>

  <dl class=domintro><dt><var>gradient</var> . <code id=fill-and-stroke-styles:dom-canvasgradient-addcolorstop><a href=#dom-canvasgradient-addcolorstop>addColorStop</a></code>(<var>offset</var>, <var>color</var>)<dd>

    <p>Adds a color stop with the given color to the gradient at the given offset. 0.0 is the offset
    at one end of the gradient, 1.0 is the offset at the other end.</p>

    <p>Throws an <a id=fill-and-stroke-styles:indexsizeerror href=https://triple-underscore.github.io/WebIDL-ja.html#indexsizeerror data-x-internal=indexsizeerror>"<code>IndexSizeError</code>"</a> <code id=fill-and-stroke-styles:domexception><a data-x-internal=domexception href=https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException>DOMException</a></code> if the offset
    is out of range. Throws a <a id=fill-and-stroke-styles:syntaxerror href=https://triple-underscore.github.io/WebIDL-ja.html#syntaxerror data-x-internal=syntaxerror>"<code>SyntaxError</code>"</a> <code id=fill-and-stroke-styles:domexception-2><a data-x-internal=domexception href=https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException>DOMException</a></code> if
    the color cannot be parsed.</p>

   <dt><var>gradient</var> = <var>context</var> . <code id=fill-and-stroke-styles:dom-context-2d-createlineargradient><a href=#dom-context-2d-createlineargradient>createLinearGradient</a></code>(<var>x0</var>, <var>y0</var>, <var>x1</var>, <var>y1</var>)<dd>

    <p>Returns a <code id=fill-and-stroke-styles:canvasgradient-8><a href=#canvasgradient>CanvasGradient</a></code> object that represents a
    linear gradient that paints along the line given by the
    coordinates represented by the arguments.</p>

   <dt><var>gradient</var> = <var>context</var> . <code id=fill-and-stroke-styles:dom-context-2d-createradialgradient><a href=#dom-context-2d-createradialgradient>createRadialGradient</a></code>(<var>x0</var>, <var>y0</var>, <var>r0</var>, <var>x1</var>, <var>y1</var>, <var>r1</var>)<dd>

    <p>Returns a <code id=fill-and-stroke-styles:canvasgradient-9><a href=#canvasgradient>CanvasGradient</a></code> object that represents a
    radial gradient that paints along the cone given by the circles
    represented by the arguments.</p>

    <p>If either of the radii are negative, throws an
    <a id=fill-and-stroke-styles:indexsizeerror-2 href=https://triple-underscore.github.io/WebIDL-ja.html#indexsizeerror data-x-internal=indexsizeerror>"<code>IndexSizeError</code>"</a> <code id=fill-and-stroke-styles:domexception-3><a data-x-internal=domexception href=https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException>DOMException</a></code> exception.</p>

   </dl>

  

  <p>The <dfn id=dom-canvasgradient-addcolorstop><code>addColorStop(<var>offset</var>,
  <var>color</var>)</code></dfn> method on the <code id=fill-and-stroke-styles:canvasgradient-10><a href=#canvasgradient>CanvasGradient</a></code> interface adds a new stop
  to a gradient. If the <var>offset</var> is less than 0 or greater than 1 then an
  <a id=fill-and-stroke-styles:indexsizeerror-3 href=https://triple-underscore.github.io/WebIDL-ja.html#indexsizeerror data-x-internal=indexsizeerror>"<code>IndexSizeError</code>"</a> <code id=fill-and-stroke-styles:domexception-4><a data-x-internal=domexception href=https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException>DOMException</a></code> must be thrown. If the
  <var>color</var> cannot be <a id=fill-and-stroke-styles:parsed-as-a-css-color-value-3 href=infrastructure.html#parsed-as-a-css-color-value>parsed as a CSS &lt;color&gt; value</a>, then a
  <a id=fill-and-stroke-styles:syntaxerror-2 href=https://triple-underscore.github.io/WebIDL-ja.html#syntaxerror data-x-internal=syntaxerror>"<code>SyntaxError</code>"</a> <code id=fill-and-stroke-styles:domexception-5><a data-x-internal=domexception href=https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException>DOMException</a></code> must be thrown. Otherwise, the
  gradient must have a new stop placed, at offset <var>offset</var> relative to the whole gradient,
  and with the color obtained by <a href=infrastructure.html#parsed-as-a-css-color-value id=fill-and-stroke-styles:parsed-as-a-css-color-value-4>parsing
  <var>color</var> as a CSS &lt;color&gt; value</a>. If multiple stops are added at the same
  offset on a gradient, then they must be placed in the order added, with the first one closest to
  the start of the gradient, and each subsequent one infinitesimally further along towards the end
  point (in effect causing all but the first and last stop added at each point to be ignored).</p>

  <p>The <dfn id=dom-context-2d-createlineargradient><code>createLinearGradient(<var>x0</var>,
  <var>y0</var>, <var>x1</var>, <var>y1</var>)</code></dfn> method takes four arguments that
  represent the start point (<var>x0</var>, <var>y0</var>) and end point (<var>x1</var>,
  <var>y1</var>) of the gradient. The method, when invoked, must return a linear
  <code id=fill-and-stroke-styles:canvasgradient-11><a href=#canvasgradient>CanvasGradient</a></code> initialized with the specified line.</p>

  <p>Linear gradients must be rendered such that all points on a line perpendicular to the line that
  crosses the start and end points have the color at the point where those two lines cross (with the
  colors coming from the <a href=#interpolation>interpolation and extrapolation</a> described
  above). The points in the linear gradient must be transformed as described by the <a href=#transformations id=fill-and-stroke-styles:transformations>current transformation matrix</a> when rendering.</p>

  <p>If <span><var>x0</var>&nbsp;=&nbsp;<var>x1</var></span> and <span><var>y0</var>&nbsp;=&nbsp;<var>y1</var></span>, then the linear
  gradient must paint nothing.</p>

  <p>The <dfn id=dom-context-2d-createradialgradient><code>createRadialGradient(<var>x0</var>,
  <var>y0</var>, <var>r0</var>, <var>x1</var>, <var>y1</var>, <var>r1</var>)</code></dfn> method
  takes six arguments, the first three representing the start circle with origin (<var>x0</var>,
  <var>y0</var>) and radius <var>r0</var>, and the last three representing the end circle with
  origin (<var>x1</var>, <var>y1</var>) and radius <var>r1</var>. The values are in coordinate space
  units. If either of <var>r0</var> or <var>r1</var> are negative, then an
  <a id=fill-and-stroke-styles:indexsizeerror-4 href=https://triple-underscore.github.io/WebIDL-ja.html#indexsizeerror data-x-internal=indexsizeerror>"<code>IndexSizeError</code>"</a> <code id=fill-and-stroke-styles:domexception-6><a data-x-internal=domexception href=https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException>DOMException</a></code> must be thrown. Otherwise,
  the method, when invoked, must return a radial <code id=fill-and-stroke-styles:canvasgradient-12><a href=#canvasgradient>CanvasGradient</a></code> initialized with the
  two specified circles.</p>

  <p>Radial gradients must be rendered by following these steps:</p>

  <ol><li><p>If <span><var>x<sub>0</sub></var>&nbsp;=&nbsp;<var>x<sub>1</sub></var></span> and <span><var>y<sub>0</sub></var>&nbsp;=&nbsp;<var>y<sub>1</sub></var></span> and <span><var>r<sub>0</sub></var>&nbsp;=&nbsp;<var>r<sub>1</sub></var></span>, then the radial gradient must
   paint nothing. Abort these steps.</li><li>

    <p>Let <span>x(<var>ω</var>)&nbsp;=&nbsp;(<var>x<sub>1</sub></var>-<var>x<sub>0</sub></var>)<var>ω</var>&nbsp;+&nbsp;<var>x<sub>0</sub></var></span></p>

    <p>Let <span>y(<var>ω</var>)&nbsp;=&nbsp;(<var>y<sub>1</sub></var>-<var>y<sub>0</sub></var>)<var>ω</var>&nbsp;+&nbsp;<var>y<sub>0</sub></var></span></p>

    <p>Let <span>r(<var>ω</var>)&nbsp;=&nbsp;(<var>r<sub>1</sub></var>-<var>r<sub>0</sub></var>)<var>ω</var>&nbsp;+&nbsp;<var>r<sub>0</sub></var></span></p>

    <p>Let the color at <var>ω</var> be the color at that position on the gradient
    (with the colors coming from the <a href=#interpolation>interpolation and extrapolation</a>
    described above).</p>

   </li><li><p>For all values of <var>ω</var> where <span>r(<var>ω</var>)&nbsp;&gt;&nbsp;0</span>, starting with the value of <var>ω</var> nearest to positive infinity and ending with the value of <var>ω</var> nearest to negative infinity, draw the circumference of the circle with
   radius <span>r(<var>ω</var>)</span> at position (<span>x(<var>ω</var>)</span>, <span>y(<var>ω</var>)</span>), with the
   color at <var>ω</var>, but only painting on the parts of the bitmap that have not
   yet been painted on by earlier circles in this step for this rendering of the gradient.</li></ol>

  <p class=note>This effectively creates a cone, touched by the two circles defined in the
  creation of the gradient, with the part of the cone before the start circle (0.0) using the color
  of the first offset, the part of the cone after the end circle (1.0) using the color of the last
  offset, and areas outside the cone untouched by the gradient (transparent black).</p>

  <p>The resulting radial gradient must then be transformed as described by the <a href=#transformations id=fill-and-stroke-styles:transformations-2>current transformation matrix</a> when rendering.</p>

  <p>Gradients must be painted only where the relevant stroking or filling effects requires that
  they be drawn.</p>

  

  <hr>

  <p>Patterns are represented by objects implementing the opaque <code id=fill-and-stroke-styles:canvaspattern-8><a href=#canvaspattern>CanvasPattern</a></code>
  interface.</p>

  <dl class=domintro><dt><var>pattern</var> = <var>context</var> . <code id=fill-and-stroke-styles:dom-context-2d-createpattern><a href=#dom-context-2d-createpattern>createPattern</a></code>(<var>image</var>, <var>repetition</var>)<dd>

    <p>Returns a <code id=fill-and-stroke-styles:canvaspattern-9><a href=#canvaspattern>CanvasPattern</a></code> object that uses the given image and repeats in the
    direction(s) given by the <var>repetition</var> argument.</p>

    <p>The allowed values for <var>repetition</var> are <code>repeat</code> (both
    directions), <code>repeat-x</code> (horizontal only), <code>repeat-y</code>
    (vertical only), and <code>no-repeat</code> (neither). If the <var>repetition</var> argument is empty, the value <code>repeat</code> is used.</p>

    <p>If the image isn't yet fully decoded, then nothing is drawn. If the image is a canvas with no
    data, throws an <a id=fill-and-stroke-styles:invalidstateerror href=https://triple-underscore.github.io/WebIDL-ja.html#invalidstateerror data-x-internal=invalidstateerror>"<code>InvalidStateError</code>"</a> <code id=fill-and-stroke-styles:domexception-7><a data-x-internal=domexception href=https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException>DOMException</a></code>.</p>

   <dt><var>pattern</var> . <code id=fill-and-stroke-styles:dom-canvaspattern-settransform><a href=#dom-canvaspattern-settransform>setTransform</a></code>(<var>transform</var>)<dd>

    <p>Sets the transformation matrix that will be used when rendering the pattern during a fill or
    stroke painting operation.</p>

   </dl>

  

  <p>The <dfn id=dom-context-2d-createpattern><code>createPattern(<var>image</var>,
  <var>repetition</var>)</code></dfn> method, when invoked, must run these steps:</p>

  <ol><li><p>Let <var>image</var> be the first argument and <var>repetition</var> be
   the second argument.</li><li><p><a href=#check-the-usability-of-the-image-argument id=fill-and-stroke-styles:check-the-usability-of-the-image-argument>Check the usability of the <var>image</var> argument</a>. If this
   returns <i>aborted</i>, then an exception has been thrown and the method doesn't return anything;
   abort these steps. If it returns <i>bad</i>, then return null and abort these steps. Otherwise it
   returns <i>good</i>; continue with these steps.</li><li><p>If <var>repetition</var> is the empty string, then set it to "<code>repeat</code>".</p>

   </li><li><p>If <var>repetition</var> is not a <a id=fill-and-stroke-styles:case-sensitive href=infrastructure.html#case-sensitive>case-sensitive</a> match for one of
   "<code>repeat</code>", "<code>repeat-x</code>", "<code>repeat-y</code>", or "<code>no-repeat</code>", then throw a
   <a id=fill-and-stroke-styles:syntaxerror-3 href=https://triple-underscore.github.io/WebIDL-ja.html#syntaxerror data-x-internal=syntaxerror>"<code>SyntaxError</code>"</a> <code id=fill-and-stroke-styles:domexception-8><a data-x-internal=domexception href=https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException>DOMException</a></code> and abort these steps.</li><li><p>Create a new <code id=fill-and-stroke-styles:canvaspattern-10><a href=#canvaspattern>CanvasPattern</a></code> object with the image <var>image</var>
   and the repetition behavior given by <var>repetition</var>.</li><li><p>If <a href=#the-image-argument-is-not-origin-clean id=fill-and-stroke-styles:the-image-argument-is-not-origin-clean>the <var>image argument</var> is not origin-clean</a>, then mark the
   <code id=fill-and-stroke-styles:canvaspattern-11><a href=#canvaspattern>CanvasPattern</a></code> object as <dfn id=concept-canvas-pattern-not-origin-clean>not
   origin-clean</dfn>.</li><li><p>Return the <code id=fill-and-stroke-styles:canvaspattern-12><a href=#canvaspattern>CanvasPattern</a></code> object.</li></ol>

  <p>Modifying the <var>image</var> used when creating a <code id=fill-and-stroke-styles:canvaspattern-13><a href=#canvaspattern>CanvasPattern</a></code> object
  after calling the <code id=fill-and-stroke-styles:dom-context-2d-createpattern-2><a href=#dom-context-2d-createpattern>createPattern()</a></code> method must
  not affect the pattern(s) rendered by the <code id=fill-and-stroke-styles:canvaspattern-14><a href=#canvaspattern>CanvasPattern</a></code> object.</p>

  <p>Patterns have a transformation matrix, which controls how the pattern is used when it is
  painted. Initially, a pattern's transformation matrix must be the identity transform.</p>

  <p>The <dfn id=dom-canvaspattern-settransform><code>setTransform(<var>transform</var>)</code></dfn> method,
  when invoked, must reset the pattern's transformation matrix to the value represented by the
  result of <a href=https://drafts.fxtf.org/geometry/#create-a-dommatrix-from-the-dictionary id=fill-and-stroke-styles:create-a-dommatrix-from-a-dictionary data-x-internal=create-a-dommatrix-from-a-dictionary>creating a <code>DOMMatrix</code>
  from a dictionary</a> <var>transform</var>.</p>

  <p>When a pattern is to be rendered within an area, the user agent must run the following steps to
  determine what is rendered:</p>

  <ol><li><p>Create an infinite transparent black bitmap.</li><li>

    <p>Place a copy of the image on the bitmap, anchored such that its top left corner is at the
    origin of the coordinate space, with one coordinate space unit per <a href=https://momdo.github.io/css3-values/#px id="fill-and-stroke-styles:'px'" data-x-internal="'px'">CSS
    pixel</a> of the image, then place repeated copies of this image horizontally to the left and
    right, if the repetition behavior is "<code>repeat-x</code>", or vertically up and
    down, if the repetition behavior is "<code>repeat-y</code>", or in all four
    directions all over the bitmap, if the repetition behavior is "<code>repeat</code>".</p>

    <p>If the original image data is a bitmap image, then the value painted at a point in the area
    of the repetitions is computed by filtering the original image data. When scaling up, if the
    <code id=fill-and-stroke-styles:dom-context-2d-imagesmoothingenabled><a href=#dom-context-2d-imagesmoothingenabled>imageSmoothingEnabled</a></code> attribute is
    set to false, then the image must be rendered using nearest-neighbor interpolation. Otherwise,
    the user agent may use any filtering algorithm (for example bilinear interpolation or
    nearest-neighbor). User agents which support multiple filtering algorithms may use the value of
    the <code id=fill-and-stroke-styles:dom-context-2d-imagesmoothingquality><a href=#dom-context-2d-imagesmoothingquality>imageSmoothingQuality</a></code> attribute
    to guide the choice of filtering algorithm. When such a filtering algorithm requires a pixel
    value from outside the original image data, it must instead use the value from wrapping the
    pixel's coordinates to the original image's dimensions. (That is, the filter uses 'repeat'
    behavior, regardless of the value of the pattern's repetition behavior.)</p> 

   </li><li><p>Transform the resulting bitmap according to the pattern's transformation matrix.</li><li><p>Transform the resulting bitmap again, this time according to the <a href=#transformations id=fill-and-stroke-styles:transformations-3>current transformation matrix</a>.</li><li><p>Replace any part of the image outside the area in which the pattern is to be rendered with
   transparent black.</li><li><p>The resulting bitmap is what is to be rendered, with the same origin and same
   scale.</li></ol>

  <hr>

  <p>If a radial gradient or repeated pattern is used when the transformation matrix is singular,
  then the resulting style must be transparent black (otherwise the gradient or pattern would be
  collapsed to a point or line, leaving the other pixels undefined). Linear gradients and solid
  colors always define all points even with singular transformation matrices.</p>

  




  <h6 id=drawing-rectangles-to-the-bitmap>4.12.5.1.10 Drawing rectangles to the bitmap<a href=#drawing-rectangles-to-the-bitmap class=self-link></a></h6>

  <p>Objects that implement the <code id=drawing-rectangles-to-the-bitmap:canvasrect><a href=#canvasrect>CanvasRect</a></code> interface provide the following methods for
  immediately drawing rectangles to the bitmap. The methods each take four arguments; the first two
  give the <var>x</var> and <var>y</var> coordinates of the top left of the rectangle, and the
  second two give the width <var>w</var> and height <var>h</var> of the rectangle, respectively.</p>

  

  <p>The <a href=#transformations id=drawing-rectangles-to-the-bitmap:transformations>current transformation matrix</a> must be
  applied to the following four coordinates, which form the path that must then be closed to get the
  specified rectangle: <span>(<var>x</var>, <var>y</var>)</span>, <span>(<span><var>x</var>+<var>w</var></span>, <var>y</var>)</span>, <span>(<span><var>x</var>+<var>w</var></span>, <span><var>y</var>+<var>h</var></span>)</span>, <span>(<var>x</var>, <span><var>y</var>+<var>h</var></span>)</span>.</p>

  <p>Shapes are painted without affecting the <a href=#current-default-path id=drawing-rectangles-to-the-bitmap:current-default-path>current default path</a>, and are subject to
  the <a href=#clipping-region id=drawing-rectangles-to-the-bitmap:clipping-region>clipping region</a>, and, with the exception of <code id=drawing-rectangles-to-the-bitmap:dom-context-2d-clearrect><a href=#dom-context-2d-clearrect>clearRect()</a></code>, also <a href=#shadows id=drawing-rectangles-to-the-bitmap:shadows>shadow
  effects</a>, <a href=#dom-context-2d-globalalpha id=drawing-rectangles-to-the-bitmap:dom-context-2d-globalalpha>global alpha</a>, and <a href=#dom-context-2d-globalcompositeoperation id=drawing-rectangles-to-the-bitmap:dom-context-2d-globalcompositeoperation>global composition operators</a>.</p>

  

  <dl class=domintro><dt><var>context</var> . <code id=drawing-rectangles-to-the-bitmap:dom-context-2d-clearrect-2><a href=#dom-context-2d-clearrect>clearRect</a></code>(<var>x</var>, <var>y</var>, <var>w</var>, <var>h</var>)<dd>

    <p>Clears all pixels on the bitmap in the given rectangle to transparent black.</p>

   <dt><var>context</var> . <code id=drawing-rectangles-to-the-bitmap:dom-context-2d-fillrect><a href=#dom-context-2d-fillrect>fillRect</a></code>(<var>x</var>, <var>y</var>, <var>w</var>, <var>h</var>)<dd>

    <p>Paints the given rectangle onto the bitmap, using the current fill style.</p>

   <dt><var>context</var> . <code id=drawing-rectangles-to-the-bitmap:dom-context-2d-strokerect><a href=#dom-context-2d-strokerect>strokeRect</a></code>(<var>x</var>, <var>y</var>, <var>w</var>, <var>h</var>)<dd>

    <p>Paints the box that outlines the given rectangle onto the bitmap, using the current stroke
    style.</p>

   </dl>

  

  <p>The <dfn id=dom-context-2d-clearrect><code>clearRect(<var>x</var>, <var>y</var>,
  <var>w</var>, <var>h</var>)</code></dfn> method, when invoked, must run these steps:</p>

  <ol><li><p>If any of the arguments are infinite or NaN, then abort these steps.</li><li><p>Let <var>pixels</var> be the set of pixels in the specified rectangle that also
   intersect the current <a href=#clipping-region id=drawing-rectangles-to-the-bitmap:clipping-region-2>clipping region</a>.</li><li><p>Clear the pixels in <var>pixels</var> to a fully transparent black, erasing any
   previous image.</li></ol>

  <p class=note>If either height or width are zero, this method has no effect, since the set of
  pixels would be empty.</p>

  <p>The <dfn id=dom-context-2d-fillrect><code>fillRect(<var>x</var>, <var>y</var>,
  <var>w</var>, <var>h</var>)</code></dfn> method, when invoked, must must run these steps:</p>

  <ol><li><p>If any of the arguments are infinite or NaN, then abort these steps.</li><li><p>If either <var>w</var> or <var>h</var> are zero, then abort these steps.</li><li><p>Paint the specified rectangular area using the <code id=drawing-rectangles-to-the-bitmap:dom-context-2d-fillstyle><a href=#dom-context-2d-fillstyle>fillStyle</a></code>.</p>
  </li></ol>

  <p>The <dfn id=dom-context-2d-strokerect><code>strokeRect(<var>x</var>, <var>y</var>,
  <var>w</var>, <var>h</var>)</code></dfn> method, when invoked, must run these steps:</p>

  <ol><li><p>If any of the arguments are infinite or NaN, then abort these steps.</li><li><p>Take the result of <a href=#trace-a-path id=drawing-rectangles-to-the-bitmap:trace-a-path>tracing the path</a> described below,
   using the <code id=drawing-rectangles-to-the-bitmap:canvaspathdrawingstyles><a href=#canvaspathdrawingstyles>CanvasPathDrawingStyles</a></code> interface's line styles, and fill it with the
   <code id=drawing-rectangles-to-the-bitmap:dom-context-2d-strokestyle><a href=#dom-context-2d-strokestyle>strokeStyle</a></code>.</li></ol>

  <p>If both <var>w</var> and <var>h</var> are zero, the path has a single subpath
  with just one point (<var>x</var>, <var>y</var>), and no lines, and this method
  thus has no effect (the <a href=#trace-a-path id=drawing-rectangles-to-the-bitmap:trace-a-path-2>trace a path</a> algorithm returns an empty path in that
  case).</p>

  <p>If just one of either <var>w</var> or <var>h</var> is zero, then the path has
  a single subpath consisting of two points, with coordinates (<span><var>x</var></span>, <span><var>y</var></span>) and (<span><var>x</var>+<var>w</var></span>, <span><var>y</var></span>+<var>h</var>), in that order, connected by a single straight line.</p>

  <p>Otherwise, the path has a single subpath consisting of four points, with coordinates (<span><var>x</var></span>, <span><var>y</var></span>), (<span><var>x</var>+<var>w</var></span>, <span><var>y</var></span>), (<span><var>x</var>+<var>w</var></span>,
  <span><var>y</var></span>+<var>h</var>), and (<span><var>x</var></span>, <span><var>y</var>+<var>h</var></span>),
  connected to each other in that order by straight lines.</p>

  



  <h6 id=drawing-text-to-the-bitmap>4.12.5.1.11 Drawing text to the bitmap<a href=#drawing-text-to-the-bitmap class=self-link></a></h6><div class=status><input onclick=toggleStatus(this) value=⋰ type=button><p class=support><strong>Support:</strong> canvas-text<span class="and_chr yes"><span>Chrome for Android</span> <span>57+</span></span><span class="chrome yes"><span>Chrome</span> <span>4+</span></span><span class="and_uc yes"><span>UC Browser for Android</span> <span>11+</span></span><span class="ios_saf yes"><span>iOS Safari</span> <span>3.2+</span></span><span class="firefox yes"><span>Firefox</span> <span>3.5+</span></span><span class="ie yes"><span>IE</span> <span>9+</span></span><span class="samsung yes"><span>Samsung Internet</span> <span>4+</span></span><span class="op_mini no"><span>Opera Mini</span> <span>None</span></span><span class="android yes"><span>Android Browser</span> <span>2.1+</span></span><span class="safari yes"><span>Safari</span> <span>4+</span></span><span class="edge yes"><span>Edge</span> <span>12+</span></span><span class="opera yes"><span>Opera</span> <span>10.5+</span></span><p class=caniuse>Source: <a href="http://caniuse.com/#feat=canvas-text">caniuse.com</a></div>

  <dl id=text-0 class=domintro><dt><var>context</var> . <code id=drawing-text-to-the-bitmap:dom-context-2d-filltext><a href=#dom-context-2d-filltext>fillText</a></code>(<var>text</var>, <var>x</var>, <var>y</var> [, <var>maxWidth</var> ] )<dt><var>context</var> . <code id=drawing-text-to-the-bitmap:dom-context-2d-stroketext><a href=#dom-context-2d-stroketext>strokeText</a></code>(<var>text</var>, <var>x</var>, <var>y</var> [, <var>maxWidth</var> ] )<dd>

    <p>Fills or strokes (respectively) the given text at the given position. If a maximum width is
    provided, the text will be scaled to fit that width if necessary.</p>

   <dt><var>metrics</var> = <var>context</var> . <code id=drawing-text-to-the-bitmap:dom-context-2d-measuretext><a href=#dom-context-2d-measuretext>measureText</a></code>(<var>text</var>)<dd>

    <p>Returns a <code id=drawing-text-to-the-bitmap:textmetrics><a href=#textmetrics>TextMetrics</a></code> object with the metrics of the given text in the current
    font.</p>

   <dt><var>metrics</var> . <code id=drawing-text-to-the-bitmap:dom-textmetrics-width><a href=#dom-textmetrics-width>width</a></code><dt><var>metrics</var> . <code id=drawing-text-to-the-bitmap:dom-textmetrics-actualboundingboxleft><a href=#dom-textmetrics-actualboundingboxleft>actualBoundingBoxLeft</a></code><dt><var>metrics</var> . <code id=drawing-text-to-the-bitmap:dom-textmetrics-actualboundingboxright><a href=#dom-textmetrics-actualboundingboxright>actualBoundingBoxRight</a></code><dt><var>metrics</var> . <code id=drawing-text-to-the-bitmap:dom-textmetrics-fontboundingboxascent><a href=#dom-textmetrics-fontboundingboxascent>fontBoundingBoxAscent</a></code><dt><var>metrics</var> . <code id=drawing-text-to-the-bitmap:dom-textmetrics-fontboundingboxdescent><a href=#dom-textmetrics-fontboundingboxdescent>fontBoundingBoxDescent</a></code><dt><var>metrics</var> . <code id=drawing-text-to-the-bitmap:dom-textmetrics-actualboundingboxascent><a href=#dom-textmetrics-actualboundingboxascent>actualBoundingBoxAscent</a></code><dt><var>metrics</var> . <code id=drawing-text-to-the-bitmap:dom-textmetrics-actualboundingboxdescent><a href=#dom-textmetrics-actualboundingboxdescent>actualBoundingBoxDescent</a></code><dt><var>metrics</var> . <code id=drawing-text-to-the-bitmap:dom-textmetrics-emheightascent><a href=#dom-textmetrics-emheightascent>emHeightAscent</a></code><dt><var>metrics</var> . <code id=drawing-text-to-the-bitmap:dom-textmetrics-emheightdescent><a href=#dom-textmetrics-emheightdescent>emHeightDescent</a></code><dt><var>metrics</var> . <code id=drawing-text-to-the-bitmap:dom-textmetrics-hangingbaseline><a href=#dom-textmetrics-hangingbaseline>hangingBaseline</a></code><dt><var>metrics</var> . <code id=drawing-text-to-the-bitmap:dom-textmetrics-alphabeticbaseline><a href=#dom-textmetrics-alphabeticbaseline>alphabeticBaseline</a></code><dt><var>metrics</var> . <code id=drawing-text-to-the-bitmap:dom-textmetrics-ideographicbaseline><a href=#dom-textmetrics-ideographicbaseline>ideographicBaseline</a></code><dd>

    <p>Returns the measurement described below.</p>

   </dl>

  

  <p>Objects that implement the <code id=drawing-text-to-the-bitmap:canvastext><a href=#canvastext>CanvasText</a></code> interface provide the following methods for
  rendering text.</p>

  <p>The <dfn id=dom-context-2d-filltext><code>fillText()</code></dfn> and <dfn id=dom-context-2d-stroketext><code>strokeText()</code></dfn> methods take three or four arguments,
  <var>text</var>, <var>x</var>, <var>y</var>, and optionally <var>maxWidth</var>, and render the
  given <var>text</var> at the given (<var>x</var>, <var>y</var>) coordinates ensuring that the text
  isn't wider than <var>maxWidth</var> if specified, using the current <code id=drawing-text-to-the-bitmap:dom-context-2d-font><a href=#dom-context-2d-font>font</a></code>, <code id=drawing-text-to-the-bitmap:dom-context-2d-textalign><a href=#dom-context-2d-textalign>textAlign</a></code>, and <code id=drawing-text-to-the-bitmap:dom-context-2d-textbaseline><a href=#dom-context-2d-textbaseline>textBaseline</a></code> values. Specifically, when the methods
  are invoked, the user agent must run these steps:</p>

  <ol><li><p>If any of the arguments are infinite or NaN, then abort these steps.</li><li><p>Run the <a href=#text-preparation-algorithm id=drawing-text-to-the-bitmap:text-preparation-algorithm>text preparation algorithm</a>, passing it <var>text</var>, the object
   implementing the <code id=drawing-text-to-the-bitmap:canvastext-2><a href=#canvastext>CanvasText</a></code> interface, and, if the <var>maxWidth</var> argument was
   provided, that argument. Let <var>glyphs</var> be the result.</p>

   </li><li><p>Move all the shapes in <var>glyphs</var> to the right by <var>x</var>
   <a href=https://momdo.github.io/css3-values/#px id="drawing-text-to-the-bitmap:'px'" data-x-internal="'px'">CSS pixels</a> and down by <var>y</var> <a href=https://momdo.github.io/css3-values/#px id="drawing-text-to-the-bitmap:'px'-2" data-x-internal="'px'">CSS
   pixels</a>.</li><li>

    <p>Paint the shapes given in <var>glyphs</var>, as transformed by the <a href=#transformations id=drawing-text-to-the-bitmap:transformations>current transformation matrix</a>, with each <a href=https://momdo.github.io/css3-values/#px id="drawing-text-to-the-bitmap:'px'-3" data-x-internal="'px'">CSS pixel</a> in the coordinate space of <var>glyphs</var> mapped to one
    coordinate space unit.</p>

    <p>For <code id=drawing-text-to-the-bitmap:dom-context-2d-filltext-2><a href=#dom-context-2d-filltext>fillText()</a></code>, <code id=drawing-text-to-the-bitmap:dom-context-2d-fillstyle><a href=#dom-context-2d-fillstyle>fillStyle</a></code> must be applied to the shapes and <code id=drawing-text-to-the-bitmap:dom-context-2d-strokestyle><a href=#dom-context-2d-strokestyle>strokeStyle</a></code> must be ignored. For <code id=drawing-text-to-the-bitmap:dom-context-2d-stroketext-2><a href=#dom-context-2d-stroketext>strokeText()</a></code>, the reverse holds: <code id=drawing-text-to-the-bitmap:dom-context-2d-strokestyle-2><a href=#dom-context-2d-strokestyle>strokeStyle</a></code> must be applied to the result of <a href=#trace-a-path id=drawing-text-to-the-bitmap:trace-a-path>tracing</a> the shapes using the object implementing the
    <code id=drawing-text-to-the-bitmap:canvastext-3><a href=#canvastext>CanvasText</a></code> interface for the line styles, and <code id=drawing-text-to-the-bitmap:dom-context-2d-fillstyle-2><a href=#dom-context-2d-fillstyle>fillStyle</a></code> must be ignored.</p>

    <p>These shapes are painted without affecting the current path, and are subject to <a href=#shadows id=drawing-text-to-the-bitmap:shadows>shadow effects</a>, <a href=#dom-context-2d-globalalpha id=drawing-text-to-the-bitmap:dom-context-2d-globalalpha>global
    alpha</a>, the <a href=#clipping-region id=drawing-text-to-the-bitmap:clipping-region>clipping region</a>, and <a href=#dom-context-2d-globalcompositeoperation id=drawing-text-to-the-bitmap:dom-context-2d-globalcompositeoperation>global composition operators</a>.</p>

   </li></ol>



  <p>The <dfn id=dom-context-2d-measuretext><code>measureText()</code></dfn> method takes one
  argument, <var>text</var>. When the method is invoked, the user agent must run the
  <a href=#text-preparation-algorithm id=drawing-text-to-the-bitmap:text-preparation-algorithm-2>text preparation algorithm</a>, passing it <var>text</var> and the object implementing
  the <code id=drawing-text-to-the-bitmap:canvastext-4><a href=#canvastext>CanvasText</a></code> interface, and then using the returned <a id=drawing-text-to-the-bitmap:inline-box href=https://momdo.github.io/css2/visuren.html#inline-box data-x-internal=inline-box>inline box</a> must
  create a new <code id=drawing-text-to-the-bitmap:textmetrics-2><a href=#textmetrics>TextMetrics</a></code> object with its attributes set as described in the following
  list.

  If doing these measurements requires using a font that has an <a id=drawing-text-to-the-bitmap:concept-origin href=browsers.html#concept-origin>origin</a> that is not the
  <a href=browsers.html#same-origin id=drawing-text-to-the-bitmap:same-origin>same</a> as that of the <code id=drawing-text-to-the-bitmap:document><a href=dom.html#document>Document</a></code> object that owns the
  <code id=drawing-text-to-the-bitmap:the-canvas-element><a href=#the-canvas-element>canvas</a></code> element (even if "using a font" means just checking if that font has a
  particular glyph in it before falling back to another font), then the method, when invoked, must
  throw a <a id=drawing-text-to-the-bitmap:securityerror href=https://triple-underscore.github.io/WebIDL-ja.html#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a> <code id=drawing-text-to-the-bitmap:domexception><a data-x-internal=domexception href=https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException>DOMException</a></code>.

  Otherwise, it must return the new <code id=drawing-text-to-the-bitmap:textmetrics-3><a href=#textmetrics>TextMetrics</a></code> object.
  <a href=references.html#refsCSS>[CSS]</a>
  <a id=drawing-text-to-the-bitmap:fingerprinting-vector title="There is a potential fingerprinting vector here." href=introduction.html#fingerprinting-vector class=fingerprint><img alt="(This is a fingerprinting vector.)" src=https://html.spec.whatwg.org/images/fingerprint.png width=46 height=64></a>
  </p>

  

  <dl><dt><dfn id=dom-textmetrics-width><code>width</code></dfn> attribute<dd><p>The width of that <a id=drawing-text-to-the-bitmap:inline-box-2 href=https://momdo.github.io/css2/visuren.html#inline-box data-x-internal=inline-box>inline box</a>, in <a href=https://momdo.github.io/css3-values/#px id="drawing-text-to-the-bitmap:'px'-4" data-x-internal="'px'">CSS pixels</a>. (The
   text's advance width.)<dt><dfn id=dom-textmetrics-actualboundingboxleft><code>actualBoundingBoxLeft</code></dfn> attribute<dd>

    <p>The distance parallel to the baseline from the alignment point given by the <code id=drawing-text-to-the-bitmap:dom-context-2d-textalign-2><a href=#dom-context-2d-textalign>textAlign</a></code> attribute to the left side of the bounding
    rectangle of the given text, in <a href=https://momdo.github.io/css3-values/#px id="drawing-text-to-the-bitmap:'px'-5" data-x-internal="'px'">CSS pixels</a>; positive numbers
    indicating a distance going left from the given alignment point.

    

    <p class=note>The sum of this value and the next (<code id=drawing-text-to-the-bitmap:dom-textmetrics-actualboundingboxright-2><a href=#dom-textmetrics-actualboundingboxright>actualBoundingBoxRight</a></code>) can be wider than
    the width of the <a id=drawing-text-to-the-bitmap:inline-box-3 href=https://momdo.github.io/css2/visuren.html#inline-box data-x-internal=inline-box>inline box</a> (<code id=drawing-text-to-the-bitmap:dom-textmetrics-width-2><a href=#dom-textmetrics-width>width</a></code>), in
    particular with slanted fonts where characters overhang their advance width.</p>

   <dt><dfn id=dom-textmetrics-actualboundingboxright><code>actualBoundingBoxRight</code></dfn> attribute<dd>

    <p>The distance parallel to the baseline from the alignment point given by the <code id=drawing-text-to-the-bitmap:dom-context-2d-textalign-3><a href=#dom-context-2d-textalign>textAlign</a></code> attribute to the right side of the bounding
    rectangle of the given text, in <a href=https://momdo.github.io/css3-values/#px id="drawing-text-to-the-bitmap:'px'-6" data-x-internal="'px'">CSS pixels</a>; positive numbers
    indicating a distance going right from the given alignment point.</p>

   <dt><dfn id=dom-textmetrics-fontboundingboxascent><code>fontBoundingBoxAscent</code></dfn> attribute<dd>

    <p>The distance from the horizontal line indicated by the <code id=drawing-text-to-the-bitmap:dom-context-2d-textbaseline-2><a href=#dom-context-2d-textbaseline>textBaseline</a></code> attribute to the top of the highest
    bounding rectangle of all the fonts used to render the text, in <a href=https://momdo.github.io/css3-values/#px id="drawing-text-to-the-bitmap:'px'-7" data-x-internal="'px'">CSS
    pixels</a>; positive numbers indicating a distance going up from the given baseline.</p>

    <p class=note>This value and the next are useful when rendering a background that have to have
    a consistent height even if the exact text being rendered changes. The <code id=drawing-text-to-the-bitmap:dom-textmetrics-actualboundingboxascent-2><a href=#dom-textmetrics-actualboundingboxascent>actualBoundingBoxAscent</a></code> attribute (and
    its corresponding attribute for the descent) are useful when drawing a bounding box around
    specific text.</p>

   <dt><dfn id=dom-textmetrics-fontboundingboxdescent><code>fontBoundingBoxDescent</code></dfn> attribute<dd><p>The distance from the horizontal line indicated by the <code id=drawing-text-to-the-bitmap:dom-context-2d-textbaseline-3><a href=#dom-context-2d-textbaseline>textBaseline</a></code> attribute to the bottom of the lowest
   bounding rectangle of all the fonts used to render the text, in <a href=https://momdo.github.io/css3-values/#px id="drawing-text-to-the-bitmap:'px'-8" data-x-internal="'px'">CSS
   pixels</a>; positive numbers indicating a distance going down from the given
   baseline.<dt><dfn id=dom-textmetrics-actualboundingboxascent><code>actualBoundingBoxAscent</code></dfn> attribute<dd>

    <p>The distance from the horizontal line indicated by the <code id=drawing-text-to-the-bitmap:dom-context-2d-textbaseline-4><a href=#dom-context-2d-textbaseline>textBaseline</a></code> attribute to the top of the bounding
    rectangle of the given text, in <a href=https://momdo.github.io/css3-values/#px id="drawing-text-to-the-bitmap:'px'-9" data-x-internal="'px'">CSS pixels</a>; positive numbers
    indicating a distance going up from the given baseline.

    

    <p class=note>This number can vary greatly based on the input text, even if the first font
    specified covers all the characters in the input. For example, the <code id=drawing-text-to-the-bitmap:dom-textmetrics-actualboundingboxascent-3><a href=#dom-textmetrics-actualboundingboxascent>actualBoundingBoxAscent</a></code> of a lowercase
    "o" from an alphabetic baseline would be less than that of an uppercase "F". The value can
    easily be negative; for example, the distance from the top of the em box (<code id=drawing-text-to-the-bitmap:dom-context-2d-textbaseline-5><a href=#dom-context-2d-textbaseline>textBaseline</a></code> value "<code id=drawing-text-to-the-bitmap:dom-context-2d-textbaseline-top><a href=#dom-context-2d-textbaseline-top>top</a></code>") to the top of the bounding rectangle when
    the given text is just a single comma "<code>,</code>" would likely (unless the font is
    quite unusual) be negative.</p>

   <dt><dfn id=dom-textmetrics-actualboundingboxdescent><code>actualBoundingBoxDescent</code></dfn> attribute<dd><p>The distance from the horizontal line indicated by the <code id=drawing-text-to-the-bitmap:dom-context-2d-textbaseline-6><a href=#dom-context-2d-textbaseline>textBaseline</a></code> attribute to the bottom of the bounding
   rectangle of the given text, in <a href=https://momdo.github.io/css3-values/#px id="drawing-text-to-the-bitmap:'px'-10" data-x-internal="'px'">CSS pixels</a>; positive numbers
   indicating a distance going down from the given baseline.<dt><dfn id=dom-textmetrics-emheightascent><code>emHeightAscent</code></dfn> attribute<dd><p>The distance from the horizontal line indicated by the <code id=drawing-text-to-the-bitmap:dom-context-2d-textbaseline-7><a href=#dom-context-2d-textbaseline>textBaseline</a></code> attribute to the highest top of the em
   squares in the <a id=drawing-text-to-the-bitmap:line-box href=https://momdo.github.io/css2/visuren.html#line-box data-x-internal=line-box>line box</a>, in <a href=https://momdo.github.io/css3-values/#px id="drawing-text-to-the-bitmap:'px'-11" data-x-internal="'px'">CSS pixels</a>; positive numbers
   indicating that the given baseline is below the top of that em square (so this value will usually
   be positive). Zero if the given baseline is the top of that em square; half the font size if the
   given baseline is the middle of that em square.<dt><dfn id=dom-textmetrics-emheightdescent><code>emHeightDescent</code></dfn> attribute<dd><p>The distance from the horizontal line indicated by the <code id=drawing-text-to-the-bitmap:dom-context-2d-textbaseline-8><a href=#dom-context-2d-textbaseline>textBaseline</a></code> attribute to the lowest bottom of the em
   squares in the <a id=drawing-text-to-the-bitmap:line-box-2 href=https://momdo.github.io/css2/visuren.html#line-box data-x-internal=line-box>line box</a>, in <a href=https://momdo.github.io/css3-values/#px id="drawing-text-to-the-bitmap:'px'-12" data-x-internal="'px'">CSS pixels</a>; positive numbers
   indicating that the given baseline is below the bottom of that em square (so this value will
   usually be negative). (Zero if the given baseline is the bottom of that em square.)<dt><dfn id=dom-textmetrics-hangingbaseline><code>hangingBaseline</code></dfn> attribute<dd><p>The distance from the horizontal line indicated by the <code id=drawing-text-to-the-bitmap:dom-context-2d-textbaseline-9><a href=#dom-context-2d-textbaseline>textBaseline</a></code> attribute to the hanging baseline of the
   <a id=drawing-text-to-the-bitmap:line-box-3 href=https://momdo.github.io/css2/visuren.html#line-box data-x-internal=line-box>line box</a>, in <a href=https://momdo.github.io/css3-values/#px id="drawing-text-to-the-bitmap:'px'-13" data-x-internal="'px'">CSS pixels</a>; positive numbers indicating that
   the given baseline is below the hanging baseline. (Zero if the given baseline is the hanging
   baseline.)<dt><dfn id=dom-textmetrics-alphabeticbaseline><code>alphabeticBaseline</code></dfn> attribute<dd><p>The distance from the horizontal line indicated by the <code id=drawing-text-to-the-bitmap:dom-context-2d-textbaseline-10><a href=#dom-context-2d-textbaseline>textBaseline</a></code> attribute to the alphabetic baseline of
   the <a id=drawing-text-to-the-bitmap:line-box-4 href=https://momdo.github.io/css2/visuren.html#line-box data-x-internal=line-box>line box</a>, in <a href=https://momdo.github.io/css3-values/#px id="drawing-text-to-the-bitmap:'px'-14" data-x-internal="'px'">CSS pixels</a>; positive numbers indicating
   that the given baseline is below the alphabetic baseline. (Zero if the given baseline is the
   alphabetic baseline.)<dt><dfn id=dom-textmetrics-ideographicbaseline><code>ideographicBaseline</code></dfn> attribute<dd><p>The distance from the horizontal line indicated by the <code id=drawing-text-to-the-bitmap:dom-context-2d-textbaseline-11><a href=#dom-context-2d-textbaseline>textBaseline</a></code> attribute to the ideographic baseline of
   the <a id=drawing-text-to-the-bitmap:line-box-5 href=https://momdo.github.io/css2/visuren.html#line-box data-x-internal=line-box>line box</a>, in <a href=https://momdo.github.io/css3-values/#px id="drawing-text-to-the-bitmap:'px'-15" data-x-internal="'px'">CSS pixels</a>; positive numbers indicating
   that the given baseline is below the ideographic baseline. (Zero if the given baseline is the
   ideographic baseline.)</dl>

  <p class=note>Glyphs rendered using <code id=drawing-text-to-the-bitmap:dom-context-2d-filltext-3><a href=#dom-context-2d-filltext>fillText()</a></code> and
  <code id=drawing-text-to-the-bitmap:dom-context-2d-stroketext-3><a href=#dom-context-2d-stroketext>strokeText()</a></code> can spill out of the box given by the
  font size (the em square size) and the width returned by <code id=drawing-text-to-the-bitmap:dom-context-2d-measuretext-2><a href=#dom-context-2d-measuretext>measureText()</a></code> (the text width). Authors are encouraged
  to use the bounding box values described above if this is an issue.</p>

  <p class=note>A future version of the 2D context API might provide a way to render fragments of
  documents, rendered using CSS, straight to the canvas. This would be provided in preference to a
  dedicated way of doing multiline layout.</p>



  <h6 id=drawing-paths-to-the-canvas>4.12.5.1.12 Drawing paths to the canvas<a href=#drawing-paths-to-the-canvas class=self-link></a></h6>

  <p>Objects that implement the <code id=drawing-paths-to-the-canvas:canvasdrawpath><a href=#canvasdrawpath>CanvasDrawPath</a></code> interface have a <dfn id=current-default-path>current default
  path</dfn>. There is only one <a href=#current-default-path id=drawing-paths-to-the-canvas:current-default-path>current default path</a>, it is not part of the
  <a href=#drawing-state id=drawing-paths-to-the-canvas:drawing-state>drawing state</a>. The <a href=#current-default-path id=drawing-paths-to-the-canvas:current-default-path-2>current default path</a> is a <a href=#concept-path id=drawing-paths-to-the-canvas:concept-path>path</a>, as described above.</p>

  <dl class=domintro><dt><var>context</var> . <code id=drawing-paths-to-the-canvas:dom-context-2d-beginpath><a href=#dom-context-2d-beginpath>beginPath</a></code>()<dd>

    <p>Resets the <a href=#current-default-path id=drawing-paths-to-the-canvas:current-default-path-3>current default path</a>.</p>

   <dt><var>context</var> . <code id=drawing-paths-to-the-canvas:dom-context-2d-fill><a href=#dom-context-2d-fill>fill</a></code>( [ <var>fillRule</var> ] )<dt><var>context</var> . <code id=drawing-paths-to-the-canvas:dom-context-2d-fill-2><a href=#dom-context-2d-fill>fill</a></code>(<var>path</var> [, <var>fillRule</var> ] )<dd>

    <p>Fills the subpaths of the <a href=#current-default-path id=drawing-paths-to-the-canvas:current-default-path-4>current default path</a> or the given path with the
    current fill style, obeying the given fill rule.</p>

   <dt><var>context</var> . <code id=drawing-paths-to-the-canvas:dom-context-2d-stroke><a href=#dom-context-2d-stroke>stroke</a></code>()<dt><var>context</var> . <code id=drawing-paths-to-the-canvas:dom-context-2d-stroke-2><a href=#dom-context-2d-stroke>stroke</a></code>(<var>path</var>)<dd>

    <p>Strokes the subpaths of the <a href=#current-default-path id=drawing-paths-to-the-canvas:current-default-path-5>current default path</a> or the given path with the
    current stroke style.</p>

   <dt><var>context</var> . <code id=drawing-paths-to-the-canvas:dom-context-2d-clip><a href=#dom-context-2d-clip>clip</a></code>( [ <var>fillRule</var> ] )<dt><var>context</var> . <code id=drawing-paths-to-the-canvas:dom-context-2d-clip-2><a href=#dom-context-2d-clip>clip</a></code>(<var>path</var> [, <var>fillRule</var> ] )<dd>

    <p>Further constrains the clipping region to the <a href=#current-default-path id=drawing-paths-to-the-canvas:current-default-path-6>current default path</a> or the given
    path, using the given fill rule to determine what points are in the path.</p>

   <dt><var>context</var> . <code id=drawing-paths-to-the-canvas:dom-context-2d-resetclip><a href=#dom-context-2d-resetclip>resetClip</a></code>()<dd>

    <p>Unconstrains the clipping region.</p>

   <dt><var>context</var> . <code id=drawing-paths-to-the-canvas:dom-context-2d-ispointinpath><a href=#dom-context-2d-ispointinpath>isPointInPath</a></code>(<var>x</var>, <var>y</var> [, <var>fillRule</var> ] )<dt><var>context</var> . <code id=drawing-paths-to-the-canvas:dom-context-2d-ispointinpath-2><a href=#dom-context-2d-ispointinpath>isPointInPath</a></code>(<var>path</var>, <var>x</var>, <var>y</var> [, <var>fillRule</var> ] )<dd>

    <p>Returns true if the given point is in the <a href=#current-default-path id=drawing-paths-to-the-canvas:current-default-path-7>current default path</a> or the given
    path, using the given fill rule to determine what points are in the path.</p>

   <dt><var>context</var> . <code id=drawing-paths-to-the-canvas:dom-context-2d-ispointinstroke><a href=#dom-context-2d-ispointinstroke>isPointInStroke</a></code>(<var>x</var>, <var>y</var>)<dt><var>context</var> . <code id=drawing-paths-to-the-canvas:dom-context-2d-ispointinstroke-2><a href=#dom-context-2d-ispointinstroke>isPointInStroke</a></code>(<var>path</var>, <var>x</var>, <var>y</var>)<dd>

    <p>Returns true if the given point would be in the region covered by the stroke of the
    <a href=#current-default-path id=drawing-paths-to-the-canvas:current-default-path-8>current default path</a> or the given path, given the current stroke style.</p>

   </dl><div class=status><input onclick=toggleStatus(this) value=⋰ type=button><p class=bugs><strong>Spec bugs:</strong> <a href="https://www.w3.org/Bugs/Public/show_bug.cgi?id=28217" title="&lt;canvas&gt;: not clear if two polygon paths with a common edge should have no line visible">28217</a></div>

  

  <p>The <dfn id=dom-context-2d-beginpath><code>beginPath()</code></dfn> method, when invoked,
  must empty the list of subpaths in the context's <a href=#current-default-path id=drawing-paths-to-the-canvas:current-default-path-9>current default path</a> so that the it
  once again has zero subpaths.</p>

  <p>Where the following method definitions use the term <i>intended path</i>, it means the
  <code id=drawing-paths-to-the-canvas:path2d><a href=#path2d>Path2D</a></code> argument, if one was provided, or the <a href=#current-default-path id=drawing-paths-to-the-canvas:current-default-path-10>current default path</a>
  otherwise.</p>

  <p>When the intended path is a <code id=drawing-paths-to-the-canvas:path2d-2><a href=#path2d>Path2D</a></code> object, the coordinates and lines of its
  subpaths must be transformed according to the <a href=#transformations id=drawing-paths-to-the-canvas:transformations>
  current transformation matrix</a> on the object implementing the
  <code id=drawing-paths-to-the-canvas:canvastransform><a href=#canvastransform>CanvasTransform</a></code> interface when used by these methods (without affecting the
  <code id=drawing-paths-to-the-canvas:path2d-3><a href=#path2d>Path2D</a></code> object itself). When the intended path is the <a href=#current-default-path id=drawing-paths-to-the-canvas:current-default-path-11>current default
  path</a>, it is not affected by the transform. (This is because transformations already affect
  the <a href=#current-default-path id=drawing-paths-to-the-canvas:current-default-path-12>current default path</a> when it is constructed, so applying it when it is painted as
  well would result in a double transformation.)</p>

  <p>The <dfn id=dom-context-2d-fill><code>fill()</code></dfn> method, when invoked, must fill
  all the subpaths of the intended path, using <code id=drawing-paths-to-the-canvas:dom-context-2d-fillstyle><a href=#dom-context-2d-fillstyle>fillStyle</a></code>, and using the <a href=#fill-rule id=drawing-paths-to-the-canvas:fill-rule>fill rule</a> indicated
  by the <var>fillRule</var> argument. Open subpaths must be implicitly closed when being filled
  (without affecting the actual subpaths).</p>

  <p>The <dfn id=dom-context-2d-stroke><code>stroke()</code></dfn> method, when invoked, must
  <a href=#trace-a-path id=drawing-paths-to-the-canvas:trace-a-path>trace</a> the intended path, using this
  <code id=drawing-paths-to-the-canvas:canvaspathdrawingstyles><a href=#canvaspathdrawingstyles>CanvasPathDrawingStyles</a></code> object for the line styles, and then fill the resulting path
  using the <code id=drawing-paths-to-the-canvas:dom-context-2d-strokestyle><a href=#dom-context-2d-strokestyle>strokeStyle</a></code> attribute, using the <a href=#dom-context-2d-fillrule-nonzero id=drawing-paths-to-the-canvas:dom-context-2d-fillrule-nonzero>non-zero winding rule</a>.</p>

  <p class=note>As a result of how the algorithm to <a href=#trace-a-path id=drawing-paths-to-the-canvas:trace-a-path-2>trace a path</a> is defined,
  overlapping parts of the paths in one stroke operation are treated as if their union was what was
  painted.</p>

  <p class=note>The stroke <em>style</em> is affected by the transformation during painting, even
  if the intended path is the <a href=#current-default-path id=drawing-paths-to-the-canvas:current-default-path-13>current default path</a>.</p>

  <p>Paths, when filled or stroked, must be painted without affecting the <a href=#current-default-path id=drawing-paths-to-the-canvas:current-default-path-14>current default
  path</a> or any <code id=drawing-paths-to-the-canvas:path2d-4><a href=#path2d>Path2D</a></code> objects, and must be subject to <a href=#shadows id=drawing-paths-to-the-canvas:shadows>shadow effects</a>, <a href=#dom-context-2d-globalalpha id=drawing-paths-to-the-canvas:dom-context-2d-globalalpha>global
  alpha</a>, the <a href=#clipping-region id=drawing-paths-to-the-canvas:clipping-region>clipping region</a>, and <a href=#dom-context-2d-globalcompositeoperation id=drawing-paths-to-the-canvas:dom-context-2d-globalcompositeoperation>global composition operators</a>. (The effect
  of transformations is described above and varies based on which path is being used.)</p>

  <hr>

  <p>The <dfn id=dom-context-2d-clip><code>clip()</code></dfn> method, when invoked, must
  create a new <dfn id=clipping-region>clipping region</dfn> by calculating the intersection of the current clipping
  region and the area described by the intended path, using the <a href=#fill-rule id=drawing-paths-to-the-canvas:fill-rule-2>fill rule</a> indicated by
  the <var>fillRule</var> argument. Open subpaths must be implicitly closed when computing the
  clipping region, without affecting the actual subpaths. The new clipping region replaces the
  current clipping region.</p>

  <p>When the context is initialized, the clipping region must be set to the largest infinite
  surface (i.e. by default, no clipping occurs).</p>

  

  <p>The <dfn id=dom-context-2d-resetclip><code>resetClip()</code></dfn> method, when invoked,
  must create a new <a href=#clipping-region id=drawing-paths-to-the-canvas:clipping-region-2>clipping region</a> that is the largest infinite surface. The new
  clipping region replaces the current clipping region.</p>

  <hr>

  <p>The <dfn id=dom-context-2d-ispointinpath><code>isPointInPath()</code></dfn> method, when
  invoked, must return true if the point given by the <var>x</var> and <var>y</var> coordinates
  passed to the method, when treated as coordinates in the canvas coordinate space unaffected by the
  current transformation, is inside the intended path as determined by the <a href=#fill-rule id=drawing-paths-to-the-canvas:fill-rule-3>fill rule</a>
  indicated by the <var>fillRule</var> argument; and must return false otherwise. Open subpaths must
  be implicitly closed when computing the area inside the path, without affecting the actual
  subpaths. Points on the path itself must be considered to be inside the path. If either of the
  arguments are infinite or NaN, then the method must return false.</p>

  <hr>

  <p>The <dfn id=dom-context-2d-ispointinstroke><code>isPointInStroke()</code></dfn> method,
  when invoked, must return true if the point given by the <var>x</var> and <var>y</var> coordinates
  passed to the method, when treated as coordinates in the canvas coordinate space unaffected by the
  current transformation, is inside the path that results from <a href=#trace-a-path id=drawing-paths-to-the-canvas:trace-a-path-3>tracing</a> the intended path, using the <a href=#dom-context-2d-fillrule-nonzero id=drawing-paths-to-the-canvas:dom-context-2d-fillrule-nonzero-2>non-zero winding rule</a>, and using the
  <code id=drawing-paths-to-the-canvas:canvaspathdrawingstyles-2><a href=#canvaspathdrawingstyles>CanvasPathDrawingStyles</a></code> interface for the line styles; and must return false
  otherwise. Points on the resulting path must be considered to be inside the path. If either of the
  arguments are infinite or NaN, then the method must return false.</p>

  <hr>

  

  <div id=drawCustomFocusRingExample class=example>

   <p>This <code id=drawing-paths-to-the-canvas:the-canvas-element><a href=#the-canvas-element>canvas</a></code> element has a couple of checkboxes. The path-related commands are
   highlighted:</p>

   <pre>&lt;canvas height=400 width=750&gt;
 &lt;label&gt;&lt;input type=checkbox id=showA&gt; Show As&lt;/label&gt;
 &lt;label&gt;&lt;input type=checkbox id=showB&gt; Show Bs&lt;/label&gt;
 &lt;!-- ... --&gt;
&lt;/canvas&gt;
&lt;script&gt;
 function drawCheckbox(context, element, x, y, paint) {
   context.save();
   context.font = '10px sans-serif';
   context.textAlign = 'left';
   context.textBaseline = 'middle';
   var metrics = context.measureText(element.labels[0].textContent);
   if (paint) {
<strong>     context.beginPath();
     context.strokeStyle = 'black';
     context.rect(x-5, y-5, 10, 10);
     context.stroke();
</strong>     if (element.checked) {
<strong>       context.fillStyle = 'black';
       context.fill();
</strong>     }
     context.fillText(element.labels[0].textContent, x+5, y);
   }
<strong>   context.beginPath();
   context.rect(x-7, y-7, 12 + metrics.width+2, 14);
</strong>
   context.drawFocusIfNeeded(element);
   context.restore();
 }
 function drawBase() { /* ... */ }
 function drawAs() { /* ... */ }
 function drawBs() { /* ... */ }
 function redraw() {
   var canvas = document.getElementsByTagName('canvas')[0];
   var context = canvas.getContext('2d');
   context.clearRect(0, 0, canvas.width, canvas.height);
   drawCheckbox(context, document.getElementById('showA'), 20, 40, true);
   drawCheckbox(context, document.getElementById('showB'), 20, 60, true);
   drawBase();
   if (document.getElementById('showA').checked)
     drawAs();
   if (document.getElementById('showB').checked)
     drawBs();
 }
 function processClick(event) {
   var canvas = document.getElementsByTagName('canvas')[0];
   var context = canvas.getContext('2d');
   var x = event.clientX;
   var y = event.clientY;
   var node = event.target;
   while (node) {
     x -= node.offsetLeft - node.scrollLeft;
     y -= node.offsetTop - node.scrollTop;
     node = node.offsetParent;
   }
   drawCheckbox(context, document.getElementById('showA'), 20, 40, false);
   if (<strong>context.isPointInPath(x, y)</strong>)
     document.getElementById('showA').checked = !(document.getElementById('showA').checked);
   drawCheckbox(context, document.getElementById('showB'), 20, 60, false);
   if (<strong>context.isPointInPath(x, y)</strong>)
     document.getElementById('showB').checked = !(document.getElementById('showB').checked);
   redraw();
 }
 document.getElementsByTagName('canvas')[0].addEventListener('focus', redraw, true);
 document.getElementsByTagName('canvas')[0].addEventListener('blur', redraw, true);
 document.getElementsByTagName('canvas')[0].addEventListener('change', redraw, true);
 document.getElementsByTagName('canvas')[0].addEventListener('click', processClick, false);
 redraw();
&lt;/script&gt;</pre>


  </div>

  <h6 id=drawing-focus-rings-and-scrolling-paths-into-view>4.12.5.1.13 Drawing focus rings and scrolling paths into view<a href=#drawing-focus-rings-and-scrolling-paths-into-view class=self-link></a></h6>

  <dl class=domintro><dt><var>context</var> . <code id=drawing-focus-rings-and-scrolling-paths-into-view:dom-context-2d-drawfocusifneeded><a href=#dom-context-2d-drawfocusifneeded>drawFocusIfNeeded</a></code>(<var>element</var>)<dt><var>context</var> . <code id=drawing-focus-rings-and-scrolling-paths-into-view:dom-context-2d-drawfocusifneeded-2><a href=#dom-context-2d-drawfocusifneeded>drawFocusIfNeeded</a></code>(<var>path</var>, <var>element</var>)<dd>

    <p>If the given element is <a id=drawing-focus-rings-and-scrolling-paths-into-view:focused href=interaction.html#focused>focused</a>, draws a focus ring around the <a href=#current-default-path id=drawing-focus-rings-and-scrolling-paths-into-view:current-default-path>current
    default path</a> or the given path, following the platform conventions for focus rings.</p>

   <dt><var>context</var> . <code id=drawing-focus-rings-and-scrolling-paths-into-view:dom-context-2d-scrollpathintoview><a href=#dom-context-2d-scrollpathintoview>scrollPathIntoView</a></code>()<dt><var>context</var> . <code id=drawing-focus-rings-and-scrolling-paths-into-view:dom-context-2d-scrollpathintoview-2><a href=#dom-context-2d-scrollpathintoview>scrollPathIntoView</a></code>(<var>path</var>)<dd>

    <p>Scrolls the <a href=#current-default-path id=drawing-focus-rings-and-scrolling-paths-into-view:current-default-path-2>current default path</a> or the given path into view. This is especially
    useful on devices with small screens, where the whole canvas might not be visible at once.</p>

   </dl>

  

  

  

  Objects that implement the <code id=drawing-focus-rings-and-scrolling-paths-into-view:canvasuserinterface><a href=#canvasuserinterface>CanvasUserInterface</a></code> interface provide the following
  methods to control drawing focus rings and scrolling paths into view.

  

  <hr>

  <p id=dom-context-2d-drawosfocusring>The <dfn id=dom-context-2d-drawfocusifneeded><code>drawFocusIfNeeded(<var>element</var>)</code></dfn>
  method, when invoked, must run these steps:</p>

  <ol><li><p>If <var>element</var> is not <a id=drawing-focus-rings-and-scrolling-paths-into-view:focused-2 href=interaction.html#focused>focused</a> or is not a descendant of the element with
   whose context the method is associated, then abort these steps.</li><li>

    <p>Draw a focus ring of the appropriate style along the intended path, following platform
    conventions.</p>

    <p class=note>Some platforms only draw focus rings around elements that have been focused from
    the keyboard, and not those focused from the mouse. Other platforms simply don't draw focus
    rings around some elements at all unless relevant accessibility features are enabled. This API
    is intended to follow these conventions. User agents that implement distinctions based on the
    manner in which the element was focused are encouraged to classify focus driven by the <code id=drawing-focus-rings-and-scrolling-paths-into-view:dom-focus><a href=interaction.html#dom-focus>focus()</a></code> method based on the kind of user interaction event from which
    the call was triggered (if any).</p>

    <p>The focus ring should not be subject to the <a href=#shadows id=drawing-focus-rings-and-scrolling-paths-into-view:shadows>shadow effects</a>, the
    <a href=#dom-context-2d-globalalpha id=drawing-focus-rings-and-scrolling-paths-into-view:dom-context-2d-globalalpha>global alpha</a>, the <a href=#dom-context-2d-globalcompositeoperation id=drawing-focus-rings-and-scrolling-paths-into-view:dom-context-2d-globalcompositeoperation>global composition operators</a>, or any of
    the members in the <code id=drawing-focus-rings-and-scrolling-paths-into-view:canvasfillstrokestyles><a href=#canvasfillstrokestyles>CanvasFillStrokeStyles</a></code>, <code id=drawing-focus-rings-and-scrolling-paths-into-view:canvaspathdrawingstyles><a href=#canvaspathdrawingstyles>CanvasPathDrawingStyles</a></code>,
    <code id=drawing-focus-rings-and-scrolling-paths-into-view:canvastextdrawingstyles><a href=#canvastextdrawingstyles>CanvasTextDrawingStyles</a></code> interfaces, but <em>should</em> be subject to the
    <a href=#clipping-region id=drawing-focus-rings-and-scrolling-paths-into-view:clipping-region>clipping region</a>. (The effect of transformations is described above and varies based
    on which path is being used.)</p>

   </li><li><p><a href=#inform>Inform the user</a> that the focus is at the location given by the
   intended path. User agents may wait until the next time the <a id=drawing-focus-rings-and-scrolling-paths-into-view:event-loop href=webappapis.html#event-loop>event loop</a> reaches its
   <i>update the rendering</i> step to optionally inform the user.</li></ol>

  <p>User agents should not implicitly close open subpaths in the intended path when drawing the
  focus ring.</p>

  <p class=note>This might be a moot point, however. For example, if the focus ring is drawn as an
  axis-aligned bounding rectangle around the points in the intended path, then whether the subpaths
  are closed or not has no effect. This specification intentionally does not specify precisely how
  focus rings are to be drawn: user agents are expected to honor their platform's native
  conventions.</p>

  <hr>

  <p>The <dfn id=dom-context-2d-scrollpathintoview><code>scrollPathIntoView()</code></dfn>
  method, when invoked, must run these steps:</p>

  <ol><li><p>Let <var>the specified rectangle</var> be the rectangle of the bounding box of
   the intended path.</li><li><p>Let <var>notional child</var> be a hypothetical element that is a rendered child
   of the <code id=drawing-focus-rings-and-scrolling-paths-into-view:the-canvas-element><a href=#the-canvas-element>canvas</a></code> element whose dimensions are those of <var>the specified
   rectangle</var>.</li><li><p><a href=https://triple-underscore.github.io/cssom-view-ja.html#scroll-an-element-into-view id=drawing-focus-rings-and-scrolling-paths-into-view:scroll-an-element-into-view data-x-internal=scroll-an-element-into-view>Scroll <var>notional child</var> into
   view</a> with the <var>align to top flag</var> set.</p>

   </li><li><p>Optionally, <a href=#inform>inform the user</a> that the caret or selection (or both)
   cover <var>the specified rectangle</var> of the canvas. The user agent may wait until the next
   time the <a id=drawing-focus-rings-and-scrolling-paths-into-view:event-loop-2 href=webappapis.html#event-loop>event loop</a> reaches its <i>update the rendering</i> step to
   optionally inform the user.</li></ol>

  <p id=inform>"Inform the user", as used in this section, does not imply any persistent state
  change. It could mean, for instance, calling a system accessibility API to notify assistive
  technologies such as magnification tools so that the user's magnifier moves to the given area of
  the canvas. However, it does not associate the path with the element, or provide a region for
  tactile feedback, etc.</p>

  

  <h6 id=drawing-images>4.12.5.1.14 Drawing images<a href=#drawing-images class=self-link></a></h6>

  <p>Objects that implement the <code id=drawing-images:canvasdrawimage><a href=#canvasdrawimage>CanvasDrawImage</a></code> interface have the <dfn id=dom-context-2d-drawimage><code>drawImage</code></dfn> method to draw images.</p>

  

  <p>This method can be invoked with three different sets of arguments:</p>

  <ul class=brief><li><code>drawImage(<var>image</var>, <var>dx</var>, <var>dy</var>)</code>
   </li><li><code>drawImage(<var>image</var>, <var>dx</var>, <var>dy</var>, <var>dw</var>, <var>dh</var>)</code>
   </li><li><code>drawImage(<var>image</var>, <var>sx</var>, <var>sy</var>, <var>sw</var>, <var>sh</var>, <var>dx</var>, <var>dy</var>, <var>dw</var>, <var>dh</var>)</code>
  </li></ul>

  

  <dl class=domintro><dt><var>context</var> . <code id=drawing-images:dom-context-2d-drawimage><a href=#dom-context-2d-drawimage>drawImage</a></code>(<var>image</var>, <var>dx</var>, <var>dy</var>)<dt><var>context</var> . <code id=drawing-images:dom-context-2d-drawimage-2><a href=#dom-context-2d-drawimage>drawImage</a></code>(<var>image</var>, <var>dx</var>, <var>dy</var>, <var>dw</var>, <var>dh</var>)<dt><var>context</var> . <code id=drawing-images:dom-context-2d-drawimage-3><a href=#dom-context-2d-drawimage>drawImage</a></code>(<var>image</var>, <var>sx</var>, <var>sy</var>, <var>sw</var>, <var>sh</var>, <var>dx</var>, <var>dy</var>, <var>dw</var>, <var>dh</var>)<dd>

    <p>Draws the given image onto the canvas. The arguments are
    interpreted as follows:</p>

    <p><img src=https://html.spec.whatwg.org/multipage/images/drawImage.png width=356 alt="The sx and sy parameters give the x and y coordinates of the source rectangle; the sw and sh arguments give the width and height of the source rectangle; the dx and dy give the x and y coordinates of the destination rectangle; and the dw and dh arguments give the width and height of the destination rectangle." height=356></p>

    <p>If the image isn't yet fully decoded, then nothing is drawn. If the image is a canvas with no
    data, throws an <a id=drawing-images:invalidstateerror href=https://triple-underscore.github.io/WebIDL-ja.html#invalidstateerror data-x-internal=invalidstateerror>"<code>InvalidStateError</code>"</a> <code id=drawing-images:domexception><a data-x-internal=domexception href=https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException>DOMException</a></code>.</p>

   </dl>

  

  <p>When the <code id=drawing-images:dom-context-2d-drawimage-4><a href=#dom-context-2d-drawimage>drawImage()</a></code> method is invoked, the user
  agent must run these steps:</p>

  <ol><li><p>If any of the arguments are infinite or NaN, then abort these steps.</li><li><p><a href=#check-the-usability-of-the-image-argument id=drawing-images:check-the-usability-of-the-image-argument>Check the usability of the <var>image</var> argument</a>. If this
   returns <i>aborted</i>, then an exception has been thrown and the method doesn't return anything;
   abort these steps. If it returns <i>bad</i>, then abort these steps without drawing anything.
   Otherwise it returns <i>good</i>; continue with these steps.</li><li>

    <p>Establish the source and destination rectangles as follows:</p>

    <p>If not specified, the <var>dw</var> and <var>dh</var> arguments must default to the values of
    <var>sw</var> and <var>sh</var>, interpreted such that one <a href=https://momdo.github.io/css3-values/#px id="drawing-images:'px'" data-x-internal="'px'">CSS pixel</a>
    in the image is treated as one unit in the <a href=#output-bitmap id=drawing-images:output-bitmap>output bitmap</a>'s coordinate space. If the
    <var>sx</var>, <var>sy</var>, <var>sw</var>, and <var>sh</var> arguments are omitted, then they
    must default to 0, 0, the image's <a id=drawing-images:intrinsic-width href=infrastructure.html#intrinsic-width>intrinsic width</a> in image pixels, and the image's
    <a id=drawing-images:intrinsic-height href=infrastructure.html#intrinsic-height>intrinsic height</a> in image pixels, respectively. If the image has no <a id=drawing-images:intrinsic-dimensions href=https://momdo.github.io/css2/conform.html#intrinsic data-x-internal=intrinsic-dimensions>intrinsic
    dimensions</a>, then the <i>concrete object size</i> must be used instead, as determined
    using the CSS "<a href=https://drafts.csswg.org/css-images/#default-sizing>Concrete Object
    Size Resolution</a>" algorithm, with the <i>specified size</i> having neither a definite width
    nor height, nor any additional constraints, the object's intrinsic properties being those of the
    <var>image</var> argument, and the <a id=drawing-images:default-object-size href=https://triple-underscore.github.io/css-images-ja.html#default-object-size data-x-internal=default-object-size>default object size</a> being the size of the
    <a href=#output-bitmap id=drawing-images:output-bitmap-2>output bitmap</a>. <a href=references.html#refsCSSIMAGES>[CSSIMAGES]</a></p>

    <p>The source rectangle is the rectangle whose corners are the four points (<var>sx</var>, <var>sy</var>), (<span><var>sx</var>+<var>sw</var></span>, <var>sy</var>), (<span><var>sx</var>+<var>sw</var></span>, <span><var>sy</var>+<var>sh</var></span>),
    (<var>sx</var>, <span><var>sy</var>+<var>sh</var></span>).</p>

    <p>The destination rectangle is the rectangle whose corners are the four points (<var>dx</var>, <var>dy</var>), (<span><var>dx</var>+<var>dw</var></span>, <var>dy</var>), (<span><var>dx</var>+<var>dw</var></span>, <span><var>dy</var>+<var>dh</var></span>),
    (<var>dx</var>, <span><var>dy</var>+<var>dh</var></span>).</p>

    <p>When the source rectangle is outside the source image, the source rectangle must be clipped
    to the source image and the destination rectangle must be clipped in the same proportion.</p>

    <p class=note>When the destination rectangle is outside the destination image (the
    <a href=#output-bitmap id=drawing-images:output-bitmap-3>output bitmap</a>), the pixels that land outside the <a href=#output-bitmap id=drawing-images:output-bitmap-4>output bitmap</a> are
    discarded, as if the destination was an infinite canvas whose rendering was clipped to the
    dimensions of the <a href=#output-bitmap id=drawing-images:output-bitmap-5>output bitmap</a>.</p>

   </li><li><p>If one of the <var>sw</var> or <var>sh</var> arguments is zero, then abort
   these steps. Nothing is painted.</li><li>

    <p>Paint the region of the <var>image</var> argument specified by the source rectangle
    on the region of the rendering context's <a href=#output-bitmap id=drawing-images:output-bitmap-6>output bitmap</a> specified by the
    destination rectangle, after applying the <a href=#transformations id=drawing-images:transformations>current
    transformation matrix</a> to the destination rectangle.</p>

    <p>The image data must be processed in the original direction, even if the dimensions given are
    negative.  </p>

    <p>When scaling up, if the <code id=drawing-images:dom-context-2d-imagesmoothingenabled><a href=#dom-context-2d-imagesmoothingenabled>imageSmoothingEnabled</a></code> attribute is set to
    true, the user agent should attempt to apply a smoothing algorithm to the image data when it is
    scaled. User agents which support multiple filtering algorithms may use the value of the <code id=drawing-images:dom-context-2d-imagesmoothingquality><a href=#dom-context-2d-imagesmoothingquality>imageSmoothingQuality</a></code> attribute to guide
    the choice of filtering algorithm when the <code id=drawing-images:dom-context-2d-imagesmoothingenabled-2><a href=#dom-context-2d-imagesmoothingenabled>imageSmoothingEnabled</a></code> attribute is set to
    true. Otherwise, the image must be rendered using nearest-neighbor interpolation.</p>

    <p class=note>This specification does not define the precise algorithm to use when scaling an
    image down, or when scaling an image up when the <code id=drawing-images:dom-context-2d-imagesmoothingenabled-3><a href=#dom-context-2d-imagesmoothingenabled>imageSmoothingEnabled</a></code> attribute is set to
    true.</p>

    <p class=note>When a <code id=drawing-images:the-canvas-element><a href=#the-canvas-element>canvas</a></code> element is drawn onto itself, the <a href=#drawing-model id=drawing-images:drawing-model>drawing
    model</a> requires the source to be copied before the image is drawn, so it is possible to
    copy parts of a <code id=drawing-images:the-canvas-element-2><a href=#the-canvas-element>canvas</a></code> element onto overlapping parts of itself.</p>

    <p>If the original image data is a bitmap image, then the value painted at a point in the
    destination rectangle is computed by filtering the original image data. The user agent may use
    any filtering algorithm (for example bilinear interpolation or nearest-neighbor). When the
    filtering algorithm requires a pixel value from outside the original image data, it must instead
    use the value from the nearest edge pixel. (That is, the filter uses 'clamp-to-edge' behavior.)
    When the filtering algorithm requires a pixel value from outside the source rectangle but inside
    the original image data, then the value from the original image data must be used.</p>
    
    

    <p class=note>Thus, scaling an image in parts or in whole will have the same effect. This does
    mean that when sprites coming from a single sprite sheet are to be scaled, adjacent images in
    the sprite sheet can interfere. This can be avoided by ensuring each sprite in the sheet is
    surrounded by a border of transparent black, or by copying sprites to be scaled into temporary
    <code id=drawing-images:the-canvas-element-3><a href=#the-canvas-element>canvas</a></code> elements and drawing the scaled sprites from there.</p>

    <p>Images are painted without affecting the current path, and are subject to <a href=#shadows id=drawing-images:shadows>shadow effects</a>, <a href=#dom-context-2d-globalalpha id=drawing-images:dom-context-2d-globalalpha>global
    alpha</a>, the <a href=#clipping-region id=drawing-images:clipping-region>clipping region</a>, and <a href=#dom-context-2d-globalcompositeoperation id=drawing-images:dom-context-2d-globalcompositeoperation>global composition operators</a>.</p>

   </li><li><p>If <a href=#the-image-argument-is-not-origin-clean id=drawing-images:the-image-argument-is-not-origin-clean>the <var>image argument</var> is not origin-clean</a>, then set the
   <code id=drawing-images:canvasrenderingcontext2d><a href=#canvasrenderingcontext2d>CanvasRenderingContext2D</a></code>'s <a href=#concept-canvas-origin-clean id=drawing-images:concept-canvas-origin-clean>origin-clean</a> flag to false.</li></ol>

  


  <h6 id=pixel-manipulation>4.12.5.1.15 <dfn>Pixel manipulation</dfn><a href=#pixel-manipulation class=self-link></a></h6>

  <dl class=domintro><dt><var>imagedata</var> = new <code id=pixel-manipulation:dom-imagedata><a href=#dom-imagedata>ImageData</a></code>(<var>sw</var>, <var>sh</var>)<dt><var>imagedata</var> = <var>context</var> . <code id=pixel-manipulation:dom-context-2d-createimagedata><a href=#dom-context-2d-createimagedata>createImageData</a></code>(<var>sw</var>, <var>sh</var>)<dd>

    <p>Returns an <code id=pixel-manipulation:imagedata><a href=#imagedata>ImageData</a></code> object with the given dimensions. All the pixels in the
    returned object are transparent black.</p>

    <p>Throws an <a id=pixel-manipulation:indexsizeerror href=https://triple-underscore.github.io/WebIDL-ja.html#indexsizeerror data-x-internal=indexsizeerror>"<code>IndexSizeError</code>"</a> <code id=pixel-manipulation:domexception><a data-x-internal=domexception href=https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException>DOMException</a></code> if either of
    the width or height arguments are zero.</p>

   <dt><var>imagedata</var> = <var>context</var> . <code id=pixel-manipulation:dom-context-2d-createimagedata-2><a href=#dom-context-2d-createimagedata>createImageData</a></code>(<var>imagedata</var>)<dd>

    <p>Returns an <code id=pixel-manipulation:imagedata-2><a href=#imagedata>ImageData</a></code> object with the same dimensions as the argument. All the
    pixels in the returned object are transparent black.</p>

   <dt><var>imagedata</var> = new <code id=pixel-manipulation:dom-imagedata-2><a href=#dom-imagedata>ImageData</a></code>(<var>data</var>, <var>sw</var> [, <var>sh</var> ] )<dd>

    <p>Returns an <code id=pixel-manipulation:imagedata-3><a href=#imagedata>ImageData</a></code> object using the data provided in the <code id=pixel-manipulation:idl-uint8clampedarray><a data-x-internal=idl-uint8clampedarray href=https://triple-underscore.github.io/WebIDL-ja.html#idl-Uint8ClampedArray>Uint8ClampedArray</a></code> argument, interpreted using the given
    dimensions.</p>

    <p>As each pixel in the data is represented by four numbers, the length of the data needs to be
    a multiple of four times the given width. If the height is provided as well, then the length
    needs to be exactly the width times the height times 4.</p>

    <p>Throws an <a id=pixel-manipulation:indexsizeerror-2 href=https://triple-underscore.github.io/WebIDL-ja.html#indexsizeerror data-x-internal=indexsizeerror>"<code>IndexSizeError</code>"</a> <code id=pixel-manipulation:domexception-2><a data-x-internal=domexception href=https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException>DOMException</a></code> if the given
    data and dimensions can't be interpreted consistently, or if either dimension is zero.</p>

   <dt><var>imagedata</var> = <var>context</var> . <code id=pixel-manipulation:dom-context-2d-getimagedata><a href=#dom-context-2d-getimagedata>getImageData</a></code>(<var>sx</var>, <var>sy</var>, <var>sw</var>, <var>sh</var>)<dd>

    <p>Returns an <code id=pixel-manipulation:imagedata-4><a href=#imagedata>ImageData</a></code> object containing the image data for the given rectangle of
    the bitmap.</p>

    <p>Throws an <a id=pixel-manipulation:indexsizeerror-3 href=https://triple-underscore.github.io/WebIDL-ja.html#indexsizeerror data-x-internal=indexsizeerror>"<code>IndexSizeError</code>"</a> <code id=pixel-manipulation:domexception-3><a data-x-internal=domexception href=https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException>DOMException</a></code> if the either
    of the width or height arguments are zero.</p>

   <dt><var>imagedata</var> . <code id=pixel-manipulation:dom-imagedata-width><a href=#dom-imagedata-width>width</a></code><dt><var>imagedata</var> . <code id=pixel-manipulation:dom-imagedata-height><a href=#dom-imagedata-height>height</a></code><dd>

    <p>Returns the actual dimensions of the data in the <code id=pixel-manipulation:imagedata-5><a href=#imagedata>ImageData</a></code> object, in
    pixels.</p>

   <dt><var>imagedata</var> . <code id=pixel-manipulation:dom-imagedata-data><a href=#dom-imagedata-data>data</a></code><dd>

    <p>Returns the one-dimensional array containing the data in RGBA order, as integers in the range
    0 to 255.</p>

   <dt><var>context</var> . <code id=pixel-manipulation:dom-context-2d-putimagedata><a href=#dom-context-2d-putimagedata>putImageData</a></code>(<var>imagedata</var>, <var>dx</var>, <var>dy</var> [, <var>dirtyX</var>, <var>dirtyY</var>, <var>dirtyWidth</var>, <var>dirtyHeight</var> ] )<dd>

    <p>Paints the data from the given <code id=pixel-manipulation:imagedata-6><a href=#imagedata>ImageData</a></code> object onto the bitmap. If a dirty
    rectangle is provided, only the pixels from that rectangle are painted.</p>

    <p>The <code id=pixel-manipulation:dom-context-2d-globalalpha><a href=#dom-context-2d-globalalpha>globalAlpha</a></code> and <code id=pixel-manipulation:dom-context-2d-globalcompositeoperation><a href=#dom-context-2d-globalcompositeoperation>globalCompositeOperation</a></code> attributes, as
    well as the shadow attributes, are ignored for the purposes of this method call; pixels in the
    canvas are replaced wholesale, with no composition, alpha blending, no shadows, etc.</p>

    <p>Throws an <a id=pixel-manipulation:invalidstateerror href=https://triple-underscore.github.io/WebIDL-ja.html#invalidstateerror data-x-internal=invalidstateerror>"<code>InvalidStateError</code>"</a> <code id=pixel-manipulation:domexception-4><a data-x-internal=domexception href=https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException>DOMException</a></code> if the
    <var>imagedata</var> object's data's <a id=pixel-manipulation:detached href=infrastructure.html#detached>[[Detached]]</a> internal slot value is true.</p>

   </dl>

  

  <p>Objects that implement the <code id=pixel-manipulation:canvasimagedata><a href=#canvasimagedata>CanvasImageData</a></code> interface provide the following methods
  for reading and writing pixel data to the bitmap.</p>

  <p>The <dfn id=dom-imagedata><code>ImageData()</code></dfn> constructors and the
  <dfn id=dom-context-2d-createimagedata><code>createImageData()</code></dfn> methods are
  used to instantiate new <code id=pixel-manipulation:imagedata-7><a href=#imagedata>ImageData</a></code> objects.</p>

  <p>When the <code id=pixel-manipulation:dom-imagedata-3><a href=#dom-imagedata>ImageData()</a></code> constructor is invoked with two
  numeric arguments <var>sw</var> and <var>sh</var>, it must <a href=#create-an-imagedata-object id=pixel-manipulation:create-an-imagedata-object>create an <code>ImageData</code>
  object</a> with parameter <var>pixelsPerRow</var> set to <var>sw</var>, and <var>rows</var> set
  to <var>sh</var>. The image data of the newly created <code id=pixel-manipulation:imagedata-8><a href=#imagedata>ImageData</a></code> object must be
  initialized to transparent black. If both <var>sw</var> and <var>sh</var> are non-zero, then
  return the new <code id=pixel-manipulation:imagedata-9><a href=#imagedata>ImageData</a></code> object. If one or both of <var>sw</var> and <var>sh</var>
  are zero, then the constructor must throw an <a id=pixel-manipulation:indexsizeerror-4 href=https://triple-underscore.github.io/WebIDL-ja.html#indexsizeerror data-x-internal=indexsizeerror>"<code>IndexSizeError</code>"</a>
  <code id=pixel-manipulation:domexception-5><a data-x-internal=domexception href=https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException>DOMException</a></code> instead.</p>

  <p>When the <code id=pixel-manipulation:dom-imagedata-4><a href=#dom-imagedata>ImageData()</a></code> constructor is invoked with its first
  argument being an <code id=pixel-manipulation:idl-uint8clampedarray-2><a data-x-internal=idl-uint8clampedarray href=https://triple-underscore.github.io/WebIDL-ja.html#idl-Uint8ClampedArray>Uint8ClampedArray</a></code> <var>source</var>
  and its second and optional third arguments being numeric arguments <var>sw</var> and
  <var>sh</var>, it must run these steps:</p>

  <ol><li><p>Let <var>length</var> be the number of bytes in <var>source</var>.</li><li><p>If <var>length</var> is not a non-zero integral multiple of four, then throw an
   <a id=pixel-manipulation:invalidstateerror-2 href=https://triple-underscore.github.io/WebIDL-ja.html#invalidstateerror data-x-internal=invalidstateerror>"<code>InvalidStateError</code>"</a> <code id=pixel-manipulation:domexception-6><a data-x-internal=domexception href=https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException>DOMException</a></code> and abort these
   steps.</li><li><p>Let <var>length</var> be <var>length</var> divided by four.</p>

   </li><li>

    <p>If <var>length</var> is not an integral multiple of <var>sw</var>, then throw an
    <a id=pixel-manipulation:indexsizeerror-5 href=https://triple-underscore.github.io/WebIDL-ja.html#indexsizeerror data-x-internal=indexsizeerror>"<code>IndexSizeError</code>"</a> <code id=pixel-manipulation:domexception-7><a data-x-internal=domexception href=https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException>DOMException</a></code> and abort these steps.</p>

    <p class=note>At this step, the length is guaranteed to be greater than zero (otherwise the
    second step above would have aborted the steps), so if <var>sw</var> is zero, this
    step will throw the exception and abort these steps.</p>

   </li><li><p>Let <var>height</var> be <var>length</var> divided by <var>sw</var>.</li><li><p>If the <var>sh</var> argument was not omitted, and its value is not equal to
   <var>height</var>, then throw an <a id=pixel-manipulation:indexsizeerror-6 href=https://triple-underscore.github.io/WebIDL-ja.html#indexsizeerror data-x-internal=indexsizeerror>"<code>IndexSizeError</code>"</a>
   <code id=pixel-manipulation:domexception-8><a data-x-internal=domexception href=https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException>DOMException</a></code> and abort these steps.</li><li>

    <p><a href=#create-an-imagedata-object id=pixel-manipulation:create-an-imagedata-object-2>Create an <code>ImageData</code> object</a>, with parameter <var>pixelsPerRow</var>
    set to <var>sw</var>, <var>rows</var> set to <var>sh</var>, and using <var>source</var>.
    Return the newly created <code id=pixel-manipulation:imagedata-10><a href=#imagedata>ImageData</a></code> object.</p>

    <p class=note>The resulting object's data is not a <em>copy</em> of <var>source</var>, it's
    the actual <code id=pixel-manipulation:idl-uint8clampedarray-3><a data-x-internal=idl-uint8clampedarray href=https://triple-underscore.github.io/WebIDL-ja.html#idl-Uint8ClampedArray>Uint8ClampedArray</a></code> object passed as the
    first argument to the constructor.</p>

   </li></ol>

  <p>When the <code id=pixel-manipulation:dom-context-2d-createimagedata-3><a href=#dom-context-2d-createimagedata>createImageData()</a></code> method is
  invoked with two numeric arguments <var>sw</var> and <var>sh</var>, it must <a href=#create-an-imagedata-object id=pixel-manipulation:create-an-imagedata-object-3>create an
  <code>ImageData</code> object</a>, with parameter <var>pixelsPerRow</var> set to the
  absolute magnitude of <var>sw</var>, and parameter <var>rows</var> set to the absolute magnitude
  of <var>sh</var>. Initialize the image data of the new <code id=pixel-manipulation:imagedata-11><a href=#imagedata>ImageData</a></code> object to
  transparent black. If both <var>sw</var> and <var>sh</var> are non-zero, then return
  the new <code id=pixel-manipulation:imagedata-12><a href=#imagedata>ImageData</a></code> object. If one or both of <var>sw</var> and <var>sh</var> are
  zero, then throw an <a id=pixel-manipulation:indexsizeerror-7 href=https://triple-underscore.github.io/WebIDL-ja.html#indexsizeerror data-x-internal=indexsizeerror>"<code>IndexSizeError</code>"</a> <code id=pixel-manipulation:domexception-9><a data-x-internal=domexception href=https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException>DOMException</a></code>
  instead.</p>

  <p>When the <code id=pixel-manipulation:dom-context-2d-createimagedata-4><a href=#dom-context-2d-createimagedata>createImageData()</a></code> method is
  invoked with a single <var>imagedata</var> argument, it must <a href=#create-an-imagedata-object id=pixel-manipulation:create-an-imagedata-object-4>create an
  <code>ImageData</code> object</a>, with parameter <var>pixelsPerRow</var> set to the value of
  the <code id=pixel-manipulation:dom-imagedata-width-2><a href=#dom-imagedata-width>width</a></code> attribute of the <code id=pixel-manipulation:imagedata-13><a href=#imagedata>ImageData</a></code>
  object passed as the argument, and the <var>rows</var> parameter set to the value of the
  <code id=pixel-manipulation:dom-imagedata-height-2><a href=#dom-imagedata-height>height</a></code> attribute.
  Initialize the image data of the new <code id=pixel-manipulation:imagedata-14><a href=#imagedata>ImageData</a></code> object to transparent black. Return
  the newly created <code id=pixel-manipulation:imagedata-15><a href=#imagedata>ImageData</a></code> object.</p>

  <p>The <dfn id=dom-context-2d-getimagedata><code>getImageData(<var>sx</var>,
  <var>sy</var>, <var>sw</var>, <var>sh</var>)</code></dfn> method, when invoked, must,
  if either the <var>sw</var> or <var>sh</var> arguments are zero, throw an
  <a id=pixel-manipulation:indexsizeerror-8 href=https://triple-underscore.github.io/WebIDL-ja.html#indexsizeerror data-x-internal=indexsizeerror>"<code>IndexSizeError</code>"</a> <code id=pixel-manipulation:domexception-10><a data-x-internal=domexception href=https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException>DOMException</a></code>; otherwise,
  
  if the <code id=pixel-manipulation:canvasrenderingcontext2d><a href=#canvasrenderingcontext2d>CanvasRenderingContext2D</a></code>'s <a href=#concept-canvas-origin-clean id=pixel-manipulation:concept-canvas-origin-clean>origin-clean</a> flag is set to false, it must throw a
  <a id=pixel-manipulation:securityerror href=https://triple-underscore.github.io/WebIDL-ja.html#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a> <code id=pixel-manipulation:domexception-11><a data-x-internal=domexception href=https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException>DOMException</a></code>;
  
  otherwise, it must <a href=#create-an-imagedata-object id=pixel-manipulation:create-an-imagedata-object-5>create an <code>ImageData</code> object</a>, with parameter
  <var>pixelsPerRow</var> set to <var>sw</var>, and parameter <var>rows</var> set to <var>sh</var>.
  Set the pixel values of the image data of the newly created <code id=pixel-manipulation:imagedata-16><a href=#imagedata>ImageData</a></code> object to
  represent the <a href=#output-bitmap id=pixel-manipulation:output-bitmap>output bitmap</a> for the area of that bitmap denoted by the rectangle
  whose corners are the four points (<var>sx</var>, <var>sy</var>), (<span><var>sx</var>+<var>sw</var></span>, <var>sy</var>), (<span><var>sx</var>+<var>sw</var></span>, <span><var>sy</var>+<var>sh</var></span>), (<var>sx</var>,
  <span><var>sy</var>+<var>sh</var></span>), in the bitmap's coordinate space units.
  Pixels outside the <a href=#output-bitmap id=pixel-manipulation:output-bitmap-2>output bitmap</a> must be set to transparent black. Pixel values
  must not be premultiplied by alpha.</p>

  <p>When the user agent is required to <dfn id=create-an-imagedata-object>create an <code>ImageData</code> object</dfn>, given a
  positive integer number of rows <var>rows</var>, a positive integer number of pixels per row
  <var>pixelsPerRow</var>, and an optional <code id=pixel-manipulation:idl-uint8clampedarray-4><a data-x-internal=idl-uint8clampedarray href=https://triple-underscore.github.io/WebIDL-ja.html#idl-Uint8ClampedArray>Uint8ClampedArray</a></code> <var>source</var>, it must run these
  steps:</p>

  <ol><li><p>Let <var>imageData</var> be a new uninitialized <code id=pixel-manipulation:imagedata-17><a href=#imagedata>ImageData</a></code> object.</li><li><p>If <var>source</var> is specified, then assign the <dfn id=dom-imagedata-data><code>data</code></dfn> attribute of <var>imageData</var> to
   <var>source</var>.</li><li>
    <p>If <var>source</var> is not specified, then initialize the <code id=pixel-manipulation:dom-imagedata-data-2><a href=#dom-imagedata-data>data</a></code> attribute of <var>imageData</var> to a new <code id=pixel-manipulation:idl-uint8clampedarray-5><a data-x-internal=idl-uint8clampedarray href=https://triple-underscore.github.io/WebIDL-ja.html#idl-Uint8ClampedArray>Uint8ClampedArray</a></code> object. The <code id=pixel-manipulation:idl-uint8clampedarray-6><a data-x-internal=idl-uint8clampedarray href=https://triple-underscore.github.io/WebIDL-ja.html#idl-Uint8ClampedArray>Uint8ClampedArray</a></code> object must use a new <a href=#canvas-pixel-arraybuffer id=pixel-manipulation:canvas-pixel-arraybuffer>Canvas
    Pixel <code>ArrayBuffer</code></a> for its storage, and must have a
    zero start offset and a length equal to the length of its storage, in bytes. The <a href=#canvas-pixel-arraybuffer id=pixel-manipulation:canvas-pixel-arraybuffer-2>Canvas
    Pixel <code>ArrayBuffer</code></a> must have the correct size to
    store <var>rows</var> × <var>pixelsPerRow</var> pixels.</p>

    <p>If the <a href=#canvas-pixel-arraybuffer id=pixel-manipulation:canvas-pixel-arraybuffer-3>Canvas Pixel <code>ArrayBuffer</code></a> cannot be
    allocated, then rethrow the <code id=pixel-manipulation:js-rangeerror><a data-x-internal=js-rangeerror href=https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-rangeerror>RangeError</a></code> thrown by JavaScript,
    and abort these steps.</p>
   </li><li><p>Initialize the <dfn id=dom-imagedata-width><code>width</code></dfn> attribute of
   <var>imageData</var> to <var>pixelsPerRow</var>.</li><li><p>Initialize the <dfn id=dom-imagedata-height><code>height</code></dfn> attribute of
   <var>imageData</var> to <var>rows</var>.</li><li><p>Return <var>imageData</var>.</li></ol>

  <p><code id=pixel-manipulation:imagedata-18><a href=#imagedata>ImageData</a></code> objects are <a id=pixel-manipulation:serializable-objects href=infrastructure.html#serializable-objects>serializable objects</a>. Their <a id=pixel-manipulation:serialization-steps href=infrastructure.html#serialization-steps>serialization
  steps</a>, given <var>value</var> and <var>serialized</var>, are:</p>

  <ol><li><p>Set <var>serialized</var>.[[Data]] to the <a id=pixel-manipulation:sub-serialization href=infrastructure.html#sub-serialization>sub-serialization</a> of the value of
   <var>value</var>'s <code id=pixel-manipulation:dom-imagedata-data-3><a href=#dom-imagedata-data>data</a></code> attribute.</li><li><p>Set <var>serialized</var>.[[Width]] to the value of <var>value</var>'s <code id=pixel-manipulation:dom-imagedata-width-3><a href=#dom-imagedata-width>width</a></code> attribute.</li><li><p>Set <var>serialized</var>.[[Height]] to the value of <var>value</var>'s <code id=pixel-manipulation:dom-imagedata-height-3><a href=#dom-imagedata-height>height</a></code> attribute.</li></ol>

  <p>Their <a id=pixel-manipulation:deserialization-steps href=infrastructure.html#deserialization-steps>deserialization steps</a>, given <var>serialized</var> and <var>value</var>,
  are:</p>

  <ol><li><p>Initialize <var>value</var>'s <code id=pixel-manipulation:dom-imagedata-data-4><a href=#dom-imagedata-data>data</a></code> attribute
   to the <a id=pixel-manipulation:sub-deserialization href=infrastructure.html#sub-deserialization>sub-deserialization</a> of <var>serialized</var>.[[Data]].</li><li><p>Initialize <var>value</var>'s <code id=pixel-manipulation:dom-imagedata-width-4><a href=#dom-imagedata-width>width</a></code> attribute
   to <var>serialized</var>.[[Width]].</li><li><p>Initialize <var>value</var>'s <code id=pixel-manipulation:dom-imagedata-height-4><a href=#dom-imagedata-height>height</a></code> attribute
   to <var>serialized</var>.[[Height]].</li></ol>

  <p>A <dfn id=canvas-pixel-arraybuffer>Canvas Pixel <code>ArrayBuffer</code></dfn> is an <code id=pixel-manipulation:idl-arraybuffer><a data-x-internal=idl-arraybuffer href=https://triple-underscore.github.io/WebIDL-ja.html#idl-ArrayBuffer>ArrayBuffer</a></code> whose data is represented in left-to-right order, row
  by row top to bottom, starting with the top left, with each pixel's red, green, blue, and alpha
  components being given in that order for each pixel. Each component of each pixel represented in
  this array must be in the range 0..255, representing the 8 bit value for that component. The
  components must be assigned consecutive indices starting with 0 for the top left pixel's red
  component.</p>

  <p>The <dfn id=dom-context-2d-putimagedata><code>putImageData()</code></dfn> method writes
  data from <code id=pixel-manipulation:imagedata-19><a href=#imagedata>ImageData</a></code> structures back to the rendering context's <a href=#output-bitmap id=pixel-manipulation:output-bitmap-3>output
  bitmap</a>. Its arguments are: <var>imagedata</var>, <var>dx</var>, <var>dy</var>,
  <var>dirtyX</var>, <var>dirtyY</var>, <var>dirtyWidth</var>, and <var>dirtyHeight</var>.</p>

  <p>When the last four arguments to this method are omitted, they must be assumed to have the
  values 0, 0, the <code id=pixel-manipulation:dom-imagedata-width-5><a href=#dom-imagedata-width>width</a></code> member of the <var>imagedata</var> structure, and the <code id=pixel-manipulation:dom-imagedata-height-5><a href=#dom-imagedata-height>height</a></code>
  member of the <var>imagedata</var> structure, respectively.</p>

  <p>The method, when invoked, must act as follows:</p>

  <ol><li>

    <p>If <var>imagedata</var>'s <code id=pixel-manipulation:dom-imagedata-data-5><a href=#dom-imagedata-data>data</a></code> attribute value's
    <a id=pixel-manipulation:detached-2 href=infrastructure.html#detached>[[Detached]]</a> internal slot value is true, then throw an
    <a id=pixel-manipulation:invalidstateerror-3 href=https://triple-underscore.github.io/WebIDL-ja.html#invalidstateerror data-x-internal=invalidstateerror>"<code>InvalidStateError</code>"</a> <code id=pixel-manipulation:domexception-12><a data-x-internal=domexception href=https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException>DOMException</a></code> and abort these
    steps.</p>

   </li><li>

    <p>If <var>dirtyWidth</var> is negative, then let <var>dirtyX</var> be <span><var>dirtyX</var>+<var>dirtyWidth</var></span>, and let <var>dirtyWidth</var> be equal
    to the absolute magnitude of <var>dirtyWidth</var>.</p>

    <p>If <var>dirtyHeight</var> is negative, then let <var>dirtyY</var> be <span><var>dirtyY</var>+<var>dirtyHeight</var></span>, and let <var>dirtyHeight</var> be
    equal to the absolute magnitude of <var>dirtyHeight</var>.</p>

   </li><li>

    <p>If <var>dirtyX</var> is negative, then let <var>dirtyWidth</var> be <span><var>dirtyWidth</var>+<var>dirtyX</var></span>, and let <var>dirtyX</var> be zero.</p>

    <p>If <var>dirtyY</var> is negative, then let <var>dirtyHeight</var> be <span><var>dirtyHeight</var>+<var>dirtyY</var></span>, and let <var>dirtyY</var> be zero.</p>

   </li><li>

    <p>If <span><var>dirtyX</var>+<var>dirtyWidth</var></span> is greater than the <code id=pixel-manipulation:dom-imagedata-width-6><a href=#dom-imagedata-width>width</a></code> attribute of the <var>imagedata</var> argument, then
    let <var>dirtyWidth</var> be the value of that <code id=pixel-manipulation:dom-imagedata-width-7><a href=#dom-imagedata-width>width</a></code>
    attribute, minus the value of <var>dirtyX</var>.</p>

    <p>If <span><var>dirtyY</var>+<var>dirtyHeight</var></span> is greater than the <code id=pixel-manipulation:dom-imagedata-height-6><a href=#dom-imagedata-height>height</a></code> attribute of the <var>imagedata</var> argument, then
    let <var>dirtyHeight</var> be the value of that <code id=pixel-manipulation:dom-imagedata-height-7><a href=#dom-imagedata-height>height</a></code> attribute, minus the value of <var>dirtyY</var>.</p>

   </li><li>

    <p>If, after those changes, either <var>dirtyWidth</var> or <var>dirtyHeight</var> are negative
    or zero, then abort these steps without affecting any bitmaps.</p>

   </li><li><p>For all integer values of <var>x</var> and <var>y</var> where <span><var>dirtyX</var>&nbsp;≤&nbsp;<var>x</var>&nbsp;&lt;&nbsp;<span><var>dirtyX</var>+<var>dirtyWidth</var></span></span> and <span><var>dirtyY</var>&nbsp;≤&nbsp;<var>y</var>&nbsp;&lt;&nbsp;<span><var>dirtyY</var>+<var>dirtyHeight</var></span></span>, copy the
   four channels of the pixel with coordinate (<var>x</var>, <var>y</var>) in
   the <var>imagedata</var> data structure's <a href=#canvas-pixel-arraybuffer id=pixel-manipulation:canvas-pixel-arraybuffer-4>Canvas Pixel
   <code>ArrayBuffer</code></a> to the pixel with coordinate (<span><var>dx</var>+<var>x</var></span>, <span><var>dy</var>+<var>y</var></span>)
   in the rendering context's <a href=#output-bitmap id=pixel-manipulation:output-bitmap-4>output bitmap</a>.</li></ol>

  <p class=note>Due to the lossy nature of converting to and from premultiplied alpha color
  values, pixels that have just been set using <code id=pixel-manipulation:dom-context-2d-putimagedata-2><a href=#dom-context-2d-putimagedata>putImageData()</a></code> might be returned to an equivalent
  <code id=pixel-manipulation:dom-context-2d-getimagedata-2><a href=#dom-context-2d-getimagedata>getImageData()</a></code> as different values.</p>

  <p>The current path, <a href=#transformations id=pixel-manipulation:transformations>transformation matrix</a>,
  <a href=#shadows id=pixel-manipulation:shadows>shadow attributes</a>, <a href=#dom-context-2d-globalalpha id=pixel-manipulation:dom-context-2d-globalalpha-2>global
  alpha</a>, the <a href=#clipping-region id=pixel-manipulation:clipping-region>clipping region</a>, and <a href=#dom-context-2d-globalcompositeoperation id=pixel-manipulation:dom-context-2d-globalcompositeoperation-2>global composition operator</a> must not
  affect the methods described in this section.</p>

  

  <div class=example>

   <p>In the following example, the script generates an <code id=pixel-manipulation:imagedata-20><a href=#imagedata>ImageData</a></code> object so that it can
   draw onto it.</p>

   <pre>// canvas is a reference to a &lt;canvas&gt; element
var context = canvas.getContext('2d');

// create a blank slate
var data = context.createImageData(canvas.width, canvas.height);

// create some plasma
FillPlasma(data, 'green'); // green plasma

// add a cloud to the plasma
AddCloud(data, data.width/2, data.height/2); // put a cloud in the middle

// paint the plasma+cloud on the canvas
context.putImageData(data, 0, 0);

// support methods
function FillPlasma(data, color) { ... }
function AddCloud(data, x, y) { ... }</pre>

  </div>

  <div class=example>

   <p>Here is an example of using <code id=pixel-manipulation:dom-context-2d-getimagedata-3><a href=#dom-context-2d-getimagedata>getImageData()</a></code> and <code id=pixel-manipulation:dom-context-2d-putimagedata-3><a href=#dom-context-2d-putimagedata>putImageData()</a></code> to implement an edge detection
   filter.</p>

   <pre>&lt;!DOCTYPE HTML&gt;
&lt;html lang="en"&gt;
 &lt;head&gt;
  &lt;title&gt;Edge detection demo&lt;/title&gt;
  &lt;script&gt;
   var image = new Image();
   function init() {
     image.onload = demo;
     image.src = "image.jpeg";
   }
   function demo() {
     var canvas = document.getElementsByTagName('canvas')[0];
     var context = canvas.getContext('2d');

     // draw the image onto the canvas
     context.drawImage(image, 0, 0);

     // get the image data to manipulate
     var input = context.getImageData(0, 0, canvas.width, canvas.height);

     // get an empty slate to put the data into
     var output = context.createImageData(canvas.width, canvas.height);

     // alias some variables for convenience
     // In this case input.width and input.height
     // match canvas.width and canvas.height
     // but we'll use the former to keep the code generic.
     var w = input.width, h = input.height;
     var inputData = input.data;
     var outputData = output.data;

     // edge detection
     for (var y = 1; y &lt; h-1; y += 1) {
       for (var x = 1; x &lt; w-1; x += 1) {
         for (var c = 0; c &lt; 3; c += 1) {
           var i = (y*w + x)*4 + c;
           outputData[i] = 127 + -inputData[i - w*4 - 4] -   inputData[i - w*4] - inputData[i - w*4 + 4] +
                                 -inputData[i - 4]       + 8*inputData[i]       - inputData[i + 4] +
                                 -inputData[i + w*4 - 4] -   inputData[i + w*4] - inputData[i + w*4 + 4];
         }
         outputData[(y*w + x)*4 + 3] = 255; // alpha
       }
     }

     // put the image data back after manipulation
     context.putImageData(output, 0, 0);
   }
  &lt;/script&gt;
 &lt;/head&gt;
 &lt;body onload="init()"&gt;
  &lt;canvas&gt;&lt;/canvas&gt;
 &lt;/body&gt;
&lt;/html&gt;</pre>

  </div>




  <h6 id=compositing>4.12.5.1.16 Compositing<a href=#compositing class=self-link></a></h6>

  <dl class=domintro><dt><var>context</var> . <code id=compositing:dom-context-2d-globalalpha><a href=#dom-context-2d-globalalpha>globalAlpha</a></code> [ = <var>value</var> ]<dd>

    <p>Returns the current alpha value applied to rendering operations.</p>

    <p>Can be set, to change the alpha value. Values outside of the range 0.0 .. 1.0 are
    ignored.</p>

   <dt><var>context</var> . <code id=compositing:dom-context-2d-globalcompositeoperation><a href=#dom-context-2d-globalcompositeoperation>globalCompositeOperation</a></code> [ = <var>value</var> ]<dd>

    <p>Returns the current composition operation, from the values defined in the Compositing and
    Blending specification. <a href=references.html#refsCOMPOSITE>[COMPOSITE]</a>.</p>

    <p>Can be set, to change the composition operation. Unknown values are ignored.</p>

   </dl>

  

  <p>All drawing operations on an object which implements the <code id=compositing:canvascompositing><a href=#canvascompositing>CanvasCompositing</a></code>
  interface are affected by the global compositing attributes, <code id=compositing:dom-context-2d-globalalpha-2><a href=#dom-context-2d-globalalpha>globalAlpha</a></code> and <code id=compositing:dom-context-2d-globalcompositeoperation-2><a href=#dom-context-2d-globalcompositeoperation>globalCompositeOperation</a></code>.</p>

  

  <p>The <dfn id=dom-context-2d-globalalpha><code>globalAlpha</code></dfn> attribute gives an
  alpha value that is applied to shapes and images before they are composited onto the <a href=#output-bitmap id=compositing:output-bitmap>output
  bitmap</a>. The value must be in the range from 0.0 (fully transparent) to 1.0 (no additional
  transparency). If an attempt is made to set the attribute to a value outside this range, including
  Infinity and Not-a-Number (NaN) values, then the attribute must retain its previous value. When
  the context is created, the <code id=compositing:dom-context-2d-globalalpha-3><a href=#dom-context-2d-globalalpha>globalAlpha</a></code> attribute
  must initially have the value 1.0.</p>

  <p>The <dfn id=dom-context-2d-globalcompositeoperation><code>globalCompositeOperation</code></dfn> attribute
  sets the <dfn id=current-composition-operator>current composition operator</dfn>, which controls how shapes and images are drawn onto the
  <a href=#output-bitmap id=compositing:output-bitmap-2>output bitmap</a>, once they have had <code id=compositing:dom-context-2d-globalalpha-4><a href=#dom-context-2d-globalalpha>globalAlpha</a></code> and the current transformation matrix
  applied. The possible values are those defined in the Compositing and Blending specification, and
  include the values <dfn id=gcop-source-over><code>source-over</code></dfn>
  and <dfn id=gcop-copy><code>copy</code></dfn>.
  <a href=references.html#refsCOMPOSITE>[COMPOSITE]</a><div class=status><input onclick=toggleStatus(this) value=⋰ type=button><p class=bugs><strong>Spec bugs:</strong> <a href="https://www.w3.org/Bugs/Public/show_bug.cgi?id=27313" title="It seems like this should be defined in terms of an IDL enum. If not, please clarify the relationshi [...]">27313</a></div>

  <p>These values are all case-sensitive — they must be used exactly as defined. User agents
  must not recognize values that are not a <a id=compositing:case-sensitive href=infrastructure.html#case-sensitive>case-sensitive</a> match for one of the values
  given in the Compositing and Blending specification. <a href=references.html#refsCOMPOSITE>[COMPOSITE]</a></p>

  <p>On setting, if the user agent does not recognize the specified value, it must be ignored,
  leaving the value of <code id=compositing:dom-context-2d-globalcompositeoperation-3><a href=#dom-context-2d-globalcompositeoperation>globalCompositeOperation</a></code> unaffected.
  Otherwise, the attribute must be set to the given new value.</p>

  <p>When the context is created, the <code id=compositing:dom-context-2d-globalcompositeoperation-4><a href=#dom-context-2d-globalcompositeoperation>globalCompositeOperation</a></code> attribute must
  initially have the value <code id=compositing:gcop-source-over><a href=#gcop-source-over>source-over</a></code>.</p>

  



  <h6 id=image-smoothing>4.12.5.1.17 Image smoothing<a href=#image-smoothing class=self-link></a></h6>

  <dl class=domintro><dt><var>context</var> . <code id=image-smoothing:dom-context-2d-imagesmoothingenabled><a href=#dom-context-2d-imagesmoothingenabled>imageSmoothingEnabled</a></code> [ = <var>value</var> ]<dd>

    <p>Returns whether pattern fills and the <code id=image-smoothing:dom-context-2d-drawimage><a href=#dom-context-2d-drawimage>drawImage()</a></code> method will attempt to smooth images if
    their pixels don't line up exactly with the display, when scaling images up.</p>

    <p>Can be set, to change whether images are smoothed (true) or not (false).</p>

   <dt><var>context</var> . <code id=image-smoothing:dom-context-2d-imagesmoothingquality><a href=#dom-context-2d-imagesmoothingquality>imageSmoothingQuality</a></code> [ = <var>value</var> ]<dd>

    <p>Returns the current image-smoothing-quality preference.</p>

    <p>Can be set, to change the preferred quality of image smoothing. The possible values are
    "<code id=image-smoothing:dom-context-2d-imagesmoothingquality-low><a href=#dom-context-2d-imagesmoothingquality-low>low</a></code>", "<code id=image-smoothing:dom-context-2d-imagesmoothingquality-medium><a href=#dom-context-2d-imagesmoothingquality-medium>medium</a></code>" and "<code id=image-smoothing:dom-context-2d-imagesmoothingquality-high><a href=#dom-context-2d-imagesmoothingquality-high>high</a></code>". Unknown values are ignored.</p>

   </dl>

  

  <p>Objects that implement the <code id=image-smoothing:canvasimagesmoothing><a href=#canvasimagesmoothing>CanvasImageSmoothing</a></code> interface have attributes that
  control how image smoothing is performed.</p>

  <p>The <dfn id=dom-context-2d-imagesmoothingenabled><code>imageSmoothingEnabled</code></dfn>
  attribute, on getting, must return the last value it was set to. On setting, it must be set to the
  new value. When the object implementing the <code id=image-smoothing:canvasimagesmoothing-2><a href=#canvasimagesmoothing>CanvasImageSmoothing</a></code> interface is
  created, the attribute must be set to true.</p>

  <p>The <dfn id=dom-context-2d-imagesmoothingquality><code>imageSmoothingQuality</code></dfn>
  attribute, on getting, must return the last value it was set to. On setting, it must be set to the
  new value. When the object implementing the <code id=image-smoothing:canvasimagesmoothing-3><a href=#canvasimagesmoothing>CanvasImageSmoothing</a></code> interface is
  created, the attribute must be set to "<code id=image-smoothing:dom-context-2d-imagesmoothingquality-low-2><a href=#dom-context-2d-imagesmoothingquality-low>low</a></code>".</p>

  


  <h6 id=shadows>4.12.5.1.18 <dfn>Shadows</dfn><a href=#shadows class=self-link></a></h6>

  <p>All drawing operations on an object which implements the <code id=shadows:canvasshadowstyles><a href=#canvasshadowstyles>CanvasShadowStyles</a></code>
  interface are affected by the four global shadow attributes.</p>

  <dl class=domintro><dt><var>context</var> . <code id=shadows:dom-context-2d-shadowcolor><a href=#dom-context-2d-shadowcolor>shadowColor</a></code> [ = <var>value</var> ]<dd>

    <p>Returns the current shadow color.</p>

    <p>Can be set, to change the shadow color. Values that cannot be parsed as CSS colors are ignored.</p>

   <dt><var>context</var> . <code id=shadows:dom-context-2d-shadowoffsetx><a href=#dom-context-2d-shadowoffsetx>shadowOffsetX</a></code> [ = <var>value</var> ]<dt><var>context</var> . <code id=shadows:dom-context-2d-shadowoffsety><a href=#dom-context-2d-shadowoffsety>shadowOffsetY</a></code> [ = <var>value</var> ]<dd>

    <p>Returns the current shadow offset.</p>

    <p>Can be set, to change the shadow offset. Values that are not finite numbers are ignored.</p>

   <dt><var>context</var> . <code id=shadows:dom-context-2d-shadowblur><a href=#dom-context-2d-shadowblur>shadowBlur</a></code> [ = <var>value</var> ]<dd>

    <p>Returns the current level of blur applied to shadows.</p>

    <p>Can be set, to change the blur level. Values that are not finite numbers greater than or
    equal to zero are ignored.</p>

   </dl>

  

  <p>The <dfn id=dom-context-2d-shadowcolor><code>shadowColor</code></dfn> attribute sets the
  color of the shadow.</p>

  <p>When the context is created, the <code id=shadows:dom-context-2d-shadowcolor-2><a href=#dom-context-2d-shadowcolor>shadowColor</a></code>
  attribute initially must be fully-transparent black.</p>

  <p>On getting, the <a href=#serialisation-of-a-color id=shadows:serialisation-of-a-color>serialization of the color</a>
  must be returned.</p>

  <p>On setting, the new value must be <a id=shadows:parsed-as-a-css-color-value href=infrastructure.html#parsed-as-a-css-color-value>parsed as a CSS &lt;color&gt; value</a> and the
  color assigned. If the value cannot be <a id=shadows:parsed-as-a-css-color-value-2 href=infrastructure.html#parsed-as-a-css-color-value>parsed as a CSS &lt;color&gt; value</a> then it
  must be ignored, and the attribute must retain its previous value. <a href=references.html#refsCSSCOLOR>[CSSCOLOR]</a></p>

  <p>The <dfn id=dom-context-2d-shadowoffsetx><code>shadowOffsetX</code></dfn> and <dfn id=dom-context-2d-shadowoffsety><code>shadowOffsetY</code></dfn> attributes specify the distance
  that the shadow will be offset in the positive horizontal and positive vertical distance
  respectively. Their values are in coordinate space units. They are not affected by the current
  transformation matrix.</p>

  <p>When the context is created, the shadow offset attributes must initially have the value
  0.</p>

  <p>On getting, they must return their current value. On setting, the attribute being set must be
  set to the new value, except if the value is infinite or NaN, in which case the new value must be
  ignored.</p>

  <p>The <dfn id=dom-context-2d-shadowblur><code>shadowBlur</code></dfn> attribute specifies
  the level of the blurring effect. (The units do not map to coordinate space units, and are not
  affected by the current transformation matrix.)</p>

  <p>When the context is created, the <code id=shadows:dom-context-2d-shadowblur-2><a href=#dom-context-2d-shadowblur>shadowBlur</a></code>
  attribute must initially have the value 0.</p>

  <p>On getting, the attribute must return its current value. On setting the attribute must be set
  to the new value, except if the value is negative, infinite or NaN, in which case the new value
  must be ignored.</p>

  <p><dfn id=when-shadows-are-drawn>Shadows are only drawn if</dfn> the opacity component of
  the alpha component of the color of <code id=shadows:dom-context-2d-shadowcolor-3><a href=#dom-context-2d-shadowcolor>shadowColor</a></code> is
  non-zero and either the <code id=shadows:dom-context-2d-shadowblur-3><a href=#dom-context-2d-shadowblur>shadowBlur</a></code> is non-zero, or
  the <code id=shadows:dom-context-2d-shadowoffsetx-2><a href=#dom-context-2d-shadowoffsetx>shadowOffsetX</a></code> is non-zero, or the <code id=shadows:dom-context-2d-shadowoffsety-2><a href=#dom-context-2d-shadowoffsety>shadowOffsetY</a></code> is non-zero.</p>

  <p><a href=#when-shadows-are-drawn id=shadows:when-shadows-are-drawn>When shadows are drawn</a>, they must be rendered as follows:</p>

  <ol><li><p>Let <var>A</var> be an infinite transparent black bitmap on which the source
   image for which a shadow is being created has been rendered.</li><li><p>Let <var>B</var> be an infinite transparent black bitmap, with a coordinate
   space and an origin identical to <var>A</var>.</li><li><p>Copy the alpha channel of <var>A</var> to <var>B</var>, offset by <code id=shadows:dom-context-2d-shadowoffsetx-3><a href=#dom-context-2d-shadowoffsetx>shadowOffsetX</a></code> in the positive <var>x</var>
   direction, and <code id=shadows:dom-context-2d-shadowoffsety-3><a href=#dom-context-2d-shadowoffsety>shadowOffsetY</a></code> in the positive
   <var>y</var> direction.</li><li>

    <p>If <code id=shadows:dom-context-2d-shadowblur-4><a href=#dom-context-2d-shadowblur>shadowBlur</a></code> is greater than 0:</p>

    <ol><li> <p>Let <var>σ</var> be half the value of <code id=shadows:dom-context-2d-shadowblur-5><a href=#dom-context-2d-shadowblur>shadowBlur</a></code>.</li><li> <p>Perform a 2D Gaussian Blur on <var>B</var>, using <var>σ</var>
     as the standard deviation.</p>  </li></ol>

    <p>User agents may limit values of <var>σ</var> to an implementation-specific
    maximum value to avoid exceeding hardware limitations during the Gaussian blur operation.</p>

   </li><li><p>Set the red, green, and blue components of every pixel in <var>B</var> to the
   red, green, and blue components (respectively) of the color of <code id=shadows:dom-context-2d-shadowcolor-4><a href=#dom-context-2d-shadowcolor>shadowColor</a></code>.</li><li><p>Multiply the alpha component of every pixel in <var>B</var> by the alpha
   component of the color of <code id=shadows:dom-context-2d-shadowcolor-5><a href=#dom-context-2d-shadowcolor>shadowColor</a></code>.</li><li><p>The shadow is in the bitmap <var>B</var>, and is rendered as part of the
   <a href=#drawing-model id=shadows:drawing-model>drawing model</a> described below.</li></ol>

  

  <p>If the current composition operation is <code id=shadows:gcop-copy><a href=#gcop-copy>copy</a></code>, then shadows
  effectively won't render (since the shape will overwrite the shadow).</p>

  <h6 id=filters>4.12.5.1.19 Filters<a href=#filters class=self-link></a></h6>

  <p>All drawing operations on an object which implements the <code id=filters:canvasfilters><a href=#canvasfilters>CanvasFilters</a></code>
  interface are affected by the global <dfn id=dom-context-2d-filter><code>filter</code></dfn>
  attribute.</p>

  <dl class=domintro><dt><var>context</var> . <code id=filters:dom-context-2d-filter><a href=#dom-context-2d-filter>filter</a></code> [ = <var>value</var> ]<dd>

    <p>Returns the current filter.</p>

    <p>Can be set, to change the filter. Values that cannot be parsed as a
    <a id=filters:filter-function-list href=https://drafts.fxtf.org/filters/#typedef-filter-function-list data-x-internal=filter-function-list>&lt;filter-function-list&gt;</a> value are ignored.</p>

   </dl>

  

  <p>The <code id=filters:dom-context-2d-filter-2><a href=#dom-context-2d-filter>filter</a></code> attribute, on getting, must
  return the last value it was successfully set to. The value must not be re-serialized. On setting,
  if the new value is 'none' (not the empty string, null, or undefined), filters must be disabled
  for the context. Otherwise, the value must be parsed as a
  <a id=filters:filter-function-list-2 href=https://drafts.fxtf.org/filters/#typedef-filter-function-list data-x-internal=filter-function-list>&lt;filter-function-list&gt;</a> value. If the value cannot be parsed as a
  <a id=filters:filter-function-list-3 href=https://drafts.fxtf.org/filters/#typedef-filter-function-list data-x-internal=filter-function-list>&lt;filter-function-list&gt;</a> value, where using property-independent style sheet
  syntax like 'inherit' or 'initial' is considered an invalid value, then it must be ignored, and
  the attribute must retain its previous value. When creating the object implementing the
  <code id=filters:canvasfilters-2><a href=#canvasfilters>CanvasFilters</a></code> interface, the attribute must be set to 'none'.</p>

  <p>A <a id=filters:filter-function-list-4 href=https://drafts.fxtf.org/filters/#typedef-filter-function-list data-x-internal=filter-function-list>&lt;filter-function-list&gt;</a> value consists of a sequence of one or more
  filter functions or references to SVG filters. The input to the filter is used as the input
  to the first item in the list. Subsequent items take the output of the previous item as
  their input. <a href=references.html#refsFILTERS>[FILTERS]</a></p>

  <p>Coordinates used in the value of the <code id=filters:dom-context-2d-filter-3><a href=#dom-context-2d-filter>filter</a></code> attribute are interpreted such that one pixel is
  equivalent to one SVG user space unit and to one canvas coordinate space unit. Filter coordinates
  are not affected by the <a href=#transformations id=filters:transformations>current transformation
  matrix</a>. The current transformation matrix affects only the input to the filter. Filters
  are applied in the <a href=#output-bitmap id=filters:output-bitmap>output bitmap</a>'s coordinate space.</p>

  <p>When the value of the <code id=filters:dom-context-2d-filter-4><a href=#dom-context-2d-filter>filter</a></code> attribute defines
  lengths using percentages or using <a id="filters:'em'" href=https://momdo.github.io/css3-values/#em data-x-internal="'em'">'em'</a> or <a id="filters:'ex'" href=https://momdo.github.io/css3-values/#ex data-x-internal="'ex'">'ex'</a> units, these must be
  interpreted relative to the <a id=filters:computed-value href=https://drafts.csswg.org/css-cascade/#computed-value data-x-internal=computed-value>computed value</a> of the <a id="filters:'font-size'" href=https://triple-underscore.github.io/css-fonts-ja.html#font-size-prop data-x-internal="'font-size'">'font-size'</a> property
  of the <a href=#font-style-source-object id=filters:font-style-source-object>font style source object</a> at the time that the attribute is set, if it is an
  element. If the <a href=https://drafts.csswg.org/css-cascade/#computed-value id=filters:computed-value-2 data-x-internal=computed-value>computed values</a> are undefined for a
  particular case (e.g. because the <a href=#font-style-source-object id=filters:font-style-source-object-2>font style source object</a> is not an element or is
  not <a id=filters:being-rendered href=rendering.html#being-rendered>being rendered</a>), then the relative keywords must be interpreted relative to the
  default value of the <code id=filters:dom-context-2d-font><a href=#dom-context-2d-font>font</a></code> attribute. The 'larger' and
  'smaller' keywords are not supported.</p>

  <p>If the value of the <code id=filters:dom-context-2d-filter-5><a href=#dom-context-2d-filter>filter</a></code> attribute refers to an
  SVG filter in the same document, and this SVG filter changes, then the changed filter is used for
  the next draw operation.</p>

  <p>If the value of the <code id=filters:dom-context-2d-filter-6><a href=#dom-context-2d-filter>filter</a></code> attribute refers to an
  SVG filter in an external resource document and that document is not loaded when a drawing
  operation is invoked, then the drawing operation must proceed with no filtering.</p>

  

  <h6 id=working-with-externally-defined-svg-filters>4.12.5.1.20 Working with externally-defined SVG filters<a href=#working-with-externally-defined-svg-filters class=self-link></a></h6>

  <p><i>この節は非規範的である。</i></p>

  <p>Since drawing is performed using filter value 'none' until an externally-defined
  filter has finished loading, authors might wish to determine whether such a filter
  has finished loading before proceeding with a drawing operation. One way to accomplish
  this is to load the externally-defined filter elsewhere within the same page in some
  element that sends a <code>load</code> event (for example, an <a id=working-with-externally-defined-svg-filters:svg-use href=https://triple-underscore.github.io/SVG11/struct.html#UseElement data-x-internal=svg-use>SVG
  <code>use</code></a> element), and wait for the <code>load</code> event to be
  dispatched.</p>

  

  <h6 id=drawing-model>4.12.5.1.21 <dfn>Drawing model</dfn><a href=#drawing-model class=self-link></a></h6>

  <p>When a shape or image is painted, user agents must follow these steps, in the order given (or
  act as if they do):</p>

  <ol><li><p>Render the shape or image onto an infinite transparent black bitmap, creating image <var>A</var>, as described in the previous sections. For shapes, the current fill, stroke,
   and line styles must be honored, and the stroke must itself also be subjected to the current
   transformation matrix.</li><li><p>When the filter attribute is set to a value other than 'none' and all the
   externally-defined filters it references, if any, are in documents that are currently loaded,
   then use image <var>A</var> as the input to the <code id=drawing-model:dom-context-2d-filter><a href=#dom-context-2d-filter>filter</a></code>, creating image <var>B</var>. Otherwise, let
   <var>B</var> be an alias for <var>A</var>.</li><li><p><a href=#when-shadows-are-drawn id=drawing-model:when-shadows-are-drawn>When shadows are drawn</a>, render the shadow from image <var>B</var>,
   using the current shadow styles, creating image <var>C</var>.</li><li><p><a href=#when-shadows-are-drawn id=drawing-model:when-shadows-are-drawn-2>When shadows are drawn</a>, multiply the alpha component of every pixel in <var>C</var> by <code id=drawing-model:dom-context-2d-globalalpha><a href=#dom-context-2d-globalalpha>globalAlpha</a></code>.</li><li><p><a href=#when-shadows-are-drawn id=drawing-model:when-shadows-are-drawn-3>When shadows are drawn</a>, composite <var>C</var> within the
   <a href=#clipping-region id=drawing-model:clipping-region>clipping region</a> over the current <a href=#output-bitmap id=drawing-model:output-bitmap>output bitmap</a> using the <a href=#current-composition-operator id=drawing-model:current-composition-operator>current
   composition operator</a>.</li><li><p>Multiply the alpha component of every pixel in <var>B</var> by <code id=drawing-model:dom-context-2d-globalalpha-2><a href=#dom-context-2d-globalalpha>globalAlpha</a></code>.</li><li><p>Composite <var>B</var> within the <a href=#clipping-region id=drawing-model:clipping-region-2>clipping region</a> over the current
   <a href=#output-bitmap id=drawing-model:output-bitmap-2>output bitmap</a> using the <a href=#current-composition-operator id=drawing-model:current-composition-operator-2>current composition operator</a>.</li></ol>

  <p>When compositing onto the <a href=#output-bitmap id=drawing-model:output-bitmap-3>output bitmap</a>, pixels that would fall outside of the
  <a href=#output-bitmap id=drawing-model:output-bitmap-4>output bitmap</a> must be discarded.</p>

  




  <h6 id=best-practices>4.12.5.1.22 Best practices<a href=#best-practices class=self-link></a></h6>

  <p>When a canvas is interactive, authors should include focusable elements in the element's
  fallback content corresponding to each focusable part of the canvas, as in the <a href=#drawCustomFocusRingExample>example above</a>.</p>

  <p>When rendering focus rings, to ensure that focus rings have the appearance of native focus
  rings, authors should use the <code id=best-practices:dom-context-2d-drawfocusifneeded><a href=#dom-context-2d-drawfocusifneeded>drawFocusIfNeeded()</a></code> method, passing it the
  element for which a ring is being drawn. This method only draws the focus ring if the element is
  <a id=best-practices:focused href=interaction.html#focused>focused</a>, so that it can simply be called whenever drawing the element, without
  checking whether the element is focused or not first.</p>

  <p>In addition to drawing focus rings, authors should use the <code id=best-practices:dom-context-2d-scrollpathintoview><a href=#dom-context-2d-scrollpathintoview>scrollPathIntoView()</a></code> method when an element in
  the canvas is focused, to make sure it is visible on the screen (if applicable).</p>

  <p id=no-text-editing-in-canvas-please>Authors should avoid implementing text editing controls
  using the <code id=best-practices:the-canvas-element><a href=#the-canvas-element>canvas</a></code> element. Doing so has a large number of disadvantages:</p>

  <ul><li>Mouse placement of the caret has to be reimplemented.</li><li>Keyboard movement of the caret has to be reimplemented (possibly across lines, for multiline
   text input).</li><li>Scrolling of the text control has to be implemented (horizontally for long lines, vertically
   for multiline input).</li><li>Native features such as copy-and-paste have to be reimplemented.</li><li>Native features such as spell-checking have to be reimplemented.</li><li>Native features such as drag-and-drop have to be reimplemented.</li><li>Native features such as page-wide text search have to be reimplemented.</li><li>Native features specific to the user, for example custom text services, have to be
   reimplemented. This is close to impossible since each user might have different services
   installed, and there is an unbounded set of possible such services.</li><li>Bidirectional text editing has to be reimplemented.</li><li>For multiline text editing, line wrapping has to be implemented for all relevant
   languages.</li><li>Text selection has to be reimplemented.</li><li>Dragging of bidirectional text selections has to be reimplemented.</li><li>Platform-native keyboard shortcuts have to be reimplemented.</li><li>Platform-native input method editors (IMEs) have to be reimplemented.</li><li>Undo and redo functionality has to be reimplemented.</li><li>Accessibility features such as magnification following the caret or selection have to be
   reimplemented.</li></ul>

  <p>This is a huge amount of work, and authors are most strongly encouraged to avoid doing any of
  it by instead using the <code id=best-practices:the-input-element><a href=forms.html#the-input-element>input</a></code> element, the <code id=best-practices:the-textarea-element><a href=forms.html#the-textarea-element>textarea</a></code> element, or the
  <code id=best-practices:attr-contenteditable><a href=interaction.html#attr-contenteditable>contenteditable</a></code> attribute.</p>


  <h6 id=examples>4.12.5.1.23 例<a href=#examples class=self-link></a></h6>

  <p><i>この節は非規範的である。</i></p>

  <div class=example>

  <p>Here is an example of a script that uses canvas to draw <a href="data:text/html;charset=utf-8;base64,PCFET0NUWVBFIEhUTUw%2BDQo8aHRtbCBsYW5nPSJlbiI%2BDQogPGhlYWQ%2BDQogIDx0aXRsZT5QcmV0dHkgR2xvd2luZyBMaW5lczwvdGl0bGU%2BDQogPC9oZWFkPg0KIDxib2R5Pg0KPGNhbnZhcyB3aWR0aD0iODAwIiBoZWlnaHQ9IjQ1MCI%2BPC9jYW52YXM%2BDQo8c2NyaXB0Pg0KDQogdmFyIGNvbnRleHQgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnY2FudmFzJylbMF0uZ2V0Q29udGV4dCgnMmQnKTsNCg0KIHZhciBsYXN0WCA9IGNvbnRleHQuY2FudmFzLndpZHRoICogTWF0aC5yYW5kb20oKTsNCiB2YXIgbGFzdFkgPSBjb250ZXh0LmNhbnZhcy5oZWlnaHQgKiBNYXRoLnJhbmRvbSgpOw0KIHZhciBodWUgPSAwOw0KIGZ1bmN0aW9uIGxpbmUoKSB7DQogICBjb250ZXh0LnNhdmUoKTsNCiAgIGNvbnRleHQudHJhbnNsYXRlKGNvbnRleHQuY2FudmFzLndpZHRoLzIsIGNvbnRleHQuY2FudmFzLmhlaWdodC8yKTsNCiAgIGNvbnRleHQuc2NhbGUoMC45LCAwLjkpOw0KICAgY29udGV4dC50cmFuc2xhdGUoLWNvbnRleHQuY2FudmFzLndpZHRoLzIsIC1jb250ZXh0LmNhbnZhcy5oZWlnaHQvMik7DQogICBjb250ZXh0LmJlZ2luUGF0aCgpOw0KICAgY29udGV4dC5saW5lV2lkdGggPSA1ICsgTWF0aC5yYW5kb20oKSAqIDEwOw0KICAgY29udGV4dC5tb3ZlVG8obGFzdFgsIGxhc3RZKTsNCiAgIGxhc3RYID0gY29udGV4dC5jYW52YXMud2lkdGggKiBNYXRoLnJhbmRvbSgpOw0KICAgbGFzdFkgPSBjb250ZXh0LmNhbnZhcy5oZWlnaHQgKiBNYXRoLnJhbmRvbSgpOw0KICAgY29udGV4dC5iZXppZXJDdXJ2ZVRvKGNvbnRleHQuY2FudmFzLndpZHRoICogTWF0aC5yYW5kb20oKSwNCiAgICAgICAgICAgICAgICAgICAgICAgICBjb250ZXh0LmNhbnZhcy5oZWlnaHQgKiBNYXRoLnJhbmRvbSgpLA0KICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRleHQuY2FudmFzLndpZHRoICogTWF0aC5yYW5kb20oKSwNCiAgICAgICAgICAgICAgICAgICAgICAgICBjb250ZXh0LmNhbnZhcy5oZWlnaHQgKiBNYXRoLnJhbmRvbSgpLA0KICAgICAgICAgICAgICAgICAgICAgICAgIGxhc3RYLCBsYXN0WSk7DQoNCiAgIGh1ZSA9IGh1ZSArIDEwICogTWF0aC5yYW5kb20oKTsNCiAgIGNvbnRleHQuc3Ryb2tlU3R5bGUgPSAnaHNsKCcgKyBodWUgKyAnLCA1MCUsIDUwJSknOw0KICAgY29udGV4dC5zaGFkb3dDb2xvciA9ICd3aGl0ZSc7DQogICBjb250ZXh0LnNoYWRvd0JsdXIgPSAxMDsNCiAgIGNvbnRleHQuc3Ryb2tlKCk7DQogICBjb250ZXh0LnJlc3RvcmUoKTsNCiB9DQogc2V0SW50ZXJ2YWwobGluZSwgNTApOw0KDQogZnVuY3Rpb24gYmxhbmsoKSB7DQogICBjb250ZXh0LmZpbGxTdHlsZSA9ICdyZ2JhKDAsMCwwLDAuMSknOw0KICAgY29udGV4dC5maWxsUmVjdCgwLCAwLCBjb250ZXh0LmNhbnZhcy53aWR0aCwgY29udGV4dC5jYW52YXMuaGVpZ2h0KTsNCiB9DQogc2V0SW50ZXJ2YWwoYmxhbmssIDQwKTsNCg0KPC9zY3JpcHQ%2BDQogPC9ib2R5Pg0KPC9odG1sPg0K">pretty glowing lines</a>.</p>

  <pre>&lt;canvas width="800" height="450"&gt;&lt;/canvas&gt;
&lt;script&gt;

 var context = document.getElementsByTagName('canvas')[0].getContext('2d');

 var lastX = context.canvas.width * Math.random();
 var lastY = context.canvas.height * Math.random();
 var hue = 0;
 function line() {
   context.save();
   context.translate(context.canvas.width/2, context.canvas.height/2);
   context.scale(0.9, 0.9);
   context.translate(-context.canvas.width/2, -context.canvas.height/2);
   context.beginPath();
   context.lineWidth = 5 + Math.random() * 10;
   context.moveTo(lastX, lastY);
   lastX = context.canvas.width * Math.random();
   lastY = context.canvas.height * Math.random();
   context.bezierCurveTo(context.canvas.width * Math.random(),
                         context.canvas.height * Math.random(),
                         context.canvas.width * Math.random(),
                         context.canvas.height * Math.random(),
                         lastX, lastY);

   hue = hue + 10 * Math.random();
   context.strokeStyle = 'hsl(' + hue + ', 50%, 50%)';
   context.shadowColor = 'white';
   context.shadowBlur = 10;
   context.stroke();
   context.restore();
 }
 setInterval(line, 50);

 function blank() {
   context.fillStyle = 'rgba(0,0,0,0.1)';
   context.fillRect(0, 0, context.canvas.width, context.canvas.height);
 }
 setInterval(blank, 40);

&lt;/script&gt;</pre>

  </div>

  <div class=example>

   <p>The 2D rendering context for <code id=examples:the-canvas-element><a href=#the-canvas-element>canvas</a></code> is often used for sprite-based games. The
   following example demonstrates this:</p>

   <iframe src=/demos/canvas/blue-robot/index-idle.html width=396 height=216></iframe>

   <p>Here is the source for this example:</p>

   <pre>&lt;!DOCTYPE HTML&gt;
&lt;meta charset="utf-8"&gt;
&lt;title&gt;Blue Robot Demo&lt;/title&gt;
&lt;style&gt;
  html { overflow: hidden; min-height: 200px; min-width: 380px; }
  body { height: 200px; position: relative; margin: 8px; }
  .buttons { position: absolute; bottom: 0px; left: 0px; margin: 4px; }
&lt;/style&gt;
&lt;canvas width="380" height="200"&gt;&lt;/canvas&gt;
&lt;script&gt;
 var Landscape = function (context, width, height) {
   this.offset = 0;
   this.width = width;
   this.advance = function (dx) {
     this.offset += dx;
   };
   this.horizon = height * 0.7;
   // This creates the sky gradient (from a darker blue to white at the bottom)
   this.sky = context.createLinearGradient(0, 0, 0, this.horizon);
   this.sky.addColorStop(0.0, 'rgb(55,121,179)');
   this.sky.addColorStop(0.7, 'rgb(121,194,245)');
   this.sky.addColorStop(1.0, 'rgb(164,200,214)');
   // this creates the grass gradient (from a darker green to a lighter green)
   this.earth = context.createLinearGradient(0, this.horizon, 0, height);
   this.earth.addColorStop(0.0, 'rgb(81,140,20)');
   this.earth.addColorStop(1.0, 'rgb(123,177,57)');
   this.paintBackground = function (context, width, height) {
     // first, paint the sky and grass rectangles
     context.fillStyle = this.sky;
     context.fillRect(0, 0, width, this.horizon);
     context.fillStyle = this.earth;
     context.fillRect(0, this.horizon, width, height-this.horizon);
     // then, draw the cloudy banner
     // we make it cloudy by having the draw text off the top of the
     // canvas, and just having the blurred shadow shown on the canvas
     context.save();
     context.translate(width-((this.offset+(this.width*3.2)) % (this.width*4.0))+0, 0);
     context.shadowColor = 'white';
     context.shadowOffsetY = 30+this.horizon/3; // offset down on canvas
     context.shadowBlur = '5';
     context.fillStyle = 'white';
     context.textAlign = 'left';
     context.textBaseline = 'top';
     context.font = '20px sans-serif';
     context.fillText('WHATWG ROCKS', 10, -30); // text up above canvas
     context.restore();
     // then, draw the background tree
     context.save();
     context.translate(width-((this.offset+(this.width*0.2)) % (this.width*1.5))+30, 0);
     context.beginPath();
     context.fillStyle = 'rgb(143,89,2)';
     context.lineStyle = 'rgb(10,10,10)';
     context.lineWidth = 2;
     context.rect(0, this.horizon+5, 10, -50); // trunk
     context.fill();
     context.stroke();
     context.beginPath();
     context.fillStyle = 'rgb(78,154,6)';
     context.arc(5, this.horizon-60, 30, 0, Math.PI*2); // leaves
     context.fill();
     context.stroke();
     context.restore();
   };
   this.paintForeground = function (context, width, height) {
     // draw the box that goes in front
     context.save();
     context.translate(width-((this.offset+(this.width*0.7)) % (this.width*1.1))+0, 0);
     context.beginPath();
     context.rect(0, this.horizon - 5, 25, 25);
     context.fillStyle = 'rgb(220,154,94)';
     context.lineStyle = 'rgb(10,10,10)';
     context.lineWidth = 2;
     context.fill();
     context.stroke();
     context.restore();
   };
 };
&lt;/script&gt;
&lt;script&gt;
 var BlueRobot = function () {
   this.sprites = new Image();
   this.sprites.src = 'blue-robot.png'; // this sprite sheet has 8 cells
   this.targetMode = 'idle';
   this.walk = function () {
     this.targetMode = 'walk';
   };
   this.stop = function () {
     this.targetMode = 'idle';
   };
   this.frameIndex = {
     'idle': [0], // first cell is the idle frame
     'walk': [1,2,3,4,5,6], // the walking animation is cells 1-6
     'stop': [7], // last cell is the stopping animation
   };
   this.mode = 'idle';
   this.frame = 0; // index into frameIndex
   this.tick = function () {
     // this advances the frame and the robot
     // the return value is how many pixels the robot has moved
     this.frame += 1;
     if (this.frame &gt;= this.frameIndex[this.mode].length) {
       // we've reached the end of this animation cycle
       this.frame = 0;
       if (this.mode != this.targetMode) {
         // switch to next cycle
         if (this.mode == 'walk') {
           // we need to stop walking before we decide what to do next
           this.mode = 'stop';
         } else if (this.mode == 'stop') {
           if (this.targetMode == 'walk')
             this.mode = 'walk';
           else
             this.mode = 'idle';
         } else if (this.mode == 'idle') {
           if (this.targetMode == 'walk')
             this.mode = 'walk';
         }
       }
     }
     if (this.mode == 'walk')
       return 8;
     return 0;
   },
   this.paint = function (context, x, y) {
     if (!this.sprites.complete) return;
     // draw the right frame out of the sprite sheet onto the canvas
     // we assume each frame is as high as the sprite sheet
     // the x,y coordinates give the position of the bottom center of the sprite
     context.drawImage(this.sprites,
                       this.frameIndex[this.mode][this.frame] * this.sprites.height, 0, this.sprites.height, this.sprites.height,
                       x-this.sprites.height/2, y-this.sprites.height, this.sprites.height, this.sprites.height);
   };
 };
&lt;/script&gt;
&lt;script&gt;
 var canvas = document.getElementsByTagName('canvas')[0];
 var context = canvas.getContext('2d');
 var landscape = new Landscape(context, canvas.width, canvas.height);
 var blueRobot = new BlueRobot();
 // paint when the browser wants us to, using requestAnimationFrame()
 function paint() {
   context.clearRect(0, 0, canvas.width, canvas.height);
   landscape.paintBackground(context, canvas.width, canvas.height);
   blueRobot.paint(context, canvas.width/2, landscape.horizon*1.1);
   landscape.paintForeground(context, canvas.width, canvas.height);
   requestAnimationFrame(paint);
 }
 paint();
 // but tick every 150ms, so that we don't slow down when we don't paint
 setInterval(function () {
   var dx = blueRobot.tick();
   landscape.advance(dx);
 }, 100);
&lt;/script&gt;
&lt;p class="buttons"&gt;
 &lt;input type=button value="Walk" onclick="blueRobot.walk()"&gt;
 &lt;input type=button value="Stop" onclick="blueRobot.stop()"&gt;
&lt;footer&gt;
 &lt;small&gt; Blue Robot Player Sprite by &lt;a href="https://johncolburn.deviantart.com/"&gt;JohnColburn&lt;/a&gt;.
 Licensed under the terms of the Creative Commons Attribution Share-Alike 3.0 Unported license.&lt;/small&gt;
 &lt;small&gt; This work is itself licensed under a &lt;a rel="license" href="https://creativecommons.org/licenses/by-sa/3.0/"&gt;Creative
 Commons Attribution-ShareAlike 3.0 Unported License&lt;/a&gt;.&lt;/small&gt;
&lt;/footer&gt;
</pre>

  </div>




  <h5 id=the-imagebitmap-rendering-context>4.12.5.2 The <code id=the-imagebitmap-rendering-context:imagebitmap><a href=webappapis.html#imagebitmap>ImageBitmap</a></code> rendering context<a href=#the-imagebitmap-rendering-context class=self-link></a></h5>

  <h6 id=introduction-6>4.12.5.2.1 導入<a href=#introduction-6 class=self-link></a></h6>

  <p><code id=introduction-6:imagebitmaprenderingcontext><a href=#imagebitmaprenderingcontext>ImageBitmapRenderingContext</a></code> is a performance-oriented interface that provides a
  low overhead method for displaying the contents of <code id=introduction-6:imagebitmap><a href=webappapis.html#imagebitmap>ImageBitmap</a></code> objects. It uses
  transfer semantics to reduce overall memory consumption. It also streamlines performance by
  avoiding intermediate compositing, unlike the <code id=introduction-6:dom-context-2d-drawimage><a href=#dom-context-2d-drawimage>drawImage()</a></code> method of
  <code id=introduction-6:canvasrenderingcontext2d><a href=#canvasrenderingcontext2d>CanvasRenderingContext2D</a></code>.</p>

  <p>Using an <code id=introduction-6:the-img-element><a href=embedded-content.html#the-img-element>img</a></code> element as an intermediate for getting an image resource into a
  canvas, for example, would result in two copies of the decoded image existing in memory at the
  same time: the <code id=introduction-6:the-img-element-2><a href=embedded-content.html#the-img-element>img</a></code> element's copy, and the one in the canvas's backing store. This
  memory cost can be prohibitive when dealing with extremely large images. This can be avoided by
  using <code id=introduction-6:imagebitmaprenderingcontext-2><a href=#imagebitmaprenderingcontext>ImageBitmapRenderingContext</a></code>.</p>

  <div class=example>
   <p>Using <code id=introduction-6:imagebitmaprenderingcontext-3><a href=#imagebitmaprenderingcontext>ImageBitmapRenderingContext</a></code>, here is how to transcode an image to the JPEG
   format in a memory- and CPU-efficient way:</p>

   <pre>createImageBitmap(inputImageBlob).then(image =&gt; {
  const canvas = document.createElement('canvas');
  const context = canvas.getContext('bitmaprenderer');
  context.transferFromImageBitmap(image);

  canvas.toBlob(outputJPEGBlob =&gt; {
    // Do something with outputJPEGBlob.
  }, 'image/jpeg');
});</pre>
  </div>
  <h6 id=the-imagebitmaprenderingcontext-interface>4.12.5.2.2 The <code id=the-imagebitmaprenderingcontext-interface:imagebitmaprenderingcontext><a href=#imagebitmaprenderingcontext>ImageBitmapRenderingContext</a></code> interface<a href=#the-imagebitmaprenderingcontext-interface class=self-link></a></h6>

  <pre class=idl>interface <dfn id=imagebitmaprenderingcontext>ImageBitmapRenderingContext</dfn> {
  readonly attribute <a href=#htmlcanvaselement id=the-imagebitmaprenderingcontext-interface:htmlcanvaselement>HTMLCanvasElement</a> <a href=#dom-imagebitmaprenderingcontext-canvas id=the-imagebitmaprenderingcontext-interface:dom-imagebitmaprenderingcontext-canvas>canvas</a>;
  void <a href=#dom-imagebitmaprenderingcontext-transferfromimagebitmap id=the-imagebitmaprenderingcontext-interface:dom-imagebitmaprenderingcontext-transferfromimagebitmap>transferFromImageBitmap</a>(ImageBitmap? bitmap);
};

dictionary <dfn id=imagebitmaprenderingcontextsettings>ImageBitmapRenderingContextSettings</dfn> {
  boolean <a href=#dom-imagebitmaprenderingcontextsettings-alpha id=the-imagebitmaprenderingcontext-interface:dom-imagebitmaprenderingcontextsettings-alpha>alpha</a> = true;
};</pre>

  <dl class=domintro><dt><var>context</var> = <var>canvas</var> . <code id=the-imagebitmaprenderingcontext-interface:dom-canvas-getcontext><a href=#dom-canvas-getcontext>getContext</a></code>('bitmaprenderer' [, { [ <code id=the-imagebitmaprenderingcontext-interface:dom-imagebitmaprenderingcontextsettings-alpha-2><a href=#dom-imagebitmaprenderingcontextsettings-alpha>alpha</a></code>: false ] } ] )<dd>

    <p>Returns an <code id=the-imagebitmaprenderingcontext-interface:imagebitmaprenderingcontext-2><a href=#imagebitmaprenderingcontext>ImageBitmapRenderingContext</a></code> object that is permanently bound to a
    particular <code id=the-imagebitmaprenderingcontext-interface:the-canvas-element><a href=#the-canvas-element>canvas</a></code> element.</p>

    <p>If the <code id=the-imagebitmaprenderingcontext-interface:dom-imagebitmaprenderingcontextsettings-alpha-3><a href=#dom-imagebitmaprenderingcontextsettings-alpha>alpha</a></code> setting is
    provided and set to false, then the canvas is forced to always be opaque.</p>

   <dt><var>context</var> . <code id=the-imagebitmaprenderingcontext-interface:dom-imagebitmaprenderingcontext-canvas-2><a href=#dom-imagebitmaprenderingcontext-canvas>canvas</a></code><dd>

    <p>Returns the <code id=the-imagebitmaprenderingcontext-interface:the-canvas-element-2><a href=#the-canvas-element>canvas</a></code> element that the context is bound to.</p>

   <dt><var>context</var> . <code id=the-imagebitmaprenderingcontext-interface:dom-imagebitmaprenderingcontext-transferfromimagebitmap-2><a href=#dom-imagebitmaprenderingcontext-transferfromimagebitmap>transferFromImageBitmap</a></code>(imageBitmap)<dd>

    <p>Transfers the underlying <a href=webappapis.html#concept-imagebitmap-bitmap-data id=the-imagebitmaprenderingcontext-interface:concept-imagebitmap-bitmap-data>bitmap data</a>
    from <var>imageBitmap</var> to <var>context</var>, and the bitmap becomes the contents of the
    <code id=the-imagebitmaprenderingcontext-interface:the-canvas-element-3><a href=#the-canvas-element>canvas</a></code> element to which <var>context</var> is bound.</p>

   <dt><var>context</var> . <code id=the-imagebitmaprenderingcontext-interface:dom-imagebitmaprenderingcontext-transferfromimagebitmap-3><a href=#dom-imagebitmaprenderingcontext-transferfromimagebitmap>transferFromImageBitmap</a></code>(
   null)<dd>

    <p>Replaces contents of the <code id=the-imagebitmaprenderingcontext-interface:the-canvas-element-4><a href=#the-canvas-element>canvas</a></code> element to which <var>context</var>
    is bound with a transparent black bitmap whose size corresponds to the <code id=the-imagebitmaprenderingcontext-interface:attr-canvas-width><a href=#attr-canvas-width>width</a></code> and <code id=the-imagebitmaprenderingcontext-interface:attr-canvas-height><a href=#attr-canvas-height>height</a></code>
    content attributes of the <code id=the-imagebitmaprenderingcontext-interface:the-canvas-element-5><a href=#the-canvas-element>canvas</a></code> element.</p>

   </dl>

  

  <p>The <dfn id=dom-imagebitmaprenderingcontext-canvas><code>canvas</code></dfn> attribute
  must return the value it was initialized to when the object was created.</p>

  <p>An <code id=the-imagebitmaprenderingcontext-interface:imagebitmaprenderingcontext-3><a href=#imagebitmaprenderingcontext>ImageBitmapRenderingContext</a></code> object has an <dfn id=concept-imagebitmaprenderingcontext-output-bitmap>output bitmap</dfn>, which is a
  reference to <a href=webappapis.html#concept-imagebitmap-bitmap-data id=the-imagebitmaprenderingcontext-interface:concept-imagebitmap-bitmap-data-2>bitmap data</a>.</p>

  <p>An <code id=the-imagebitmaprenderingcontext-interface:imagebitmaprenderingcontext-4><a href=#imagebitmaprenderingcontext>ImageBitmapRenderingContext</a></code> object has a <dfn id=concept-imagebitmaprenderingcontext-bitmap-mode>bitmap mode</dfn>, which can be set to
  <dfn id=concept-imagebitmaprenderingcontext-valid>valid</dfn> or <dfn id=concept-imagebitmaprenderingcontext-blank>blank</dfn>. A value of <a href=#concept-imagebitmaprenderingcontext-valid id=the-imagebitmaprenderingcontext-interface:concept-imagebitmaprenderingcontext-valid>valid</a> indicates that the context's
  <a href=#concept-imagebitmaprenderingcontext-output-bitmap id=the-imagebitmaprenderingcontext-interface:concept-imagebitmaprenderingcontext-output-bitmap>output bitmap</a> refers to
  <a href=webappapis.html#concept-imagebitmap-bitmap-data id=the-imagebitmaprenderingcontext-interface:concept-imagebitmap-bitmap-data-3>bitmap data</a> that was acquired via <code id=the-imagebitmaprenderingcontext-interface:dom-imagebitmaprenderingcontext-transferfromimagebitmap-4><a href=#dom-imagebitmaprenderingcontext-transferfromimagebitmap>transferFromImageBitmap()</a></code>.
  A value <a href=#concept-imagebitmaprenderingcontext-blank id=the-imagebitmaprenderingcontext-interface:concept-imagebitmaprenderingcontext-blank>blank</a> indicates that the
  context's <a href=#concept-imagebitmaprenderingcontext-output-bitmap id=the-imagebitmaprenderingcontext-interface:concept-imagebitmaprenderingcontext-output-bitmap-2>output
  bitmap</a> is a default transparent bitmap.</p>

  <p>An <code id=the-imagebitmaprenderingcontext-interface:imagebitmaprenderingcontext-5><a href=#imagebitmaprenderingcontext>ImageBitmapRenderingContext</a></code> object also has an <dfn id=concept-imagebitmaprenderingcontext-alpha>alpha</dfn> flag, which can be set to true or
  false. When an <code id=the-imagebitmaprenderingcontext-interface:imagebitmaprenderingcontext-6><a href=#imagebitmaprenderingcontext>ImageBitmapRenderingContext</a></code> object has its <a href=#concept-imagebitmaprenderingcontext-alpha id=the-imagebitmaprenderingcontext-interface:concept-imagebitmaprenderingcontext-alpha>alpha</a> flag set to false, the contents
  of the <code id=the-imagebitmaprenderingcontext-interface:the-canvas-element-6><a href=#the-canvas-element>canvas</a></code> element to which the context is bound are obtained by
  compositing the context's <a href=#concept-imagebitmaprenderingcontext-output-bitmap id=the-imagebitmaprenderingcontext-interface:concept-imagebitmaprenderingcontext-output-bitmap-3>output bitmap</a> onto an opaque
  black bitmap of the same size using the source-over composite operation. If the <a href=#concept-imagebitmaprenderingcontext-alpha id=the-imagebitmaprenderingcontext-interface:concept-imagebitmaprenderingcontext-alpha-2>alpha</a> flag is set to true, then the
  <a href=#concept-imagebitmaprenderingcontext-output-bitmap id=the-imagebitmaprenderingcontext-interface:concept-imagebitmaprenderingcontext-output-bitmap-4>output bitmap</a> is used
  as the contents of the <code id=the-imagebitmaprenderingcontext-interface:the-canvas-element-7><a href=#the-canvas-element>canvas</a></code> element to which the context is bound. <a href=references.html#refsCOMPOSITE>[COMPOSITE]</a></p>

  <p class=note>The step of compositing over an opaque black bitmap ought to be elided whenever
  equivalent results can be obtained more efficiently by other means.</p>

  <hr>

  <p>When a user agent is required to <dfn id="set-an-imagebitmaprenderingcontext's-output-bitmap">set an <code>ImageBitmapRenderingContext</code>'s output
  bitmap</dfn>, with a <var>context</var> argument that is an
  <code id=the-imagebitmaprenderingcontext-interface:imagebitmaprenderingcontext-7><a href=#imagebitmaprenderingcontext>ImageBitmapRenderingContext</a></code> object and an optional argument <var>bitmap</var> that
  refers to <a href=webappapis.html#concept-imagebitmap-bitmap-data id=the-imagebitmaprenderingcontext-interface:concept-imagebitmap-bitmap-data-4>bitmap data</a>, it must run these
  steps:</p>

  <ol><li><p>If a <var>bitmap</var> argument was not provided, then:</p>

    <ol><li><p>Set <var>context</var>'s <a href=#concept-imagebitmaprenderingcontext-bitmap-mode id=the-imagebitmaprenderingcontext-interface:concept-imagebitmaprenderingcontext-bitmap-mode>bitmap mode</a> to <a href=#concept-imagebitmaprenderingcontext-blank id=the-imagebitmaprenderingcontext-interface:concept-imagebitmaprenderingcontext-blank-2>blank</a>.</li><li><p>Let <var>canvas</var> be the <code id=the-imagebitmaprenderingcontext-interface:the-canvas-element-8><a href=#the-canvas-element>canvas</a></code> element to which <var>context</var>
     is bound.</li><li><p>Set <var>context</var>'s <a href=#concept-imagebitmaprenderingcontext-output-bitmap id=the-imagebitmaprenderingcontext-interface:concept-imagebitmaprenderingcontext-output-bitmap-5>output bitmap</a> to be fully
     transparent black with an <a id=the-imagebitmaprenderingcontext-interface:intrinsic-width href=infrastructure.html#intrinsic-width>intrinsic width</a> equal to the numeric value of
     <var>canvas</var>'s <code id=the-imagebitmaprenderingcontext-interface:attr-canvas-width-2><a href=#attr-canvas-width>width</a></code> attribute and an
     <a id=the-imagebitmaprenderingcontext-interface:intrinsic-height href=infrastructure.html#intrinsic-height>intrinsic height</a> equal to the numeric value of <var>canvas</var>'s <code id=the-imagebitmaprenderingcontext-interface:attr-canvas-height-2><a href=#attr-canvas-height>height</a></code> attribute, those values being interpreted in <a href=https://momdo.github.io/css3-values/#px id="the-imagebitmaprenderingcontext-interface:'px'" data-x-internal="'px'">CSS pixels</a>.</li><li><p>Set the <a href=#concept-imagebitmaprenderingcontext-output-bitmap id=the-imagebitmaprenderingcontext-interface:concept-imagebitmaprenderingcontext-output-bitmap-6>output bitmap</a>'s <a href=#concept-canvas-origin-clean id=the-imagebitmaprenderingcontext-interface:concept-canvas-origin-clean>origin-clean</a> flag to true.</li></ol>

   </li><li><p>If a <var>bitmap</var> argument was provided, then:</p>

    <ol><li><p>Set <var>context</var>'s <a href=#concept-imagebitmaprenderingcontext-bitmap-mode id=the-imagebitmaprenderingcontext-interface:concept-imagebitmaprenderingcontext-bitmap-mode-2>bitmap mode</a> to <a href=#concept-imagebitmaprenderingcontext-valid id=the-imagebitmaprenderingcontext-interface:concept-imagebitmaprenderingcontext-valid-2>valid</a>.</li><li>
      <p>Set <var>context</var>'s <a href=#concept-imagebitmaprenderingcontext-output-bitmap id=the-imagebitmaprenderingcontext-interface:concept-imagebitmaprenderingcontext-output-bitmap-7>output bitmap</a> to refer
      to the same underlying bitmap data as <var>bitmap</var>, without making a copy.</p>

      <p class=note>The <a href=#concept-canvas-origin-clean id=the-imagebitmaprenderingcontext-interface:concept-canvas-origin-clean-2>origin-clean</a> flag of
      <var>bitmap</var> is included in the bitmap data to be referenced by <var>context</var>'s
      <a href=#concept-imagebitmaprenderingcontext-output-bitmap id=the-imagebitmaprenderingcontext-interface:concept-imagebitmaprenderingcontext-output-bitmap-8>output bitmap</a>.</p>
     </li></ol>

   </li></ol>

  <hr>

  <p>The <dfn id=imagebitmaprenderingcontext-creation-algorithm><code>ImageBitmapRenderingContext</code> creation algorithm</dfn>, which is passed a
  <var>target</var> (a <code id=the-imagebitmaprenderingcontext-interface:the-canvas-element-9><a href=#the-canvas-element>canvas</a></code> element) and optionally some arguments, consists of
  running the following steps:</p>

  <ol><li><p>If the algorithm was passed some arguments, then let <var>arg</var> be the first such
   argument. Otherwise, let <var>arg</var> be undefined.</li><li><p>Let <var>settings</var> be the result of <a href=#coerce-context-arguments-for-imagebitmaprenderingcontext id=the-imagebitmaprenderingcontext-interface:coerce-context-arguments-for-imagebitmaprenderingcontext>coercing the <var>arg</var> context arguments for
   <code>ImageBitmapRenderingContext</code></a>.</li><li><p>Create a new <code id=the-imagebitmaprenderingcontext-interface:imagebitmaprenderingcontext-8><a href=#imagebitmaprenderingcontext>ImageBitmapRenderingContext</a></code> object.</li><li><p>Initialize its <code id=the-imagebitmaprenderingcontext-interface:dom-context-2d-canvas><a href=#dom-context-2d-canvas>canvas</a></code> attribute to point to
   <var>target</var>.</li><li><p>Let the new <code id=the-imagebitmaprenderingcontext-interface:imagebitmaprenderingcontext-9><a href=#imagebitmaprenderingcontext>ImageBitmapRenderingContext</a></code> object's <a href=#concept-imagebitmaprenderingcontext-output-bitmap id=the-imagebitmaprenderingcontext-interface:concept-imagebitmaprenderingcontext-output-bitmap-9>output bitmap</a> and
   <var>target</var>'s bitmap be a shared reference to the same bitmap.</li><li><p>Run the steps to <a href="#set-an-imagebitmaprenderingcontext's-output-bitmap" id="the-imagebitmaprenderingcontext-interface:set-an-imagebitmaprenderingcontext's-output-bitmap">set an <code>ImageBitmapRenderingContext</code>'s output
   bitmap</a>, using the new <code id=the-imagebitmaprenderingcontext-interface:imagebitmaprenderingcontext-10><a href=#imagebitmaprenderingcontext>ImageBitmapRenderingContext</a></code> object as the
   <var>context</var> argument, and with no <var>bitmap</var> argument.</li><li><p>Initialize <var>context</var>'s <a href=#concept-imagebitmaprenderingcontext-alpha id=the-imagebitmaprenderingcontext-interface:concept-imagebitmaprenderingcontext-alpha-3>alpha</a> flag to true.

   

   </li><li>

    <p>Process each of the members of <var>settings</var> as follows:</p>

    <dl><dt><dfn id=dom-imagebitmaprenderingcontextsettings-alpha><code>alpha</code></dfn><dd>If false, then set <var>context</var>'s <a href=#concept-imagebitmaprenderingcontext-alpha id=the-imagebitmaprenderingcontext-interface:concept-imagebitmaprenderingcontext-alpha-4>alpha</a> flag to false.</dl>

   </li><li><p>Return the new <code id=the-imagebitmaprenderingcontext-interface:imagebitmaprenderingcontext-11><a href=#imagebitmaprenderingcontext>ImageBitmapRenderingContext</a></code> object.</li></ol>

  <hr>

  <p>When a user agent is required to <dfn id=coerce-context-arguments-for-imagebitmaprenderingcontext>coerce context arguments for
  <code>ImageBitmapRenderingContext</code></dfn>, it must run these steps:</p>

  <ol><li><p>Let <var>input</var> be the argument to coerce.</li><li><p>Let <var>jsval</var> be the result of <a href=https://triple-underscore.github.io/WebIDL-ja.html#es-type-mapping id=the-imagebitmaprenderingcontext-interface:concept-idl-convert data-x-internal=concept-idl-convert>converting</a> <var>input</var> to a JavaScript value. If this
   throws an exception, then propagate the exception and abort these steps.</li><li><p>Let <var>dict</var> be the result of <a href=https://triple-underscore.github.io/WebIDL-ja.html#es-type-mapping id=the-imagebitmaprenderingcontext-interface:concept-idl-convert-2 data-x-internal=concept-idl-convert>converting</a>
   <var>jsval</var> to the dictionary type <code id=the-imagebitmaprenderingcontext-interface:imagebitmaprenderingcontextsettings><a href=#imagebitmaprenderingcontextsettings>ImageBitmapRenderingContextSettings</a></code>. If
   this throws an exception, then propagate the exception and abort these steps.</li><li><p>Return <var>dict</var>.</li></ol>

  <hr>

  <p>The <dfn id=dom-imagebitmaprenderingcontext-transferfromimagebitmap><code>transferFromImageBitmap(<var>imageBitmap</var>)</code></dfn>
  method, when invoked, must run these steps:</p>

  <ol><li><p>Let <var>bitmapContext</var> be the <code id=the-imagebitmaprenderingcontext-interface:imagebitmaprenderingcontext-12><a href=#imagebitmaprenderingcontext>ImageBitmapRenderingContext</a></code> object on
   which the <code id=the-imagebitmaprenderingcontext-interface:dom-imagebitmaprenderingcontext-transferfromimagebitmap-5><a href=#dom-imagebitmaprenderingcontext-transferfromimagebitmap>transferFromImageBitmap()</a></code>
   method was called.</li><li><p>If <var>imageBitmap</var> is null, then run the steps to <a href="#set-an-imagebitmaprenderingcontext's-output-bitmap" id="the-imagebitmaprenderingcontext-interface:set-an-imagebitmaprenderingcontext's-output-bitmap-2">set an
   ImageBitmapRenderingContext's output bitmap</a>, with <var>bitmapContext</var> as the
   <var>context</var> argument and no <var>bitmap</var> argument, then abort these steps.</li><li><p>If the value of <var>imageBitmap</var>'s <a id=the-imagebitmaprenderingcontext-interface:detached href=infrastructure.html#detached>[[Detached]]</a> internal slot is set to
   true, then throw an <a id=the-imagebitmaprenderingcontext-interface:invalidstateerror href=https://triple-underscore.github.io/WebIDL-ja.html#invalidstateerror data-x-internal=invalidstateerror>"<code>InvalidStateError</code>"</a> <code id=the-imagebitmaprenderingcontext-interface:domexception><a data-x-internal=domexception href=https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException>DOMException</a></code> and
   abort these steps.</li><li><p>Run the steps to <a href="#set-an-imagebitmaprenderingcontext's-output-bitmap" id="the-imagebitmaprenderingcontext-interface:set-an-imagebitmaprenderingcontext's-output-bitmap-3">set an <code>ImageBitmapRenderingContext</code>'s output
   bitmap</a>, with the <var>context</var> argument equal to <var>bitmapContext</var>, and the
   <var>bitmap</var> argument referring to <var>imageBitmap</var>'s underlying <a href=webappapis.html#concept-imagebitmap-bitmap-data id=the-imagebitmaprenderingcontext-interface:concept-imagebitmap-bitmap-data-5>bitmap data</a>.

   

   </li><li><p>Set the value of <var>imageBitmap</var>'s <a id=the-imagebitmaprenderingcontext-interface:detached-2 href=infrastructure.html#detached>[[Detached]]</a> internal slot to
   true.</li><li><p>Unset <var>imageBitmap's</var> <a href=webappapis.html#concept-imagebitmap-bitmap-data id=the-imagebitmaprenderingcontext-interface:concept-imagebitmap-bitmap-data-6>bitmap
   data</a>.</li></ol>

  




  <h5 id=the-offscreencanvas-interface>4.12.5.3 The <code id=the-offscreencanvas-interface:offscreencanvas><a href=#offscreencanvas>OffscreenCanvas</a></code> interface<a href=#the-offscreencanvas-interface class=self-link></a></h5>

  <pre class=idl>typedef (<a href=#offscreencanvasrenderingcontext2d id=the-offscreencanvas-interface:offscreencanvasrenderingcontext2d>OffscreenCanvasRenderingContext2D</a> or
        <a id=the-offscreencanvas-interface:webglrenderingcontext href=https://www.khronos.org/registry/webgl/specs/latest/1.0/#WebGLRenderingContext data-x-internal=webglrenderingcontext>WebGLRenderingContext</a>) <dfn id=offscreenrenderingcontext>OffscreenRenderingContext</dfn>;

dictionary <dfn id=imageencodeoptions>ImageEncodeOptions</dfn> {
  DOMString <a href=#image-encode-options-type id=the-offscreencanvas-interface:image-encode-options-type>type</a> = "image/png";
  unrestricted double <a href=#image-encode-options-quality id=the-offscreencanvas-interface:image-encode-options-quality>quality</a> = 1.0;
};

enum <dfn id=offscreenrenderingcontexttype>OffscreenRenderingContextType</dfn> { "<a href=#offscreen-context-type-2d id=the-offscreencanvas-interface:offscreen-context-type-2d>2d</a>", "<a href=#offscreen-context-type-webgl id=the-offscreencanvas-interface:offscreen-context-type-webgl>webgl</a>" };

[<a href=#dom-offscreencanvas id=the-offscreencanvas-interface:dom-offscreencanvas>Constructor</a>([EnforceRange] unsigned long long width, [EnforceRange] unsigned long long height), Exposed=(Window,Worker), <a id=the-offscreencanvas-interface:transferable href=infrastructure.html#transferable>Transferable</a>]
interface <dfn id=offscreencanvas>OffscreenCanvas</dfn> : <a id=the-offscreencanvas-interface:eventtarget href=https://triple-underscore.github.io/DOM4-ja.html#interface-eventtarget data-x-internal=eventtarget>EventTarget</a> {
  attribute unsigned long long <a href=#dom-offscreencanvas-width id=the-offscreencanvas-interface:dom-offscreencanvas-width>width</a>;
  attribute unsigned long long <a href=#dom-offscreencanvas-height id=the-offscreencanvas-interface:dom-offscreencanvas-height>height</a>;

  <a href=#offscreenrenderingcontext id=the-offscreencanvas-interface:offscreenrenderingcontext>OffscreenRenderingContext</a>? <a href=#dom-offscreencanvas-getcontext id=the-offscreencanvas-interface:dom-offscreencanvas-getcontext>getContext</a>(<a href=#offscreenrenderingcontexttype id=the-offscreencanvas-interface:offscreenrenderingcontexttype>OffscreenRenderingContextType</a> contextType, any... arguments);
  <a id=the-offscreencanvas-interface:imagebitmap href=webappapis.html#imagebitmap>ImageBitmap</a> <a href=#dom-offscreencanvas-transfertoimagebitmap id=the-offscreencanvas-interface:dom-offscreencanvas-transfertoimagebitmap>transferToImageBitmap</a>();
  Promise&lt;<a id=the-offscreencanvas-interface:blob href=https://triple-underscore.github.io/File_API-ja.html#blob data-x-internal=blob>Blob</a>&gt; <a href=#dom-offscreencanvas-converttoblob id=the-offscreencanvas-interface:dom-offscreencanvas-converttoblob>convertToBlob</a>(optional <a href=#imageencodeoptions id=the-offscreencanvas-interface:imageencodeoptions>ImageEncodeOptions</a> options);
};
</pre>

  <p><code id=the-offscreencanvas-interface:offscreencanvas-2><a href=#offscreencanvas>OffscreenCanvas</a></code> objects are used to create rendering contexts, much like an
  <code id=the-offscreencanvas-interface:htmlcanvaselement><a href=#htmlcanvaselement>HTMLCanvasElement</a></code>, but with no connection to the DOM. This makes it possible to
  use canvas rendering contexts in <a href=workers.html#workers>workers</a>.</p>

  <p>An <code id=the-offscreencanvas-interface:offscreencanvas-3><a href=#offscreencanvas>OffscreenCanvas</a></code> object may hold a weak reference to a <dfn id=offscreencanvas-placeholder>placeholder <code>canvas</code> element</dfn>, which is
  typically in the DOM, whose embedded content is provided by the <code id=the-offscreencanvas-interface:offscreencanvas-4><a href=#offscreencanvas>OffscreenCanvas</a></code>
  object. The bitmap of the <code id=the-offscreencanvas-interface:offscreencanvas-5><a href=#offscreencanvas>OffscreenCanvas</a></code> object is pushed to the <a href=#offscreencanvas-placeholder id=the-offscreencanvas-interface:offscreencanvas-placeholder>placeholder <code>canvas</code> element</a> by
  calling the <dfn id=offscreencontext-commit><code>commit()</code></dfn> method of the
  <code id=the-offscreencanvas-interface:offscreencanvas-6><a href=#offscreencanvas>OffscreenCanvas</a></code> object's rendering context. All rendering context types that
  can be created by an <code id=the-offscreencanvas-interface:offscreencanvas-7><a href=#offscreencanvas>OffscreenCanvas</a></code> object must implement a <code id=the-offscreencanvas-interface:offscreencontext-commit><a href=#offscreencontext-commit>commit()</a></code> method. The exact behavior of the commit
  method (e.g. whether it copies or transfers bitmaps) may vary, as defined by the rendering
  contexts' respective specifications. Only the <a href=#offscreencanvasrenderingcontext2d id=the-offscreencanvas-interface:offscreencanvasrenderingcontext2d-2>2D context for offscreen canvases</a> is defined
  in this specification.</p>

  <dl class=domintro><dt><var>offscreenCanvas</var> = new <code id=the-offscreencanvas-interface:dom-offscreencanvas-2><a href=#dom-offscreencanvas>OffscreenCanvas</a></code>(<var>width</var>,
   <var>height</var>)<dt>

   <dd>

    <p>Returns a new <code id=the-offscreencanvas-interface:offscreencanvas-8><a href=#offscreencanvas>OffscreenCanvas</a></code> object that is not linked to a <a href=#offscreencanvas-placeholder id=the-offscreencanvas-interface:offscreencanvas-placeholder-2>placeholder <code>canvas</code> element</a>, and
    whose bitmap's size is determined by the <var>width</var> and <var>height</var> arguments.</p>

   <dt><var>context</var> = <var>offscreenCanvas</var> . <code id=the-offscreencanvas-interface:dom-offscreencanvas-getcontext-2><a href=#dom-offscreencanvas-getcontext>getContext</a></code>(<var>contextType</var> [, ... ] )<dd>

    <p>Returns an object that exposes an API for drawing on the <code id=the-offscreencanvas-interface:offscreencanvas-9><a href=#offscreencanvas>OffscreenCanvas</a></code> object. The first argument specifies the desired API, either "<code id=the-offscreencanvas-interface:offscreen-context-type-2d-2><a href=#offscreen-context-type-2d>2d</a></code>", or "<code id=the-offscreencanvas-interface:offscreen-context-type-webgl-2><a href=#offscreen-context-type-webgl>webgl</a></code>". 後続の引数は、そのAPIによって処理される。</p>

    <p>This specification defines the "<code id=the-offscreencanvas-interface:canvas-context-2d><a href=#canvas-context-2d>2d</a></code>" context below,
    which is similar but distinct from the "<code id=the-offscreencanvas-interface:offscreen-context-type-2d-3><a href=#offscreen-context-type-2d>2d</a></code>"
    context that is created from a <code id=the-offscreencanvas-interface:the-canvas-element><a href=#the-canvas-element>canvas</a></code> element. There is also a specification that
    defines a "<code id=the-offscreencanvas-interface:offscreen-context-type-webgl-3><a href=#offscreen-context-type-webgl>webgl</a></code>" context.
    <a href=references.html#refsWEBGL>[WEBGL]</a></p>

    <p>Returns null if the canvas has already been initialized with another context type (e.g.
    trying to get a "<code id=the-offscreencanvas-interface:offscreen-context-type-2d-4><a href=#offscreen-context-type-2d>2d</a></code>" context after getting a
    "<code id=the-offscreencanvas-interface:offscreen-context-type-webgl-4><a href=#offscreen-context-type-webgl>webgl</a></code>" context).</p>

   </dl>

  

  <p>An <code id=the-offscreencanvas-interface:offscreencanvas-10><a href=#offscreencanvas>OffscreenCanvas</a></code> object has an internal <dfn id=offscreencanvas-bitmap>bitmap</dfn> that is initialized when the object
  is created. The width and height of the <a href=#offscreencanvas-bitmap id=the-offscreencanvas-interface:offscreencanvas-bitmap>bitmap</a> are
  equal to the values of the <code id=the-offscreencanvas-interface:dom-offscreencanvas-width-2><a href=#dom-offscreencanvas-width>width</a></code> and <code id=the-offscreencanvas-interface:dom-offscreencanvas-height-2><a href=#dom-offscreencanvas-height>height</a></code> attributes of the <code id=the-offscreencanvas-interface:offscreencanvas-11><a href=#offscreencanvas>OffscreenCanvas</a></code>
  object. Initially, all the bitmap's pixels are transparent black.</p>

  <p>An <code id=the-offscreencanvas-interface:offscreencanvas-12><a href=#offscreencanvas>OffscreenCanvas</a></code> object can have a rendering context bound to it. Initially,
  it does not have a bound rendering context. To keep track of whether it has a rendering context
  or not, and what kind of rendering context it is, an <code id=the-offscreencanvas-interface:offscreencanvas-13><a href=#offscreencanvas>OffscreenCanvas</a></code> object also
  has a <dfn id=offscreencanvas-context-mode>context mode</dfn>, which is initially <dfn id=offscreencanvas-context-none>none</dfn> but can be changed to either <dfn id=offscreencanvas-context-2d>2d</dfn>, <dfn id=offscreencanvas-context-webgl>webgl</dfn> or <dfn id=offscreencanvas-context-detached>detached</dfn> by algorithms defined in this
  specification.</p>

  <p>The constructor <dfn id=dom-offscreencanvas><code>OffscreenCanvas(<var>width</var>,
  <var>height</var>)</code></dfn>, when invoked, must create a new <code id=the-offscreencanvas-interface:offscreencanvas-14><a href=#offscreencanvas>OffscreenCanvas</a></code>
  object with its <a href=#offscreencanvas-bitmap id=the-offscreencanvas-interface:offscreencanvas-bitmap-2>bitmap</a> initialized to a rectangular
  array of transparent black pixels of the dimensions specified by <var>width</var> and
  <var>height</var>; and its <code id=the-offscreencanvas-interface:dom-offscreencanvas-width-3><a href=#dom-offscreencanvas-width>width</a></code> and <code id=the-offscreencanvas-interface:dom-offscreencanvas-height-3><a href=#dom-offscreencanvas-height>height</a></code> attributes initialized to <var>width</var> and
  <var>height</var> respectively.</p>

  <hr>

  <p><code id=the-offscreencanvas-interface:offscreencanvas-15><a href=#offscreencanvas>OffscreenCanvas</a></code> objects are <a href=infrastructure.html#transferable-objects id=the-offscreencanvas-interface:transferable-objects>transferable</a>. Their <a id=the-offscreencanvas-interface:transfer-steps href=infrastructure.html#transfer-steps>transfer steps</a>, given <var>value</var> and
  <var>dataHolder</var>, are as follows:</p>

  <ol><li><p>If <var>value</var>'s <a href=#offscreencanvas-context-mode id=the-offscreencanvas-interface:offscreencanvas-context-mode>context mode</a> is
   not equal to <a href=#offscreencanvas-context-none id=the-offscreencanvas-interface:offscreencanvas-context-none>none</a>, then throw an
   <a id=the-offscreencanvas-interface:invalidstateerror href=https://triple-underscore.github.io/WebIDL-ja.html#invalidstateerror data-x-internal=invalidstateerror>"<code>InvalidStateError</code>"</a> <code id=the-offscreencanvas-interface:domexception><a data-x-internal=domexception href=https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException>DOMException</a></code>.</li><li><p>Set <var>value</var>'s <a href=#offscreencanvas-context-mode id=the-offscreencanvas-interface:offscreencanvas-context-mode-2>context mode</a> to
   <a href=#offscreencanvas-context-detached id=the-offscreencanvas-interface:offscreencanvas-context-detached>detached</a>.</li><li><p>Let <var>width</var> and <var>height</var> be the dimensions of <var>value</var>'s <a href=#offscreencanvas-bitmap id=the-offscreencanvas-interface:offscreencanvas-bitmap-3>bitmap</a>.</li><li><p>Unset <var>value</var>'s <a href=#offscreencanvas-bitmap id=the-offscreencanvas-interface:offscreencanvas-bitmap-4>bitmap</a>.</li><li><p>Set <var>dataHolder</var>.[[With]] to <var>width</var>, and
   <var>dataHolder</var>.[[Height]] to <var>height</var>.</li><li><p>Set <var>dataHolder</var>.[[PlaceholderCanvas]] to be a weak reference to
   <var>value</var>'s <a href=#offscreencanvas-placeholder id=the-offscreencanvas-interface:offscreencanvas-placeholder-3>placeholder <code>canvas</code>
   element</a>, if <var>value</var> has one, or null if it does not.</li></ol>

  <p>Their <a id=the-offscreencanvas-interface:transfer-receiving-steps href=infrastructure.html#transfer-receiving-steps>transfer-receiving steps</a>, given <var>dataHolder</var> and <var>value</var>,
  are:</p>

  <ol><li><p>Initialize <var>value</var>'s <a href=#offscreencanvas-bitmap id=the-offscreencanvas-interface:offscreencanvas-bitmap-5>bitmap</a> to a
   rectangular array of transparent black pixels with width given by <var>dataHolder</var>.[[Width]]
   and height given by <var>dataHolder</var>.[[Height]].</li><li><p>If <var>dataHolder</var>.[[PlaceholderCanvas]] is not null, set <var>value</var>'s <a href=#offscreencanvas-placeholder id=the-offscreencanvas-interface:offscreencanvas-placeholder-4>placeholder <code>canvas</code> element</a> to
   <var>dataHolder</var>.[[PlaceholderCanvas]] (while maintaining the weak reference
   semantics).</li></ol>

  <hr>

  <p>The <dfn id=dom-offscreencanvas-getcontext><code>getContext(<var>contextId</var>,
  <var>arguments...</var>)</code></dfn> method of an <code id=the-offscreencanvas-interface:offscreencanvas-16><a href=#offscreencanvas>OffscreenCanvas</a></code> object, when
  invoked, must run the steps in the cell of the following table whose column header describes the
  <code id=the-offscreencanvas-interface:offscreencanvas-17><a href=#offscreencanvas>OffscreenCanvas</a></code> object's <a href=#offscreencanvas-context-mode id=the-offscreencanvas-interface:offscreencanvas-context-mode-3>context
  mode</a> and whose row header describes the method's first argument.</p>

  <table><thead><tr><td>
     <th><a href=#offscreencanvas-context-none id=the-offscreencanvas-interface:offscreencanvas-context-none-2>none</a>
     </th><th><a href=#offscreencanvas-context-2d id=the-offscreencanvas-interface:offscreencanvas-context-2d>2d</a>
     </th><th><a href=#offscreencanvas-context-webgl id=the-offscreencanvas-interface:offscreencanvas-context-webgl>webgl</a>
     </th><th><a href=#offscreencanvas-context-detached id=the-offscreencanvas-interface:offscreencanvas-context-detached-2>detached</a>
   <tbody></th></td></tr><tr><th>"<dfn id=offscreen-context-type-2d><code>2d</code></dfn>"
     
     <td>
      
      Follow the steps to <a href=#offscreen-2d-context-creation-algorithm id=the-offscreencanvas-interface:offscreen-2d-context-creation-algorithm>create an
      offscreen 2D context</a> defined in the section below, passing it the
      <code id=the-offscreencanvas-interface:offscreencanvas-18><a href=#offscreencanvas>OffscreenCanvas</a></code> object and the method's <var>arguments...</var>, to obtain
      an <code id=the-offscreencanvas-interface:offscreencanvasrenderingcontext2d-3><a href=#offscreencanvasrenderingcontext2d>OffscreenCanvasRenderingContext2D</a></code> object; if this does not throw an
      exception, then set the <code id=the-offscreencanvas-interface:offscreencanvas-19><a href=#offscreencanvas>OffscreenCanvas</a></code> object's <a href=#offscreencanvas-context-mode id=the-offscreencanvas-interface:offscreencanvas-context-mode-4>context mode</a> to <a href=#offscreencanvas-context-2d id=the-offscreencanvas-interface:offscreencanvas-context-2d-2>2d</a>, and return the new
      <code id=the-offscreencanvas-interface:offscreencanvasrenderingcontext2d-4><a href=#offscreencanvasrenderingcontext2d>OffscreenCanvasRenderingContext2D</a></code> object.
     
     </td><td>
      
      Return the same object as was returned the last time the method was invoked with this same
      first argument.
     
     </td><td>
      
      Return null.
     
     </td><td>
      
      Throw an <a id=the-offscreencanvas-interface:invalidstateerror-2 href=https://triple-underscore.github.io/WebIDL-ja.html#invalidstateerror data-x-internal=invalidstateerror>"<code>InvalidStateError</code>"</a> <code id=the-offscreencanvas-interface:domexception-2><a data-x-internal=domexception href=https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException>DOMException</a></code>.

    

    </td></th></tr><tr><th>"<dfn id=offscreen-context-type-webgl><code>webgl</code></dfn>"
     
     <td>
      
      Follow the instructions given in the WebGL specification's <i>Context Creation</i> section to
      obtain either a <code id=the-offscreencanvas-interface:webglrenderingcontext-2><a data-x-internal=webglrenderingcontext href=https://www.khronos.org/registry/webgl/specs/latest/1.0/#WebGLRenderingContext>WebGLRenderingContext</a></code> or null; if the returned value is null,
      then return null and abort these steps, otherwise, set the <code id=the-offscreencanvas-interface:offscreencanvas-20><a href=#offscreencanvas>OffscreenCanvas</a></code>
      object's <a href=#offscreencanvas-context-mode id=the-offscreencanvas-interface:offscreencanvas-context-mode-5>context mode</a> to <a href=#offscreencanvas-context-webgl id=the-offscreencanvas-interface:offscreencanvas-context-webgl-2>webgl</a>, and return the
      <code id=the-offscreencanvas-interface:webglrenderingcontext-3><a data-x-internal=webglrenderingcontext href=https://www.khronos.org/registry/webgl/specs/latest/1.0/#WebGLRenderingContext>WebGLRenderingContext</a></code> object. <a href=references.html#refsWEBGL>[WEBGL]</a>
     </td><td>
      
      Return null.
     
     </td><td>
      
      Return the same value as was returned the last time the method was invoked with this same
      first argument.
     
     </td><td>
      
      Throw an <a id=the-offscreencanvas-interface:invalidstateerror-3 href=https://triple-underscore.github.io/WebIDL-ja.html#invalidstateerror data-x-internal=invalidstateerror>"<code>InvalidStateError</code>"</a> <code id=the-offscreencanvas-interface:domexception-3><a data-x-internal=domexception href=https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException>DOMException</a></code>.

  

  </td></th></tr></table>

  <hr>

  

  <dl class=domintro><dt><var>offscreenCanvas</var> . <code id=the-offscreencanvas-interface:dom-offscreencanvas-width-4><a href=#dom-offscreencanvas-width>width</a></code> [
   = <var>value</var> ]<dt><var>offscreenCanvas</var> . <code id=the-offscreencanvas-interface:dom-offscreencanvas-height-4><a href=#dom-offscreencanvas-height>height</a></code> [
   = <var>value</var> ]<dd>
    <p>These attributes return the dimensions of the <code id=the-offscreencanvas-interface:offscreencanvas-21><a href=#offscreencanvas>OffscreenCanvas</a></code> object's <a href=#offscreencanvas-bitmap id=the-offscreencanvas-interface:offscreencanvas-bitmap-6>bitmap</a>.</p>

    <p>They can be set, to replace the <a href=#offscreencanvas-bitmap id=the-offscreencanvas-interface:offscreencanvas-bitmap-7>bitmap</a> with a
    new, transparent black bitmap of the specified dimensions (effectively resizing it).</p>
   </dl>

  

  <p>If either the <dfn id=dom-offscreencanvas-width><code>width</code></dfn> or <dfn id=dom-offscreencanvas-height><code>height</code></dfn> attributes of an
  <code id=the-offscreencanvas-interface:offscreencanvas-22><a href=#offscreencanvas>OffscreenCanvas</a></code> object are set (to a new value or to the same value as before) and
  the <code id=the-offscreencanvas-interface:offscreencanvas-23><a href=#offscreencanvas>OffscreenCanvas</a></code> object's <a href=#offscreencanvas-context-mode id=the-offscreencanvas-interface:offscreencanvas-context-mode-6>context
  mode</a> is <a href=#offscreencanvas-context-2d id=the-offscreencanvas-interface:offscreencanvas-context-2d-3>2d</a>, then replace the
  <code id=the-offscreencanvas-interface:offscreencanvas-24><a href=#offscreencanvas>OffscreenCanvas</a></code> object's <a href=#offscreencanvas-bitmap id=the-offscreencanvas-interface:offscreencanvas-bitmap-8>bitmap</a> with a
  new transparent black bitmap and <a href=#reset-the-rendering-context-to-its-default-state id=the-offscreencanvas-interface:reset-the-rendering-context-to-its-default-state>reset the rendering context to its default state</a>.
  The new bitmap's dimensions are equal to the new values of the <code id=the-offscreencanvas-interface:dom-offscreencanvas-width-5><a href=#dom-offscreencanvas-width>width</a></code> and <code id=the-offscreencanvas-interface:dom-offscreencanvas-height-5><a href=#dom-offscreencanvas-height>height</a></code> attributes.</p>

  <p>The resizing behavior for "<code id=the-offscreencanvas-interface:offscreen-context-type-webgl-5><a href=#offscreen-context-type-webgl>webgl</a></code>"
  contexts is defined in the WebGL specification. <a href=references.html#refsWEBGL>[WEBGL]</a></p>

  

  <p class=note>If an <code id=the-offscreencanvas-interface:offscreencanvas-25><a href=#offscreencanvas>OffscreenCanvas</a></code> object whose dimensions were changed has
  a <a href=#offscreencanvas-placeholder id=the-offscreencanvas-interface:offscreencanvas-placeholder-5>placeholder <code>canvas</code> element</a>, then
  the <a href=#offscreencanvas-placeholder id=the-offscreencanvas-interface:offscreencanvas-placeholder-6>placeholder <code>canvas</code> element</a>'s
  <a href=https://momdo.github.io/css2/conform.html#intrinsic id=the-offscreencanvas-interface:intrinsic-dimensions data-x-internal=intrinsic-dimensions>intrinsic size</a> will only be updated via the <code id=the-offscreencanvas-interface:offscreencontext-commit-2><a href=#offscreencontext-commit>commit()</a></code> method of the <code id=the-offscreencanvas-interface:offscreencanvas-26><a href=#offscreencanvas>OffscreenCanvas</a></code>
  object's rendering context.</p>

  <dl class=domintro><dt><var>promise</var> = <var>offscreenCanvas</var> . <code id=the-offscreencanvas-interface:dom-offscreencanvas-converttoblob-2><a href=#dom-offscreencanvas-converttoblob>convertToBlob</a></code>( [<var>options</var>] )<dd>
    <p>Returns a promise that will fulfill with a new <code id=the-offscreencanvas-interface:blob-2><a data-x-internal=blob href=https://triple-underscore.github.io/File_API-ja.html#blob>Blob</a></code> object representing a file
    containing the image in the <code id=the-offscreencanvas-interface:offscreencanvas-27><a href=#offscreencanvas>OffscreenCanvas</a></code> object.</p>

    <p>The argument, if provided, is a dictionary that controls the encoding options of the image
    file to be created. The <code id=the-offscreencanvas-interface:image-encode-options-type-2><a href=#image-encode-options-type>type</a></code>
    field specifies the file format and has a default value of "<code id=the-offscreencanvas-interface:image/png><a href=indices.html#image/png>image/png</a></code>"; that type
    is also used if the requested type isn't supported. If the image format supports variable
    quality (such as "<code id=the-offscreencanvas-interface:image/jpeg><a href=indices.html#image/jpeg>image/jpeg</a></code>"), then the <code id=the-offscreencanvas-interface:image-encode-options-quality-2><a href=#image-encode-options-quality>quality</a></code> field is a number in the range 0.0
    to 1.0 inclusive indicating the desired quality level for the resulting image.</p>
   <dt><var>canvas</var> . <code id=the-offscreencanvas-interface:dom-offscreencanvas-transfertoimagebitmap-2><a href=#dom-offscreencanvas-transfertoimagebitmap>transferToImageBitmap</a></code>()<dd>
    <p>Returns a newly created <code id=the-offscreencanvas-interface:imagebitmap-2><a href=webappapis.html#imagebitmap>ImageBitmap</a></code> object with the image in the
    <code id=the-offscreencanvas-interface:offscreencanvas-28><a href=#offscreencanvas>OffscreenCanvas</a></code> object. The image in the <code id=the-offscreencanvas-interface:offscreencanvas-29><a href=#offscreencanvas>OffscreenCanvas</a></code> object is
    replaced with a new blank image.</p>
   </dl>

  

  <p>The <dfn id=dom-offscreencanvas-converttoblob><code>convertToBlob(<var>options</var>)</code></dfn> method,
  when invoked, must run the following steps:</p>

  <ol><li><p>If the value of this <code id=the-offscreencanvas-interface:offscreencanvas-30><a href=#offscreencanvas>OffscreenCanvas</a></code> object's <a id=the-offscreencanvas-interface:detached href=infrastructure.html#detached>[[Detached]]</a>
   internal slot is set to true, then return a promise rejected with an
   <a id=the-offscreencanvas-interface:invalidstateerror-4 href=https://triple-underscore.github.io/WebIDL-ja.html#invalidstateerror data-x-internal=invalidstateerror>"<code>InvalidStateError</code>"</a> <code id=the-offscreencanvas-interface:domexception-4><a data-x-internal=domexception href=https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException>DOMException</a></code> and abort these
   steps.</li><li><p>If this <code id=the-offscreencanvas-interface:offscreencanvas-31><a href=#offscreencanvas>OffscreenCanvas</a></code> object's <a href=#offscreencanvas-context-mode id=the-offscreencanvas-interface:offscreencanvas-context-mode-7>context mode</a> is <a href=#offscreencanvas-context-2d id=the-offscreencanvas-interface:offscreencanvas-context-2d-4>2d</a> and the rendering context's <a href=#offscreencontext2d-bitmap id=the-offscreencanvas-interface:offscreencontext2d-bitmap>bitmap</a>'s <a href=#offscreencontext2d-origin-clean id=the-offscreencanvas-interface:offscreencontext2d-origin-clean>origin-clean</a> flag is set to false, then return a
   promise rejected with a <a id=the-offscreencanvas-interface:securityerror href=https://triple-underscore.github.io/WebIDL-ja.html#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a> <code id=the-offscreencanvas-interface:domexception-5><a data-x-internal=domexception href=https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException>DOMException</a></code> and
   abort these steps.</p>

   </li><li><p>If this <code id=the-offscreencanvas-interface:offscreencanvas-32><a href=#offscreencanvas>OffscreenCanvas</a></code> object's <a href=#offscreencanvas-bitmap id=the-offscreencanvas-interface:offscreencanvas-bitmap-9>bitmap</a> has no pixels (i.e. either its
   horizontal dimension or its vertical dimension is zero) then return a promise rejected with an
   <a id=the-offscreencanvas-interface:indexsizeerror href=https://triple-underscore.github.io/WebIDL-ja.html#indexsizeerror data-x-internal=indexsizeerror>"<code>IndexSizeError</code>"</a> <code id=the-offscreencanvas-interface:domexception-6><a data-x-internal=domexception href=https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException>DOMException</a></code> and abort these
   steps.</li><li><p>Let <var>result</var> be a new promise object.</li><li><p>Return <var>result</var>, and <a id=the-offscreencanvas-interface:queue-a-task href=webappapis.html#queue-a-task>queue a task</a> to run the remaining steps
   <a id=the-offscreencanvas-interface:in-parallel href=infrastructure.html#in-parallel>in parallel</a>.</li><li><p>Let <var>blob</var> be a <code id=the-offscreencanvas-interface:blob-3><a data-x-internal=blob href=https://triple-underscore.github.io/File_API-ja.html#blob>Blob</a></code> object, created in the <a href=webappapis.html#concept-relevant-realm id=the-offscreencanvas-interface:concept-relevant-realm>relevant Realm</a> of this <code id=the-offscreencanvas-interface:offscreencanvas-33><a href=#offscreencanvas>OffscreenCanvas</a></code>
   object, representing <a href=#a-serialisation-of-the-bitmap-as-a-file id=the-offscreencanvas-interface:a-serialisation-of-the-bitmap-as-a-file>a serialization of
   this <code>OffscreenCanvas</code> object's <span>bitmap</span> as
   a file</a>, passing the values of the <dfn id=image-encode-options-type><code>type</code></dfn> and <dfn id=image-encode-options-quality><code>quality</code></dfn> fields of <var>options</var>, if
   <var>options</var> was specified. <a href=references.html#refsFILEAPI>[FILEAPI]</a></li><li><p>If <var>blob</var> is null, then reject <var>result</var> with an
   <a id=the-offscreencanvas-interface:encodingerror href=https://heycam.github.io/webidl/#encodingerror data-x-internal=encodingerror>"<code>EncodingError</code>"</a> <code id=the-offscreencanvas-interface:domexception-7><a data-x-internal=domexception href=https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException>DOMException</a></code>.</li><li><p>Otherwise, resolve <var>result</var> with <var>blob</var>.</li></ol>

  <p>The <dfn id=dom-offscreencanvas-transfertoimagebitmap><code>transferToImageBitmap()</code></dfn> method,
  when invoked, must run the following steps:</p>
  <ol><li><p>If the value of this <code id=the-offscreencanvas-interface:offscreencanvas-34><a href=#offscreencanvas>OffscreenCanvas</a></code> object's <a id=the-offscreencanvas-interface:detached-2 href=infrastructure.html#detached>[[Detached]]</a>
   internal slot is set to true, then throw an <a id=the-offscreencanvas-interface:invalidstateerror-5 href=https://triple-underscore.github.io/WebIDL-ja.html#invalidstateerror data-x-internal=invalidstateerror>"<code>InvalidStateError</code>"</a>
   <code id=the-offscreencanvas-interface:domexception-8><a data-x-internal=domexception href=https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException>DOMException</a></code> and abort these steps.</li><li><p>If this <code id=the-offscreencanvas-interface:offscreencanvas-35><a href=#offscreencanvas>OffscreenCanvas</a></code> object's <a href=#offscreencanvas-context-mode id=the-offscreencanvas-interface:offscreencanvas-context-mode-8>context mode</a> is set to <a href=#offscreencanvas-context-none id=the-offscreencanvas-interface:offscreencanvas-context-none-3>none</a>, then throw an
   <a id=the-offscreencanvas-interface:invalidstateerror-6 href=https://triple-underscore.github.io/WebIDL-ja.html#invalidstateerror data-x-internal=invalidstateerror>"<code>InvalidStateError</code>"</a> <code id=the-offscreencanvas-interface:domexception-9><a data-x-internal=domexception href=https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException>DOMException</a></code> and abort these
   steps.</li><li><p>Let <var>image</var> be a newly created <code id=the-offscreencanvas-interface:imagebitmap-3><a href=webappapis.html#imagebitmap>ImageBitmap</a></code> object that references
   the same underlying bitmap data as this <code id=the-offscreencanvas-interface:offscreencanvas-36><a href=#offscreencanvas>OffscreenCanvas</a></code> object's <a href=#offscreencanvas-bitmap id=the-offscreencanvas-interface:offscreencanvas-bitmap-10>bitmap</a>.</li><li><p>Set this <code id=the-offscreencanvas-interface:offscreencanvas-37><a href=#offscreencanvas>OffscreenCanvas</a></code> object's <a href=#offscreencanvas-bitmap id=the-offscreencanvas-interface:offscreencanvas-bitmap-11>bitmap</a> to reference a newly created bitmap of the
   same dimensions as the previous bitmap, and with its pixels initialized to transparent black,
   or opaque black if the rendering context's <a href=#offscreencontext2d-alpha id=the-offscreencanvas-interface:offscreencontext2d-alpha>alpha</a> flag is set to false.</li><li><p>Return <var>image</var>.</li></ol>
  

  <h6 id=the-offscreen-2d-rendering-context>4.12.5.3.1 The offscreen 2D rendering context<a href=#the-offscreen-2d-rendering-context class=self-link></a></h6>

  <pre class=idl>[Exposed=(Window,Worker)]
interface <a href=#offscreencanvasrenderingcontext2d id=the-offscreen-2d-rendering-context:offscreencanvasrenderingcontext2d>OffscreenCanvasRenderingContext2D</a> {
  void <a href=#offscreencontext2d-commit id=the-offscreen-2d-rendering-context:offscreencontext2d-commit>commit</a>();
  readonly attribute <a href=#offscreencanvas id=the-offscreen-2d-rendering-context:offscreencanvas>OffscreenCanvas</a> <a href=#offscreencontext2d-canvas id=the-offscreen-2d-rendering-context:offscreencontext2d-canvas>canvas</a>;
};

<a href=#offscreencanvasrenderingcontext2d id=the-offscreen-2d-rendering-context:offscreencanvasrenderingcontext2d-2>OffscreenCanvasRenderingContext2D</a> implements <a href=#canvasstate id=the-offscreen-2d-rendering-context:canvasstate>CanvasState</a>;
<a href=#offscreencanvasrenderingcontext2d id=the-offscreen-2d-rendering-context:offscreencanvasrenderingcontext2d-3>OffscreenCanvasRenderingContext2D</a> implements <a href=#canvastransform id=the-offscreen-2d-rendering-context:canvastransform>CanvasTransform</a>;
<a href=#offscreencanvasrenderingcontext2d id=the-offscreen-2d-rendering-context:offscreencanvasrenderingcontext2d-4>OffscreenCanvasRenderingContext2D</a> implements <a href=#canvascompositing id=the-offscreen-2d-rendering-context:canvascompositing>CanvasCompositing</a>;
<a href=#offscreencanvasrenderingcontext2d id=the-offscreen-2d-rendering-context:offscreencanvasrenderingcontext2d-5>OffscreenCanvasRenderingContext2D</a> implements <a href=#canvasimagesmoothing id=the-offscreen-2d-rendering-context:canvasimagesmoothing>CanvasImageSmoothing</a>;
<a href=#offscreencanvasrenderingcontext2d id=the-offscreen-2d-rendering-context:offscreencanvasrenderingcontext2d-6>OffscreenCanvasRenderingContext2D</a> implements <a href=#canvasfillstrokestyles id=the-offscreen-2d-rendering-context:canvasfillstrokestyles>CanvasFillStrokeStyles</a>;
<a href=#offscreencanvasrenderingcontext2d id=the-offscreen-2d-rendering-context:offscreencanvasrenderingcontext2d-7>OffscreenCanvasRenderingContext2D</a> implements <a href=#canvasshadowstyles id=the-offscreen-2d-rendering-context:canvasshadowstyles>CanvasShadowStyles</a>;
<a href=#offscreencanvasrenderingcontext2d id=the-offscreen-2d-rendering-context:offscreencanvasrenderingcontext2d-8>OffscreenCanvasRenderingContext2D</a> implements <a href=#canvasfilters id=the-offscreen-2d-rendering-context:canvasfilters>CanvasFilters</a>;
<a href=#offscreencanvasrenderingcontext2d id=the-offscreen-2d-rendering-context:offscreencanvasrenderingcontext2d-9>OffscreenCanvasRenderingContext2D</a> implements <a href=#canvasrect id=the-offscreen-2d-rendering-context:canvasrect>CanvasRect</a>;
<a href=#offscreencanvasrenderingcontext2d id=the-offscreen-2d-rendering-context:offscreencanvasrenderingcontext2d-10>OffscreenCanvasRenderingContext2D</a> implements <a href=#canvasdrawpath id=the-offscreen-2d-rendering-context:canvasdrawpath>CanvasDrawPath</a>;
<a href=#offscreencanvasrenderingcontext2d id=the-offscreen-2d-rendering-context:offscreencanvasrenderingcontext2d-11>OffscreenCanvasRenderingContext2D</a> implements <a href=#canvasdrawimage id=the-offscreen-2d-rendering-context:canvasdrawimage>CanvasDrawImage</a>;
<a href=#offscreencanvasrenderingcontext2d id=the-offscreen-2d-rendering-context:offscreencanvasrenderingcontext2d-12>OffscreenCanvasRenderingContext2D</a> implements <a href=#canvasimagedata id=the-offscreen-2d-rendering-context:canvasimagedata>CanvasImageData</a>;
<a href=#offscreencanvasrenderingcontext2d id=the-offscreen-2d-rendering-context:offscreencanvasrenderingcontext2d-13>OffscreenCanvasRenderingContext2D</a> implements <a href=#canvaspathdrawingstyles id=the-offscreen-2d-rendering-context:canvaspathdrawingstyles>CanvasPathDrawingStyles</a>;
<a href=#offscreencanvasrenderingcontext2d id=the-offscreen-2d-rendering-context:offscreencanvasrenderingcontext2d-14>OffscreenCanvasRenderingContext2D</a> implements <a href=#canvaspath id=the-offscreen-2d-rendering-context:canvaspath>CanvasPath</a>;
</pre>

  <p>The <dfn id=offscreencanvasrenderingcontext2d><code>OffscreenCanvasRenderingContext2D</code></dfn> is a rendering context
  interface for drawing to the <a href=#offscreencanvas-bitmap id=the-offscreen-2d-rendering-context:offscreencanvas-bitmap>bitmap</a> of an
  <code id=the-offscreen-2d-rendering-context:offscreencanvas-2><a href=#offscreencanvas>OffscreenCanvas</a></code> object. It is similar to <code id=the-offscreen-2d-rendering-context:canvasrenderingcontext2d><a href=#canvasrenderingcontext2d>CanvasRenderingContext2D</a></code>,
  with the following differences:</p>
  <ul><li><p><a href=#canvastext id=the-offscreen-2d-rendering-context:canvastext>text rendering</a> is not supported;</li><li><p>there is no support for <a href=#canvasuserinterface id=the-offscreen-2d-rendering-context:canvasuserinterface>user interface</a>
   features;</li><li><p>its <code id=the-offscreen-2d-rendering-context:offscreencontext2d-canvas-2><a href=#offscreencontext2d-canvas>canvas</a></code> attribute refers to an
   <code id=the-offscreen-2d-rendering-context:offscreencanvas-3><a href=#offscreencanvas>OffscreenCanvas</a></code> object rather than a <code id=the-offscreen-2d-rendering-context:the-canvas-element><a href=#the-canvas-element>canvas</a></code> element;</li><li><p>it has a <code id=the-offscreen-2d-rendering-context:offscreencontext2d-commit-2><a href=#offscreencontext2d-commit>commit()</a></code> method for pushing the
   rendered image to the context's <code id=the-offscreen-2d-rendering-context:offscreencanvas-4><a href=#offscreencanvas>OffscreenCanvas</a></code> object's <a href=#offscreencanvas-placeholder id=the-offscreen-2d-rendering-context:offscreencanvas-placeholder>placeholder <code>canvas</code> element</a>.</li></ul>

  <p>An <code id=the-offscreen-2d-rendering-context:offscreencanvasrenderingcontext2d-15><a href=#offscreencanvasrenderingcontext2d>OffscreenCanvasRenderingContext2D</a></code> object has a <dfn id=offscreencontext2d-bitmap>bitmap</dfn> that is initialized when the object is
  created.</p>

  <p>The <a href=#offscreencontext2d-bitmap id=the-offscreen-2d-rendering-context:offscreencontext2d-bitmap>bitmap</a> has an <dfn id=offscreencontext2d-origin-clean>origin-clean</dfn> flag, which can be set to true or
  false. Initially, when one of these bitmaps is created, its <a href=#offscreencontext2d-origin-clean id=the-offscreen-2d-rendering-context:offscreencontext2d-origin-clean>origin-clean</a> flag must be set to true.</p>

  <p>An <code id=the-offscreen-2d-rendering-context:offscreencanvasrenderingcontext2d-16><a href=#offscreencanvasrenderingcontext2d>OffscreenCanvasRenderingContext2D</a></code> object also has an <dfn id=offscreencontext2d-alpha>alpha</dfn> flag, which can be set to true or false. Initially,
  when the context is created, its alpha flag must be set to true. When an
  <code id=the-offscreen-2d-rendering-context:offscreencanvasrenderingcontext2d-17><a href=#offscreencanvasrenderingcontext2d>OffscreenCanvasRenderingContext2D</a></code> object has its <a href=#offscreencontext2d-alpha id=the-offscreen-2d-rendering-context:offscreencontext2d-alpha>alpha</a> flag set to false, then its alpha channel must be
  fixed to 1.0 (fully opaque) for all pixels, and attempts to change the alpha component of any pixel
  must be silently ignored.</p>

  <p>An <code id=the-offscreen-2d-rendering-context:offscreencanvasrenderingcontext2d-18><a href=#offscreencanvasrenderingcontext2d>OffscreenCanvasRenderingContext2D</a></code> object has an <dfn id=associated-offscreencanvas-object>associated
  <code>OffscreenCanvas</code> object</dfn>, which is the <code id=the-offscreen-2d-rendering-context:offscreencanvas-5><a href=#offscreencanvas>OffscreenCanvas</a></code> object
  from which the <code id=the-offscreen-2d-rendering-context:offscreencanvasrenderingcontext2d-19><a href=#offscreencanvasrenderingcontext2d>OffscreenCanvasRenderingContext2D</a></code> object was created.

  

  <dl class=domintro><dt><var>offscreenCanvasRenderingContext2D</var> . <code id=the-offscreen-2d-rendering-context:offscreencontext2d-commit-3><a href=#offscreencontext2d-commit>commit</a></code>()<dd>
    <p>Copies the rendering context's <a href=#offscreencontext2d-bitmap id=the-offscreen-2d-rendering-context:offscreencontext2d-bitmap-2>bitmap</a> to
    the bitmap of the <a href=#offscreencanvas-placeholder id=the-offscreen-2d-rendering-context:offscreencanvas-placeholder-2>placeholder <code>canvas</code>
    element</a> of the <a href=#associated-offscreencanvas-object id=the-offscreen-2d-rendering-context:associated-offscreencanvas-object>associated <code>OffscreenCanvas</code> object</a>. The copy
    operation is asynchronous.</p>
   <dt><var>offscreenCanvas</var> = <var>offscreenCanvasRenderingContext2D</var> . <code id=the-offscreen-2d-rendering-context:offscreencontext2d-canvas-3><a href=#offscreencontext2d-canvas>canvas</a></code><dd>
    <p>Returns the <a href=#associated-offscreencanvas-object id=the-offscreen-2d-rendering-context:associated-offscreencanvas-object-2>associated <code>OffscreenCanvas</code> object</a>.</p>
   </dl>

  

  <p>The <dfn id=offscreen-2d-context-creation-algorithm>offscreen 2D context creation algorithm</dfn>, which is passed a
  <var>target</var> (an <code id=the-offscreen-2d-rendering-context:offscreencanvas-6><a href=#offscreencanvas>OffscreenCanvas</a></code> object) and optionally some arguments,
  consists of running the following steps:</p>

  <ol><li><p>If the algorithm was passed some arguments, let <var>arg</var> be the first such
   argument. Otherwise, let <var>arg</var> be undefined.</li><li><p>Let <var>settings</var> be the result of <a href=#coerce-context-arguments-for-2d id=the-offscreen-2d-rendering-context:coerce-context-arguments-for-2d>coercing the <var>arg</var> context arguments
   for 2D</a>.</li><li><p>Let <var>context</var> be a new <code id=the-offscreen-2d-rendering-context:offscreencanvasrenderingcontext2d-20><a href=#offscreencanvasrenderingcontext2d>OffscreenCanvasRenderingContext2D</a></code>
   object.</li><li><p>Set <var>context</var>'s <a href=#associated-offscreencanvas-object id=the-offscreen-2d-rendering-context:associated-offscreencanvas-object-3>associated <code>OffscreenCanvas</code> object</a> to
   <var>target</var>.</li><li><p>Process each of the members of <var>settings</var> as follows:</p>
    <dl><dt><code id=the-offscreen-2d-rendering-context:dom-canvasrenderingcontext2dsettings-alpha><a href=#dom-canvasrenderingcontext2dsettings-alpha>alpha</a></code><dd>If false, set <var>context</var>'s <a href=#offscreencontext2d-alpha id=the-offscreen-2d-rendering-context:offscreencontext2d-alpha-2>alpha</a>
     flag to false.</dl>
   </li><li><p>Set <var>context</var>'s <a href=#offscreencontext2d-bitmap id=the-offscreen-2d-rendering-context:offscreencontext2d-bitmap-3>bitmap</a> to a newly
   created bitmap with the dimensions specified by the <code id=the-offscreen-2d-rendering-context:dom-offscreencanvas-width><a href=#dom-offscreencanvas-width>width</a></code> and <code id=the-offscreen-2d-rendering-context:dom-offscreencanvas-height><a href=#dom-offscreencanvas-height>height</a></code> attributes of <var>target</var>, and set
   <var>target</var>'s bitmap to the same bitmap (so that they are shared).</li><li><p>If <var>context</var>'s <a href=#offscreencontext2d-alpha id=the-offscreen-2d-rendering-context:offscreencontext2d-alpha-3>alpha</a> flag is set
   to true, initialize all the pixels of <var>context</var>'s <a href=#offscreencontext2d-bitmap id=the-offscreen-2d-rendering-context:offscreencontext2d-bitmap-4>bitmap</a> to transparent black. Otherwise, initialize
   the pixels to opaque black.</li><li><p>Return <var>context</var>.</li></ol>

  <p>The <dfn id=offscreencontext2d-commit><code>commit()</code></dfn> method, when invoked,
  must run the following steps:</p>

  <ol><li><p>If this <code id=the-offscreen-2d-rendering-context:offscreencanvasrenderingcontext2d-21><a href=#offscreencanvasrenderingcontext2d>OffscreenCanvasRenderingContext2D</a></code>'s <a href=#associated-offscreencanvas-object id=the-offscreen-2d-rendering-context:associated-offscreencanvas-object-4>associated
    <code>OffscreenCanvas</code> object</a> does not have a <a href=#offscreencanvas-placeholder id=the-offscreen-2d-rendering-context:offscreencanvas-placeholder-3>placeholder <code>canvas</code> element</a>, abort
    these steps.</li><li><p>Let <var>image</var> be a copy of this <code id=the-offscreen-2d-rendering-context:offscreencanvasrenderingcontext2d-22><a href=#offscreencanvasrenderingcontext2d>OffscreenCanvasRenderingContext2D</a></code>'s
    <a href=#offscreencontext2d-bitmap id=the-offscreen-2d-rendering-context:offscreencontext2d-bitmap-5>bitmap</a>, including the value of its <a href=#offscreencontext2d-origin-clean id=the-offscreen-2d-rendering-context:offscreencontext2d-origin-clean-2>origin-clean</a> flag.</li><li>
     <p><a id=the-offscreen-2d-rendering-context:queue-a-task href=webappapis.html#queue-a-task>Queue a task</a> in the <a href=#offscreencanvas-placeholder id=the-offscreen-2d-rendering-context:offscreencanvas-placeholder-4>placeholder <code>canvas</code> element</a>'s
     <a id=the-offscreen-2d-rendering-context:relevant-settings-object href=webappapis.html#relevant-settings-object>relevant settings object</a>'s <a id=the-offscreen-2d-rendering-context:responsible-event-loop href=webappapis.html#responsible-event-loop>responsible event loop</a> (which will be a
     <a id=the-offscreen-2d-rendering-context:browsing-context href=browsers.html#browsing-context>browsing context</a> <a id=the-offscreen-2d-rendering-context:event-loop href=webappapis.html#event-loop>event loop</a>) to set the <a href=#offscreencanvas-placeholder id=the-offscreen-2d-rendering-context:offscreencanvas-placeholder-5>placeholder <code>canvas</code> element</a>'s
     <a href=#output-bitmap id=the-offscreen-2d-rendering-context:output-bitmap>output bitmap</a> to be a reference to <var>image</var>.</p>

     <p class=note>If <var>image</var> has different dimensions than the bitmap previously
     referenced as the <a href=#offscreencanvas-placeholder id=the-offscreen-2d-rendering-context:offscreencanvas-placeholder-6>placeholder <code>canvas</code>
     element</a>'s <a href=#output-bitmap id=the-offscreen-2d-rendering-context:output-bitmap-2>output bitmap</a>, then this task will result in a change in
     the <a href=#offscreencanvas-placeholder id=the-offscreen-2d-rendering-context:offscreencanvas-placeholder-7>placeholder <code>canvas</code>
     element</a>'s <a href=https://momdo.github.io/css2/conform.html#intrinsic id=the-offscreen-2d-rendering-context:intrinsic-dimensions data-x-internal=intrinsic-dimensions>intrinsic size</a>, which can affect
     document layout.</p>
    </li></ol>

  <p class=note>Implementations are encouraged to short-circuit the graphics update steps of
  the <a id=the-offscreen-2d-rendering-context:browsing-context-2 href=browsers.html#browsing-context>browsing context</a> <a id=the-offscreen-2d-rendering-context:event-loop-2 href=webappapis.html#event-loop>event loop</a> for the purposes of updating the
  contents of a <a href=#offscreencanvas-placeholder id=the-offscreen-2d-rendering-context:offscreencanvas-placeholder-8>placeholder <code>canvas</code>
  element</a> to the display. This could mean, for example, that the <code id=the-offscreen-2d-rendering-context:offscreencontext2d-commit-4><a href=#offscreencontext2d-commit>commit()</a></code> method can copy the bitmap contents directly
  to a graphics buffer that is mapped to the physical display location of the <a href=#offscreencanvas-placeholder id=the-offscreen-2d-rendering-context:offscreencanvas-placeholder-9>placeholder <code>canvas</code> element</a>. This or
  similar short-circuiting approaches can significantly reduce display latency, especially in cases
  where the <code id=the-offscreen-2d-rendering-context:offscreencontext2d-commit-5><a href=#offscreencontext2d-commit>commit()</a></code> method is invoked from a worker
  and the <a id=the-offscreen-2d-rendering-context:event-loop-3 href=webappapis.html#event-loop>event loop</a> of the <a href=#offscreencanvas-placeholder id=the-offscreen-2d-rendering-context:offscreencanvas-placeholder-10>placeholder <code>canvas</code> element</a>'s
  <a id=the-offscreen-2d-rendering-context:browsing-context-3 href=browsers.html#browsing-context>browsing context</a> is busy. However, such shortcuts can not have any
  script-observable side-effects. This means that the committed bitmap still needs to be sent to
  the <a href=#offscreencanvas-placeholder id=the-offscreen-2d-rendering-context:offscreencanvas-placeholder-11>placeholder <code>canvas</code> element</a>, in
  case the element is used as a <code id=the-offscreen-2d-rendering-context:canvasimagesource><a href=#canvasimagesource>CanvasImageSource</a></code>, as an
  <code id=the-offscreen-2d-rendering-context:imagebitmapsource><a href=webappapis.html#imagebitmapsource>ImageBitmapSource</a></code>, or in case <code id=the-offscreen-2d-rendering-context:dom-canvas-todataurl><a href=#dom-canvas-todataurl>toDataURL()</a></code>
  or <code id=the-offscreen-2d-rendering-context:dom-canvas-toblob><a href=#dom-canvas-toblob>toBlob()</a></code> are called on it.</p>

  <p>The <dfn id=offscreencontext2d-canvas><code>canvas</code></dfn> attribute, on getting,
  must return this <code id=the-offscreen-2d-rendering-context:offscreencanvasrenderingcontext2d-23><a href=#offscreencanvasrenderingcontext2d>OffscreenCanvasRenderingContext2D</a></code>'s <a href=#associated-offscreencanvas-object id=the-offscreen-2d-rendering-context:associated-offscreencanvas-object-5>associated
  <code>OffscreenCanvas</code> object</a>.

  

  </p>

  

  <h5 id=colour-spaces-and-colour-correction>4.12.5.4 Color spaces and color correction<a href=#colour-spaces-and-colour-correction class=self-link></a></h5>

  <p>The <code id=colour-spaces-and-colour-correction:the-canvas-element><a href=#the-canvas-element>canvas</a></code> APIs must perform color correction at only two points: when rendering
  images with their own gamma correction and color space information onto a bitmap, to convert the
  image to the color space used by the bitmaps (e.g. using the 2D Context's <code id=colour-spaces-and-colour-correction:dom-context-2d-drawimage><a href=#dom-context-2d-drawimage>drawImage()</a></code> method with an
  <code id=colour-spaces-and-colour-correction:htmlorsvgimageelement><a href=#htmlorsvgimageelement>HTMLOrSVGImageElement</a></code> object), and when rendering the actual canvas bitmap to the
  output device.</p>

  <p class=note>Thus, in the 2D context, colors used to draw shapes onto the canvas will exactly
  match colors obtained through the <code id=colour-spaces-and-colour-correction:dom-context-2d-getimagedata><a href=#dom-context-2d-getimagedata>getImageData()</a></code> method.</p>

  <p>The <code id=colour-spaces-and-colour-correction:dom-canvas-todataurl><a href=#dom-canvas-todataurl>toDataURL()</a></code> method, when invoked, must not
  include color space information in the resources they return. Where the output format allows it,
  the color of pixels in resources created by <code id=colour-spaces-and-colour-correction:dom-canvas-todataurl-2><a href=#dom-canvas-todataurl>toDataURL()</a></code>
  must match those returned by the <code id=colour-spaces-and-colour-correction:dom-context-2d-getimagedata-2><a href=#dom-context-2d-getimagedata>getImageData()</a></code>
  method.</p>

  <p>In user agents that support CSS, the color space used by a <code id=colour-spaces-and-colour-correction:the-canvas-element-2><a href=#the-canvas-element>canvas</a></code> element must
  match the color space used for processing any colors for that element in CSS.</p>

  <p>The gamma correction and color space information of images must be handled in such a way that
  an image rendered directly using an <code id=colour-spaces-and-colour-correction:the-img-element><a href=embedded-content.html#the-img-element>img</a></code> element would use the same colors as one
  painted on a <code id=colour-spaces-and-colour-correction:the-canvas-element-3><a href=#the-canvas-element>canvas</a></code> element that is then itself rendered. Furthermore, the rendering
  of images that have no color correction information (such as those returned by the <code id=colour-spaces-and-colour-correction:dom-canvas-todataurl-3><a href=#dom-canvas-todataurl>toDataURL()</a></code> method) must be rendered with no color
  correction.</p>

  <p class=note>Thus, in the 2D context, calling the <code id=colour-spaces-and-colour-correction:dom-context-2d-drawimage-2><a href=#dom-context-2d-drawimage>drawImage()</a></code> method to render the output of the <code id=colour-spaces-and-colour-correction:dom-canvas-todataurl-4><a href=#dom-canvas-todataurl>toDataURL()</a></code> method to the canvas, given the appropriate
  dimensions, has no visible effect.</p>

  



  <h5 id=serialising-bitmaps-to-a-file>4.12.5.5 Serializing bitmaps to a file<a href=#serialising-bitmaps-to-a-file class=self-link></a></h5>

  

  <p>When a user agent is to create <dfn id=a-serialisation-of-the-bitmap-as-a-file>a
  serialization of the bitmap as a file</dfn>, given an optional <var>type</var> and
  <var>quality</var>, it must create an image file in the format given by <var>type</var>, or if
  <var>type</var> was not supplied, in the PNG format. If an error occurs during the creation of
  the image file (e.g. an internal encoder error), then the result of the serialization is null.
  <a href=references.html#refsPNG>[PNG]</a></p>

  <p>The image file's pixel data must be the bitmap's pixel data scaled to one image pixel per
  coordinate space unit, and if the file format used supports encoding resolution metadata, the
  resolution must be given as 96dpi (one image pixel per <a href=https://momdo.github.io/css3-values/#px id="serialising-bitmaps-to-a-file:'px'" data-x-internal="'px'">CSS pixel</a>).</p>

  <p>If <var>type</var> is supplied, then it must be interpreted as a <a href=https://mimesniff.spec.whatwg.org/#mime-type id=serialising-bitmaps-to-a-file:mime-type data-x-internal=mime-type>MIME
  type</a> giving the format to use. If the type has any parameters, then it must be treated as
  not supported.</p>

  <p class=example>For example, the value "<code id=serialising-bitmaps-to-a-file:image/png><a href=indices.html#image/png>image/png</a></code>" would mean to generate a PNG
  image, the value "<code id=serialising-bitmaps-to-a-file:image/jpeg><a href=indices.html#image/jpeg>image/jpeg</a></code>" would mean to generate a JPEG image, and the value
  "<code id=serialising-bitmaps-to-a-file:image/svg+xml><a href=indices.html#image/svg+xml>image/svg+xml</a></code>" would mean to generate an SVG image (which would require that the
  user agent track how the bitmap was generated, an unlikely, though potentially awesome,
  feature).</p>

  <p>User agents must support PNG ("<code id=serialising-bitmaps-to-a-file:image/png-2><a href=indices.html#image/png>image/png</a></code>"). User agents may support other types.
  If the user agent does not support the requested type, then it must create the file using the PNG
  format. <a href=references.html#refsPNG>[PNG]</a></p>

  <p>User agents must <a href=https://infra.spec.whatwg.org/#ascii-lowercase id=serialising-bitmaps-to-a-file:converted-to-ascii-lowercase data-x-internal=converted-to-ascii-lowercase>convert the provided type to ASCII
  lowercase</a> before establishing if they support that type.</p>

  <p>For image types that do not support an alpha channel, the serialized image must be the bitmap
  image composited onto a solid black background using the source-over operator.</p>

  <p>If <var>type</var> is an image format that supports variable quality (such as
  "<code id=serialising-bitmaps-to-a-file:image/jpeg-2><a href=indices.html#image/jpeg>image/jpeg</a></code>") and <var>quality</var> is given, then, if <a href=https://tc39.github.io/ecma262/#sec-ecmascript-data-types-and-values id=serialising-bitmaps-to-a-file:js-type data-x-internal=js-type>Type</a>(<var>quality</var>) is Number, and <var>quality</var> is in the range
  0.0 to 1.0 inclusive, the user agent must treat <var>quality</var> as the desired quality level.
  If <a href=https://tc39.github.io/ecma262/#sec-ecmascript-data-types-and-values id=serialising-bitmaps-to-a-file:js-type-2 data-x-internal=js-type>Type</a>(<var>quality</var>) is not Number, or if <var>quality</var>
  is outside that range, the user agent must use its default quality value, as if the
  <var>quality</var> argument had not been given.</p>

  <p class=note>The use of type-testing here, instead of simply declaring <var>quality</var> as
  a Web IDL <code>double</code>, is a historical artifact.</p>

  


  

  <h5 id=security-with-canvas-elements>4.12.5.6 Security with <code id=security-with-canvas-elements:the-canvas-element><a href=#the-canvas-element>canvas</a></code> elements<a href=#security-with-canvas-elements class=self-link></a></h5>

  <p><i>この節は非規範的である。</i></p>

  <p><strong>Information leakage</strong> can occur if scripts from one <a id=security-with-canvas-elements:concept-origin href=browsers.html#concept-origin>origin</a> can
  access information (e.g. read pixels) from images from another origin (one that isn't the <a href=browsers.html#same-origin id=security-with-canvas-elements:same-origin>same</a>).</p>

  <p>To mitigate this, bitmaps used with <code id=security-with-canvas-elements:the-canvas-element-2><a href=#the-canvas-element>canvas</a></code> elements and <code id=security-with-canvas-elements:imagebitmap><a href=webappapis.html#imagebitmap>ImageBitmap</a></code>
  objects are defined to have a flag indicating whether they are <a href=#concept-canvas-origin-clean id=security-with-canvas-elements:concept-canvas-origin-clean>origin-clean</a>. All bitmaps start with their <a href=#concept-canvas-origin-clean id=security-with-canvas-elements:concept-canvas-origin-clean-2>origin-clean</a> set to true. The flag is set to false
  when cross-origin images are used.</p>

  <p>The <code id=security-with-canvas-elements:dom-canvas-todataurl><a href=#dom-canvas-todataurl>toDataURL()</a></code>, <code id=security-with-canvas-elements:dom-canvas-toblob><a href=#dom-canvas-toblob>toBlob()</a></code>, and <code id=security-with-canvas-elements:dom-context-2d-getimagedata><a href=#dom-context-2d-getimagedata>getImageData()</a></code> methods check the flag and will
  throw a <a id=security-with-canvas-elements:securityerror href=https://triple-underscore.github.io/WebIDL-ja.html#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a> <code id=security-with-canvas-elements:domexception><a data-x-internal=domexception href=https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException>DOMException</a></code> rather than leak
  cross-origin data.</p>

  <p>The value of the <a href=#concept-canvas-origin-clean id=security-with-canvas-elements:concept-canvas-origin-clean-3>origin-clean</a> flag is
  propagated from a source <code id=security-with-canvas-elements:the-canvas-element-3><a href=#the-canvas-element>canvas</a></code> element's bitmap to a new <code id=security-with-canvas-elements:imagebitmap-2><a href=webappapis.html#imagebitmap>ImageBitmap</a></code>
  object by <code id=security-with-canvas-elements:dom-createimagebitmap><a href=webappapis.html#dom-createimagebitmap>createImageBitmap()</a></code>. Conversely, a
  destination <code id=security-with-canvas-elements:the-canvas-element-4><a href=#the-canvas-element>canvas</a></code> element's bitmap will have its <a href=#concept-canvas-origin-clean id=security-with-canvas-elements:concept-canvas-origin-clean-4>origin-clean</a> flags set to false by <code id=security-with-canvas-elements:dom-context-2d-drawimage><a href=#dom-context-2d-drawimage>drawImage</a></code> if the source image is an
  <code id=security-with-canvas-elements:imagebitmap-3><a href=webappapis.html#imagebitmap>ImageBitmap</a></code> object whose bitmap has its <a href=#concept-canvas-origin-clean id=security-with-canvas-elements:concept-canvas-origin-clean-5>origin-clean</a> flag set to false.</p>

  <p>The flag can be reset in certain situations; for example, when changing the value of the
  <code id=security-with-canvas-elements:attr-canvas-width><a href=#attr-canvas-width>width</a></code> or the <code id=security-with-canvas-elements:attr-canvas-height><a href=#attr-canvas-height>height</a></code> content attribute of the <code id=security-with-canvas-elements:the-canvas-element-5><a href=#the-canvas-element>canvas</a></code> element
  to which a <code id=security-with-canvas-elements:canvasrenderingcontext2d><a href=#canvasrenderingcontext2d>CanvasRenderingContext2D</a></code> is bound, the bitmap is
  cleared and its <a href=#concept-canvas-origin-clean id=security-with-canvas-elements:concept-canvas-origin-clean-6>origin-clean</a> flag is reset.</p>

  <p>When using an <code id=security-with-canvas-elements:imagebitmaprenderingcontext><a href=#imagebitmaprenderingcontext>ImageBitmapRenderingContext</a></code>, the value of the <a href=#concept-canvas-origin-clean id=security-with-canvas-elements:concept-canvas-origin-clean-7>origin-clean</a> flag is propagated from
  <code id=security-with-canvas-elements:imagebitmap-4><a href=webappapis.html#imagebitmap>ImageBitmap</a></code> objects when they are transferred to the <code id=security-with-canvas-elements:the-canvas-element-6><a href=#the-canvas-element>canvas</a></code>
  via <a href=#dom-imagebitmaprenderingcontext-transferfromimagebitmap id=security-with-canvas-elements:dom-imagebitmaprenderingcontext-transferfromimagebitmap>transferFromImageBitmap()</a>.</p>

  

  <h3 id=custom-elements>4.13 Custom elements<a href=#custom-elements class=self-link></a></h3><div class=status><input onclick=toggleStatus(this) value=⋰ type=button><p class=support><strong>Support:</strong> custom-elementsv1<span class="and_chr partial"><span>Chrome for Android (limited)</span> <span>57+</span></span><span class="chrome partial"><span>Chrome (limited)</span> <span>54+</span></span><span class="and_uc no"><span>UC Browser for Android</span> <span>None</span></span><span class="ios_saf partial"><span>iOS Safari (limited)</span> <span>10.3+</span></span><span class="firefox no"><span>Firefox</span> <span>None</span></span><span class="ie no"><span>IE</span> <span>None</span></span><span class="samsung no"><span>Samsung Internet</span> <span>None</span></span><span class="op_mini no"><span>Opera Mini</span> <span>None</span></span><span class="android partial"><span>Android Browser (limited)</span> <span>56+</span></span><span class="safari partial"><span>Safari (limited)</span> <span>10.1+</span></span><span class="opera partial"><span>Opera (limited)</span> <span>41+</span></span><p class=caniuse>Source: <a href="http://caniuse.com/#feat=custom-elementsv1">caniuse.com</a></div>

  <h4 id=custom-elements-intro>4.13.1 導入<a href=#custom-elements-intro class=self-link></a></h4>

  <p><i>この節は非規範的である。</i></p>

  <p><a href=#custom-element id=custom-elements-intro:custom-element>Custom elements</a> provide a way for authors to build their
  own fully-featured DOM elements. Although authors could always use non-standard elements in their
  documents, with application-specific behavior added after the fact by scripting or similar, such
  elements have historically been non-conforming and not very functional. By <a href=#element-definition id=custom-elements-intro:element-definition>defining</a> a custom element, authors can inform the parser how to
  properly construct an element and how elements of that class should react to changes.</p>

  <p>Custom elements are part of a larger effort to "rationalise the platform", by explaining
  existing platform features (like the elements of HTML) in terms of lower-level author-exposed
  extensibility points (like custom element definition). Although today there are many limitations
  on the capabilities of custom elements—both functionally and semantically—that prevent them from
  fully explaining the behaviors of HTML's existing elements, we hope to shrink this gap over
  time.</p>

  <h5 id=custom-elements-autonomous-example>4.13.1.1 Creating an autonomous custom element<a href=#custom-elements-autonomous-example class=self-link></a></h5>

  <p><i>この節は非規範的である。</i></p>

  <p>For the purposes of illustrating how to create an <a href=#autonomous-custom-element id=custom-elements-autonomous-example:autonomous-custom-element>autonomous custom element</a>, let's
  define a custom element that encapsulates rendering a small icon for a country flag. Our goal is
  to be able to use it like so:</p>

  <pre>&lt;flag-icon country="nl"&gt;&lt;/flag-icon&gt;</pre>

  <p>To do this, we first declare a class for the custom element, extending
  <code id=custom-elements-autonomous-example:htmlelement><a href=dom.html#htmlelement>HTMLElement</a></code>:</p>

  <pre>class FlagIcon extends HTMLElement {
  constructor() {
    super();
    this._countryCode = null;
  }

  static get observedAttributes() { return ["country"]; }

  attributeChangedCallback(name, oldValue, newValue) {
    // name will always be "country" due to observedAttributes
    this._countryCode = newValue;
    this._updateRendering();
  }
  connectedCallback() {
    this._updateRendering();
  }

  get country() {
    return this._countryCode;
  }
  set country(v) {
    this.setAttribute("country", v);
  }

  _updateRendering() {
    // Left as an exercise for the reader. But, you'll probably want to
    // check this.ownerDocument.defaultView to see if we've been
    // inserted into a document with a browsing context, and avoid
    // doing any work if not.
  }
}</pre>

  <p>We then need to use this class to define the element:</p>

  <pre>customElements.define("flag-icon", FlagIcon);</pre>

  <p>At this point, our above code will work! The parser, whenever it sees the <code>flag-icon</code> tag, will construct a new instance of our <code>FlagIcon</code> class, and tell our code about its new <code>country</code>
  attribute, which we then use to set the element's internal state and update its rendering (when
  appropriate).</p>

  <p>You can also create <code>flag-icon</code> elements using the DOM API:</p>

  <pre>const flagIcon = document.createElement("flag-icon")
flagIcon.country = "jp"
document.body.appendChild(flagIcon)</pre>

  <p>Finally, we can also use the <a href=#custom-element-constructor id=custom-elements-autonomous-example:custom-element-constructor>custom element constructor</a> itself. That is, the above
  code is equivalent to:</p>

  <pre>const flagIcon = new FlagIcon()
flagIcon.country = "jp"
document.body.appendChild(flagIcon)</pre>

  <h5 id=custom-elements-customized-builtin-example>4.13.1.2 Creating a customized built-in element<a href=#custom-elements-customized-builtin-example class=self-link></a></h5>

  <p><i>この節は非規範的である。</i></p>

  <p><a href=#customized-built-in-element id=custom-elements-customized-builtin-example:customized-built-in-element>Customized built-in elements</a> are a distinct
  kind of <a href=#custom-element id=custom-elements-customized-builtin-example:custom-element>custom element</a>, which are defined slightly differently and used very
  differently compared to <a href=#autonomous-custom-element id=custom-elements-customized-builtin-example:autonomous-custom-element>autonomous custom
  elements</a>. They exist to allow reuse of behaviors from the existing elements of HTML, by
  extending those elements with new custom functionality. This is important since many of the
  existing behaviors of HTML elements can unfortunately not be duplicated by using purely <a href=#autonomous-custom-element id=custom-elements-customized-builtin-example:autonomous-custom-element-2>autonomous custom elements</a>. Instead, <a href=#customized-built-in-element id=custom-elements-customized-builtin-example:customized-built-in-element-2>customized built-in elements</a> allow the installation of
  custom construction behavior, lifecycle hooks, and prototype chain onto existing elements,
  essentially "mixing in" these capabilities on top of the already-existing element.</p>

  <p><a href=#customized-built-in-element id=custom-elements-customized-builtin-example:customized-built-in-element-3>Customized built-in elements</a> require a
  distinct syntax from <a href=#autonomous-custom-element id=custom-elements-customized-builtin-example:autonomous-custom-element-3>autonomous custom elements</a>
  because user agents and other software key off an element's local name in order to identify the
  element's semantics and behavior. That is, the concept of <a href=#customized-built-in-element id=custom-elements-customized-builtin-example:customized-built-in-element-4>customized built-in elements</a> building on top of existing behavior depends
  crucially on the extended elements retaining their original local name.</p>

  <p>In this example, we'll be creating a <a href=#customized-built-in-element id=custom-elements-customized-builtin-example:customized-built-in-element-5>customized built-in element</a> named <code>plastic-button</code>, which behaves like a normal button but gets fancy animation
  effects added whenever you click on it. We start by defining a class, just like before, although
  this time we extend <code id=custom-elements-customized-builtin-example:htmlbuttonelement><a href=forms.html#htmlbuttonelement>HTMLButtonElement</a></code> instead of <code id=custom-elements-customized-builtin-example:htmlelement><a href=dom.html#htmlelement>HTMLElement</a></code>:</p>

  <pre>class PlasticButton extends HTMLButtonElement {
  constructor() {
    super();

    this.addEventListener("click", () =&gt; {
      // Draw some fancy animation effects!
    });
  }
}</pre>

  <p>When defining our custom element, we have to also specify the <code>extends</code>
  option:</p>

  <pre>customElements.define("plastic-button", PlasticButton, { extends: "button" });</pre>

  <p>In general, the name of the element being extended cannot be determined simply by looking at
  what element interface it extends, as many elements share the same interface (such as
  <code id=custom-elements-customized-builtin-example:the-q-element><a href=semantics.html#the-q-element>q</a></code> and <code id=custom-elements-customized-builtin-example:the-blockquote-element><a href=semantics.html#the-blockquote-element>blockquote</a></code> both sharing <code id=custom-elements-customized-builtin-example:htmlquoteelement><a href=semantics.html#htmlquoteelement>HTMLQuoteElement</a></code>).</p>

  <p>To use our <a href=#customized-built-in-element id=custom-elements-customized-builtin-example:customized-built-in-element-6>customized built-in element</a>, we use the <code id=custom-elements-customized-builtin-example:attr-is><a href=#attr-is>is</a></code> attribute on a <code id=custom-elements-customized-builtin-example:the-button-element><a href=forms.html#the-button-element>button</a></code> element:</p>

  <pre>&lt;button is="plastic-button"&gt;Click Me!&lt;/button&gt;</pre>

  <p>Trying to use a <a href=#customized-built-in-element id=custom-elements-customized-builtin-example:customized-built-in-element-7>customized built-in element</a> as an <a href=#autonomous-custom-element id=custom-elements-customized-builtin-example:autonomous-custom-element-4>autonomous custom
  element</a> will <em>not</em> work; that is, <code>&lt;plastic-button&gt;Click
  me?&lt;/plastic-button&gt;</code> will simply create an <code id=custom-elements-customized-builtin-example:htmlelement-2><a href=dom.html#htmlelement>HTMLElement</a></code> with no special
  behavior.</p>

  <p>If you need to create a type-extended element programmatically, you can use the following form
  of <code id=custom-elements-customized-builtin-example:dom-document-createelement><a data-x-internal=dom-document-createelement href=https://triple-underscore.github.io/DOM4-ja.html#dom-document-createelement>createElement()</a></code>:</p>

  <pre>const plasticButton = document.createElement("button", { is: "plastic-button" });
plasticButton.textContent = "Click me!";</pre>

  <p>And as before, the constructor will also work:</p>

  <pre>const plasticButton2 = new PlasticButton();
console.log(plasticButton2.localName);          // will output "button"
console.log(plasticButton2.getAttribute("is")); // will output "plastic-button"</pre>

  <p>Notably, all the of the ways in which <code id=custom-elements-customized-builtin-example:the-button-element-2><a href=forms.html#the-button-element>button</a></code> is special apply to such "plastic
  buttons" as well: their focus behavior, ability to participate in <a href=forms.html#concept-form-submit id=custom-elements-customized-builtin-example:concept-form-submit>form submission</a>, the <code id=custom-elements-customized-builtin-example:attr-fe-disabled><a href=forms.html#attr-fe-disabled>disabled</a></code> attribute, and so on.</p>

  <p id=customized-built-in-element-restrictions><a href=#customized-built-in-element id=custom-elements-customized-builtin-example:customized-built-in-element-8>Customized built-in elements</a> are designed to allow extension of existing HTML
  elements that have useful user-agent supplied behavior or APIs. As such, they can only extend
  existing HTML elements defined in this specification, and cannot extend legacy elements such as
  <code id=custom-elements-customized-builtin-example:bgsound><a href=obsolete.html#bgsound>bgsound</a></code>, <code id=custom-elements-customized-builtin-example:blink><a href=obsolete.html#blink>blink</a></code>, <code id=custom-elements-customized-builtin-example:isindex><a href=obsolete.html#isindex>isindex</a></code>, <code id=custom-elements-customized-builtin-example:keygen><a href=obsolete.html#keygen>keygen</a></code>,
  <code id=custom-elements-customized-builtin-example:multicol><a href=obsolete.html#multicol>multicol</a></code>, <code id=custom-elements-customized-builtin-example:nextid><a href=obsolete.html#nextid>nextid</a></code>, or <code id=custom-elements-customized-builtin-example:spacer><a href=obsolete.html#spacer>spacer</a></code> that have been defined to use
  <code id=custom-elements-customized-builtin-example:htmlunknownelement><a href=dom.html#htmlunknownelement>HTMLUnknownElement</a></code> as their <a id=custom-elements-customized-builtin-example:element-interface href=https://triple-underscore.github.io/DOM4-ja.html#concept-element-interface data-x-internal=element-interface>element interface</a>.</p>

  <p>One reason for this requirement is future-compatibility: if a <a href=#customized-built-in-element id=custom-elements-customized-builtin-example:customized-built-in-element-9>customized built-in
  element</a> was defined that extended a currently-unknown element, for example <code>combobox</code>, this would prevent this specification from defining a <code>combobox</code> element in the future, as consumers of the derived <a href=#customized-built-in-element id=custom-elements-customized-builtin-example:customized-built-in-element-10>customized
  built-in element</a> would have come to depend on their base element having no interesting
  user-agent-supplied behavior.</p>

  <p>Additionally, <code id=custom-elements-customized-builtin-example:the-applet-element><a href=obsolete.html#the-applet-element>applet</a></code> elements cannot be extended, as they are in the process of
  being removed from the Web platform.</p>

  <h5 id=custom-elements-autonomous-drawbacks>4.13.1.3 Drawbacks of autonomous custom elements<a href=#custom-elements-autonomous-drawbacks class=self-link></a></h5>

  <p><i>この節は非規範的である。</i></p>

  <p>As specified below, and alluded to above, simply defining and using an element called
  <code>taco-button</code> does not mean that such elements <a href=dom.html#represents id=custom-elements-autonomous-drawbacks:represents>represent</a> buttons. That is, tools such as Web browsers, search engines,
  or accessibility technology will not automatically treat the resulting element as a button just
  based on its defined name.</p>

  <p>To convey the desired button semantics to a variety of users, while still using an
  <a href=#autonomous-custom-element id=custom-elements-autonomous-drawbacks:autonomous-custom-element>autonomous custom element</a>, a number of techniques would need to be employed:</p>

  <ul><li><p>The addition of the <code id=custom-elements-autonomous-drawbacks:attr-tabindex><a href=interaction.html#attr-tabindex>tabindex</a></code> attribute would make the
   <code>taco-button</code> <a id=custom-elements-autonomous-drawbacks:interactive-content-2 href=dom.html#interactive-content-2>interactive content</a>, thus making it
   <a href=interaction.html#focusable-area id=custom-elements-autonomous-drawbacks:focusable-area>focusable</a>. Note that if the
   <code>taco-button</code> were to become logically disabled, the <code id=custom-elements-autonomous-drawbacks:attr-tabindex-2><a href=interaction.html#attr-tabindex>tabindex</a></code> attribute would need to be removed.</li><li><p>The addition of various ARIA attributes helps convey semantics to accessibility
   technology. For example, setting the <code id=custom-elements-autonomous-drawbacks:attr-aria-role><a href=infrastructure.html#attr-aria-role>role</a></code> attribute to
   "<code id=custom-elements-autonomous-drawbacks:attr-aria-role-button><a data-x-internal=attr-aria-role-button href=http://momdo.github.io/wai-aria-1.1/#button>button</a></code>" will convey the semantics that this is a
   button, enabling users to successfully interact with the control using usual button-like
   interactions in their accessibility technology. Setting the <code id=custom-elements-autonomous-drawbacks:attr-aria-label><a data-x-internal=attr-aria-label href=http://momdo.github.io/wai-aria-1.1/#aria-label>aria-label</a></code> attribute is necessary to give the button an
   <a href=http://momdo.github.io/wai-aria-1.1/#dfn-accessible-name id=custom-elements-autonomous-drawbacks:concept-accessible-name data-x-internal=concept-accessible-name>accessible name</a>, instead of having accessibility
   technology traverse its child text nodes and announce them. And setting <code id=custom-elements-autonomous-drawbacks:attr-aria-disabled><a data-x-internal=attr-aria-disabled href=http://momdo.github.io/wai-aria-1.1/#aria-disabled>aria-disabled</a></code> to "<code>true</code>" when the button
   is logically disabled conveys to accessibility technology the button's disabled state.</li><li><p>The addition of event handlers to handle commonly-expected button behaviors helps convey
   the semantics of the button to Web browser users. In this case, the most relevant event handler
   would be one that proxies appropriate <code id=custom-elements-autonomous-drawbacks:event-keydown><a data-x-internal=event-keydown href=https://w3c.github.io/uievents/#event-type-keydown>keydown</a></code> events to
   become <code id=custom-elements-autonomous-drawbacks:event-click><a data-x-internal=event-click href=https://w3c.github.io/uievents/#event-type-click>click</a></code> events, so that you can activate the button both
   with keyboard and by clicking.</li><li><p>In addition to any default visual styling provided for <code>taco-button</code>
   elements, the visual styling will also need to be updated to reflect changes in logical state,
   such as becoming disabled; that is, whatever stylesheet has rules for <code>taco-button</code> will also need to have rules for <code>taco-button[disabled]</code>.</li></ul>

  <p>With these points in mind, a full-featured <code>taco-button</code> that took on the
  responsibility of conveying button semantics (including the ability to be disabled) might look
  something like this:</p>

  <pre>class TacoButton extends HTMLElement {
  static get observedAttributes() { return ["disabled"]; }

  constructor() {
    super();

    this.addEventListener("keydown", e =&gt; {
      if (e.keyCode === 32 || e.keyCode === 13) {
        this.dispatchEvent(new MouseEvent("click", {
          bubbles: true,
          cancelable: true
        }));
      }
    });

    this.addEventListener("click", e =&gt; {
      if (this.disabled) {
        e.preventDefault();
        e.stopPropagation();
      }
    });

    this._observer = new MutationObserver(() =&gt; {
      this.setAttribute("aria-label", this.textContent);
    });
  }

  connectedCallback() {
    this.setAttribute("role", "button");
    this.setAttribute("tabindex", "0");

    this._observer.observe(this, {
      childList: true,
      characterData: true,
      subtree: true
    });
  }

  disconnectedCallback() {
    this._observer.disconnect();
  }

  get disabled() {
    return this.hasAttribute("disabled");
  }

  set disabled(v) {
    if (v) {
      this.setAttribute("disabled", "");
    } else {
      this.removeAttribute("disabled");
    }
  }

  attributeChangedCallback() {
    // only is called for the disabled attribute due to observedAttributes
    if (this.disabled) {
      this.removeAttribute("tabindex");
      this.setAttribute("aria-disabled", "true");
    } else {
      this.setAttribute("tabindex", "0");
      this.setAttribute("aria-disabled", "false");
    }
  }
}</pre>

  <p>Even with this rather-complicated element definition, the element is not a pleasure to use for
  consumers: it will be continually "sprouting" <code id=custom-elements-autonomous-drawbacks:attr-tabindex-3><a href=interaction.html#attr-tabindex>tabindex</a></code> and
  <code id=custom-elements-autonomous-drawbacks:attr-aria-*><a href=infrastructure.html#attr-aria-*>aria-*</a></code> attributes of its own volition. This is because as of now
  there is no way to specify default accessibility semantics or focus behavior for custom elements,
  forcing the use of these attributes to do so (even though they are usually reserved for allowing
  the consumer to override default behavior).</p>

  <p>In contrast, a simple <a href=#customized-built-in-element id=custom-elements-autonomous-drawbacks:customized-built-in-element>customized built-in element</a>, as shown in the previous
  section, would automatically inherit the semantics and behavior of the <code id=custom-elements-autonomous-drawbacks:the-button-element><a href=forms.html#the-button-element>button</a></code>
  element, with no need to implement these behaviors manually. In general, for any elements with
  nontrivial behavior and semantics that build on top of existing elements of HTML, <a href=#customized-built-in-element id=custom-elements-autonomous-drawbacks:customized-built-in-element-2>customized built-in elements</a> will be easier to
  develop, maintain, and consume.</p>

  <h5 id=custom-elements-upgrades-examples>4.13.1.4 Upgrading elements after their creation<a href=#custom-elements-upgrades-examples class=self-link></a></h5>

  <p><i>この節は非規範的である。</i></p>

  <p>Because <a href=#element-definition id=custom-elements-upgrades-examples:element-definition>element definition</a> can occur at any time, a non-custom element could be
  <a href=https://triple-underscore.github.io/DOM4-ja.html#concept-create-element id=custom-elements-upgrades-examples:create-an-element data-x-internal=create-an-element>created</a>, and then later become a <a href=#custom-element id=custom-elements-upgrades-examples:custom-element>custom
  element</a> after an appropriate <a href=#custom-element-definition id=custom-elements-upgrades-examples:custom-element-definition>definition</a> is
  registered. We call this process "upgrading" the element, from a normal element into a custom
  element.</p>

  <p><a href=#upgrades id=custom-elements-upgrades-examples:upgrades>Upgrades</a> enable scenarios where it may be
  preferable for <a href=#custom-element-definition id=custom-elements-upgrades-examples:custom-element-definition-2>custom element definitions</a> to be
  registered after relevant elements has been initially created, such as by the parser. They allow
  progressive enhancement of the content in the custom element. For example, in the following HTML
  document the element definition for <code>img-viewer</code> is loaded
  asynchronously:</p>

  <pre>&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
&lt;title&gt;Image viewer example&lt;/title&gt;

&lt;img-viewer filter="Kelvin"&gt;
  &lt;img src="images/tree.jpg" alt="A beautiful tree towering over an empty savannah"&gt;
&lt;/img-viewer&gt;

&lt;script src="js/elements/img-viewer.js" async&gt;&lt;/script&gt;</pre>

  <p>The definition for the <code>img-viewer</code> element here is loaded using a
  <code id=custom-elements-upgrades-examples:the-script-element><a href=#the-script-element>script</a></code> element marked with the <code id=custom-elements-upgrades-examples:attr-script-async><a href=#attr-script-async>async</a></code>
  attribute, placed after the <code>&lt;img-viewer&gt;</code> tag in the markup. While the
  script is loading, the <code>img-viewer</code> element will be treated as an undefined
  element, similar to a <code id=custom-elements-upgrades-examples:the-span-element><a href=semantics.html#the-span-element>span</a></code>. Once the script loads, it will define the <code>img-viewer</code> element, and the existing <code>img-viewer</code> element on
  the page will be upgraded, applying the custom element's definition (which presumably includes
  applying an image filter identified by the string "Kelvin", enhancing the image's visual
  appearance).</p>

  <hr>

  <p>Note that <a href=#upgrades id=custom-elements-upgrades-examples:upgrades-2>upgrades</a> only apply to elements in the
  document tree. (Formally, elements that are <a id=custom-elements-upgrades-examples:connected href=https://triple-underscore.github.io/DOM4-ja.html#connected data-x-internal=connected>connected</a>.) An element that is not
  inserted into a document will stay un-upgraded. An example illustrates this point:</p>

  <pre>&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
&lt;title&gt;Upgrade edge-cases example&lt;/title&gt;

&lt;example-element&gt;&lt;/example-element&gt;

&lt;script&gt;
  "use strict";

  const inDocument = document.querySelector("example-element");
  const outOfDocument = document.createElement("example-element");

  // Before the element definition, both are HTMLElement:
  console.assert(inDocument instanceof HTMLElement);
  console.assert(outOfDocument instanceof HTMLElement);

  class ExampleElement extends HTMLElement {}
  customElements.define("example-element", ExampleElement);

  // After element definition, the in-document element was upgraded:
  console.assert(inDocument instanceof ExampleElement);
  console.assert(!(outOfDocument instanceof ExampleElement));

  document.body.appendChild(outOfDocument);

  // Now that we've moved the element into the document, it too was upgraded:
  console.assert(outOfDocument instanceof ExampleElement);
&lt;/script&gt;</pre>

  <h4 id=custom-element-conformance>4.13.2 Requirements for custom element constructors<a href=#custom-element-conformance class=self-link></a></h4>

  <p>When authoring <a href=#custom-element-constructor id=custom-element-conformance:custom-element-constructor>custom element constructors</a>,
  authors are bound by the following conformance requirements:</p>

  <ul><li><p>A parameter-less call to <code>super()</code> must be the first statement in the
   constructor body, to establish the correct prototype chain and <b>this</b> value before any
   further code is run.</li><li><p>A <code>return</code> statement must not appear anywhere inside the constructor
   body, unless it is a simple early-return (<code>return</code> or <code>return
   this</code>).</li><li><p>The constructor must not use the <code id=custom-element-conformance:dom-document-write><a href=webappapis.html#dom-document-write>document.write()</a></code>
   or <code id=custom-element-conformance:dom-document-open><a href=webappapis.html#dom-document-open>document.open()</a></code> methods.</li><li><p>The element's attributes and children must not be inspected, as in the non-<a href=#upgrades id=custom-element-conformance:upgrades>upgrade</a> case none will be present, and relying on
   upgrades makes the element less usable.</li><li><p>The element must not gain any attributes or children, as this violates the expectations of
   consumers who use the <code id=custom-element-conformance:dom-document-createelement><a data-x-internal=dom-document-createelement href=https://triple-underscore.github.io/DOM4-ja.html#dom-document-createelement>createElement</a></code> or <code id=custom-element-conformance:dom-document-createelementns><a data-x-internal=dom-document-createelementns href=https://triple-underscore.github.io/DOM4-ja.html#dom-document-createelementns>createElementNS</a></code> methods.</li><li><p>In general, work should be deferred to <code>connectedCallback</code> as much as
   possible—especially work involving fetching resources or rendering. However, note that <code>connectedCallback</code> can be called more than once, so any initialization work that
   is truly one-time will need a guard to prevent it from running twice.</li><li><p>In general, the constructor should be used to set up initial state and default values, and
   to set up event listeners and possibly a <a id=custom-element-conformance:shadow-root href=https://triple-underscore.github.io/DOM4-ja.html#concept-shadow-root data-x-internal=shadow-root>shadow root</a>.</li></ul>

  <p>Several of these requirements are checked during <a href=https://triple-underscore.github.io/DOM4-ja.html#concept-create-element id=custom-element-conformance:create-an-element data-x-internal=create-an-element>element
  creation</a>, either directly or indirectly, and failing to follow them will result in a custom
  element that cannot be instantiated by the parser or DOM APIs. This is true even if the work is
  done inside a constructor-initiated <a id=custom-element-conformance:microtask href=webappapis.html#microtask>microtask</a>, as a <a href=webappapis.html#perform-a-microtask-checkpoint id=custom-element-conformance:perform-a-microtask-checkpoint>microtask checkpoint</a> can occur immediately after construction.</p>

  <h4 id=custom-elements-core-concepts>4.13.3 Core concepts<a href=#custom-elements-core-concepts class=self-link></a></h4>

  <p>A <dfn id=custom-element>custom element</dfn> is an element that is <a href=https://triple-underscore.github.io/DOM4-ja.html#concept-element-custom id=custom-elements-core-concepts:concept-element-custom data-x-internal=concept-element-custom>custom</a>. Informally, this means that its constructor and
  prototype are defined by the author, instead of by the user agent. This author-supplied
  constructor function is called the <dfn id=custom-element-constructor data-export="">custom element constructor</dfn>.</p>

  <p>Two distinct types of <a href=#custom-element id=custom-elements-core-concepts:custom-element>custom elements</a> can be defined:</p>

  <ol><li><p>An <dfn id=autonomous-custom-element data-export="">autonomous custom element</dfn>, which is defined with no <code>extends</code> option. These types of custom elements have a local name equal to their
   <a href=#concept-custom-element-definition-name id=custom-elements-core-concepts:concept-custom-element-definition-name>defined name</a>.</li><li><p>A <dfn id=customized-built-in-element data-export="">customized built-in element</dfn>, which is defined with an <code>extends</code> option. These types of custom elements have a local name equal to the
   value passed in their <code>extends</code> option, and their <a href=#concept-custom-element-definition-name id=custom-elements-core-concepts:concept-custom-element-definition-name-2>defined name</a> is used as the value of the
   <dfn id=attr-is><code>is</code></dfn> attribute, which therefore must be a <a href=#valid-custom-element-name id=custom-elements-core-concepts:valid-custom-element-name>valid
   custom element name</a>.</li></ol>

  <p>After a <a href=#custom-element id=custom-elements-core-concepts:custom-element-2>custom element</a> is <a href=https://triple-underscore.github.io/DOM4-ja.html#concept-create-element id=custom-elements-core-concepts:create-an-element data-x-internal=create-an-element>created</a>,
  changing the value of the <code id=custom-elements-core-concepts:attr-is><a href=#attr-is>is</a></code> attribute does not
  change the element's behavior, as it is saved on the element as its <a href=https://triple-underscore.github.io/DOM4-ja.html#concept-element-is-value id=custom-elements-core-concepts:concept-element-is-value data-x-internal=concept-element-is-value><code>is</code> value</a>.</p>

  <p><a href=#autonomous-custom-element id=custom-elements-core-concepts:autonomous-custom-element>Autonomous custom elements</a> have the following
  element definition:</p>

  <dl class=element><dt><a href=dom.html#concept-element-categories id=custom-elements-core-concepts:concept-element-categories>カテゴリー</a>：<dd><a id=custom-elements-core-concepts:flow-content-2 href=dom.html#flow-content-2>フローコンテンツ</a>。<dd><a id=custom-elements-core-concepts:phrasing-content-2 href=dom.html#phrasing-content-2>フレージングコンテンツ</a>。<dd><a id=custom-elements-core-concepts:palpable-content-2 href=dom.html#palpable-content-2>パルパブルコンテンツ</a>。<dt><a href=dom.html#concept-element-contexts id=custom-elements-core-concepts:concept-element-contexts>この要素を使用できるコンテキスト</a>：<dd><a id=custom-elements-core-concepts:phrasing-content-2-2 href=dom.html#phrasing-content-2>フレージングコンテンツ</a>が期待される場所。<dt><a href=dom.html#concept-element-content-model id=custom-elements-core-concepts:concept-element-content-model>コンテンツモデル</a>：<dd><a id=custom-elements-core-concepts:transparent href=dom.html#transparent>透過的</a>。<dt><a href=dom.html#concept-element-attributes id=custom-elements-core-concepts:concept-element-attributes>コンテンツ属性</a>：<dd><a id=custom-elements-core-concepts:global-attributes href=dom.html#global-attributes>Global attributes</a>, except the <code id=custom-elements-core-concepts:attr-is-2><a href=#attr-is>is</a></code> attribute<dd>名前空間を持たないその他の属性（文参照）。<dt><a href=dom.html#concept-element-dom id=custom-elements-core-concepts:concept-element-dom>DOMインターフェイス</a>：<dd>Supplied by the element's author (inherits from <code id=custom-elements-core-concepts:htmlelement><a href=dom.html#htmlelement>HTMLElement</a></code>)</dl>


  <p>An <a href=#autonomous-custom-element id=custom-elements-core-concepts:autonomous-custom-element-2>autonomous custom element</a> does not have any special meaning: it
  <a id=custom-elements-core-concepts:represents href=dom.html#represents>represents</a> its children. A <a href=#customized-built-in-element id=custom-elements-core-concepts:customized-built-in-element>customized built-in element</a> inherits the
  semantics of the element that it extends.</p>

  <p>Any namespace-less attribute that is relevant to the element's functioning, as determined by
  the element's author, may be specified on an <a href=#autonomous-custom-element id=custom-elements-core-concepts:autonomous-custom-element-3>autonomous custom element</a>, so long as
  the attribute name is <a id=custom-elements-core-concepts:xml-compatible href=infrastructure.html#xml-compatible>XML-compatible</a> and contains no <a href=https://infra.spec.whatwg.org/#ascii-upper-alpha id=custom-elements-core-concepts:uppercase-ascii-letters data-x-internal=uppercase-ascii-letters>ASCII upper alphas</a>. The exception is the <code id=custom-elements-core-concepts:attr-is-3><a href=#attr-is>is</a></code> attribute,
  which must not be specified on an <a href=#autonomous-custom-element id=custom-elements-core-concepts:autonomous-custom-element-4>autonomous custom element</a> (and which will have no
  effect if it is).</p>

  <p><a href=#customized-built-in-element id=custom-elements-core-concepts:customized-built-in-element-2>Customized built-in elements</a> follow the
  normal requirements for attributes, based on the elements they extend. To add custom
  attribute-based behavior, use <code id=custom-elements-core-concepts:attr-data-*><a href=dom.html#attr-data-*>data-*</a></code> attributes.</p>

  <hr>

  <p>A <dfn id=valid-custom-element-name data-export="">valid custom element name</dfn> is a sequence of characters
  <var>name</var> that meets all of the following requirements:</p>

  <ul><li>
    <p><var>name</var> must match the <code id=custom-elements-core-concepts:prod-potentialcustomelementname><a href=#prod-potentialcustomelementname>PotentialCustomElementName</a></code> production:</p>

    <dl><dt><code><dfn id=prod-potentialcustomelementname>PotentialCustomElementName</dfn> ::=</code><dd><code>[a-z] (<a href=#prod-pcenchar id=custom-elements-core-concepts:prod-pcenchar>PCENChar</a>)* '-'
     (<a href=#prod-pcenchar id=custom-elements-core-concepts:prod-pcenchar-2>PCENChar</a>)*</code><dt><code><dfn id=prod-pcenchar>PCENChar</dfn> ::=</code><dd><code>"-" | "." | [0-9] | "_" | [a-z] | #xB7 | [#xC0-#xD6] | [#xD8-#xF6] |
     [#xF8-#x37D] | [#x37F-#x1FFF] | [#x200C-#x200D] | [#x203F-#x2040] | [#x2070-#x218F] |
     [#x2C00-#x2FEF] | [#x3001-#xD7FF] | [#xF900-#xFDCF] | [#xFDF0-#xFFFD] |
     [#x10000-#xEFFFF]</code></dl>

    <p>This uses the <a href=https://www.w3.org/TR/xml/#sec-notation>EBNF notation</a> from the
    <cite>XML</cite> specification. <a href=references.html#refsXML>[XML]</a></p>
   </li><li>
    <p><var>name</var> must not be any of the following:</p>

    <ul class=brief><li><code>annotation-xml</code></li><li><code>color-profile</code></li><li><code>font-face</code></li><li><code>font-face-src</code></li><li><code>font-face-uri</code></li><li><code>font-face-format</code></li><li><code>font-face-name</code></li><li><code>missing-glyph</code></li></ul>

    <p class=note>The list of names above is the summary of all hyphen-containing element names
    from the <a href=infrastructure.html#other-applicable-specifications id=custom-elements-core-concepts:other-applicable-specifications>applicable specifications</a>, namely
    <cite>SVG</cite> and <cite>MathML</cite>. <a href=references.html#refsSVG>[SVG]</a> <a href=references.html#refsMATHML>[MATHML]</a></p>
   </li></ul>

  <div class=note>
   <p>These requirements ensure a number of goals for <a href=#valid-custom-element-name id=custom-elements-core-concepts:valid-custom-element-name-2>valid
   custom element names</a>:</p>

   <ul><li><p>They start with an <a id=custom-elements-core-concepts:lowercase-ascii-letters href=https://infra.spec.whatwg.org/#ascii-lower-alpha data-x-internal=lowercase-ascii-letters>ASCII lower alpha</a>, ensuring that the HTML parser will
    treat them as tags instead of as text.</li><li><p>They do not contain any <a href=https://infra.spec.whatwg.org/#ascii-upper-alpha id=custom-elements-core-concepts:uppercase-ascii-letters-2 data-x-internal=uppercase-ascii-letters>ASCII upper alphas</a>,
    ensuring that the user agent can always treat HTML elements ASCII-case-insensitively.</li><li><p>They contain a hyphen, used for namespacing and to ensure forward compatibility (since no
    elements will be added to HTML, SVG, or MathML with hyphen-containing local names in the
    future).</li><li><p>They can always be created with <code id=custom-elements-core-concepts:dom-document-createelement><a data-x-internal=dom-document-createelement href=https://triple-underscore.github.io/DOM4-ja.html#dom-document-createelement>createElement()</a></code> and <code id=custom-elements-core-concepts:dom-document-createelementns><a data-x-internal=dom-document-createelementns href=https://triple-underscore.github.io/DOM4-ja.html#dom-document-createelementns>createElementNS()</a></code>, which have restrictions that go
    beyond the parser's.</li></ul>

   <p>Apart from these restrictions, a large variety of names is allowed, to give maximum
   flexibility for use cases like <code>&lt;math-α&gt;</code> or <code>&lt;emotion-😍&gt;</code>.</p>
  </div>

  <p>A <dfn id=custom-element-definition>custom element definition</dfn> describes a <a href=#custom-element id=custom-elements-core-concepts:custom-element-3>custom element</a> and consists
  of:</p>

  <dl><dt>A <dfn data-dfn-for="custom element definition" id=concept-custom-element-definition-name data-export="">name</dfn><dd>A <a href=#valid-custom-element-name id=custom-elements-core-concepts:valid-custom-element-name-3>valid custom element name</a><dt>A <dfn data-dfn-for="custom element definition" id=concept-custom-element-definition-local-name data-export="">local name</dfn><dd>A local name<dt>A <dfn data-dfn-for="custom element definition" id=concept-custom-element-definition-constructor data-export="">constructor</dfn><dd>A Web IDL <code id=custom-elements-core-concepts:idl-function><a data-x-internal=idl-function href=https://triple-underscore.github.io/WebIDL-ja.html#common-Function>Function</a></code> callback function type value wrapping
   the <a href=#custom-element-constructor id=custom-elements-core-concepts:custom-element-constructor>custom element constructor</a><dt>A list of <dfn id=concept-custom-element-definition-observed-attributes>observed
   attributes</dfn><dd>A <code>sequence&lt;DOMString&gt;</code><dt>A collection of <dfn id=concept-custom-element-definition-lifecycle-callbacks>lifecycle callbacks</dfn><dd>A map, whose four keys are the strings "<code>connectedCallback</code>",
   "<code>disconnectedCallback</code>", "<code>adoptedCallback</code>", and
   "<code>attributeChangedCallback</code>". The corresponding values are either a Web IDL
   <code id=custom-elements-core-concepts:idl-function-2><a data-x-internal=idl-function href=https://triple-underscore.github.io/WebIDL-ja.html#common-Function>Function</a></code> callback function type value, or null. By default the
   value of each entry is null.<dt>A <dfn id=concept-custom-element-definition-construction-stack>construction
   stack</dfn><dd>A list, initially empty, that is manipulated by the <a href=#concept-upgrade-an-element id=custom-elements-core-concepts:concept-upgrade-an-element>upgrade an element</a> algorithm and the <a href=dom.html#html-element-constructors>HTML element constructors</a>. Each entry in the list will be
   either an element or an <dfn id=concept-already-constructed-marker><i>already
   constructed</i> marker</dfn>.</dl>

  <p>To <dfn id=look-up-a-custom-element-definition data-export="">look up a custom element definition</dfn>, given a <var>document</var>,
  <var>namespace</var>, <var>localName</var>, and <var>is</var>, perform the following steps. They
  will return either a <a href=#custom-element-definition id=custom-elements-core-concepts:custom-element-definition>custom element definition</a> or null:</p>

  <ol><li><p>If <var>namespace</var> is not the <a id=custom-elements-core-concepts:html-namespace-2 href=https://infra.spec.whatwg.org/#html-namespace data-x-internal=html-namespace-2>HTML namespace</a>, return null.</li><li><p>If <var>document</var> does not have a <a href=browsers.html#concept-document-bc id=custom-elements-core-concepts:concept-document-bc>browsing
   context</a>, return null.</li><li><p>Let <var>registry</var> be <var>document</var>'s <a href=browsers.html#concept-document-bc id=custom-elements-core-concepts:concept-document-bc-2>browsing context</a>'s <code id=custom-elements-core-concepts:window><a href=browsers.html#window>Window</a></code>'s
   <code id=custom-elements-core-concepts:customelementregistry><a href=#customelementregistry>CustomElementRegistry</a></code> object.</li><li><p>If there is <a href=#custom-element-definition id=custom-elements-core-concepts:custom-element-definition-2>custom element definition</a> in <var>registry</var> with <a href=#concept-custom-element-definition-name id=custom-elements-core-concepts:concept-custom-element-definition-name-3>name</a> and <a href=#concept-custom-element-definition-local-name id=custom-elements-core-concepts:concept-custom-element-definition-local-name>local name</a> both equal to
   <var>localName</var>, return that <a href=#custom-element-definition id=custom-elements-core-concepts:custom-element-definition-3>custom element definition</a>.</li><li><p>If there is a <a href=#custom-element-definition id=custom-elements-core-concepts:custom-element-definition-4>custom element definition</a> in <var>registry</var> with <a href=#concept-custom-element-definition-name id=custom-elements-core-concepts:concept-custom-element-definition-name-4>name</a> equal to <var>is</var> and <a href=#concept-custom-element-definition-local-name id=custom-elements-core-concepts:concept-custom-element-definition-local-name-2>local name</a> equal to
   <var>localName</var>, return that <a href=#custom-element-definition id=custom-elements-core-concepts:custom-element-definition-5>custom element definition</a>.</li><li><p>Return null.</li></ol>

  <h4 id=custom-elements-api>4.13.4 The <code id=custom-elements-api:customelementregistry><a href=#customelementregistry>CustomElementRegistry</a></code> interface<a href=#custom-elements-api class=self-link></a></h4>

  <p>Each <code id=custom-elements-api:window><a href=browsers.html#window>Window</a></code> object is associated with a unique instance of a
  <code id=custom-elements-api:customelementregistry-2><a href=#customelementregistry>CustomElementRegistry</a></code> object, allocated when the <code id=custom-elements-api:window-2><a href=browsers.html#window>Window</a></code> object is
  created.</p>

  <p class=note>Custom element registries are associated with <code id=custom-elements-api:window-3><a href=browsers.html#window>Window</a></code> objects, instead
  of <code id=custom-elements-api:document><a href=dom.html#document>Document</a></code> objects, since each <a href=#custom-element-constructor id=custom-elements-api:custom-element-constructor>custom element constructor</a> inherits from
  the <code id=custom-elements-api:htmlelement><a href=dom.html#htmlelement>HTMLElement</a></code> interface, and there is exactly one <code id=custom-elements-api:htmlelement-2><a href=dom.html#htmlelement>HTMLElement</a></code>
  interface per <code id=custom-elements-api:window-4><a href=browsers.html#window>Window</a></code> object.</p>

  <p>The <dfn id=dom-window-customelements><code>customElements</code></dfn> attribute of the
  <code id=custom-elements-api:window-5><a href=browsers.html#window>Window</a></code> interface must return the <code id=custom-elements-api:customelementregistry-3><a href=#customelementregistry>CustomElementRegistry</a></code> object for that
  <code id=custom-elements-api:window-6><a href=browsers.html#window>Window</a></code> object.</p>

  <pre class=idl>interface <dfn id=customelementregistry>CustomElementRegistry</dfn> {
  [<a href=#cereactions id=custom-elements-api:cereactions>CEReactions</a>] void <a href=#dom-customelementregistry-define id=custom-elements-api:dom-customelementregistry-define>define</a>(DOMString name, Function constructor, optional ElementDefinitionOptions options);
  any <a href=#dom-customelementregistry-get id=custom-elements-api:dom-customelementregistry-get>get</a>(DOMString name);
  Promise&lt;void&gt; <a href=#dom-customelementregistry-whendefined id=custom-elements-api:dom-customelementregistry-whendefined>whenDefined</a>(DOMString name);
};

dictionary <dfn id=elementdefinitionoptions>ElementDefinitionOptions</dfn> {
  DOMString extends;
};</pre>

  <p>Every <code id=custom-elements-api:customelementregistry-4><a href=#customelementregistry>CustomElementRegistry</a></code> has a set of <a href=#custom-element-definition id=custom-elements-api:custom-element-definition>custom element definitions</a>, initially empty. In general, algorithms in this
  specification look up elements in the registry by any of <a href=#concept-custom-element-definition-name id=custom-elements-api:concept-custom-element-definition-name>name</a>, <a href=#concept-custom-element-definition-local-name id=custom-elements-api:concept-custom-element-definition-local-name>local name</a>, or <a href=#concept-custom-element-definition-constructor id=custom-elements-api:concept-custom-element-definition-constructor>constructor</a>.</p>

  <p>Every <code id=custom-elements-api:customelementregistry-5><a href=#customelementregistry>CustomElementRegistry</a></code> also has an <dfn id=element-definition-is-running>element definition is running</dfn>
  flag which is used to prevent reentrant invocations of <a href=#element-definition id=custom-elements-api:element-definition>element definition</a>. It is
  initially unset.</p>

  <p>Every <code id=custom-elements-api:customelementregistry-6><a href=#customelementregistry>CustomElementRegistry</a></code> also has a <dfn id=when-defined-promise-map>when-defined promise map</dfn>,
  mapping <a href=#valid-custom-element-name id=custom-elements-api:valid-custom-element-name>valid custom element names</a> to promises. It
  is used to implement the <code id=custom-elements-api:dom-customelementregistry-whendefined-2><a href=#dom-customelementregistry-whendefined>whenDefined()</a></code> method.</p>

  <dl class=domintro><dt><var>window</var> . <code id=custom-elements-api:dom-window-customelements><a href=#dom-window-customelements>customElements</a></code> . <code id=custom-elements-api:dom-customelementregistry-define-2><a href=#dom-customelementregistry-define>define</a></code>(<var>name</var>,
   <var>constructor</var>)<dd>Defines a new <a href=#custom-element id=custom-elements-api:custom-element>custom element</a>, mapping the given name to the given constructor as
   an <a href=#autonomous-custom-element id=custom-elements-api:autonomous-custom-element>autonomous custom element</a>.<dt><var>window</var> . <code id=custom-elements-api:dom-window-customelements-2><a href=#dom-window-customelements>customElements</a></code> . <code id=custom-elements-api:dom-customelementregistry-define-3><a href=#dom-customelementregistry-define>define</a></code>(<var>name</var>, <var>constructor</var>,
   { extends: <var>baseLocalName</var> })<dd>Defines a new <a href=#custom-element id=custom-elements-api:custom-element-2>custom element</a>, mapping the given name to the given constructor as
   a <a href=#customized-built-in-element id=custom-elements-api:customized-built-in-element>customized built-in element</a> for the <a id=custom-elements-api:element-type href=infrastructure.html#element-type>element type</a> identified by the
   supplied <var>baseLocalName</var>. A <a id=custom-elements-api:notsupportederror href=https://triple-underscore.github.io/WebIDL-ja.html#notsupportederror data-x-internal=notsupportederror>"<code>NotSupportedError</code>"</a>
   <code id=custom-elements-api:domexception><a data-x-internal=domexception href=https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException>DOMException</a></code> will be thrown upon trying to extend a <a href=#custom-element id=custom-elements-api:custom-element-3>custom element</a> or
   an unknown element.<dt><var>window</var> . <code id=custom-elements-api:dom-window-customelements-3><a href=#dom-window-customelements>customElements</a></code> . <code id=custom-elements-api:dom-customelementregistry-get-2><a href=#dom-customelementregistry-get>get</a></code>(<var>name</var>)<dd>Retrieves the <a href=#custom-element-constructor id=custom-elements-api:custom-element-constructor-2>custom element constructor</a> defined for the given <a href=#concept-custom-element-definition-name id=custom-elements-api:concept-custom-element-definition-name-2>name</a>. Returns undefined if there is no
   <a href=#custom-element-definition id=custom-elements-api:custom-element-definition-2>custom element definition</a> with the given <a href=#concept-custom-element-definition-name id=custom-elements-api:concept-custom-element-definition-name-3>name</a>.<dt><var>window</var> . <code id=custom-elements-api:dom-window-customelements-4><a href=#dom-window-customelements>customElements</a></code> . <code id=custom-elements-api:dom-customelementregistry-whendefined-3><a href=#dom-customelementregistry-whendefined>whenDefined</a></code>(<var>name</var>)<dd>Returns a promise that will be fulfilled when a <a href=#custom-element id=custom-elements-api:custom-element-4>custom element</a> becomes defined
   with the given name. (If such a <a href=#custom-element id=custom-elements-api:custom-element-5>custom element</a> is already defined, the returned
   promise will be immediately fulfilled.) Returns a promise rejected with a
   <a id=custom-elements-api:syntaxerror href=https://triple-underscore.github.io/WebIDL-ja.html#syntaxerror data-x-internal=syntaxerror>"<code>SyntaxError</code>"</a> <code id=custom-elements-api:domexception-2><a data-x-internal=domexception href=https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException>DOMException</a></code> if not given a <a href=#valid-custom-element-name id=custom-elements-api:valid-custom-element-name-2>valid
   custom element name</a>.</dl>

  <p><dfn id=element-definition>Element definition</dfn> is a process of adding a <a href=#custom-element-definition id=custom-elements-api:custom-element-definition-3>custom element definition</a>
  to the <code id=custom-elements-api:customelementregistry-7><a href=#customelementregistry>CustomElementRegistry</a></code>. This is accomplished by the <code id=custom-elements-api:dom-customelementregistry-define-4><a href=#dom-customelementregistry-define>define()</a></code> method. When invoked, the <dfn id=dom-customelementregistry-define><code>define(<var>name</var>, <var>constructor</var>,
  <var>options</var>)</code></dfn> method must run these steps:</p>

  <ol><li><p>If <a id=custom-elements-api:isconstructor href=https://tc39.github.io/ecma262/#sec-isconstructor data-x-internal=isconstructor>IsConstructor</a>(<var>constructor</var>) is false, then throw a
   <code id=custom-elements-api:typeerror><a data-x-internal=typeerror href=https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-typeerror>TypeError</a></code> and abort these steps.</li><li><p>If <var>name</var> is not a <a href=#valid-custom-element-name id=custom-elements-api:valid-custom-element-name-3>valid custom element name</a>, then throw a
   <a id=custom-elements-api:syntaxerror-2 href=https://triple-underscore.github.io/WebIDL-ja.html#syntaxerror data-x-internal=syntaxerror>"<code>SyntaxError</code>"</a> <code id=custom-elements-api:domexception-3><a data-x-internal=domexception href=https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException>DOMException</a></code> and abort these steps.</li><li><p>If this <code id=custom-elements-api:customelementregistry-8><a href=#customelementregistry>CustomElementRegistry</a></code> contains an entry with <a href=#concept-custom-element-definition-name id=custom-elements-api:concept-custom-element-definition-name-4>name</a> <var>name</var>, then throw a
   <a id=custom-elements-api:notsupportederror-2 href=https://triple-underscore.github.io/WebIDL-ja.html#notsupportederror data-x-internal=notsupportederror>"<code>NotSupportedError</code>"</a> <code id=custom-elements-api:domexception-4><a data-x-internal=domexception href=https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException>DOMException</a></code> and abort these
   steps.</li><li><p>If this <code id=custom-elements-api:customelementregistry-9><a href=#customelementregistry>CustomElementRegistry</a></code> contains an entry with <a href=#concept-custom-element-definition-constructor id=custom-elements-api:concept-custom-element-definition-constructor-2>constructor</a> <var>constructor</var>,
   then throw a <a id=custom-elements-api:notsupportederror-3 href=https://triple-underscore.github.io/WebIDL-ja.html#notsupportederror data-x-internal=notsupportederror>"<code>NotSupportedError</code>"</a> <code id=custom-elements-api:domexception-5><a data-x-internal=domexception href=https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException>DOMException</a></code> and abort
   these steps.</li><li><p>Let <var>localName</var> be <var>name</var>.</li><li><p>Let <var>extends</var> be the value of the <code>extends</code> member of
   <var>options</var>, or null if no such member exists.</li><li>
    <p>If <var>extends</var> is not null, then:</p>

    <ol><li><p>If <var>extends</var> is a <a href=#valid-custom-element-name id=custom-elements-api:valid-custom-element-name-4>valid custom element name</a>, then throw a
     <a id=custom-elements-api:notsupportederror-4 href=https://triple-underscore.github.io/WebIDL-ja.html#notsupportederror data-x-internal=notsupportederror>"<code>NotSupportedError</code>"</a> <code id=custom-elements-api:domexception-6><a data-x-internal=domexception href=https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException>DOMException</a></code>.</li><li><p>If the <a id=custom-elements-api:element-interface href=https://triple-underscore.github.io/DOM4-ja.html#concept-element-interface data-x-internal=element-interface>element interface</a> for <var>extends</var> and the <a id=custom-elements-api:html-namespace-2 href=https://infra.spec.whatwg.org/#html-namespace data-x-internal=html-namespace-2>HTML
     namespace</a> is <code id=custom-elements-api:htmlunknownelement><a href=dom.html#htmlunknownelement>HTMLUnknownElement</a></code> (e.g., if <var>extends</var> does not
     indicate an element definition in this specification), then throw a
     <a id=custom-elements-api:notsupportederror-5 href=https://triple-underscore.github.io/WebIDL-ja.html#notsupportederror data-x-internal=notsupportederror>"<code>NotSupportedError</code>"</a> <code id=custom-elements-api:domexception-7><a data-x-internal=domexception href=https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException>DOMException</a></code>.</li><li><p>Set <var>localName</var> to <var>extends</var>.</li></ol>
   </li><li><p>If this <code id=custom-elements-api:customelementregistry-10><a href=#customelementregistry>CustomElementRegistry</a></code>'s <a href=#element-definition-is-running id=custom-elements-api:element-definition-is-running>element definition is running</a>
   flag is set, then throw a <a id=custom-elements-api:notsupportederror-6 href=https://triple-underscore.github.io/WebIDL-ja.html#notsupportederror data-x-internal=notsupportederror>"<code>NotSupportedError</code>"</a> <code id=custom-elements-api:domexception-8><a data-x-internal=domexception href=https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException>DOMException</a></code>
   and abort these steps.</li><li><p>Set this <code id=custom-elements-api:customelementregistry-11><a href=#customelementregistry>CustomElementRegistry</a></code>'s <a href=#element-definition-is-running id=custom-elements-api:element-definition-is-running-2>element definition is running</a>
   flag.</li><li>
    <p>Run the following substeps while catching any exceptions:</p>

    <ol><li><p>Let <var>prototype</var> be <a href=https://tc39.github.io/ecma262/#sec-get-o-p id=custom-elements-api:js-get data-x-internal=js-get>Get</a>(<var>constructor</var>, "prototype"). 例外を再度投げる。</li><li><p>If <a href=https://tc39.github.io/ecma262/#sec-ecmascript-data-types-and-values id=custom-elements-api:js-type data-x-internal=js-type>Type</a>(<var>prototype</var>) is not Object, then throw a
     <code id=custom-elements-api:typeerror-2><a data-x-internal=typeerror href=https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-typeerror>TypeError</a></code> exception.</li><li><p>Let <var>lifecycleCallbacks</var> be a map with the four keys "<code>connectedCallback</code>", "<code>disconnectedCallback</code>", "<code>adoptedCallback</code>", and "<code>attributeChangedCallback</code>", each
     of which belongs to an entry whose value is null.</p>

     </li><li>
      <p>For each of the four keys <var>callbackName</var> in <var>lifecycleCallbacks</var>, in the
      order listed in the previous step:</p>

      <ol><li><p>Let <var>callbackValue</var> be <a href=https://tc39.github.io/ecma262/#sec-get-o-p id=custom-elements-api:js-get-2 data-x-internal=js-get>Get</a>(<var>prototype</var>, <var>callbackName</var>). 例外を再度投げる。</p>

       </li><li><p>If <var>callbackValue</var> is not undefined, then set the value of the entry in
       <var>lifecycleCallbacks</var> with key <var>callbackName</var> to the result of <a href=https://triple-underscore.github.io/WebIDL-ja.html#es-type-mapping id=custom-elements-api:concept-idl-convert data-x-internal=concept-idl-convert>converting</a> <var>callbackValue</var> to the Web IDL
       <code id=custom-elements-api:idl-function><a data-x-internal=idl-function href=https://triple-underscore.github.io/WebIDL-ja.html#common-Function>Function</a></code> callback type. Rethrow any exceptions from the
       conversion.</li></ol>
     </li><li><p>Let <var>observedAttributes</var> be an empty <code>sequence&lt;DOMString&gt;</code>.</li><li>
      <p>If the value of the entry in <var>lifecycleCallbacks</var> with key "<code>attributeChangedCallback</code>" is not null, then:</p>

      <ol><li><p>Let <var>observedAttributesIterable</var> be <a href=https://tc39.github.io/ecma262/#sec-get-o-p id=custom-elements-api:js-get-3 data-x-internal=js-get>Get</a>(<var>constructor</var>, "observedAttributes"). 例外を再度投げる。</li><li><p>If <var>observedAttributesIterable</var> is not undefined, then set
       <var>observedAttributes</var> to the result of <a href=https://triple-underscore.github.io/WebIDL-ja.html#es-type-mapping id=custom-elements-api:concept-idl-convert-2 data-x-internal=concept-idl-convert>converting</a> <var>observedAttributesIterable</var> to a
       <code>sequence&lt;DOMString&gt;</code>. Rethrow any exceptions from the
       conversion.</li></ol>
    </li></ol>

    <p>Then, perform the following substep, regardless of whether the above steps threw an exception
    or not:</p>

    <ol><li><p>Unset this <code id=custom-elements-api:customelementregistry-12><a href=#customelementregistry>CustomElementRegistry</a></code>'s <a href=#element-definition-is-running id=custom-elements-api:element-definition-is-running-3>element definition is
     running</a> flag.</li></ol>

    <p>Finally, if the first set of substeps threw an exception, then rethrow that exception, and
    terminate this algorithm. Otherwise, continue onward.</p>
   </li><li><p>Let <var>definition</var> be a new <a href=#custom-element-definition id=custom-elements-api:custom-element-definition-4>custom element definition</a> with <a href=#concept-custom-element-definition-name id=custom-elements-api:concept-custom-element-definition-name-5>name</a> <var>name</var>, <a href=#concept-custom-element-definition-local-name id=custom-elements-api:concept-custom-element-definition-local-name-2>local name</a> <var>localName</var>,
   <a href=#concept-custom-element-definition-constructor id=custom-elements-api:concept-custom-element-definition-constructor-3>constructor</a>
   <var>constructor</var>, <a href=#concept-custom-element-definition-observed-attributes id=custom-elements-api:concept-custom-element-definition-observed-attributes>observed attributes</a>
   <var>observedAttributes</var>, and <a href=#concept-custom-element-definition-lifecycle-callbacks id=custom-elements-api:concept-custom-element-definition-lifecycle-callbacks>lifecycle callbacks</a>
   <var>lifecycleCallbacks</var>.</li><li><p>Add <var>definition</var> to this <code id=custom-elements-api:customelementregistry-13><a href=#customelementregistry>CustomElementRegistry</a></code>.</li><li><p>Let <var>document</var> be this <code id=custom-elements-api:customelementregistry-14><a href=#customelementregistry>CustomElementRegistry</a></code>'s <a href=webappapis.html#concept-relevant-global id=custom-elements-api:concept-relevant-global>relevant global object</a>'s <a href=browsers.html#concept-document-window id=custom-elements-api:concept-document-window>associated <code>Document</code></a>.</li><li><p>Let <var>upgrade candidates</var> be all elements that are <a href=https://triple-underscore.github.io/DOM4-ja.html#concept-shadow-including-descendant id=custom-elements-api:shadow-including-descendant data-x-internal=shadow-including-descendant>shadow-including descendants</a> of <var>document</var>, whose namespace
   is the <a id=custom-elements-api:html-namespace-2-2 href=https://infra.spec.whatwg.org/#html-namespace data-x-internal=html-namespace-2>HTML namespace</a> and whose local name is <var>localName</var>, in
   <a id=custom-elements-api:shadow-including-tree-order href=https://triple-underscore.github.io/DOM4-ja.html#concept-shadow-including-tree-order data-x-internal=shadow-including-tree-order>shadow-including tree order</a>. Additionally, if <var>extends</var> is non-null, only
   include elements whose <a href=https://triple-underscore.github.io/DOM4-ja.html#concept-element-is-value id=custom-elements-api:concept-element-is-value data-x-internal=concept-element-is-value><code>is</code>
   value</a> is equal to <var>name</var>.</li><li><p>For each element <var>element</var> in <var>upgrade candidates</var>, <a href=#enqueue-a-custom-element-upgrade-reaction id=custom-elements-api:enqueue-a-custom-element-upgrade-reaction>enqueue a
   custom element upgrade reaction</a> given <var>element</var> and
   <var>definition</var>.</li><li>
    <p>If this <code id=custom-elements-api:customelementregistry-15><a href=#customelementregistry>CustomElementRegistry</a></code>'s <a href=#when-defined-promise-map id=custom-elements-api:when-defined-promise-map>when-defined promise map</a>
    contains an entry with key <var>name</var>:</p>

    <ol><li><p>Let <var>promise</var> be the value of that entry.</li><li><p>Resolve <var>promise</var> with undefined.</li><li><p>Delete the entry with key <var>name</var> from this
     <code id=custom-elements-api:customelementregistry-16><a href=#customelementregistry>CustomElementRegistry</a></code>'s <a href=#when-defined-promise-map id=custom-elements-api:when-defined-promise-map-2>when-defined promise map</a>.</li></ol>
   </li></ol>

  <p>When invoked, the <dfn id=dom-customelementregistry-get><code>get(<var>name</var>)</code></dfn> method must run these
  steps:</p>

  <ol><li><p>If this <code id=custom-elements-api:customelementregistry-17><a href=#customelementregistry>CustomElementRegistry</a></code> contains an entry with <a href=#concept-custom-element-definition-name id=custom-elements-api:concept-custom-element-definition-name-6>name</a> <var>name</var>, then return that
   entry's <a href=#concept-custom-element-definition-constructor id=custom-elements-api:concept-custom-element-definition-constructor-4>constructor</a>.</li><li><p>Otherwise, return undefined.</li></ol>

  <p>When invoked, the <dfn id=dom-customelementregistry-whendefined><code>whenDefined(<var>name</var>)</code></dfn> method
  must run these steps:</p>

  <ol><li><p>If <var>name</var> is not a <a href=#valid-custom-element-name id=custom-elements-api:valid-custom-element-name-5>valid custom element name</a>, then return a new
   promise rejected with a <a id=custom-elements-api:syntaxerror-3 href=https://triple-underscore.github.io/WebIDL-ja.html#syntaxerror data-x-internal=syntaxerror>"<code>SyntaxError</code>"</a> <code id=custom-elements-api:domexception-9><a data-x-internal=domexception href=https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException>DOMException</a></code> and
   abort these steps.</li><li><p>If this <code id=custom-elements-api:customelementregistry-18><a href=#customelementregistry>CustomElementRegistry</a></code> contains an entry with <a href=#concept-custom-element-definition-name id=custom-elements-api:concept-custom-element-definition-name-7>name</a> <var>name</var>, then return a new
   promise resolved with undefined and abort these steps.</li><li><p>Let <var>map</var> be this <code id=custom-elements-api:customelementregistry-19><a href=#customelementregistry>CustomElementRegistry</a></code>'s <a href=#when-defined-promise-map id=custom-elements-api:when-defined-promise-map-3>when-defined
   promise map</a>.</li><li><p>If <var>map</var> does not contain an entry with key <var>name</var>, create an entry in
   <var>map</var> with key <var>name</var> and whose value is a new promise.</li><li><p>Let <var>promise</var> be the value of the entry in <var>map</var> with key
   <var>name</var>.</li><li><p>Return <var>promise</var>.</li></ol>

  <div class=example>
   <p>The <code id=custom-elements-api:dom-customelementregistry-whendefined-4><a href=#dom-customelementregistry-whendefined>whenDefined()</a></code> method can be
   used to avoid performing an action until all appropriate <a href=#custom-element id=custom-elements-api:custom-element-6>custom
   elements</a> are <a href=https://triple-underscore.github.io/DOM4-ja.html#concept-element-defined id=custom-elements-api:concept-element-defined data-x-internal=concept-element-defined>defined</a>. In this example, we
   combine it with the <code id=custom-elements-api:selector-defined><a href=#selector-defined>:defined</a></code> pseudo-class to hide a
   dynamically-loaded article's contents until we're sure that all of the <a href=#autonomous-custom-element id=custom-elements-api:autonomous-custom-element-2>autonomous custom elements</a> it uses are defined.</p>

   <pre>articleContainer.hidden = true;

fetch(articleURL)
  .then(response =&gt; response.text())
  .then(text =&gt; {
    articleContainer.innerHTML = text;

    return Promise.all(
      [...articleContainer.querySelectorAll(":not(:defined)")]
        .map(el =&gt; customElements.whenDefined(el.localName))
    );
  })
  .then(() =&gt; {
    articleContainer.hidden = false;
  });</pre>
  </div>

  <h4 id=upgrades>4.13.5 <dfn>Upgrades</dfn><a href=#upgrades class=self-link></a></h4>

  <p>To <dfn id=concept-upgrade-an-element data-export="">upgrade an element</dfn>, given as
  input a <a href=#custom-element-definition id=upgrades:custom-element-definition>custom element definition</a> <var>definition</var> and an element
  <var>element</var>, run the following steps:</p>

  <ol><li>
    <p>If <var>element</var> is <a href=https://triple-underscore.github.io/DOM4-ja.html#concept-element-custom id=upgrades:concept-element-custom data-x-internal=concept-element-custom>custom</a>, abort these
    steps.</p>

    <div class=example>
     <p>This can occur due to reentrant invocation of this algorithm, as in the following
     example:</p>

     <pre>&lt;!DOCTYPE html&gt;
&lt;x-foo id="a"&gt;&lt;/x-foo&gt;
&lt;x-foo id="b"&gt;&lt;/x-foo&gt;

&lt;script&gt;
// Defining enqueues upgrade reactions for both "a" and "b"
customElements.define("x-foo", class extends HTMLElement {
  constructor() {
    super();

    const b = document.querySelector("#b");
    b.remove();

    // While this constructor is running for "a", "b" is still
    // undefined, and so inserting it into the document will enqueue a
    // second upgrade reaction for "b" in addition to the one enqueued
    // by defining x-foo.
    document.body.appendChild(b);
  }
})
&lt;/script&gt;</pre>

     <p>This step will thus bail out the algorithm early when <a href=#concept-upgrade-an-element id=upgrades:concept-upgrade-an-element>upgrade an element</a> is invoked
     with "<code>b</code>" a second time.</p>
    </div>
   </li><li><p>If <var>element</var>'s <a id=upgrades:custom-element-state href=https://triple-underscore.github.io/DOM4-ja.html#concept-element-custom-element-state data-x-internal=custom-element-state>custom element state</a> is "<code>failed</code>", then abort these steps.</li><li><p>For each <var>attribute</var> in <var>element</var>'s <a id=upgrades:attribute-list href=https://triple-underscore.github.io/DOM4-ja.html#concept-element-attribute data-x-internal=attribute-list>attribute list</a>, in
   order, <a href=#enqueue-a-custom-element-callback-reaction id=upgrades:enqueue-a-custom-element-callback-reaction>enqueue a custom element callback reaction</a> with <var>element</var>, callback
   name "<code>attributeChangedCallback</code>", and an argument list containing
   <var>attribute</var>'s local name, null, <var>attribute</var>'s value, and <var>attribute</var>'s
   namespace.</li><li><p>If <var>element</var> is <a id=upgrades:connected href=https://triple-underscore.github.io/DOM4-ja.html#connected data-x-internal=connected>connected</a>, then <a href=#enqueue-a-custom-element-callback-reaction id=upgrades:enqueue-a-custom-element-callback-reaction-2>enqueue a custom element
   callback reaction</a> with <var>element</var>, callback name "<code>connectedCallback</code>", and an empty argument list.</li><li><p>Add <var>element</var> to the end of <var>definition</var>'s <a href=#concept-custom-element-definition-construction-stack id=upgrades:concept-custom-element-definition-construction-stack>construction stack</a>.</li><li><p>Let <var>C</var> be <var>definition</var>'s <a href=#concept-custom-element-definition-constructor id=upgrades:concept-custom-element-definition-constructor>constructor</a>.</li><li>
    <p>Run the following substeps while catching any exceptions:</p>

    <ol><li>
      <p>Let <var>constructResult</var> be the result of <a href=https://heycam.github.io/webidl/#construct-a-callback-function id=upgrades:es-constructing-callback-functions data-x-internal=es-constructing-callback-functions>constructing</a> <var>C</var>, with no
      arguments.</p>

      <p class=note>If <var>C</var> <a href=#custom-element-conformance>non-conformantly</a>
      uses an API decorated with the <code id=upgrades:cereactions><a href=#cereactions>[CEReactions]</a></code> extended
      attribute, then the reactions enqueued at the beginning of this algorithm will execute during
      this step, before <var>C</var> finishes and control returns to this algorithm. Otherwise, they
      will execute after <var>C</var> and the rest of the upgrade process finishes.</p>
     </li><li>
      <p>If <a id=upgrades:samevalue href=https://tc39.github.io/ecma262/#sec-samevalue data-x-internal=samevalue>SameValue</a>(<var>constructResult</var>, <var>element</var>) is false,
      then throw an <a id=upgrades:invalidstateerror href=https://triple-underscore.github.io/WebIDL-ja.html#invalidstateerror data-x-internal=invalidstateerror>"<code>InvalidStateError</code>"</a> <code id=upgrades:domexception><a data-x-internal=domexception href=https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException>DOMException</a></code>.</p>

      <p class=note>This can occur if <var>C</var> constructs another instance of the same custom
      element before calling <code>super()</code>, or if <var>C</var> uses JavaScript's
      <code>return</code>-override feature to return an arbitrary object from the
      constructor.</p>
     </li></ol>

    <p>Then, perform the following substep, regardless of whether the above steps threw an exception
    or not:</p>

    <ol><li>
      <p>Remove the last entry from the end of <var>definition</var>'s <a href=#concept-custom-element-definition-construction-stack id=upgrades:concept-custom-element-definition-construction-stack-2>construction stack</a>.</p>

      <div class=note>
       <p>Assuming <var>C</var> calls <code>super()</code> (as it will if it is <a href=#custom-element-conformance>conformant</a>), and that the call succeeds, this will be
       the <a href=#concept-already-constructed-marker id=upgrades:concept-already-constructed-marker><i>already
       constructed</i> marker</a> that replaced the <var>element</var> we pushed at the beginning
       of this algorithm. (The <a href=dom.html#html-element-constructors>HTML element constructor</a>
       carries out this replacement.)</p>

       <p>If <var>C</var> does not call <code>super()</code> (i.e. it is not <a href=#custom-element-conformance>conformant</a>), or if any step in the <a href=dom.html#html-element-constructors>HTML element constructor</a> throws, then this entry will
       still be <var>element</var>.</p>
      </div>
     </li></ol>

    <p>Finally, if the above steps threw an exception, then:</p>

    <ol><li><p>Set <var>element</var>'s <a id=upgrades:custom-element-state-2 href=https://triple-underscore.github.io/DOM4-ja.html#concept-element-custom-element-state data-x-internal=custom-element-state>custom element state</a> to "<code>failed</code>".</li><li><p>Empty <var>element</var>'s <a href=#custom-element-reaction-queue id=upgrades:custom-element-reaction-queue>custom element reaction queue</a>.</p>

     </li><li><p>Rethrow the exception, and terminate this algorithm.</li></ol>
   </li><li><p>Set <var>element</var>'s <a id=upgrades:custom-element-state-3 href=https://triple-underscore.github.io/DOM4-ja.html#concept-element-custom-element-state data-x-internal=custom-element-state>custom element state</a> to "<code>custom</code>".</li><li><p>Set <var>element</var>'s <a href=https://triple-underscore.github.io/DOM4-ja.html#concept-element-custom-element-definition id=upgrades:concept-element-custom-element-definition data-x-internal=concept-element-custom-element-definition>custom
   element definition</a> to <var>definition</var>.</li></ol>

  <p>To <dfn id=concept-try-upgrade data-export="">try to upgrade an element</dfn>, given as
  input an element <var>element</var>, run the following steps:</p>

  <ol><li><p>Let <var>definition</var> be the result of <a href=#look-up-a-custom-element-definition id=upgrades:look-up-a-custom-element-definition>looking up a custom element definition</a> given <var>element</var>'s <a id=upgrades:node-document href=https://triple-underscore.github.io/DOM4-ja.html#concept-node-document data-x-internal=node-document>node
   document</a>, <var>element</var>'s namespace, <var>element</var>'s local name, and
   <var>element</var>'s <a href=https://triple-underscore.github.io/DOM4-ja.html#concept-element-is-value id=upgrades:concept-element-is-value data-x-internal=concept-element-is-value><code>is</code>
   value</a>.</li><li><p>If <var>definition</var> is not null, then <a href=#enqueue-a-custom-element-upgrade-reaction id=upgrades:enqueue-a-custom-element-upgrade-reaction>enqueue a custom element upgrade
   reaction</a> given <var>element</var> and <var>definition</var>.</li></ol>

  <h4 id=custom-element-reactions>4.13.6 Custom element reactions<a href=#custom-element-reactions class=self-link></a></h4>

  <p>A <a href=#custom-element id=custom-element-reactions:custom-element>custom element</a> possesses the ability to respond to certain occurrences by
  running author code:</p>

  <ul><li><p>When <a href=#upgrades id=custom-element-reactions:upgrades>upgraded</a>, its <a href=#custom-element-constructor id=custom-element-reactions:custom-element-constructor>constructor</a> is run.</li><li><p>When it <a id=custom-element-reactions:becomes-connected href=infrastructure.html#becomes-connected>becomes connected</a>, its <code>connectedCallback</code> is
   run.</li><li><p>When it <a id=custom-element-reactions:becomes-disconnected href=infrastructure.html#becomes-disconnected>becomes disconnected</a>, its <code>disconnectedCallback</code>
   is run.</li><li><p>When it is <a href=https://triple-underscore.github.io/DOM4-ja.html#concept-node-adopt id=custom-element-reactions:concept-node-adopt data-x-internal=concept-node-adopt>adopted</a> into a new document, its <code>adoptedCallback</code> is run.</li><li><p>When any of its attributes are <a href=https://triple-underscore.github.io/DOM4-ja.html#concept-element-attributes-change id=custom-element-reactions:concept-element-attributes-change data-x-internal=concept-element-attributes-change>changed</a>, <a href=https://triple-underscore.github.io/DOM4-ja.html#concept-element-attributes-append id=custom-element-reactions:concept-element-attributes-append data-x-internal=concept-element-attributes-append>appended</a>, <a href=https://triple-underscore.github.io/DOM4-ja.html#concept-element-attributes-remove id=custom-element-reactions:concept-element-attributes-remove data-x-internal=concept-element-attributes-remove>removed</a>, or <a href=https://triple-underscore.github.io/DOM4-ja.html#concept-element-attributes-replace id=custom-element-reactions:concept-element-attributes-replace data-x-internal=concept-element-attributes-replace>replaced</a>, its <code>attributeChangedCallback</code> is run.</li></ul>

  <p>We call these reactions collectively <dfn id=concept-custom-element-reaction>custom
  element reactions</dfn>.</p>

  <p>The way in which <a href=#concept-custom-element-reaction id=custom-element-reactions:concept-custom-element-reaction>custom element reactions</a>
  are invoked is done with special care, to avoid running author code during the middle of delicate
  operations. Effectively, they are delayed until "just before returning to user script". This means
  that for most purposes they appear to execute synchronously, but in the case of complicated
  composite operations (like <a href=https://triple-underscore.github.io/DOM4-ja.html#concept-node-clone id=custom-element-reactions:concept-node-clone data-x-internal=concept-node-clone>cloning</a>, or <a href=https://triple-underscore.github.io/DOM4-ja.html#concept-range id=custom-element-reactions:concept-range data-x-internal=concept-range>range</a> manipulation), they will instead be delayed until after all
  the relevant user agent processing steps have completed, and then run together as a batch.</p>

  <p>Additionally, the precise ordering of these reactions is managed via a somewhat-complicated
  stack-of-queues system, described below. The intention behind this system is to guarantee that
  <a href=#concept-custom-element-reaction id=custom-element-reactions:concept-custom-element-reaction-2>custom element reactions</a> always are invoked
  in the same order as their triggering actions, at least within the local context of a single
  <a href=#custom-element id=custom-element-reactions:custom-element-2>custom element</a>. (Because <a href=#concept-custom-element-reaction id=custom-element-reactions:concept-custom-element-reaction-3>custom
  element reaction</a> code can perform its own mutations, it is not possible to give a global
  ordering guarantee across multiple elements.)</p>

  <hr>

  <p>Each <a id=custom-element-reactions:unit-of-related-similar-origin-browsing-contexts href=browsers.html#unit-of-related-similar-origin-browsing-contexts>unit of related similar-origin browsing contexts</a> has a <dfn id=custom-element-reactions-stack>custom element
  reactions stack</dfn>, which is initially empty. The <dfn id=current-element-queue>current element queue</dfn> is the
  <a href=#element-queue id=custom-element-reactions:element-queue>element queue</a> at the top of the <a href=#custom-element-reactions-stack id=custom-element-reactions:custom-element-reactions-stack>custom element reactions stack</a>. Each
  item in the stack is an <dfn id=element-queue>element queue</dfn>, which is initially empty as well. Each item in
  an <a href=#element-queue id=custom-element-reactions:element-queue-2>element queue</a> is an element. (The elements are not necessarily <a href=https://triple-underscore.github.io/DOM4-ja.html#concept-element-custom id=custom-element-reactions:concept-element-custom data-x-internal=concept-element-custom>custom</a> yet, since this queue is used for <a href=#upgrades id=custom-element-reactions:upgrades-2>upgrades</a> as well.)</p>

  <p>Each <a href=#custom-element-reactions-stack id=custom-element-reactions:custom-element-reactions-stack-2>custom element reactions stack</a> has an associated <dfn id=backup-element-queue>backup element
  queue</dfn>, which an initially-empty <a href=#element-queue id=custom-element-reactions:element-queue-3>element queue</a>. Elements are pushed onto the
  <a href=#backup-element-queue id=custom-element-reactions:backup-element-queue>backup element queue</a> during operations that affect the DOM without going through an
  API decorated with <code id=custom-element-reactions:cereactions><a href=#cereactions>[CEReactions]</a></code>, or through the parser's
  <a id=custom-element-reactions:create-an-element-for-the-token href=syntax.html#create-an-element-for-the-token>create an element for the token</a> algorithm. An example of this is a user-initiated
  editing operation which modifies the descendants or attributes of an <a id=custom-element-reactions:editable href=https://w3c.github.io/editing/execCommand.html#editable data-x-internal=editable>editable</a>
  element. To prevent reentrancy when processing the <a href=#backup-element-queue id=custom-element-reactions:backup-element-queue-2>backup element queue</a>, each
  <a href=#custom-element-reactions-stack id=custom-element-reactions:custom-element-reactions-stack-3>custom element reactions stack</a> also has a <dfn id=processing-the-backup-element-queue>processing the backup element
  queue</dfn> flag, initially unset.</p>

  <p>All elements have an associated <dfn id=custom-element-reaction-queue>custom element reaction queue</dfn>, initially empty. Each
  item in the <a href=#custom-element-reaction-queue id=custom-element-reactions:custom-element-reaction-queue>custom element reaction queue</a> is of one of two types:</p>

  <ul><li><p>An <dfn id=upgrade-reaction>upgrade reaction</dfn>, which will <a href=#upgrades id=custom-element-reactions:upgrades-3>upgrade</a> the custom element and contains a <a href=#custom-element-definition id=custom-element-reactions:custom-element-definition>custom
   element definition</a>; or</li><li><p>A <dfn id=callback-reaction>callback reaction</dfn>, which will call a lifecycle callback, and contains a
   callback function as well as a list of arguments.</li></ul>

  <p>これは、次の模式図にすべて要約される：</p>

  <p><img src=https://html.spec.whatwg.org/multipage/images/custom-element-reactions.svg alt="A custom element reactions stack consists of a stack of element queues. Zooming in on a particular queue, we see that it contains a number of elements (in our example, &lt;x-a&gt;, then &lt;x-b&gt;, then &lt;x-c&gt;). Any particular element in the queue then has a custom element reaction queue. Zooming in on the custom element reaction queue, we see that it contains a variety of queued-up reactions (in our example, upgrade, then attribute changed, then another attribute changed, then connected)." style="width: 80%; max-width: 580px;"></p>

  <p>To <dfn id=enqueue-an-element-on-the-appropriate-element-queue>enqueue an element on the appropriate element queue</dfn>, given an element
  <var>element</var>, run the following steps:</p>

  <ol><li>
    <p>If the <a href=#custom-element-reactions-stack id=custom-element-reactions:custom-element-reactions-stack-4>custom element reactions stack</a> is empty, then:</p>

    <ol><li><p>Add <var>element</var> to the <a href=#backup-element-queue id=custom-element-reactions:backup-element-queue-3>backup element queue</a>.</li><li><p>If the <a href=#processing-the-backup-element-queue id=custom-element-reactions:processing-the-backup-element-queue>processing the backup element queue</a> flag is set, abort this
     algorithm.</li><li><p>Set the <a href=#processing-the-backup-element-queue id=custom-element-reactions:processing-the-backup-element-queue-2>processing the backup element queue</a> flag.</li><li>
      <p><a id=custom-element-reactions:queue-a-microtask href=webappapis.html#queue-a-microtask>Queue a microtask</a> to perform the following steps:</p>

      <ol><li><p><a href=#invoke-custom-element-reactions id=custom-element-reactions:invoke-custom-element-reactions>Invoke custom element reactions</a> in the <a href=#backup-element-queue id=custom-element-reactions:backup-element-queue-4>backup element
       queue</a>.</li><li><p>Unset the <a href=#processing-the-backup-element-queue id=custom-element-reactions:processing-the-backup-element-queue-3>processing the backup element queue</a> flag.</li></ol>
     </li></ol>
   </li><li><p>Otherwise, add <var>element</var> to the <a href=#current-element-queue id=custom-element-reactions:current-element-queue>current element queue</a>.</li></ol>

  <p>To <dfn id=enqueue-a-custom-element-callback-reaction data-export="">enqueue a custom element callback reaction</dfn>, given a <a href=#custom-element id=custom-element-reactions:custom-element-3>custom
  element</a> <var>element</var>, a callback name <var>callbackName</var>, and a list of
  arguments <var>args</var>, run the following steps:</p>

  <ol><li><p>Let <var>definition</var> be <var>element</var>'s <a href=https://triple-underscore.github.io/DOM4-ja.html#concept-element-custom-element-definition id=custom-element-reactions:concept-element-custom-element-definition data-x-internal=concept-element-custom-element-definition>custom element definition</a>.</p>

   </li><li><p>Let <var>callback</var> be the value of the entry in <var>definition</var>'s <a href=#concept-custom-element-definition-lifecycle-callbacks id=custom-element-reactions:concept-custom-element-definition-lifecycle-callbacks>lifecycle callbacks</a> with
   key <var>callbackName</var>.</li><li><p>If <var>callback</var> is null, then abort these steps.</li><li>
    <p>If <var>callbackName</var> is "<code>attributeChangedCallback</code>", then:</p>

    <ol><li><p>Let <var>attributeName</var> be the first element of <var>args</var>.</li><li><p>If <var>definition</var>'s <a href=#concept-custom-element-definition-observed-attributes id=custom-element-reactions:concept-custom-element-definition-observed-attributes>observed attributes</a> does
     not contain <var>attributeName</var>, then abort these steps.</li></ol>
   </li><li><p>Add a new <a href=#callback-reaction id=custom-element-reactions:callback-reaction>callback reaction</a> to <var>element</var>'s <a href=#custom-element-reaction-queue id=custom-element-reactions:custom-element-reaction-queue-2>custom element
   reaction queue</a>, with callback function <var>callback</var> and arguments
   <var>args</var>.</li><li><p><a href=#enqueue-an-element-on-the-appropriate-element-queue id=custom-element-reactions:enqueue-an-element-on-the-appropriate-element-queue>Enqueue an element on the appropriate element queue</a> given
   <var>element</var>.</li></ol>

  <p>To <dfn id=enqueue-a-custom-element-upgrade-reaction data-export="">enqueue a custom element upgrade reaction</dfn>, given an element
  <var>element</var> and <a href=#custom-element-definition id=custom-element-reactions:custom-element-definition-2>custom element definition</a> <var>definition</var>, run the
  following steps:</p>

  <ol><li><p>Add a new <a href=#upgrade-reaction id=custom-element-reactions:upgrade-reaction>upgrade reaction</a> to <var>element</var>'s <a href=#custom-element-reaction-queue id=custom-element-reactions:custom-element-reaction-queue-3>custom element
   reaction queue</a>, with <a href=#custom-element-definition id=custom-element-reactions:custom-element-definition-3>custom element definition</a>
   <var>definition</var>.</li><li><p><a href=#enqueue-an-element-on-the-appropriate-element-queue id=custom-element-reactions:enqueue-an-element-on-the-appropriate-element-queue-2>Enqueue an element on the appropriate element queue</a> given
   <var>element</var>.</li></ol>

  <p>To <dfn id=invoke-custom-element-reactions>invoke custom element reactions</dfn> in an <a href=#element-queue id=custom-element-reactions:element-queue-4>element queue</a>
  <var>queue</var>, run the following steps:</p>

  <ol><li>
    <p>For each <a href=#custom-element id=custom-element-reactions:custom-element-4>custom element</a> <var>element</var> in <var>queue</var>:</p>

    <ol><li><p>Let <var>reactions</var> be <var>element</var>'s <a href=#custom-element-reaction-queue id=custom-element-reactions:custom-element-reaction-queue-4>custom element reaction
     queue</a>.</li><li>
      <p>Repeat until <var>reactions</var> is empty:</p>

      <ol><li>
        <p>Remove the first element of <var>reactions</var>, and let <var>reaction</var> be that
        element. Switch on <var>reaction</var>'s type:</p>

        <dl class=switch><dt><a href=#upgrade-reaction id=custom-element-reactions:upgrade-reaction-2>upgrade reaction</a><dd><a href=#concept-upgrade-an-element id=custom-element-reactions:concept-upgrade-an-element>Upgrade</a> <var>element</var> using
         <var>reaction</var>'s <a href=#custom-element-definition id=custom-element-reactions:custom-element-definition-4>custom element definition</a>.<dt><a href=#callback-reaction id=custom-element-reactions:callback-reaction-2>callback reaction</a><dd><a href=https://heycam.github.io/webidl/#invoke-a-callback-function id=custom-element-reactions:es-invoking-callback-functions data-x-internal=es-invoking-callback-functions>Invoke</a> <var>reaction</var>'s
         callback function with <var>reaction</var>'s arguments, and with <var>element</var> as the
         <a href=https://triple-underscore.github.io/WebIDL-ja.html#dfn-callback-this-value id=custom-element-reactions:dfn-callback-this-value data-x-internal=dfn-callback-this-value>callback this value</a>.</dl>

        <p>If this throws any exception, then <a id=custom-element-reactions:report-the-exception href=webappapis.html#report-the-exception>report the exception</a>.</p>
       </li></ol>
     </li></ol>
   </li></ol>

  <hr>

  <p>To ensure <a href=#concept-custom-element-reaction id=custom-element-reactions:concept-custom-element-reaction-4>custom element reactions</a> are
  triggered appropriately, we introduce the <dfn id=cereactions data-dfn-type=extended-attribute data-lt=CEReactions data-export=""><code>[CEReactions]</code></dfn> IDL <a id=custom-element-reactions:extended-attribute href=https://triple-underscore.github.io/WebIDL-ja.html#dfn-extended-attribute data-x-internal=extended-attribute>extended
  attribute</a>. It indicates that the relevant algorithm is to be supplemented with additional
  steps in order to appropriately track and invoke <a href=#concept-custom-element-reaction id=custom-element-reactions:concept-custom-element-reaction-5>custom element reactions</a>.</p>

  <p>The <code id=custom-element-reactions:cereactions-2><a href=#cereactions>[CEReactions]</a></code> extended attribute must take no
  arguments, and must not appear on anything other than an operation, attribute, setter, or deleter.
  Additionally, it must not appear on readonly attributes.</p>

  <p>Operations, attributes, setters, or deleters annotated with the <code id=custom-element-reactions:cereactions-3><a href=#cereactions>[CEReactions]</a></code> extended attribute must run the following steps
  surrounding the actions listed in the description of the operation, setter, deleter, or the
  attribute's setter:</p>

  <dl><dt>Before executing the listed actions<dd>Push a new <a href=#element-queue id=custom-element-reactions:element-queue-5>element queue</a> onto the <a href=#custom-element-reactions-stack id=custom-element-reactions:custom-element-reactions-stack-5>custom element reactions
   stack</a>.<dt>After executing the listed actions<dd>Pop the <a href=#element-queue id=custom-element-reactions:element-queue-6>element queue</a> from the <a href=#custom-element-reactions-stack id=custom-element-reactions:custom-element-reactions-stack-6>custom element reactions stack</a>, and
   <a href=#invoke-custom-element-reactions id=custom-element-reactions:invoke-custom-element-reactions-2>invoke custom element reactions</a> in that queue.</dl>

  <div class=note>
   <p>The intent behind this extended attribute is somewhat subtle. One way of accomplishing its
   goals would be to say that every operation, attribute, setter, and deleter on the platform
   must have these steps inserted, and to allow implementers to optimize away
   unnecessary cases (where no DOM mutation is possible that could cause <a href=#concept-custom-element-reaction id=custom-element-reactions:concept-custom-element-reaction-6>custom element reactions</a> to occur).</p>

   <p>However, in practice this imprecision could lead to non-interoperable implementations of <a href=#concept-custom-element-reaction id=custom-element-reactions:concept-custom-element-reaction-7>custom element reactions</a>, as some implementations
   might forget to invoke these steps in some cases. Instead, we settled on the approach of
   explicitly annotating all relevant IDL constructs, as a way of ensuring interoperable behavior
   and helping implementations easily pinpoint all cases where these steps are necessary.</p>
  </div>

  <p>Any nonstandard APIs introduced by the user agent that could modify the DOM in such a way as to
  cause <a href=#enqueue-a-custom-element-callback-reaction id=custom-element-reactions:enqueue-a-custom-element-callback-reaction>enqueuing a custom element
  callback reaction</a> or <a href=#enqueue-a-custom-element-upgrade-reaction id=custom-element-reactions:enqueue-a-custom-element-upgrade-reaction>enqueuing a
  custom element upgrade reaction</a>, for example by modifying any attributes or child elements,
  must also be decorated with the <code id=custom-element-reactions:cereactions-4><a href=#cereactions>[CEReactions]</a></code> attribute.</p>

  <div class=note>
   <p>As of the time of this writing, the following nonstandard or not-yet-standardized APIs are
   known to fall into this category:</p>

   <ul><li><p><code id=custom-element-reactions:htmlelement><a href=dom.html#htmlelement>HTMLElement</a></code>'s <code>outerText</code> IDL attribute</li><li><p><code id=custom-element-reactions:htmlinputelement><a href=forms.html#htmlinputelement>HTMLInputElement</a></code>'s <code>webkitdirectory</code> and <code>incremental</code> IDL attributes</li><li><p><code id=custom-element-reactions:htmllinkelement><a href=semantics.html#htmllinkelement>HTMLLinkElement</a></code>'s <code>disabled</code> and <code>scope</code> IDL attributes</li><li><p><code id=custom-element-reactions:shadowroot><a data-x-internal=shadowroot href=https://triple-underscore.github.io/DOM4-ja.html#interface-shadowroot>ShadowRoot</a></code>'s <code>innerHTML</code> IDL attribute</li></ul>
  </div>



  <h3 id=common-idioms>4.14 専用要素なしの一般的語彙<a href=#common-idioms class=self-link></a></h3>

  <h4 id=the-main-part-of-the-content>4.14.1 コンテンツの主要部分<a href=#the-main-part-of-the-content class=self-link></a></h4>

  <p>ページの主要コンテンツ―ヘッダーとフッター、ナビゲーションリンク、サイドバー、広告などを含まない―は、著者のニーズに応じて、様々な方法でマークアップすることができる。</p>

  <p>最も簡単な解決策は、すべての主要なコンテンツをマークアップせず、単に暗黙的としてそれを放置することである。これを考えるための別の方法は、<code id=the-main-part-of-the-content:the-body-element><a href=semantics.html#the-body-element>body</a></code>要素が、ページの主要コンテンツをマークし、主要コンテンツでないビットは、<code id=the-main-part-of-the-content:the-aside-element><a href=semantics.html#the-aside-element>aside</a></code>や<code id=the-main-part-of-the-content:the-nav-element><a href=semantics.html#the-nav-element>nav</a></code>のような、より適切な要素を使用することを通して排除される。</p>

  <div class=example>

   <p>これは思考のこの最小主義の学校に沿ってマークアップされた短いウェブページである。主要コンテンツは強調表示される。<code id=the-main-part-of-the-content:the-body-element-2><a href=semantics.html#the-body-element>body</a></code>内の<em>他の</em>すべてのコンテンツが、この場合<code id=the-main-part-of-the-content:the-header-element><a href=semantics.html#the-header-element>header</a></code>、<code id=the-main-part-of-the-content:the-nav-element-2><a href=semantics.html#the-nav-element>nav</a></code>、および<code id=the-main-part-of-the-content:the-footer-element><a href=semantics.html#the-footer-element>footer</a></code>で、主要コンテンツの一部ではないことを示すための要素でマークアップされる方法に注目する。</p>

   <pre>&lt;!DOCTYPE HTML&gt;
&lt;html lang="en"&gt;
 &lt;head&gt;
  &lt;title&gt; My Toys &lt;/title&gt;
 &lt;/head&gt;
 &lt;body&gt;
  &lt;header&gt;
   &lt;h1&gt;My toys&lt;/h1&gt;
  &lt;/header&gt;
  &lt;nav&gt;
   &lt;p&gt;&lt;a href="/"&gt;Home&lt;/a&gt;&lt;/p&gt;
   &lt;p&gt;&lt;a href="/contact"&gt;Contact&lt;/a&gt;&lt;/p&gt;
  &lt;/nav&gt;
<strong>  &lt;p&gt;I really like my chained book and my telephone. I'm not such a
  fan of my big ball.&lt;/p&gt;
  &lt;p&gt;Another toy I like is my mirror.&lt;/p&gt;</strong>
  &lt;footer&gt;
   &lt;p&gt;© copyright 2010 by the boy&lt;/p&gt;
  &lt;/footer&gt;
 &lt;/body&gt;
&lt;/html&gt;</pre>

  </div>

  <p>主要コンテンツは、1つが独立してシンジケートを想像できるコンテンツの独立したユニットである場合、<code id=the-main-part-of-the-content:the-article-element><a href=semantics.html#the-article-element>article</a></code>要素は、文書のメインコンテンツをマークアップするために適切である。</p>

  <div class=example>

   <p>前の例の文書は、ここではブログの記事として書き直される：</p>

   <pre>&lt;!DOCTYPE HTML&gt;
&lt;html lang="en"&gt;
 &lt;head&gt;
  &lt;title&gt; The Boy Blog: My Toys &lt;/title&gt;
 &lt;/head&gt;
 &lt;body&gt;
  &lt;header&gt;
   &lt;h1&gt;The Boy Blog&lt;/h1&gt;
  &lt;/header&gt;
  &lt;nav&gt;
   &lt;p&gt;&lt;a href="/"&gt;Home&lt;/a&gt;&lt;/p&gt;
   &lt;p&gt;&lt;a href="/contact"&gt;Contact&lt;/a&gt;&lt;/p&gt;
  &lt;/nav&gt;
<strong>  &lt;article&gt;
   &lt;header&gt;
    &lt;h1&gt;My toys&lt;/h1&gt;
    &lt;p&gt;Published August 4th&lt;/p&gt;
   &lt;/header&gt;
   &lt;p&gt;I really like my chained book and my telephone. I'm not such a
   fan of my big ball.&lt;/p&gt;
   &lt;p&gt;Another toy I like is my mirror.&lt;/p&gt;
  &lt;/article&gt;</strong>
  &lt;footer&gt;
   &lt;p&gt;© copyright 2010 by the boy&lt;/p&gt;
  &lt;/footer&gt;
 &lt;/body&gt;
&lt;/html&gt;</pre>

  </div>

  <p>主要コンテンツは、例えば章の場合、より大きな作業の一部と同じようなコンテンツの独立したユニットでない場合、<code id=the-main-part-of-the-content:the-section-element><a href=semantics.html#the-section-element>section</a></code>要素は、文書のメインコンテンツをマークアップするために適切である。</p>

  <div class=example>

   <p>これは同じ文書であるが、オンラインブックの章のように：</p>

   <pre>&lt;!DOCTYPE HTML&gt;
&lt;html lang="en"&gt;
 &lt;head&gt;
  &lt;title&gt; Chapter 2: My Toys — The Book of the Boy &lt;/title&gt;
 &lt;/head&gt;
 &lt;body&gt;
  &lt;header&gt;
   &lt;hgroup&gt;
    &lt;h1&gt;The Book of the Boy&lt;/h1&gt;
    &lt;h2&gt;A book about boy stuff&lt;/h2&gt;
   &lt;/hgroup&gt;
  &lt;/header&gt;
  &lt;nav&gt;
   &lt;p&gt;&lt;a href="/"&gt;Front Page&lt;/a&gt;&lt;/p&gt;
   &lt;p&gt;&lt;a href="/toc"&gt;Table of Contents&lt;/a&gt;&lt;/p&gt;
   &lt;p&gt;&lt;a href="/c1"&gt;Chapter 1&lt;/a&gt; — &lt;a href="/c3"&gt;Chapter 3&lt;/a&gt;&lt;/p&gt;
  &lt;/nav&gt;
<strong>  &lt;section&gt;
   &lt;h1&gt;Chapter 2: My Toys&lt;/h1&gt;
   &lt;p&gt;I really like my chained book and my telephone. I'm not such a
   fan of my big ball.&lt;/p&gt;
   &lt;p&gt;Another toy I like is my mirror.&lt;/p&gt;
  &lt;/section&gt;</strong>
 &lt;/body&gt;
&lt;/html&gt;</pre>

  </div>

  <p><code id=the-main-part-of-the-content:the-article-element-2><a href=semantics.html#the-article-element>article</a></code>も<code id=the-main-part-of-the-content:the-section-element-2><a href=semantics.html#the-section-element>section</a></code>のいずれも適切でないが、主要コンテンツはまだ明確な要素を必要とする場合、たとえばスタイリングのために、<code id=the-main-part-of-the-content:the-main-element><a href=semantics.html#the-main-element>main</a></code>要素を使用することができる。</p>

  <div class=example>

   <p>これは元の例と同じであるが、代わりに暗黙のセクションを残して主要コンテンツのために<code id=the-main-part-of-the-content:the-main-element-2><a href=semantics.html#the-main-element>main</a></code>を使用する：</p>

   <pre>&lt;!DOCTYPE HTML&gt;
&lt;html lang="en"&gt;
 &lt;head&gt;
  &lt;title&gt; My Toys &lt;/title&gt;
  &lt;style&gt;
   body &gt; main { background: navy; color: yellow; }
  &lt;/style&gt;
 &lt;/head&gt;
 &lt;body&gt;
  &lt;header&gt;
   &lt;h1&gt;My toys&lt;/h1&gt;
  &lt;/header&gt;
  &lt;nav&gt;
   &lt;p&gt;&lt;a href="/"&gt;Home&lt;/a&gt;&lt;/p&gt;
   &lt;p&gt;&lt;a href="/contact"&gt;Contact&lt;/a&gt;&lt;/p&gt;
  &lt;/nav&gt;
<strong>  &lt;main&gt;
   &lt;p&gt;I really like my chained book and my telephone. I'm not such a
   fan of my big ball.&lt;/p&gt;
   &lt;p&gt;Another toy I like is my mirror.&lt;/p&gt;
  &lt;/main&gt;</strong>
  &lt;footer&gt;
   &lt;p&gt;© copyright 2010 by the boy&lt;/p&gt;
  &lt;/footer&gt;
 &lt;/body&gt;
&lt;/html&gt;</pre>

  </div>


  <h4 id=rel-up>4.14.2 パンくずナビゲーション<a href=#rel-up class=self-link></a></h4>

  <p>この仕様は、パンくずナビゲーションメニューを記述する機械可読な方法を提供しない。著者は単に段落で一連のリンクを使用するよう推奨される。<code id=rel-up:the-nav-element><a href=semantics.html#the-nav-element>nav</a></code>要素は、ナビゲーションブロックであるとして、これらの段落を含むセクションをマークするために使用できる。</p>

  

  <div class=example>

   <p>次の例において、現在のページは2つの経路を経由して到達できる。</p>

   <pre>&lt;nav&gt;
 &lt;p&gt;
  &lt;a href="/"&gt;Main&lt;/a&gt; ▸
  &lt;a href="/products/"&gt;Products&lt;/a&gt; ▸
  &lt;a href="/products/dishwashers/"&gt;Dishwashers&lt;/a&gt; ▸
  &lt;a&gt;Second hand&lt;/a&gt;
 &lt;/p&gt;
 &lt;p&gt;
  &lt;a href="/"&gt;Main&lt;/a&gt; ▸
  &lt;a href="/second-hand/"&gt;Second hand&lt;/a&gt; ▸
  &lt;a&gt;Dishwashers&lt;/a&gt;
 &lt;/p&gt;
&lt;/nav&gt;</pre>

  </div>


  <h4 id=tag-clouds>4.14.3 タグクラウド<a href=#tag-clouds class=self-link></a></h4>

  <p id=tag-cloud>この仕様は、ページのグループ（<i>タグクラウド</i>とも呼ばれる）に適用するキーワードのリストをマークアップするための特別な任意のマークアップを定義しない。一般に著者は、非表示およびスタイルシートを使って見栄え効果をだす明示的なインラインのカウントをもつ<code id=tag-clouds:the-ul-element><a href=semantics.html#the-ul-element>ul</a></code>要素を使用してこのようなリストをマークアップする、またはSVGを使用することのいずれかを推奨される。</p>

  <div class=example>

   <p>ここで、3つのタグは短いタグクラウドに含まれる：</p>

   <pre>&lt;style&gt;
.tag-cloud &gt; li &gt; span { display: none; }
.tag-cloud &gt; li { display: inline; }
.tag-cloud-1 { font-size: 0.7em; }
.tag-cloud-2 { font-size: 0.9em; }
.tag-cloud-3 { font-size: 1.1em; }
.tag-cloud-4 { font-size: 1.3em; }
.tag-cloud-5 { font-size: 1.5em; }

@media speech {
  .tag-cloud &gt; li &gt; span { display:inline }
}
&lt;/style&gt;
...
&lt;ul class="tag-cloud"&gt;
 &lt;li class="tag-cloud-4"&gt;&lt;a title="28 instances" href="/t/apple"&gt;apple&lt;/a&gt; &lt;span&gt;(popular)&lt;/span&gt;
 &lt;li class="tag-cloud-2"&gt;&lt;a title="6 instances"  href="/t/kiwi"&gt;kiwi&lt;/a&gt; &lt;span&gt;(rare)&lt;/span&gt;
 &lt;li class="tag-cloud-5"&gt;&lt;a title="41 instances" href="/t/pear"&gt;pear&lt;/a&gt; &lt;span&gt;(very popular)&lt;/span&gt;
&lt;/ul&gt;</pre>

   <p>それぞれのタグに関する実際の頻度は、<code id=tag-clouds:attr-title><a href=dom.html#attr-title>title</a></code>属性を用いて説明する。CSSスタイルシートは、異なるサイズの単語のクラウドにマークアップを変換するために提供されるが、CSSをサポートしないか視覚系でないユーザーエージェントのために、頻度によって様々なタグを分類するためにマークアップは"(popular)"または"(rare)"のような注釈を含む。したがって、すべてのユーザーが情報の恩恵を受けることが可能となる。</p>

   <p>順序は特に重要でないので、（<code id=tag-clouds:the-ol-element><a href=semantics.html#the-ol-element>ol</a></code>よりむしろ）<code id=tag-clouds:the-ul-element-2><a href=semantics.html#the-ul-element>ul</a></code>要素が使用される。リストは実際にはアルファベット順である一方で、タグの長さによって並べられる場合に同じ情報を伝えるだろう。</p>

   <p>ページ自体に適用するタグを表すものではないため、<code id=tag-clouds:link-type-tag><a href=semantics.html#link-type-tag>tag</a></code>の<code id=tag-clouds:attr-hyperlink-rel><a href=semantics.html#attr-hyperlink-rel>rel</a></code>キーワードはこれら<code id=tag-clouds:the-a-element><a href=semantics.html#the-a-element>a</a></code>要素で使用され<em>ない</em>。これらはタグ自体をリスト化するインデックスの単なる一部である。</p>

  </div>


  <h4 id=conversations>4.14.4 会話<a href=#conversations class=self-link></a></h4>

  

  <p>この仕様は、ミーティング議事録、チャット記録、脚本における対話、インスタントメッセージログ、および様々なプレーヤーが交代で談話する他の状況を満たし、会話をマークアップするための特定の要素を定義しない。</p>

  <p>代わりに、著者は<code id=conversations:the-p-element><a href=semantics.html#the-p-element>p</a></code>要素や句読点を使って会話をマークアップすることを推奨する。スタイリング目的のために話者を印をつける必要がある著者は、<code id=conversations:the-span-element><a href=semantics.html#the-span-element>span</a></code>または<code id=conversations:the-b-element><a href=semantics.html#the-b-element>b</a></code>を使用するよう推奨される。<code id=conversations:the-i-element><a href=semantics.html#the-i-element>i</a></code>要素に包まれたテキストを含む段落は、ステージ方向をマークアップするために使用できる。</p>

  <div class=example>

   <p>この例は、AbbotとCostelloの有名なスケッチ、<cite>Who's on first</cite>からの抽出物を用いてこれを示す：</p>

<pre>&lt;p&gt; Costello: Look, you gotta first baseman?
&lt;p&gt; Abbott: Certainly.
&lt;p&gt; Costello: Who's playing first?
&lt;p&gt; Abbott: That's right.
&lt;p&gt; Costello becomes exasperated.
&lt;p&gt; Costello: When you pay off the first baseman every month, who gets the money?
&lt;p&gt; Abbott: Every dollar of it.</pre>

  </div>

  <div class=example>

   <p>以下の抜粋は、インスタントメッセージの会話ログが、行ごとのUnixタイムスタンプを提供するために<code id=conversations:the-data-element><a href=semantics.html#the-data-element>data</a></code>要素を使用して、マークアップする方法を示す。タイムスタンプは、<code id=conversations:the-time-element><a href=semantics.html#the-time-element>time</a></code>要素が対応していない形式で提供されており、よって<code id=conversations:the-data-element-2><a href=semantics.html#the-data-element>data</a></code>要素が（すなわち、Unixの<code>time_t</code>のタイムスタンプ）代わりに使用されることに注意されたい。著者は、<code id=conversations:the-time-element-2><a href=semantics.html#the-time-element>time</a></code>要素でサポートされる日付と時刻のいずれかを使用してデータをマークアップすることを望んだが、その要素は、<code id=conversations:the-data-element-3><a href=semantics.html#the-data-element>data</a></code>の代わりに使用されていたかもしれない。データ分析ツールがページの著者と調整することなく、明確にタイムスタンプを検出することを可能にするので、これは都合がよいかもしれない。</p>

   <pre>&lt;p&gt; &lt;data value="1319898155"&gt;14:22&lt;/data&gt; &lt;b&gt;egof&lt;/b&gt; I'm not that nerdy, I've only seen 30% of the star trek episodes
&lt;p&gt; &lt;data value="1319898192"&gt;14:23&lt;/data&gt; &lt;b&gt;kaj&lt;/b&gt; if you know what percentage of the star trek episodes you have seen, you are inarguably nerdy
&lt;p&gt; &lt;data value="1319898200"&gt;14:23&lt;/data&gt; &lt;b&gt;egof&lt;/b&gt; it's unarguably
&lt;p&gt; &lt;data value="1319898228"&gt;14:23&lt;/data&gt; &lt;i&gt;* kaj blinks&lt;/i&gt;
&lt;p&gt; &lt;data value="1319898260"&gt;14:24&lt;/data&gt; &lt;b&gt;kaj&lt;/b&gt; you are not helping your case</pre>
   

  </div>

  <div class=example>

   <p>HTMLは、グラフをマークアップするための良い方法を持たないので、ゲーム由来のインタラクティブな会話の記述をマークアップするのはより困難である。この例は、会話の各時点での可能な応答を列挙するために<code id=conversations:the-dl-element><a href=semantics.html#the-dl-element>dl</a></code>要素を用いて1つの可能な規則を示す。考慮すべきもう一つのオプションは、DOTファイル形式で会話を記述するものであり、文書内に配置するSVG画像として結果を出力している。<a href=references.html#refsDOT>[DOT]</a></p>

   <pre>&lt;p&gt; Next, you meet a fisher. You can say one of several greetings:
&lt;dl&gt;
 &lt;dt&gt; "Hello there!"
 &lt;dd&gt;
  &lt;p&gt; She responds with "Hello, how may I help you?"; you can respond with:
  &lt;dl&gt;
   &lt;dt&gt; "I would like to buy a fish."
   &lt;dd&gt; &lt;p&gt; She sells you a fish and the conversation finishes.
   &lt;dt&gt; "Can I borrow your boat?"
   &lt;dd&gt;
    &lt;p&gt; She is surprised and asks "What are you offering in return?".
    &lt;dl&gt;
     &lt;dt&gt; "Five gold." (if you have enough)
     &lt;dt&gt; "Ten gold." (if you have enough)
     &lt;dt&gt; "Fifteen gold." (if you have enough)
     &lt;dd&gt; &lt;p&gt; She lends you her boat. The conversation ends.
     &lt;dt&gt; "A fish." (if you have one)
     &lt;dt&gt; "A newspaper." (if you have one)
     &lt;dt&gt; "A pebble." (if you have one)
     &lt;dd&gt; &lt;p&gt; "No thanks", she replies. Your conversation options
     at this point are the same as they were after asking to borrow
     her boat, minus any options you've suggested before.
    &lt;/dl&gt;
   &lt;/dd&gt;
  &lt;/dl&gt;
 &lt;/dd&gt;
 &lt;dt&gt; "Vote for me in the next election!"
 &lt;dd&gt; &lt;p&gt; She turns away. The conversation finishes.
 &lt;dt&gt; "Madam, are you aware that your fish are running away?"
 &lt;dd&gt;
  &lt;p&gt; She looks at you skeptically and says "Fish cannot run, miss".
  &lt;dl&gt;
   &lt;dt&gt; "You got me!"
   &lt;dd&gt; &lt;p&gt; The fisher sighs and the conversation ends.
   &lt;dt&gt; "Only kidding."
   &lt;dd&gt; &lt;p&gt; "Good one!" she retorts. Your conversation options at this
   point are the same as those following "Hello there!" above.
   &lt;dt&gt; "Oh, then what are they doing?"
   &lt;dd&gt; &lt;p&gt; She looks at her fish, giving you an opportunity to steal
   her boat, which you do. The conversation ends.
  &lt;/dl&gt;
 &lt;/dd&gt;
&lt;/dl&gt;</pre>

  </div>

  <div class=example>

   <p>一部のゲームにおいて、会話はより単純である。各文字は単に、彼らが言うことを行の固定セットを持つ。この例において、ゲームのFAQ/チュートリアルは、各文字の既知の可能な応答の一部を示す：</p>

   <pre>&lt;section&gt;
 &lt;h1&gt;Dialogue&lt;/h1&gt;
 &lt;p&gt;&lt;small&gt;Some characters repeat their lines in order each time you interact
 with them, others randomly pick from amongst their lines. Those who respond in
 order have numbered entries in the lists below.&lt;/small&gt;
 &lt;h2&gt;The Shopkeeper&lt;/h2&gt;
 &lt;ul&gt;
  &lt;li&gt;How may I help you?
  &lt;li&gt;Fresh apples!
  &lt;li&gt;A loaf of bread for madam?
 &lt;/ul&gt;
 &lt;h2&gt;The pilot&lt;/h2&gt;
 &lt;p&gt;Before the accident:
 &lt;ul&gt;
  &lt;li&gt;I'm about to fly out, sorry!
  &lt;li&gt;Sorry, I'm just waiting for flight clearance and then I'll be off!
 &lt;/ul&gt;
 &lt;p&gt;After the accident:
 &lt;ol&gt;
  &lt;li&gt;I'm about to fly out, sorry!
  &lt;li&gt;Ok, I'm not leaving right now, my plane is being cleaned.
  &lt;li&gt;Ok, it's not being cleaned, it needs a minor repair first.
  &lt;li&gt;Ok, ok, stop bothering me!Truth is, I had a crash.
 &lt;/ol&gt;
 &lt;h2&gt;Clan Leader&lt;/h2&gt;
 &lt;p&gt;During the first clan meeting:
 &lt;ul&gt;
  &lt;li&gt;Hey, have you seen my daughter?I bet she's up to something nefarious again...
  &lt;li&gt;Nice weather we're having today, eh?
  &lt;li&gt;The name is Bailey, Jeff Bailey. How can I help you today?
  &lt;li&gt;A glass of water?Fresh from the well!
 &lt;/ul&gt;
 &lt;p&gt;After the earthquake:
 &lt;ol&gt;
  &lt;li&gt;Everyone is safe in the shelter, we just have to put out the fire!
  &lt;li&gt;I'll go and tell the fire brigade, you keep hosing it down!
 &lt;/ol&gt;
&lt;/section&gt;</pre>

  </div>


  <h4 id=footnotes>4.14.5 脚注<a href=#footnotes class=self-link></a></h4>

  <p>HTMLは、脚注をマークアップするための専用のメカニズムを持たない。ここで提案する選択肢がある。</p>

  <hr>

  <p>短いインライン注釈の場合、<code id=footnotes:attr-title><a href=dom.html#attr-title>title</a></code>属性を使用することができる。</p>

  <div class=example>

   <p>この例において、対話の2つの部分は、<code id=footnotes:attr-title-2><a href=dom.html#attr-title>title</a></code>属性を使用して脚注のようなコンテンツで注釈付けされる。</p>

   <pre>&lt;p&gt; &lt;b&gt;Customer&lt;/b&gt;: Hello! I wish to register a complaint. Hello. Miss?
&lt;p&gt; &lt;b&gt;Shopkeeper&lt;/b&gt;: <strong>&lt;span title="Colloquial pronunciation of 'What do you'"</strong>
&gt;Watcha&lt;/span&gt; mean, miss?
&lt;p&gt; &lt;b&gt;Customer&lt;/b&gt;: Uh, I'm sorry, I have a cold. I wish to make a complaint.
&lt;p&gt; &lt;b&gt;Shopkeeper&lt;/b&gt;: Sorry, &lt;span <strong>title="This is, of course, a lie."</strong>&gt;we're
closing for lunch&lt;/span&gt;.</pre>

  </div>

  
  <p class=note>不幸なことに、<code id=footnotes:attr-title-3><a href=dom.html#attr-title>title</a></code>属性に依存することは、多くのユーザーエージェントがこの仕様で要求されるようなアクセス可能な方法で属性を公開しないため、現在推奨されない（たとえば、ツールチップを出現させるマウスなどのポインティングデバイスが必要になり、これはモダンな携帯端末やタブレットをもつ人のような、キーボードのみのユーザーとタッチのみのユーザーを締め出す）。</p>

  <p class=note><code id=footnotes:attr-title-4><a href=dom.html#attr-title>title</a></code>属性が使用される場合、属性をもつ要素への読者の関心を引き出すためにCSSを使用することができる。</p>

  <div class=example>

   <p>たとえば、次のCSSは、<code id=footnotes:attr-title-5><a href=dom.html#attr-title>title</a></code>属性を持つ要素の下に破線を置く。</p>

   <pre>[title] { border-bottom: thin dashed; }</pre>

  </div>

  <hr>

  <p>より長い注釈の場合、後で文書の要素を指すよう、<code id=footnotes:the-a-element><a href=semantics.html#the-a-element>a</a></code>要素が使用されるべきである。リンクのコンテンツが角括弧内の数字であるのが慣例である。</p>

  <div class=example>

   <p>この例において、対話における脚注は、ダイアログの下の段落にリンクする。段落は、ユーザーが脚注の場所に戻ることができるように、対話へ相互にリンクする。</p>

   <pre>&lt;p&gt; Announcer: Number 16: The &lt;i&gt;hand&lt;/i&gt;.
&lt;p&gt; Interviewer: Good evening. I have with me in the studio tonight
Mr Norman St John Polevaulter, who for the past few years has been
contradicting people. Mr Polevaulter, why &lt;em&gt;do&lt;/em&gt; you
contradict people?
&lt;p&gt; Norman: I don't. &lt;sup&gt;&lt;a href="#fn1" id="r1"&gt;[1]&lt;/a&gt;&lt;/sup&gt;
&lt;p&gt; Interviewer: You told me you did!
<em>...</em>
&lt;section&gt;
 &lt;p id="fn1"&gt;&lt;a href="#r1"&gt;[1]&lt;/a&gt; This is, naturally, a lie,
 but paradoxically if it were true he could not say so without
 contradicting the interviewer and thus making it false.&lt;/p&gt;
&lt;/section&gt;</pre>

  </div>

  <hr>

  <p>サイドノートに対して、単に特定の単語や文よりもテキストのセクション全体に適用されるより長い注釈の場合、<code id=footnotes:the-aside-element><a href=semantics.html#the-aside-element>aside</a></code>要素を使用すべきである。</p>

  <div class=example>

   <p>この例では、サイドバーはそれにいくつかの文脈を与えて、対話の後に与えられる。</p>

   <pre>&lt;p&gt; &lt;span class="speaker"&gt;Customer&lt;/span&gt;: I will not buy this record, it is scratched.
&lt;p&gt; &lt;span class="speaker"&gt;Shopkeeper&lt;/span&gt;: I'm sorry?
&lt;p&gt; &lt;span class="speaker"&gt;Customer&lt;/span&gt;: I will not buy this record, it is scratched.
&lt;p&gt; &lt;span class="speaker"&gt;Shopkeeper&lt;/span&gt;: No no no, this's'a tobacconist's.
&lt;aside&gt;
 &lt;p&gt;In 1970, the British Empire lay in ruins, and foreign
 nationalists frequented the streets — many of them Hungarians
 (not the streets — the foreign nationals). Sadly, Alexander
 Yalt has been publishing incompetently-written phrase books.
&lt;/aside&gt;</pre>

  </div>

  <hr>

  <p>図または表について、脚注は該当<code id=footnotes:the-figcaption-element><a href=semantics.html#the-figcaption-element>figcaption</a></code>または<code id=footnotes:the-caption-element><a href=tables.html#the-caption-element>caption</a></code>要素、または文の周囲に含めることができる。</p>

  <div class=example>

   <p>この例において、表は、文に与えられる脚注を持つセルを持つ。<code id=footnotes:the-figure-element><a href=semantics.html#the-figure-element>figure</a></code>要素は、表とその脚注の組み合わせを単一の凡例に与えるために使用される。</p>

   <pre>&lt;figure&gt;
 &lt;figcaption&gt;Table 1. Alternative activities for knights.&lt;/figcaption&gt;
 &lt;table&gt;
  &lt;tr&gt;
   &lt;th&gt; Activity
   &lt;th&gt; Location
   &lt;th&gt; Cost
  &lt;tr&gt;
   &lt;td&gt; Dance
   &lt;td&gt; Wherever possible
   &lt;td&gt; £0&lt;sup&gt;&lt;a href="#fn1"&gt;1&lt;/a&gt;&lt;/sup&gt;
  &lt;tr&gt;
   &lt;td&gt; Routines, chorus scenes&lt;sup&gt;&lt;a href="#fn2"&gt;2&lt;/a&gt;&lt;/sup&gt;
   &lt;td&gt; Undisclosed
   &lt;td&gt; Undisclosed
  &lt;tr&gt;
   &lt;td&gt; Dining&lt;sup&gt;&lt;a href="#fn3"&gt;3&lt;/a&gt;&lt;/sup&gt;
   &lt;td&gt; Camelot
   &lt;td&gt; Cost of ham, jam, and spam&lt;sup&gt;&lt;a href="#fn4"&gt;4&lt;/a&gt;&lt;/sup&gt;
 &lt;/table&gt;
 &lt;p id="fn1"&gt;1. Assumed.&lt;/p&gt;
 &lt;p id="fn2"&gt;2. Footwork impeccable.&lt;/p&gt;
 &lt;p id="fn3"&gt;3. Quality described as "well".&lt;/p&gt;
 &lt;p id="fn4"&gt;4. A lot.&lt;/p&gt;
&lt;/figure&gt;</pre>

  </div>


  <h3 id=disabled-elements>4.15 無効要素<a href=#disabled-elements class=self-link></a></h3>

  <p>An element is said to be <dfn id=concept-element-disabled>actually disabled</dfn> if it
  is one of the following:</p>

  <ul><li><a href=forms.html#concept-fe-disabled id=disabled-elements:concept-fe-disabled>無効</a>である<code id=disabled-elements:the-button-element><a href=forms.html#the-button-element>button</a></code>要素</li><li><a href=forms.html#concept-fe-disabled id=disabled-elements:concept-fe-disabled-2>無効</a>である<code id=disabled-elements:the-input-element><a href=forms.html#the-input-element>input</a></code>要素</li><li><a href=forms.html#concept-fe-disabled id=disabled-elements:concept-fe-disabled-3>無効</a>である<code id=disabled-elements:the-select-element><a href=forms.html#the-select-element>select</a></code>要素</li><li><a href=forms.html#concept-fe-disabled id=disabled-elements:concept-fe-disabled-4>無効</a>である<code id=disabled-elements:the-textarea-element><a href=forms.html#the-textarea-element>textarea</a></code>要素</li><li><code id=disabled-elements:attr-optgroup-disabled><a href=forms.html#attr-optgroup-disabled>disabled</a></code>属性を持つ<code id=disabled-elements:the-optgroup-element><a href=forms.html#the-optgroup-element>optgroup</a></code>要素</li><li><a href=forms.html#concept-option-disabled id=disabled-elements:concept-option-disabled>無効</a>である<code id=disabled-elements:the-option-element><a href=forms.html#the-option-element>option</a></code>要素</li><li><code id=disabled-elements:attr-menuitem-disabled><a href=forms.html#attr-menuitem-disabled>disabled</a></code>属性を持つ<code id=disabled-elements:the-menuitem-element><a href=forms.html#the-menuitem-element>menuitem</a></code>要素</li><li><a href=forms.html#concept-fieldset-disabled id=disabled-elements:concept-fieldset-disabled>無効なフィールドセット</a>である<code id=disabled-elements:the-fieldset-element><a href=forms.html#the-fieldset-element>fieldset</a></code>要素</li></ul>

  <p class=note>This definition is used to determine what elements <a href=interaction.html#specially-focusable id=disabled-elements:specially-focusable>can be focused</a> and which elements match the <code id=disabled-elements:selector-enabled><a href=#selector-enabled>:enabled</a></code> and <code id=disabled-elements:selector-disabled><a href=#selector-disabled>:disabled</a></code>
  <a href=https://triple-underscore.github.io/selectors4-ja.html#pseudo-class id=disabled-elements:pseudo-class data-x-internal=pseudo-class>pseudo-classes</a>.</p>


  



  <h3 id=selectors>4.16 Matching HTML elements using selectors and CSS<a href=#selectors class=self-link></a></h3>

  <h4 id="case-sensitivity-of-the-css-'attr()'-function">4.16.1 Case-sensitivity of the CSS <a id="case-sensitivity-of-the-css-'attr()'-function:'attr()'" href=https://momdo.github.io/css3-values/#funcdef-attr data-x-internal="'attr()'">'attr()'</a> function<a href="#case-sensitivity-of-the-css-'attr()'-function" class=self-link></a></h4>

  <p>The CSS Values and Units specification leaves the case-sensitivity of attribute names for the
  purpose of the <a id="case-sensitivity-of-the-css-'attr()'-function:'attr()'-2" href=https://momdo.github.io/css3-values/#funcdef-attr data-x-internal="'attr()'">'attr()'</a> function to be defined by the host language. <a href=references.html#refsCSSVALUES>[CSSVALUES]</a></p>

  <p>When comparing the attribute name part of a CSS <a id="case-sensitivity-of-the-css-'attr()'-function:'attr()'-3" href=https://momdo.github.io/css3-values/#funcdef-attr data-x-internal="'attr()'">'attr()'</a> function to the names of namespace-less attributes on <a id="case-sensitivity-of-the-css-'attr()'-function:html-elements" href=infrastructure.html#html-elements>HTML elements</a> in <a id="case-sensitivity-of-the-css-'attr()'-function:html-documents" href=https://triple-underscore.github.io/DOM4-ja.html#html-document data-x-internal=html-documents>HTML documents</a>, the name part of the CSS <a id="case-sensitivity-of-the-css-'attr()'-function:'attr()'-4" href=https://momdo.github.io/css3-values/#funcdef-attr data-x-internal="'attr()'">'attr()'</a> function must first be <a id="case-sensitivity-of-the-css-'attr()'-function:converted-to-ascii-lowercase" href=https://infra.spec.whatwg.org/#ascii-lowercase data-x-internal=converted-to-ascii-lowercase>converted to ASCII lowercase</a>. The same function when compared to other attributes must be compared according to its original case. どちらの場合も、比較は<a id="case-sensitivity-of-the-css-'attr()'-function:case-sensitive" href=infrastructure.html#case-sensitive>大文字・小文字区別</a>である。</p>

  <p class=note>This is the same as comparing the name part of a CSS <a id="case-sensitivity-of-the-css-'attr()'-function:attribute-selector" href=https://triple-underscore.github.io/selectors4-ja.html#attribute-selector data-x-internal=attribute-selector>attribute
  selector</a>, specified in the next section.</p>


  <h4 id=case-sensitivity-of-selectors>4.16.2 Case-sensitivity of selectors<a href=#case-sensitivity-of-selectors class=self-link></a></h4>

  <p>セレクター仕様は、ホスト言語によって定義される要素名、属性名、および属性値の大文字・小文字区別のままにする。<a href=references.html#refsSELECTORS>[SELECTORS]</a></p>

  <p class=note><cite>Selectors</cite> defines that ID and class selectors, when matched against
  elements in documents that are in <a id=case-sensitivity-of-selectors:quirks-mode href=https://triple-underscore.github.io/DOM4-ja.html#concept-document-quirks data-x-internal=quirks-mode>quirks mode</a>, will be matched in an <a id=case-sensitivity-of-selectors:ascii-case-insensitive href=https://infra.spec.whatwg.org/#ascii-case-insensitive data-x-internal=ascii-case-insensitive>ASCII
  case-insensitive</a> manner.</p>

  <p><a id=case-sensitivity-of-selectors:html-documents href=https://triple-underscore.github.io/DOM4-ja.html#html-document data-x-internal=html-documents>HTML文書</a>内の<a id=case-sensitivity-of-selectors:html-elements href=infrastructure.html#html-elements>HTML要素</a>の名前とCSS要素<a id=case-sensitivity-of-selectors:type-selector href=https://triple-underscore.github.io/selectors4-ja.html#type-selector data-x-internal=type-selector>型セレクター</a>を比較する際、CSS要素<a id=case-sensitivity-of-selectors:type-selector-2 href=https://triple-underscore.github.io/selectors4-ja.html#type-selector data-x-internal=type-selector>型セレクター</a>は、最初に<a id=case-sensitivity-of-selectors:converted-to-ascii-lowercase href=https://infra.spec.whatwg.org/#ascii-lowercase data-x-internal=converted-to-ascii-lowercase>ASCII小文字に変換</a>しなければならない。他の要素と比較する際に同じセレクターは、元のケースに応じて比較されなければならない。どちらの場合も、比較は<a id=case-sensitivity-of-selectors:case-sensitive href=infrastructure.html#case-sensitive>大文字・小文字区別</a>である。</p>
  

  <p><a id=case-sensitivity-of-selectors:html-documents-2 href=https://triple-underscore.github.io/DOM4-ja.html#html-document data-x-internal=html-documents>HTML文書</a>における<a id=case-sensitivity-of-selectors:html-elements-2 href=infrastructure.html#html-elements>HTML要素</a>の名前空間なし属性の名前とCSS<a id=case-sensitivity-of-selectors:attribute-selector href=https://triple-underscore.github.io/selectors4-ja.html#attribute-selector data-x-internal=attribute-selector>属性セレクター</a>の名前部分を比較する際、CSS<a id=case-sensitivity-of-selectors:attribute-selector-2 href=https://triple-underscore.github.io/selectors4-ja.html#attribute-selector data-x-internal=attribute-selector>属性セレクター</a>の名前部分は、最初に<a id=case-sensitivity-of-selectors:converted-to-ascii-lowercase-2 href=https://infra.spec.whatwg.org/#ascii-lowercase data-x-internal=converted-to-ascii-lowercase>ASCII小文字に変換</a>しなければならない。他の要素と比較する際に同じセレクターは、元のケースに応じて比較されなければならない。どちらの場合も、比較は<a id=case-sensitivity-of-selectors:case-sensitive-2 href=infrastructure.html#case-sensitive>大文字・小文字区別</a>である。</p>
  

  <p><a href=https://triple-underscore.github.io/selectors4-ja.html#attribute-selector id=case-sensitivity-of-selectors:attribute-selector-3 data-x-internal=attribute-selector>Attribute selectors</a> on an <a href=infrastructure.html#html-elements id=case-sensitivity-of-selectors:html-elements-3>HTML element</a> in an <a href=https://triple-underscore.github.io/DOM4-ja.html#html-document id=case-sensitivity-of-selectors:html-documents-3 data-x-internal=html-documents>HTML
  document</a> must treat the <em>values</em> of attributes with the following names as
  <a id=case-sensitivity-of-selectors:ascii-case-insensitive-2 href=https://infra.spec.whatwg.org/#ascii-case-insensitive data-x-internal=ascii-case-insensitive>ASCII case-insensitive</a>, with one exception as noted
  <a href=rendering.html#attribute-selector-case-sensitive>in the rendering section</a>:</p>

  
  
  <ul class=brief><li><code>accept</code>
   </li><li><code>accept-charset</code>
   </li><li><code>align</code>
   </li><li><code>alink</code>
   </li><li><code>axis</code>
   </li><li><code>bgcolor</code>
   </li><li><code>charset</code>
   </li><li><code>checked</code>
   </li><li><code>clear</code>
   </li><li><code>codetype</code>
   </li><li><code>color</code>
   </li><li><code>compact</code>
   </li><li><code>declare</code>
   </li><li><code>defer</code>
   </li><li><code>dir</code>
   </li><li><code>direction</code> 
   </li><li><code>disabled</code>
   </li><li><code>enctype</code>
   </li><li><code>face</code>
   </li><li><code>frame</code>
   </li><li><code>hreflang</code>
   </li><li><code>http-equiv</code>
   </li><li><code>lang</code>
   </li><li><code>language</code>
   </li><li><code>link</code>
   </li><li><code>media</code>
   </li><li><code>メソッド</code>
   </li><li><code>multiple</code>
   </li><li><code>nohref</code>
   </li><li><code>noresize</code>
   </li><li><code>noshade</code>
   </li><li><code>nowrap</code>
   </li><li><code>readonly</code>
   </li><li><code>rel</code>
   </li><li><code>rev</code>
   </li><li><code>rules</code>
   </li><li><code>scope</code>
   </li><li><code>scrolling</code>
   </li><li><code>selected</code>
   </li><li><code>shape</code>
   </li><li><code>target</code>
   </li><li><code>text</code>
   </li><li><code>type</code> (except as specified in the rendering section)
   
   </li><li><code>valign</code>
   </li><li><code>valuetype</code>
   </li><li><code>vlink</code>
  </li></ul>

  <p>すべての他の属性値と他のすべては、セレクターマッチングの目的のために完全に<a id=case-sensitivity-of-selectors:case-sensitive-3 href=infrastructure.html#case-sensitive>大文字・小文字区別</a>として扱われなければならない。これは次を含む：</p>

  <ul class=brief><li> <a id=case-sensitivity-of-selectors:no-quirks-mode href=https://triple-underscore.github.io/DOM4-ja.html#concept-document-no-quirks data-x-internal=no-quirks-mode>非Quirksモード</a>および<a id=case-sensitivity-of-selectors:limited-quirks-mode href=https://triple-underscore.github.io/DOM4-ja.html#concept-document-limited-quirks data-x-internal=limited-quirks-mode>限定Quirksモード</a>におけるIDおよびクラス
   </li><li> <a id=case-sensitivity-of-selectors:html-namespace-2 href=https://infra.spec.whatwg.org/#html-namespace data-x-internal=html-namespace-2>HTML名前空間</a>でない要素の名前
   </li><li> <a id=case-sensitivity-of-selectors:xml-documents href=https://triple-underscore.github.io/DOM4-ja.html#xml-document data-x-internal=xml-documents>XML文書</a>内の<a id=case-sensitivity-of-selectors:html-elements-4 href=infrastructure.html#html-elements>HTML要素</a>の名前
   </li><li> <a id=case-sensitivity-of-selectors:html-namespace-2-2 href=https://infra.spec.whatwg.org/#html-namespace data-x-internal=html-namespace-2>HTML名前空間</a>内でない要素の属性の名前
   </li><li> <a id=case-sensitivity-of-selectors:xml-documents-2 href=https://triple-underscore.github.io/DOM4-ja.html#xml-document data-x-internal=xml-documents>XML文書</a>内の<a id=case-sensitivity-of-selectors:html-elements-5 href=infrastructure.html#html-elements>HTML要素</a>の属性の名前
   </li><li> 自身が名前空間を持つ属性の名前
  </li></ul>


  <h4 id=pseudo-classes>4.16.3 擬似クラス<a href=#pseudo-classes class=self-link></a></h4>

  <p>HTMLと一緒に使用することができる多数の動的セレクターが存在する。このセレクターがHTML要素とマッチする場合に、このセクションは定義する。<a href=references.html#refsSELECTORS>[SELECTORS]</a> <a href=references.html#refsCSSUI>[CSSUI]</a></p>

  <dl><dt><dfn id=selector-defined data-dfn-type=selector data-export=""><code>:defined</code></dfn><dd>

    <p>The <code id=pseudo-classes:selector-defined><a href=#selector-defined>:defined</a></code> <a id=pseudo-classes:pseudo-class href=https://triple-underscore.github.io/selectors4-ja.html#pseudo-class data-x-internal=pseudo-class>pseudo-class</a> must match
    any element that is <a href=https://triple-underscore.github.io/DOM4-ja.html#concept-element-defined id=pseudo-classes:concept-element-defined data-x-internal=concept-element-defined>defined</a>.</p>

   <dt><dfn id=selector-link><code>:link</code></dfn><dt><dfn id=selector-visited><code>:visited</code></dfn><dd>

    <p><code id=pseudo-classes:attr-hyperlink-href><a href=semantics.html#attr-hyperlink-href>href</a></code>属性を持つすべての<code id=pseudo-classes:the-a-element><a href=semantics.html#the-a-element>a</a></code>要素、<code id=pseudo-classes:attr-hyperlink-href-2><a href=semantics.html#attr-hyperlink-href>href</a></code>属性を持つすべての<code id=pseudo-classes:the-area-element><a href=embedded-content.html#the-area-element>area</a></code>要素、および<code id=pseudo-classes:attr-link-href><a href=semantics.html#attr-link-href>href</a></code>属性を持つすべての<code id=pseudo-classes:the-link-element><a href=semantics.html#the-link-element>link</a></code>要素は、<code id=pseudo-classes:selector-link><a href=#selector-link>:link</a></code>および<code id=pseudo-classes:selector-visited><a href=#selector-visited>:visited</a></code>のいずれかとマッチしなければならない。</p>

    <p>Other specifications might apply more specific rules regarding how these elements are to
    match these <a href=https://triple-underscore.github.io/selectors4-ja.html#pseudo-class id=pseudo-classes:pseudo-class-2 data-x-internal=pseudo-class>pseudo-classes</a>, to mitigate some privacy concerns
    that apply with straightforward implementations of this requirement.</p>

   <dt><dfn id=selector-active><code>:active</code></dfn><dd>

    <p><q cite=https://drafts.csswg.org/selectors3/#the-user-action-pseudo-classes-hover-act>要素がユーザーによって<dfn id=concept-selector-active><i>活性化されている</i></dfn>間</q><code id=pseudo-classes:selector-active><a href=#selector-active>:active</a></code><a id=pseudo-classes:pseudo-class-3 href=https://triple-underscore.github.io/selectors4-ja.html#pseudo-class data-x-internal=pseudo-class>疑似クラス</a>は要素にマッチするように定義される。</p>

    <p>特定の要素が<code id=pseudo-classes:selector-active-2><a href=#selector-active>:active</a></code><a id=pseudo-classes:pseudo-class-4 href=https://triple-underscore.github.io/selectors4-ja.html#pseudo-class data-x-internal=pseudo-class>疑似クラス</a>のみを定義する目的のために<i id=pseudo-classes:concept-selector-active><a href=#concept-selector-active>活性化されている</a></i>かどうかを判断するために、HTMLユーザーエージェントは、次のリストで最初の該当するエントリーを使用しなければならない。</p>

    <dl><dt>要素が<code id=pseudo-classes:selector-active-3><a href=#selector-active>:active</a></code><a id=pseudo-classes:pseudo-class-5 href=https://triple-underscore.github.io/selectors4-ja.html#pseudo-class data-x-internal=pseudo-class>擬似クラス</a>と現在マッチしている子孫を持つ場合<dd><p>要素は<i id=pseudo-classes:concept-selector-active-2><a href=#concept-selector-active>活性化されている</a></i>。<dt>要素が<code id=pseudo-classes:selector-active-4><a href=#selector-active>:active</a></code>と現在マッチしている<code id=pseudo-classes:the-label-element><a href=forms.html#the-label-element>label</a></code>要素の<a id=pseudo-classes:labeled-control href=forms.html#labeled-control>ラベル付け</a>されたコントロールである場合<dd><p>要素は<i id=pseudo-classes:concept-selector-active-3><a href=#concept-selector-active>活性化されている</a></i>。<dt>要素が<code id=pseudo-classes:the-button-element><a href=forms.html#the-button-element>button</a></code>要素がある場合<dt>要素が<code id=pseudo-classes:attr-input-type><a href=forms.html#attr-input-type>type</a></code>属性が<a href="forms.html#submit-button-state-(type=submit)" id="pseudo-classes:submit-button-state-(type=submit)">送信ボタン</a>、<a href="forms.html#image-button-state-(type=image)" id="pseudo-classes:image-button-state-(type=image)">イメージボタン</a>、<a href="forms.html#reset-button-state-(type=reset)" id="pseudo-classes:reset-button-state-(type=reset)">リセットボタン</a>または<a href="forms.html#button-state-(type=button)" id="pseudo-classes:button-state-(type=button)">ボタン</a>状態である<code id=pseudo-classes:the-input-element><a href=forms.html#the-input-element>input</a></code>要素である場合<dd>

      <p>要素が<a href=#in-a-formal-activation-state id=pseudo-classes:in-a-formal-activation-state>形式的な活性化状態</a>にありかつ<a href=forms.html#concept-fe-disabled id=pseudo-classes:concept-fe-disabled>無効</a>でない場合、要素は<i id=pseudo-classes:concept-selector-active-4><a href=#concept-selector-active>活性化されている</a></i>。</p>

      <p class=example>たとえば、ユーザーがスペースバーを押すことで<code id=pseudo-classes:the-button-element-2><a href=forms.html#the-button-element>button</a></code>要素を押すためにキーボードを使用している場合、要素は、要素が<code id=pseudo-classes:event-keydown><a data-x-internal=event-keydown href=https://w3c.github.io/uievents/#event-type-keydown>keydown</a></code>イベントを受信した時刻と要素が<code id=pseudo-classes:event-keyup><a data-x-internal=event-keyup href=https://w3c.github.io/uievents/#event-type-keyup>keyup</a></code>イベントを受信した時刻との間でこの<a id=pseudo-classes:pseudo-class-6 href=https://triple-underscore.github.io/selectors4-ja.html#pseudo-class data-x-internal=pseudo-class>擬似クラス</a>とマッチする。</p>

     <dt>要素が<code id=pseudo-classes:the-menuitem-element><a href=forms.html#the-menuitem-element>menuitem</a></code>要素である場合<dd><p>要素が<a href=#in-a-formal-activation-state id=pseudo-classes:in-a-formal-activation-state-2>正式な活性化状態</a>でありかつ<code id=pseudo-classes:attr-menuitem-disabled><a href=forms.html#attr-menuitem-disabled>disabled</a></code>属性を持たない場合、要素は<i id=pseudo-classes:concept-selector-active-5><a href=#concept-selector-active>活性化されている</a></i>。<dt>要素が<code id=pseudo-classes:attr-hyperlink-href-3><a href=semantics.html#attr-hyperlink-href>href</a></code>属性を持つ<code id=pseudo-classes:the-a-element-2><a href=semantics.html#the-a-element>a</a></code>要素である場合<dt>要素が<code id=pseudo-classes:attr-hyperlink-href-4><a href=semantics.html#attr-hyperlink-href>href</a></code>属性を持つ<code id=pseudo-classes:the-area-element-2><a href=embedded-content.html#the-area-element>area</a></code>要素である場合<dt>要素が<code id=pseudo-classes:attr-link-href-2><a href=semantics.html#attr-link-href>href</a></code>属性を持つ<code id=pseudo-classes:the-link-element-2><a href=semantics.html#the-link-element>link</a></code>要素である場合<dt>要素が要素の<a id=pseudo-classes:specially-focusable href=interaction.html#specially-focusable>tabindexフォーカスフラグ</a>が設定される場合<dd><p>要素が<a href=#in-a-formal-activation-state id=pseudo-classes:in-a-formal-activation-state-3>正式な活性化状態</a>にある場合、要素は<i id=pseudo-classes:concept-selector-active-6><a href=#concept-selector-active>活性化されている</a></i>。<dt>要素が<a href=#being-actively-pointed-at id=pseudo-classes:being-actively-pointed-at>being actively pointed at</a>である場合<dd><p>要素は<i id=pseudo-classes:concept-selector-active-7><a href=#concept-selector-active>活性化されている</a></i>。</dl>

    <p>An element is said to be <dfn id=in-a-formal-activation-state>in a formal activation state</dfn> between the time the user
    begins to indicate an intent to trigger the element's <a id=pseudo-classes:activation-behaviour href=https://dom.spec.whatwg.org/#eventtarget-activation-behavior data-x-internal=activation-behaviour>activation behavior</a> and
    either the time the user stops indicating an intent to trigger the element's <a id=pseudo-classes:activation-behaviour-2 href=https://dom.spec.whatwg.org/#eventtarget-activation-behavior data-x-internal=activation-behaviour>activation
    behavior</a>, or the time the element's <a id=pseudo-classes:activation-behaviour-3 href=https://dom.spec.whatwg.org/#eventtarget-activation-behavior data-x-internal=activation-behaviour>activation behavior</a> has finished
    running, which ever comes first.</p>

    <p>要素は、ポインティングデバイスが"down"状態にある間、ユーザーがポインティングデバイスを使用して要素を示す間<dfn id=being-actively-pointed-at>積極的に指摘されている</dfn>と言われる（たとえば、マウスに対して、マウスボタンが押される時間とマウスブタンが離される時間の間、マルチタッチ環境における指に対して、指がディスプレイ表面に接触している間）。</p>

   <dt><dfn id=selector-hover><code>:hover</code></dfn><dd>

    <p><code id=pseudo-classes:selector-hover><a href=#selector-hover>:hover</a></code><a id=pseudo-classes:pseudo-class-7 href=https://triple-underscore.github.io/selectors4-ja.html#pseudo-class data-x-internal=pseudo-class>疑似クラス</a>は、<q cite=https://drafts.csswg.org/selectors3/#the-user-action-pseudo-classes-hover-act>ユーザーがポインティングデバイスで要素を<i>指定する</i>間</q>の要素とマッチするように定義される。<code id=pseudo-classes:selector-hover-2><a href=#selector-hover>:hover</a></code><a id=pseudo-classes:pseudo-class-8 href=https://triple-underscore.github.io/selectors4-ja.html#pseudo-class data-x-internal=pseudo-class>疑似クラス</a>のみの定義のために、HTMLユーザーエージェントは、それがある場合、ユーザーが<i>指定する</i>ものであるとして要素を考慮しなければならない。</p>

    <ul><li>

      <p>ユーザーがポインティングデバイスを使用して示す要素。</p>

     </li><li>

      <p>ユーザーがポインティングデバイスを使用して示す子孫を持つ要素。</p>

     </li><li>

      <p>現在<code id=pseudo-classes:selector-hover-3><a href=#selector-hover>:hover</a></code>とマッチングしている<code id=pseudo-classes:the-label-element-2><a href=forms.html#the-label-element>label</a></code>要素の<a id=pseudo-classes:labeled-control-2 href=forms.html#labeled-control>ラベル付けされたコントロール</a>である要素。</p>

     </li></ul>


    <div class=example>

     <p>具体的に、このような断片を考えてみる：</p>

     <pre>&lt;p&gt; &lt;label for=c&gt; &lt;input id=a&gt; &lt;/label&gt; &lt;span id=b&gt; &lt;input id=c&gt; &lt;/span&gt; &lt;/p&gt;</pre>

     <p>ユーザーがポインティングデバイスとともにID"<code>a</code>"をもつ要素を指定する場合、<code id=pseudo-classes:the-p-element><a href=semantics.html#the-p-element>p</a></code>要素（および上記の断片で示されない要素のすべての祖先）、<code id=pseudo-classes:the-label-element-3><a href=forms.html#the-label-element>label</a></code>要素、ID"<code>a</code>"をもつ要素、およびID"<code>c</code>"をもつ要素は<code id=pseudo-classes:selector-hover-4><a href=#selector-hover>:hover</a></code><a id=pseudo-classes:pseudo-class-9 href=https://triple-underscore.github.io/selectors4-ja.html#pseudo-class data-x-internal=pseudo-class>疑似クラス</a>とマッチする。ID"<code>a</code>"をもつ要素は条件1からマッチし、<code id=pseudo-classes:the-label-element-4><a href=forms.html#the-label-element>label</a></code>および<code id=pseudo-classes:the-p-element-2><a href=semantics.html#the-p-element>p</a></code>要素は（その子孫の1つの指定される）条件2によりマッチし、ID "<code>c</code>"をもつ要素は条件3を通してマッチする（その<code id=pseudo-classes:the-label-element-5><a href=forms.html#the-label-element>label</a></code>要素は<code id=pseudo-classes:selector-hover-5><a href=#selector-hover>:hover</a></code>とマッチする）。しかし、ID "<code>b</code>"をもつ要素は<code id=pseudo-classes:selector-hover-6><a href=#selector-hover>:hover</a></code>とマッチ<em>しない</em>。たとえそれが<code id=pseudo-classes:selector-hover-7><a href=#selector-hover>:hover</a></code>とマッチしても、その子孫は指定されない。</p>

    </div>

   <dt><dfn id=selector-focus><code>:focus</code></dfn><dd>

    <p>CSS <code id=pseudo-classes:selector-focus><a href=#selector-focus>:focus</a></code><a id=pseudo-classes:pseudo-class-10 href=https://triple-underscore.github.io/selectors4-ja.html#pseudo-class data-x-internal=pseudo-class>疑似クラス</a>の場合、要素の<a id=pseudo-classes:top-level-browsing-context href=browsers.html#top-level-browsing-context>トップレベルブラウジングコンテキスト</a>がシステムフォーカスを持ち、要素が<a id=pseudo-classes:browsing-context-container href=browsers.html#browsing-context-container>ブラウジングコンテキストコンテナ</a>自身でなく、かつ要素が<a href=interaction.html#currently-focused-area-of-a-top-level-browsing-context id=pseudo-classes:currently-focused-area-of-a-top-level-browsing-context>トップレベルブラウジングコンテキストの現在フォーカスエリア</a>の<a id=pseudo-classes:focus-chain href=interaction.html#focus-chain>フォーカスチェーン</a>に記載される要素の1つである場合、<dfn id=element-has-the-focus>要素はフォーカスを持つ</dfn>。</p>

   <dt><dfn id=selector-target><code>:target</code></dfn><dd>

    <p>For the purposes of the CSS <code id=pseudo-classes:selector-focus-2><a href=#selector-focus>:target</a></code>
    <a id=pseudo-classes:pseudo-class-11 href=https://triple-underscore.github.io/selectors4-ja.html#pseudo-class data-x-internal=pseudo-class>pseudo-class</a>, the <code id=pseudo-classes:document><a href=dom.html#document>Document</a></code>'s <i>target elements</i> are a list
    containing the <code id=pseudo-classes:document-2><a href=dom.html#document>Document</a></code>'s <a id=pseudo-classes:target-element href=browsers.html#target-element>target element</a>, if it is
    not null, or containing no elements, if it is. <a href=references.html#refsSELECTORS>[SELECTORS]</a></p>

   <dt><dfn id=selector-enabled><code>:enabled</code></dfn><dd>

    <p>The <code id=pseudo-classes:selector-enabled><a href=#selector-enabled>:enabled</a></code> <a id=pseudo-classes:pseudo-class-12 href=https://triple-underscore.github.io/selectors4-ja.html#pseudo-class data-x-internal=pseudo-class>pseudo-class</a> must match any
    <code id=pseudo-classes:the-button-element-3><a href=forms.html#the-button-element>button</a></code>, <code id=pseudo-classes:the-input-element-2><a href=forms.html#the-input-element>input</a></code>, <code id=pseudo-classes:the-select-element><a href=forms.html#the-select-element>select</a></code>, <code id=pseudo-classes:the-textarea-element><a href=forms.html#the-textarea-element>textarea</a></code>,
    <code id=pseudo-classes:the-optgroup-element><a href=forms.html#the-optgroup-element>optgroup</a></code>, <code id=pseudo-classes:the-option-element><a href=forms.html#the-option-element>option</a></code>, <code id=pseudo-classes:the-menuitem-element-2><a href=forms.html#the-menuitem-element>menuitem</a></code>, or <code id=pseudo-classes:the-fieldset-element><a href=forms.html#the-fieldset-element>fieldset</a></code>
    element that is not <a href=#concept-element-disabled id=pseudo-classes:concept-element-disabled>actually disabled</a>.</p>

   <dt><dfn id=selector-disabled><code>:disabled</code></dfn><dd>

    <p><code id=pseudo-classes:selector-disabled><a href=#selector-disabled>:disabled</a></code><a id=pseudo-classes:pseudo-class-13 href=https://triple-underscore.github.io/selectors4-ja.html#pseudo-class data-x-internal=pseudo-class>擬似クラス</a>は、<a href=#concept-element-disabled id=pseudo-classes:concept-element-disabled-2>実際に無効</a>である任意の要素とマッチしなければならない。</p>

   <dt><dfn id=selector-checked><code>:checked</code></dfn><dd>

    <p><code id=pseudo-classes:selector-checked><a href=#selector-checked>:checked</a></code><a id=pseudo-classes:pseudo-class-14 href=https://triple-underscore.github.io/selectors4-ja.html#pseudo-class data-x-internal=pseudo-class>擬似クラス</a>は、次のカテゴリーのいずれかに分類される任意の要素とマッチしなければならない。</p>

    <ul><li><code id=pseudo-classes:attr-input-type-2><a href=forms.html#attr-input-type>type</a></code>属性が<a href="forms.html#checkbox-state-(type=checkbox)" id="pseudo-classes:checkbox-state-(type=checkbox)">チェックボックス</a>状態にありかつ<a href=forms.html#concept-fe-checked id=pseudo-classes:concept-fe-checked>checkedness</a>状態がtrueである<code id=pseudo-classes:the-input-element-3><a href=forms.html#the-input-element>input</a></code>要素</li><li><code id=pseudo-classes:attr-input-type-3><a href=forms.html#attr-input-type>type</a></code>属性が<a href="forms.html#radio-button-state-(type=radio)" id="pseudo-classes:radio-button-state-(type=radio)">ラジオボタン</a>状態にありかつ<a href=forms.html#concept-fe-checked id=pseudo-classes:concept-fe-checked-2>checkedness</a>状態がtrueである<code id=pseudo-classes:the-input-element-4><a href=forms.html#the-input-element>input</a></code>要素</li><li><a href=forms.html#concept-option-selectedness id=pseudo-classes:concept-option-selectedness>selectedness</a>がtrueである<code id=pseudo-classes:the-option-element-2><a href=forms.html#the-option-element>option</a></code>要素</li><li><code id=pseudo-classes:attr-menuitem-type><a href=forms.html#attr-menuitem-type>type</a></code>属性が<a href=forms.html#attr-menuitem-type-state-checkbox id=pseudo-classes:attr-menuitem-type-state-checkbox>チェックボックス</a>状態にありかつ<code id=pseudo-classes:attr-menuitem-checked><a href=forms.html#attr-menuitem-checked>checked</a></code>属性を持つ<code id=pseudo-classes:the-menuitem-element-3><a href=forms.html#the-menuitem-element>menuitem</a></code>要素</li><li><code id=pseudo-classes:attr-menuitem-type-2><a href=forms.html#attr-menuitem-type>type</a></code>属性が<a href=forms.html#attr-menuitem-type-state-radio id=pseudo-classes:attr-menuitem-type-state-radio>ラジオ</a>状態にありかつ<code id=pseudo-classes:attr-menuitem-checked-2><a href=forms.html#attr-menuitem-checked>checked</a></code>を持つ<code id=pseudo-classes:the-menuitem-element-4><a href=forms.html#the-menuitem-element>menuitem</a></code>要素</li></ul>

   <dt><dfn id=selector-indeterminate><code>:indeterminate</code></dfn><dd>

    <p><code id=pseudo-classes:selector-indeterminate><a href=#selector-indeterminate>:indeterminate</a></code><a id=pseudo-classes:pseudo-class-15 href=https://triple-underscore.github.io/selectors4-ja.html#pseudo-class data-x-internal=pseudo-class>擬似クラス</a>は、次のカテゴリーのいずれかに分類される任意の要素とマッチしなければならない。</p>

    <ul><li><code id=pseudo-classes:attr-input-type-4><a href=forms.html#attr-input-type>type</a></code>属性が<a href="forms.html#checkbox-state-(type=checkbox)" id="pseudo-classes:checkbox-state-(type=checkbox)-2">チェックボックス</a>状態でありかつ<code id=pseudo-classes:dom-input-indeterminate><a href=forms.html#dom-input-indeterminate>indeterminate</a></code> IDL属性がtrueに設定される
<code id=pseudo-classes:the-input-element-5><a href=forms.html#the-input-element>input</a></code>要素</li><li><code id=pseudo-classes:attr-input-type-5><a href=forms.html#attr-input-type>type</a></code>属性が<a href="forms.html#radio-button-state-(type=radio)" id="pseudo-classes:radio-button-state-(type=radio)-2">ラジオボタン状</a>態でありかつ<a id=pseudo-classes:radio-button-group href=forms.html#radio-button-group>ラジオボタングループ</a>が<a href=forms.html#concept-fe-checked id=pseudo-classes:concept-fe-checked-3>checkedness</a>状態がtrueである<code id=pseudo-classes:the-input-element-7><a href=forms.html#the-input-element>input</a></code>要素を含まない<code id=pseudo-classes:the-input-element-6><a href=forms.html#the-input-element>input</a></code>要素。</li><li><code id=pseudo-classes:attr-progress-value><a href=forms.html#attr-progress-value>value</a></code>コンテンツ属性をもたない<code id=pseudo-classes:the-progress-element><a href=forms.html#the-progress-element>progress</a></code>要素</li></ul>

   <dt><dfn id=selector-default><code>:default</code></dfn><dd>

    <p><code id=pseudo-classes:selector-default><a href=#selector-default>:default</a></code><a id=pseudo-classes:pseudo-class-16 href=https://triple-underscore.github.io/selectors4-ja.html#pseudo-class data-x-internal=pseudo-class>擬似クラス</a>は、次のカテゴリーのいずれかに分類される任意の要素とマッチしなければならない：</p>

    <ul><li>要素のフォームの<a id=pseudo-classes:default-button href=forms.html#default-button>デフォルトボタン</a>である<code id=pseudo-classes:the-button-element-4><a href=forms.html#the-button-element>button</a></code>要素</li><li><code id=pseudo-classes:attr-input-type-6><a href=forms.html#attr-input-type>type</a></code>属性が<a href="forms.html#submit-button-state-(type=submit)" id="pseudo-classes:submit-button-state-(type=submit)-2">送信ボタン</a>または<a href="forms.html#image-button-state-(type=image)" id="pseudo-classes:image-button-state-(type=image)-2">イメージボタン</a>状態でありかつ、要素のフォームの<a id=pseudo-classes:default-button-2 href=forms.html#default-button>デフォルトボタン</a>である<code id=pseudo-classes:the-input-element-8><a href=forms.html#the-input-element>input</a></code>要素</li><li><code id=pseudo-classes:attr-input-checked><a href=forms.html#attr-input-checked>checked</a></code>属性が適用されかつ<code id=pseudo-classes:attr-input-checked-2><a href=forms.html#attr-input-checked>checked</a></code>属性を持つ<code id=pseudo-classes:the-input-element-9><a href=forms.html#the-input-element>input</a></code>要素</li><li><code id=pseudo-classes:attr-option-selected><a href=forms.html#attr-option-selected>selected</a></code>属性を持つ<code id=pseudo-classes:the-option-element-3><a href=forms.html#the-option-element>option</a></code>要素</li></ul>

   <dt><dfn id=selector-placeholder-shown><code>:placeholder-shown</code></dfn><dd>

    <p>The <code id=pseudo-classes:selector-placeholder-shown><a href=#selector-placeholder-shown>:placeholder-shown</a></code>
    <a id=pseudo-classes:pseudo-class-17 href=https://triple-underscore.github.io/selectors4-ja.html#pseudo-class data-x-internal=pseudo-class>pseudo-class</a> must match any element falling into one of the following
    categories:</p>

    <ul><li><code id=pseudo-classes:the-input-element-10><a href=forms.html#the-input-element>input</a></code> elements that have a <code id=pseudo-classes:attr-input-placeholder><a href=forms.html#attr-input-placeholder>placeholder</a></code> attribute whose value is currently being
     presented to the user.</li><li><code id=pseudo-classes:the-textarea-element-2><a href=forms.html#the-textarea-element>textarea</a></code> elements that have a <code id=pseudo-classes:attr-textarea-placeholder><a href=forms.html#attr-textarea-placeholder>placeholder</a></code> attribute whose value is currently being
     presented to the user.</li></ul>

   <dt><dfn id=selector-valid><code>:valid</code></dfn><dd>

    <p><code id=pseudo-classes:selector-valid><a href=#selector-valid>:valid</a></code><a id=pseudo-classes:pseudo-class-18 href=https://triple-underscore.github.io/selectors4-ja.html#pseudo-class data-x-internal=pseudo-class>擬似クラス</a>は、次のカテゴリーのいずれかに分類される任意の要素とマッチしなければならない：</p>

    <ul><li><a href=forms.html#candidate-for-constraint-validation id=pseudo-classes:candidate-for-constraint-validation>制約検証の候補</a>でありかつ<a href=forms.html#concept-fv-valid id=pseudo-classes:concept-fv-valid>制約を満たす</a>要素</li><li>自身が<a href=forms.html#candidate-for-constraint-validation id=pseudo-classes:candidate-for-constraint-validation-2>制約検証の候補</a>であるが<a href=forms.html#concept-fv-valid id=pseudo-classes:concept-fv-valid-2>制約を満た</a>さない任意の要素の<a id=pseudo-classes:form-owner href=forms.html#form-owner>フォーム所有者</a>ではない<code id=pseudo-classes:the-form-element><a href=forms.html#the-form-element>form</a></code>要素</li><li>自身が<a href=forms.html#candidate-for-constraint-validation id=pseudo-classes:candidate-for-constraint-validation-3>制約検証の候補</a>であるが<a href=forms.html#concept-fv-valid id=pseudo-classes:concept-fv-valid-3>制約を満た</a>さない子孫要素を持たない<code id=pseudo-classes:the-fieldset-element-2><a href=forms.html#the-fieldset-element>fieldset</a></code>要素</li></ul>

   <dt><dfn id=selector-invalid><code>:invalid</code></dfn><dd>

    <p><code id=pseudo-classes:selector-invalid><a href=#selector-invalid>:invalid</a></code><a id=pseudo-classes:pseudo-class-19 href=https://triple-underscore.github.io/selectors4-ja.html#pseudo-class data-x-internal=pseudo-class>擬似クラス</a>は、次のカテゴリーのいずれかに分類される任意の要素とマッチしなければならない：</p>

    <ul><li><a href=forms.html#candidate-for-constraint-validation id=pseudo-classes:candidate-for-constraint-validation-4>制約検証の候補</a>であるが<a href=forms.html#concept-fv-valid id=pseudo-classes:concept-fv-valid-4>制約を満た</a>さない要素</li><li>自身が<a href=forms.html#candidate-for-constraint-validation id=pseudo-classes:candidate-for-constraint-validation-5>制約検証の候補</a>であるが<a href=forms.html#concept-fv-valid id=pseudo-classes:concept-fv-valid-5>制約を満た</a>さない1つ以上の要素の<a id=pseudo-classes:form-owner-2 href=forms.html#form-owner>フォーム所有者</a>ではない<code id=pseudo-classes:the-form-element-2><a href=forms.html#the-form-element>form</a></code>要素</li><li>自身が<a href=forms.html#candidate-for-constraint-validation id=pseudo-classes:candidate-for-constraint-validation-6>制約検証の候補</a>であるが<a href=forms.html#concept-fv-valid id=pseudo-classes:concept-fv-valid-6>制約を満た</a>さない1つ以上の子孫要素を持つ<code id=pseudo-classes:the-fieldset-element-3><a href=forms.html#the-fieldset-element>fieldset</a></code>要素</li></ul>

   <dt><dfn id=selector-in-range><code>:in-range</code></dfn><dd>

    <p><code id=pseudo-classes:selector-in-range><a href=#selector-in-range>:in-range</a></code><a id=pseudo-classes:pseudo-class-20 href=https://triple-underscore.github.io/selectors4-ja.html#pseudo-class data-x-internal=pseudo-class>擬似クラス</a>は、<a href=forms.html#candidate-for-constraint-validation id=pseudo-classes:candidate-for-constraint-validation-7>制約検証の候補</a>であり、<a id=pseudo-classes:have-range-limitations href=forms.html#have-range-limitations>範囲に制限があり</a>、<a id=pseudo-classes:suffering-from-an-underflow href=forms.html#suffering-from-an-underflow>アンダーフローに苦しまず</a><a id=pseudo-classes:suffering-from-an-overflow href=forms.html#suffering-from-an-overflow>オーバーフローに苦しまない</a>、すべての要素とマッチしなければならない。</p>

   <dt><dfn id=selector-out-of-range><code>:out-of-range</code></dfn><dd>

    <p><code id=pseudo-classes:selector-out-of-range><a href=#selector-out-of-range>:out-of-range</a></code><a id=pseudo-classes:pseudo-class-21 href=https://triple-underscore.github.io/selectors4-ja.html#pseudo-class data-x-internal=pseudo-class>擬似クラス</a>は、<a href=forms.html#candidate-for-constraint-validation id=pseudo-classes:candidate-for-constraint-validation-8>制約検証の候補</a>であり、<a id=pseudo-classes:have-range-limitations-2 href=forms.html#have-range-limitations>範囲に制限があり</a>、<a id=pseudo-classes:suffering-from-an-underflow-2 href=forms.html#suffering-from-an-underflow>アンダーフローに苦しむ</a>または<a id=pseudo-classes:suffering-from-an-overflow-2 href=forms.html#suffering-from-an-overflow>オーバーフローに苦しむ</a>かのいずれかであるすべての要素とマッチしなければならない。</p>

   <dt><dfn id=selector-required><code>:required</code></dfn><dd>

    <p><code id=pseudo-classes:selector-required><a href=#selector-required>:required</a></code><a id=pseudo-classes:pseudo-class-22 href=https://triple-underscore.github.io/selectors4-ja.html#pseudo-class data-x-internal=pseudo-class>擬似クラス</a>は、次のカテゴリーのいずれかに分類される任意の要素とマッチしなければならない：</p>

    <ul><li><i id=pseudo-classes:concept-input-required><a href=forms.html#concept-input-required>required</a></i>である<code id=pseudo-classes:the-input-element-11><a href=forms.html#the-input-element>input</a></code>要素</li><li><code id=pseudo-classes:attr-select-required><a href=forms.html#attr-select-required>required</a></code>属性を持つ<code id=pseudo-classes:the-select-element-2><a href=forms.html#the-select-element>select</a></code>要素</li><li><code id=pseudo-classes:attr-textarea-required><a href=forms.html#attr-textarea-required>required</a></code>属性を持つ<code id=pseudo-classes:the-textarea-element-3><a href=forms.html#the-textarea-element>textarea</a></code>要素</li></ul>

   <dt><dfn id=selector-optional><code>:optional</code></dfn><dd>

    <p><code id=pseudo-classes:selector-optional><a href=#selector-optional>:optional</a></code><a id=pseudo-classes:pseudo-class-23 href=https://triple-underscore.github.io/selectors4-ja.html#pseudo-class data-x-internal=pseudo-class>擬似クラス</a>は、次のカテゴリーのいずれかに分類される任意の要素とマッチしなければならない：</p>

    <ul><li><i id=pseudo-classes:concept-input-required-2><a href=forms.html#concept-input-required>required</a></i>でない<code id=pseudo-classes:attr-input-required><a href=forms.html#attr-input-required>required</a></code>要素が適用する<code id=pseudo-classes:the-input-element-12><a href=forms.html#the-input-element>input</a></code>要素</li><li><code id=pseudo-classes:attr-select-required-2><a href=forms.html#attr-select-required>required</a></code>属性を持たない<code id=pseudo-classes:the-select-element-3><a href=forms.html#the-select-element>select</a></code>要素</li><li><code id=pseudo-classes:attr-textarea-required-2><a href=forms.html#attr-textarea-required>required</a></code>属性を持たない<code id=pseudo-classes:the-textarea-element-4><a href=forms.html#the-textarea-element>textarea</a></code>要素</li></ul>

   <dt><dfn id=selector-read-only><code>:read-only</code></dfn><dt><dfn id=selector-read-write><code>:read-write</code></dfn><dd>

    <p><code id=pseudo-classes:selector-read-write><a href=#selector-read-write>:read-write</a></code><a id=pseudo-classes:pseudo-class-24 href=https://triple-underscore.github.io/selectors4-ja.html#pseudo-class data-x-internal=pseudo-class>疑似クラス</a>は、セレクターの目的のために<i>ユーザー変更可能</i>とみなされる、次のカテゴリーの1つに分類される任意の要素とマッチしなければならない：[<a href=references.html#refsSELECTORS>SELECTORS</a>]</p>

    <ul><li><code id=pseudo-classes:attr-input-readonly><a href=forms.html#attr-input-readonly>readonly</a></code>属性が適用され、かつ<i id=pseudo-classes:concept-fe-mutable><a href=forms.html#concept-fe-mutable>mutable</a></i>である<code id=pseudo-classes:the-input-element-13><a href=forms.html#the-input-element>input</a></code>要素（すなわち、<code id=pseudo-classes:attr-input-readonly-2><a href=forms.html#attr-input-readonly>readonly</a></code>属性を指定させず、かつ<a href=forms.html#concept-fe-disabled id=pseudo-classes:concept-fe-disabled-2>無効</a>でない）</li><li><code id=pseudo-classes:attr-textarea-readonly><a href=forms.html#attr-textarea-readonly>readonly</a></code>属性を持たず、かつ<a href=forms.html#concept-fe-disabled id=pseudo-classes:concept-fe-disabled-3>無効</a>でない<code id=pseudo-classes:the-textarea-element-5><a href=forms.html#the-textarea-element>textarea</a></code>要素</li><li><a href=https://w3c.github.io/editing/execCommand.html#editing-host id=pseudo-classes:editing-host data-x-internal=editing-host>編集ホスト</a>または<a id=pseudo-classes:editable href=https://w3c.github.io/editing/execCommand.html#editable data-x-internal=editable>編集可能</a>である要素でかつ、<code id=pseudo-classes:the-input-element-14><a href=forms.html#the-input-element>input</a></code>要素でも<code id=pseudo-classes:the-textarea-element-6><a href=forms.html#the-textarea-element>textarea</a></code>要素でもない要素</li></ul>

    <p><code id=pseudo-classes:selector-read-only><a href=#selector-read-only>:read-only</a></code><a id=pseudo-classes:pseudo-class-25 href=https://triple-underscore.github.io/selectors4-ja.html#pseudo-class data-x-internal=pseudo-class>擬似クラス</a>は、他のすべての<a id=pseudo-classes:html-elements href=infrastructure.html#html-elements>HTML要素</a>とマッチしなければならない。</p>

   <dt><dfn id=selector-ltr><code>:dir(ltr)</code></dfn><dd>

    <p><code id=pseudo-classes:selector-ltr><a href=#selector-ltr>:dir(ltr)</a></code><a id=pseudo-classes:pseudo-class-26 href=https://triple-underscore.github.io/selectors4-ja.html#pseudo-class data-x-internal=pseudo-class>擬似クラス</a>は、<a href=dom.html#the-directionality id=pseudo-classes:the-directionality>書字方向</a>が'<a href=dom.html#concept-ltr id=pseudo-classes:concept-ltr>ltr</a>'であるすべての要素とマッチしなければならない。</p>

   <dt><dfn id=selector-rtl><code>:dir(rtl)</code></dfn><dd>

    <p><code id=pseudo-classes:selector-rtl><a href=#selector-rtl>:dir(rtl)</a></code><a id=pseudo-classes:pseudo-class-27 href=https://triple-underscore.github.io/selectors4-ja.html#pseudo-class data-x-internal=pseudo-class>擬似クラス</a>は、<a href=dom.html#the-directionality id=pseudo-classes:the-directionality-2>書字方向</a>が'<a href=dom.html#concept-rtl id=pseudo-classes:concept-rtl>rtl</a>'であるすべての要素とマッチしなければならない。</p>

   </dl>

  <p class=note>セレクター仕様における言語に依存しない方式で十分に詳細に定義されるので、要素が<code>:lang()</code>動的<a id=pseudo-classes:pseudo-class-28 href=https://triple-underscore.github.io/selectors4-ja.html#pseudo-class data-x-internal=pseudo-class>疑似クラス</a>とマッチする場合にこの仕様は定義しない。<a href=references.html#refsSELECTORS>[SELECTORS]</a></p>



  




  <nav><a href=forms.html>← 4.10 フォーム</a> — <a href=index.html>目次</a> — <a href=microdata.html>5 Microdata →</a></nav>
</html>